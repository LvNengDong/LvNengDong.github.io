<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/22/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/22/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/22/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">231</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/09/MySql%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">MySQL基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-10-09 20:32:50" itemprop="dateCreated datePublished" datetime="2020-10-09T20:32:50+08:00">2020-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-10-06 13:48:51" itemprop="dateModified" datetime="2021-10-06T13:48:51+08:00">2021-10-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySql/" itemprop="url" rel="index"><span itemprop="name">MySql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/MySQL%E5%9F%BA%E7%A1%80.png"></p>
<h1 id="1、数据库介绍"><a href="#1、数据库介绍" class="headerlink" title="1、数据库介绍"></a>1、数据库介绍</h1><h2 id="1-1、是什么"><a href="#1-1、是什么" class="headerlink" title="1.1、是什么"></a>1.1、是什么</h2><ul>
<li>  数据库 == <strong>存储数据的仓库</strong>，</li>
<li>  数据库本质上是一个<strong>文件</strong>，我们可以称之为文件系统，与普通的文件相比多了便于管理的特点。</li>
</ul>
<h3 id="1-1-1、常见数据的存储方式"><a href="#1-1-1、常见数据的存储方式" class="headerlink" title="1.1.1、常见数据的存储方式"></a>1.1.1、常见数据的存储方式</h3><table>
<thead>
<tr>
<th align="left">存储位置</th>
<th align="left">优点</th>
<th align="left">缺点</th>
<th align="left">举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">内存</td>
<td align="left">存取速度快</td>
<td align="left">不能永久保存，数据是临时状态</td>
<td align="left">Java中创建的对象</td>
</tr>
<tr>
<td align="left">文件</td>
<td align="left">数据可以永久保存</td>
<td align="left">数据操作不方便，查询数据时不方便</td>
<td align="left">通过Java的IO流，把临时数据保存到文件中</td>
</tr>
<tr>
<td align="left">数据库<br>(文件的一种)</td>
<td align="left">1、数据可以永久保存<br>2、查询速度快<br>3、对数据的管理方便</td>
<td align="left">占用资源，需要购买</td>
<td align="left">MySQL</td>
</tr>
</tbody></table>
<h2 id="1-2、数据库的好处"><a href="#1-2、数据库的好处" class="headerlink" title="1.2、数据库的好处"></a>1.2、数据库的好处</h2><ol>
<li> 可以持久化数据到本地</li>
<li> 结构化查询</li>
</ol>
<h2 id="1-3、数据库管理系统"><a href="#1-3、数据库管理系统" class="headerlink" title="1.3、数据库管理系统"></a>1.3、数据库管理系统</h2><h3 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h3><ul>
<li>  数据库管理系统(DBMS)是管理和操作数据库的<strong>软件</strong>。</li>
<li>  数据库管理系统可由 <strong>DOS窗口</strong> 或 <strong>SQLyog</strong> 等软件充当。</li>
</ul>
<h3 id="能干什么"><a href="#能干什么" class="headerlink" title="能干什么"></a>能干什么</h3><ul>
<li>  用户通过DBMS <strong>访问数据库中的数据</strong>。</li>
</ul>
<h2 id="1-3、DBMS、DB-和表的关系"><a href="#1-3、DBMS、DB-和表的关系" class="headerlink" title="1.3、DBMS、DB 和表的关系"></a>1.3、DBMS、DB 和表的关系</h2><p>​        数据库管理系统(DBMS)可以管理多个数据库，一般开发人员会针对每一个应用创建一个数据库，每个数据库中又会创建多个表，以保存程序中的实体类数据。</p>
<blockquote>
<p>  数据库管理系统、数据库和表的关系如图所示：</p>
</blockquote>
<p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/image-20201008221624101.png" alt="image-20201008221624101"></p>
<hr>
<h1 id="2、SQL-概述"><a href="#2、SQL-概述" class="headerlink" title="2、SQL 概述"></a>2、SQL 概述</h1><h2 id="2-1、是什么"><a href="#2-1、是什么" class="headerlink" title="2.1、是什么"></a>2.1、是什么</h2><blockquote>
<p>  <strong>SQL；Structured Query Language；结构化查询语言；</strong></p>
</blockquote>
<ul>
<li>  顾名思义，<strong>最主要的功能是查询</strong>。</li>
<li>  SQL 是一种<strong>所有关系型数据库通用的查询规范</strong>。可以作用在不同的数据库中，当然不同数据库的 SQL 也有一些细小的区别区别。打个比方就是 SQL 就是普通话，而不同的数据库实现（如MySQL、Oracle等）可以实现自己的方言。</li>
</ul>
<h2 id="2-2、SQL-分类"><a href="#2-2、SQL-分类" class="headerlink" title="2.2、SQL 分类"></a>2.2、SQL 分类</h2><p>虽然 SQL 最主要的功能是查询，但也实现了基本的增删改的功能。按照功能可将 SQL 划分为以下 4 类：</p>
<blockquote>
<ul>
<li><strong>DDL（Data Definition Language）：建库、建表</strong></li>
<li><strong>DML（Data Manipulation Language）：对表中的记录进行CRUD</strong></li>
<li><strong>DQL</strong></li>
<li><strong>DCL：授权、收权</strong></li>
</ul>
</blockquote>
<h2 id="2-3、MySQL"><a href="#2-3、MySQL" class="headerlink" title="2.3、MySQL"></a>2.3、MySQL</h2><p>MySQL 是 SQL 的一个具体落地产品。</p>
<blockquote>
<p>  <strong>MySQL的 启动 &amp; 登录 &amp; 退出：</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 MySQL 服务</span></span><br><span class="line">net start mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭 MySQL 服务</span></span><br><span class="line">net stop mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">方式1【本地登录】</span></span><br><span class="line">	mysql -u用户名 -p密码	</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">方式2</span></span><br><span class="line">	mysql -hip地址 -u用户名 -p密码	</span><br><span class="line">	mysql -h127.0.0.1 -uroot -proot</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">方式3</span></span><br><span class="line">	mysql --h=ip地址 --user=用户名 --password=密码	</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出</span></span><br><span class="line">quit 或 exit</span><br></pre></td></tr></table></figure>



<h3 id="MySql数据类型"><a href="#MySql数据类型" class="headerlink" title="MySql数据类型"></a>MySql数据类型</h3><table>
<thead>
<tr>
<th align="center">大类</th>
<th align="center">小类</th>
<th align="center">类型说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center"><code>tinyInt</code></td>
<td align="center">微整型，<code>1Byte</code>，<code>8bit</code></td>
</tr>
<tr>
<td align="center"><strong>整数类型</strong></td>
<td align="center"><code>smallInt</code></td>
<td align="center">微整型，<code>2Byte</code>，<code>16bit</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>mediumint</code></td>
<td align="center">微整型，<code>3Byte</code>，<code>24bit</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>int</code></td>
<td align="center">整型，<code>4Byte</code>，<code>32bit</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>小数类型</strong></td>
<td align="center"><code>float</code></td>
<td align="center">单精度浮点数，<code>4Byte</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>double</code></td>
<td align="center">双精度浮点数，<code>8Byte</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>time</code></td>
<td align="center">时间类型，<code>HH:MM:SS</code></td>
</tr>
<tr>
<td align="center"><strong>日期类型</strong></td>
<td align="center"><code>date</code></td>
<td align="center">日期类型，<code>YYYY-MM-DD</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>datetime</code></td>
<td align="center">同时可以表示日期和时间类型，<code>YYYY-MM-DD HH:MM:SS</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>字符串</strong></td>
<td align="center"><code>char(x)</code></td>
<td align="center">固定长度的字符串，无论使用几个字符都占满全部</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>varchar(x)</code></td>
<td align="center">可变长度的字符串，使用几个字符就占用几个</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>大二进制</strong></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>大文本</strong></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<hr>
<h1 id="3、DDL"><a href="#3、DDL" class="headerlink" title="3、DDL"></a>3、DDL</h1><blockquote>
<p><strong>DDL；Data Definition Language；数据定义语言；</strong></p>
</blockquote>
<ul>
<li>  主要用于：<strong>建库、建表</strong></li>
</ul>
<p><strong>如何理解？</strong></p>
<p>数据定义语言，可以理解为给数据分类，定义数据的类型，即哪些数据属于 A 类，哪些数据属于 B 类。</p>
<p>建库、建表就是给数据分类的过程。也就是定义数据类型的过程。库是大类型，表是小类型。比如有一批数据需要处理，我们可以先定义一批数据库，比如腾讯公司的数据放在数据库 A，阿里的数据放在数据库 B；建表则是子类型，如在腾讯的数据中包含了员工数据和部门数据，我们可以将员工数据保存在 emp 表中，将部门数据保存在 dep 表中。通过 【<strong>库 + 表</strong>】 的分类方式我们可以将全部的数据划分为不同的类型。</p>
<h2 id="3-1、数据库操作"><a href="#3-1、数据库操作" class="headerlink" title="3.1、数据库操作"></a>3.1、数据库操作</h2><h3 id="1、创建数据库-create"><a href="#1、创建数据库-create" class="headerlink" title="1、创建数据库[create]"></a>1、创建数据库[create]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 创建数据库</span><br><span class="line">create database db1;</span><br><span class="line"></span><br><span class="line">-- 2. 当数据库不存在时，再创建数据库</span><br><span class="line">create database if not exists db1;</span><br><span class="line"></span><br><span class="line">-- 3. 创建数据库并指定字符集</span><br><span class="line">create database db1 [default] character set utf8;		-- `utf-8` 在这里写为 `utf8`</span><br></pre></td></tr></table></figure>

<h3 id="2、查看数据库-show"><a href="#2、查看数据库-show" class="headerlink" title="2、查看数据库[show]"></a>2、查看数据库[show]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 1、查看所有的数据库</span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">-- 2、查看某个数据库的创建语句</span><br><span class="line">show create database db1;</span><br></pre></td></tr></table></figure>

<h3 id="3、修改数据库-alter"><a href="#3、修改数据库-alter" class="headerlink" title="3、修改数据库[alter]"></a>3、修改数据库[alter]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 修改数据库默认字符集</span><br><span class="line">Alter database db1 Default Character set gbk;</span><br></pre></td></tr></table></figure>

<h3 id="4、删除数据库-drop"><a href="#4、删除数据库-drop" class="headerlink" title="4、删除数据库[drop]"></a>4、删除数据库[drop]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop database db1;</span><br><span class="line">drop database if exists db1;</span><br></pre></td></tr></table></figure>

<h3 id="5、使用数据库"><a href="#5、使用数据库" class="headerlink" title="5、使用数据库"></a>5、使用数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 使用/切换数据库</span><br><span class="line">use db1;</span><br><span class="line"></span><br><span class="line">-- 查看正在使用的数据库</span><br><span class="line">select database();</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="3-2、表操作"><a href="#3-2、表操作" class="headerlink" title="3.2、表操作"></a>3.2、表操作</h2><h3 id="1、建表-create"><a href="#1、建表-create" class="headerlink" title="1、建表[create]"></a>1、建表[create]</h3><ol>
<li><p>创建表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">-- 字段1	 字段类型1，</span><br><span class="line">    id			int(8),</span><br><span class="line">    name		varchar(20),</span><br><span class="line">    birthday	date</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li><p>创建表的同时指定</p>
<ul>
<li>存储引擎，缺省值是 InnoDB；</li>
<li>字符集（优先级大于对整个数据库全局设置字符集）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">-- 字段1	 字段类型1，</span><br><span class="line">    id			int(8),</span><br><span class="line">    name		varchar(20),</span><br><span class="line">    birthday	date</span><br><span class="line">)engine=InnoDB [Default] CharSet=utf8;</span><br></pre></td></tr></table></figure>

<p><strong>Tip：建表时如果想要同时指定存储引擎，则指定存储引擎的设置信息一定要放在最前面指定，否则会报错。</strong></p>
</li>
<li><p>快速创建相同结构相同的表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table new_user like user;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2、查看表-show-DESC"><a href="#2、查看表-show-DESC" class="headerlink" title="2、查看表[show/DESC]"></a>2、查看表[show/DESC]</h3><ol>
<li><p>查看当前数据库下的所有表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure></li>
<li><p>查看某个具体表的结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC user；</span><br></pre></td></tr></table></figure></li>
<li><p>查看创建某个具体表的SQL语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table user;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3、删除表-drop"><a href="#3、删除表-drop" class="headerlink" title="3、删除表[drop]"></a>3、删除表[drop]</h3><ol>
<li><p>直接删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table user;</span><br></pre></td></tr></table></figure></li>
<li><p>判断是否存在，存在则删除表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists user;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4、修改表结构"><a href="#4、修改表结构" class="headerlink" title="4、修改表结构"></a>4、修改表结构</h3><ol>
<li><p>修改表名<code>[alter table ...rename to...]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 方式1：</span><br><span class="line">alter table 表名 rename to 新表名;</span><br><span class="line">alter table users rename to user;</span><br><span class="line"></span><br><span class="line">-- 方式2：</span><br><span class="line">rename table 表名 to 新表名;</span><br><span class="line">RENAME TABLE users TO USER;</span><br></pre></td></tr></table></figure></li>
<li><p>修改字符集<code>[alter table... character set...]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aLter table 表名 character set 字符集;</span><br><span class="line">alter table user character set utf8;</span><br></pre></td></tr></table></figure></li>
<li><p>新增一列<code>[alter table...add...]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add 列名 类型;</span><br><span class="line">ALTER TABLE user ADD hobby VARCHAR(32);</span><br></pre></td></tr></table></figure></li>
<li><p>修改列类型<code>[alter table...modify...]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 MODIFY 列名 新的类型;</span><br><span class="line">ALTER TABLE user MODIFY hobby INT(3);</span><br></pre></td></tr></table></figure></li>
<li><p>修改列名<code>[alter table... change...]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 change 列名 新列名 类型;</span><br><span class="line">ALTER TABLE user CHANGE hobby newhobby VARCHAR(23);</span><br></pre></td></tr></table></figure></li>
<li><p>删除列<code>[alter table...drop...]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop 列名;</span><br><span class="line">ALTER TABLE user DROP newhobby;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="4、DML"><a href="#4、DML" class="headerlink" title="4、DML"></a>4、DML</h1><blockquote>
<p><strong>DML；Data Manipulation Language；数组操作语言</strong></p>
</blockquote>
<p>操作的数据是表中的记录，主要用于<strong>对表中的记录进行增删改</strong>操作</p>
<h2 id="4-1、增"><a href="#4-1、增" class="headerlink" title="4.1、增"></a>4.1、增</h2><h3 id="1、插入记录"><a href="#1、插入记录" class="headerlink" title="1、插入记录"></a>1、插入记录</h3><p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/%E6%8F%92%E5%85%A5%E8%AE%B0%E5%BD%95.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">insert [into] 表名 </span><br><span class="line">[(字段名)] </span><br><span class="line">values</span><br><span class="line">(字段值)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO USER			-- 插入哪个表</span><br><span class="line">(username, passsword)		 -- 插入哪些字段</span><br><span class="line">VALUES						-- 表示插入数据</span><br><span class="line">(&quot;李四&quot;,&quot;8546&quot;)				-- 具体数据</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>insert的注意事项:</strong></p>
</blockquote>
<ol>
<li> 没有添加数据的字段会使用<code>NULL</code>填充。</li>
<li> 字符和<strong>日期型</strong>数据应该包含在引号中。</li>
</ol>
<h3 id="2、蠕虫复制"><a href="#2、蠕虫复制" class="headerlink" title="2、蠕虫复制"></a>2、蠕虫复制</h3><p>​        将一张表中的数据复制到另一张表中。<strong>蠕虫复制</strong>只复制表数据，而不复制表结构，所以使用前必须保证向新表中插入数据时数据类型不会冲突。【最简单的方式可以使用<code>create table... like...</code>快速创建一张结构相同的表】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 1、将表user1中的所有数据复制到user2中</span><br><span class="line">insert into user2 select * from user1</span><br><span class="line"></span><br><span class="line">-- 2、将表user1中的部分列数据复制到user2中</span><br><span class="line">insert into user2(username, password) select username, password from user1</span><br></pre></td></tr></table></figure>





<h2 id="4-2、删"><a href="#4-2、删" class="headerlink" title="4.2、删"></a>4.2、删</h2><h3 id="1、删除表记录"><a href="#1、删除表记录" class="headerlink" title="1、删除表记录"></a>1、删除表记录</h3><ol>
<li><p>删除表中的所有记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from user; </span><br></pre></td></tr></table></figure></li>
<li><p>删除表中的指定记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from user where 条件表达式;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>使用<code>truncate</code>删除表中的记录</strong></p>
<ul>
<li>相当于删除表的结构，再重建一张表【只能在删除所有数据时使用】</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table user;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="4-3、改"><a href="#4-3、改" class="headerlink" title="4.3、改"></a>4.3、改</h2><h3 id="1、更新表记录"><a href="#1、更新表记录" class="headerlink" title="1、更新表记录"></a>1、更新表记录</h3><ol>
<li><p>更新某列上所有行的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update user</span><br><span class="line">set username=&quot;擎天柱&quot;; </span><br></pre></td></tr></table></figure></li>
<li><p>更新某列上的部分行的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update user </span><br><span class="line">set username=&quot;擎天柱&quot; </span><br><span class="line">[where 条件表达式]</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="5、DQL"><a href="#5、DQL" class="headerlink" title="5、DQL"></a>5、DQL</h1><blockquote>
<p><strong>DQL；Data QueryLanguage；</strong></p>
</blockquote>
<ul>
<li>  主要用于查询表中的记录。</li>
<li>  查询结果是一个虚拟表</li>
</ul>
<h2 id="5-1、简单查询"><a href="#5-1、简单查询" class="headerlink" title="5.1、简单查询"></a>5.1、简单查询</h2><p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2.png"></p>
<ol>
<li><p>查询表中所有记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user;</span><br></pre></td></tr></table></figure></li>
<li><p>查询所有记录的某几列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id,name,age from user;</span><br></pre></td></tr></table></figure></li>
<li><p>清除重复值查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct * from user;</span><br></pre></td></tr></table></figure></li>
<li><p>查询结果参与运算</p>
<ul>
<li>某列数据和固定值运算</li>
<li>某列数据和其他列数据进行运算</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 列名1 + 固定值 from 表名;</span><br><span class="line">select math + 5 form student; </span><br><span class="line"></span><br><span class="line"># ---------------------------------------</span><br><span class="line"></span><br><span class="line">select 列名1 + 列名2 from 表名;</span><br><span class="line">select *, (math+age) as 总成绩 form student; </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>参与运算的元素必须是数值类型</strong></li>
</ul>
</li>
</ol>
<hr>
<h2 id="5-2、条件查询"><a href="#5-2、条件查询" class="headerlink" title="5.2、条件查询"></a>5.2、条件查询</h2><h3 id="1、语法"><a href="#1、语法" class="headerlink" title="1、语法"></a>1、语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select 字段名</span><br><span class="line">from 表名</span><br><span class="line">where 条件;</span><br></pre></td></tr></table></figure>

<h3 id="2、运算符"><a href="#2、运算符" class="headerlink" title="2、运算符"></a>2、运算符</h3><h4 id="2-1、比较运算符"><a href="#2-1、比较运算符" class="headerlink" title="2.1、比较运算符"></a>2.1、比较运算符</h4><table>
<thead>
<tr>
<th align="center">比较运算符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>&gt;、&gt;=、&lt;、&lt;=、=、&lt;&gt;</code></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>between...and</code></td>
<td align="center">前后都是闭区间</td>
</tr>
<tr>
<td align="center"><code>in(集合)</code></td>
<td align="center">集合中的数据使用逗号分隔</td>
</tr>
<tr>
<td align="center"><code>like &#39;%李%&#39;</code></td>
<td align="center">模糊查询</td>
</tr>
<tr>
<td align="center"><code>is null</code></td>
<td align="center">不能写成<code>=NULL</code></td>
</tr>
</tbody></table>
<h5 id="2-1-1、通配符"><a href="#2-1-1、通配符" class="headerlink" title="2.1.1、通配符"></a>2.1.1、通配符</h5><table>
<thead>
<tr>
<th align="center">通配符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>%</code></td>
<td align="center">匹配任意多个字符串</td>
</tr>
<tr>
<td align="center"><code>_</code></td>
<td align="center">匹配一个字符串</td>
</tr>
</tbody></table>
<h4 id="2-2、逻辑运算符"><a href="#2-2、逻辑运算符" class="headerlink" title="2.2、逻辑运算符"></a>2.2、逻辑运算符</h4><table>
<thead>
<tr>
<th align="center">逻辑运算符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>and</code></td>
<td align="center">与</td>
</tr>
<tr>
<td align="center"><code>or</code></td>
<td align="center">或</td>
</tr>
<tr>
<td align="center"><code>not</code></td>
<td align="center">非</td>
</tr>
</tbody></table>
<hr>
<h2 id="5-3、排序查询"><a href="#5-3、排序查询" class="headerlink" title="5.3、排序查询"></a>5.3、排序查询</h2><blockquote>
<ul>
<li><strong>单列排序</strong>：只按某一个字段进行排序。</li>
<li><strong>组合排序</strong>：同时对多个字段进行排序，如果第1个字段相等，则按第2个字段排序，以此类推。</li>
</ul>
</blockquote>
<p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/%E6%8E%92%E5%BA%8F.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 排序[DESC/ASC]</span><br><span class="line">select 字段名</span><br><span class="line">from 表名</span><br><span class="line">where 条件</span><br><span class="line">order by 字段名 DESC					-- 单列排序</span><br><span class="line">order by age DESC, grade ASC		   -- 组合排序[在age降序的基础上，对于年龄相同的再按grade升序]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>排序只影响数据的展示顺序，而不会影响数据库中数据的保存顺序。</p>
</blockquote>
<hr>
<h2 id="5-4、聚合函数"><a href="#5-4、聚合函数" class="headerlink" title="5.4、聚合函数"></a>5.4、聚合函数</h2><ul>
<li>  之前我们做的查询都是横向查询，它们都是根据条件一行一行的进行判断。    而使用聚合函数查询则是<strong>纵向查询</strong>，它是对一列的值进行计算，然后返回一个结果值。</li>
<li>  聚合函数是对横向查询结果值的统计，首先必须要经过横向查询这一步骤，只是没有在最后展示出来，展示出来的是聚合后的结果。</li>
</ul>
<p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/5%E4%B8%AA%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0.png"></p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select 聚合函数(列名) form 表名;</span><br><span class="line">select count(*) from user;</span><br><span class="line">select max(age) from user;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  <strong>聚合函数注意事项</strong>：</p>
</blockquote>
<p><strong>聚合函数会自动忽略 <code>NULL</code> 值对应的记录</strong></p>
<p>聚合函数不会统计<code>NULL</code>对应的记录，建议统计时尽量不要选择有可能为<code>NULL</code>的字段。</p>
<p>如果要求需要把 <code>NULL</code> 也统计进去的话，可以使用<code>ifnull()</code>函数将 <code>NULL</code> 值转换为一个自定义值，这样统计个数时就不会遗漏。</p>
<ul>
<li><p><code>IFNULL()</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IFNULL(列名, 自定义值)	-- 如果列名不为NULL，返回原值；如果为NULL，返回自定义的值。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 查询id字段，如果为null，则使用0代替</span><br><span class="line">select ifnull(id, 0) form user;</span><br></pre></td></tr></table></figure></li>
<li><p><code>聚合函数 + ifnull()函数</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(ifnull(id, 0)) form user;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="5-5、分组"><a href="#5-5、分组" class="headerlink" title="5.5、分组"></a>5.5、分组</h2><ul>
<li>  <strong>group by</strong> 的真正执行顺序在 WHERE 之后，一般情况下是对经过 WHRER 筛选后的中间表继续进行分组，同类型的数据作为一组。</li>
<li>  一般当我们使用某个字段对数据进行分组后，在查询的时候最好将这个字段查询出来，否则看不到查询的数据是属于哪一组的。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 分组</span><br><span class="line">select 字段名</span><br><span class="line">from 表名</span><br><span class="line">group by 分组字段</span><br><span class="line">[having 条件]</span><br></pre></td></tr></table></figure>



<h3 id="1、having-和-where的区别"><a href="#1、having-和-where的区别" class="headerlink" title="1、having 和 where的区别"></a>1、having 和 where的区别</h3><table>
<thead>
<tr>
<th align="center">where</th>
<th align="center">having</th>
</tr>
</thead>
<tbody><tr>
<td align="center">在分组之前执行</td>
<td align="center">在分组之后执行</td>
</tr>
<tr>
<td align="center"><em><code>where</code>后面不可以使用聚合函数</em></td>
<td align="center"><em><code>having</code>后面可以使用聚合函数</em></td>
</tr>
</tbody></table>
<hr>
<h2 id="5-6、分页"><a href="#5-6、分页" class="headerlink" title="5.6、分页"></a>5.6、分页</h2><h3 id="1、语法-1"><a href="#1、语法-1" class="headerlink" title="1、语法"></a>1、语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">limit [offset,] length;</span><br><span class="line">-- offset：起始行数，从0开始。如果省略，缺省值就是0。</span><br><span class="line">-- length：返回的行数。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查询user表中的数据，从第3条开始显示，显示6条</span><br><span class="line">select * from user </span><br><span class="line">limit 2,6</span><br></pre></td></tr></table></figure>







<hr>
<h1 id="6、DCL"><a href="#6、DCL" class="headerlink" title="6、DCL"></a>6、DCL</h1><blockquote>
<p>DCL；Data Control Language；</p>
</blockquote>
<ul>
<li>  DCL 主要用于 <strong>授权（grant）、收权（revoke）</strong>。</li>
</ul>
<p>我们在自己的电脑上安装的数据库使用的都是root超级管理员用户，拥有全部的权限。    </p>
<p>在实际公司中，一个数据库服务器上一般同时运行着很多个项目的数据库，一般的编程人员是不可能拥有超级管理员权限的，所以我们应该根据不同的项目创建不同的用户，分配不同的权限来管理和维护数据库。</p>
<hr>
<h1 id="7、数据库表的约束"><a href="#7、数据库表的约束" class="headerlink" title="7、数据库表的约束"></a>7、数据库表的约束</h1><blockquote>
<p>对表中的数据进行限定，保证数据的正确性、有效性和完整性。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">约束名</th>
<th align="center">关键字</th>
</tr>
</thead>
<tbody><tr>
<td align="center">主键</td>
<td align="center"><code>primary key</code></td>
</tr>
<tr>
<td align="center">唯一</td>
<td align="center"><code>unique</code></td>
</tr>
<tr>
<td align="center">非空</td>
<td align="center"><code>not null</code></td>
</tr>
<tr>
<td align="center">外键</td>
<td align="center"><code>foreign key</code></td>
</tr>
<tr>
<td align="center">检查约束</td>
<td align="center"><code>check[MySQL不支持]</code></td>
</tr>
</tbody></table>
<h2 id="7-1、主键约束"><a href="#7-1、主键约束" class="headerlink" title="7.1、主键约束"></a>7.1、主键约束</h2><blockquote>
<p>用来唯一标识数据库中的每一条记录。</p>
</blockquote>
<ul>
<li>通常不用业务字段作为主键，而是单独给每张表设计一个<code>id</code>字段作为主键。[主键是给数据库和程序使用的，不是展示给用户看的，所以主键有没有含义没关系，只要<strong>唯一、非空</strong>即可]</li>
</ul>
<h3 id="1、创建表的时候添加主键"><a href="#1、创建表的时候添加主键" class="headerlink" title="1、创建表的时候添加主键"></a>1、创建表的时候添加主键</h3><ol>
<li><p>格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 primary key</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">	id int(8) primary key,	</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2、已有表中添加主键"><a href="#2、已有表中添加主键" class="headerlink" title="2、已有表中添加主键"></a>2、已有表中添加主键</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add primary key(字段名);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table users add primary key(id);</span><br></pre></td></tr></table></figure>

<h3 id="3、删除主键"><a href="#3、删除主键" class="headerlink" title="3、删除主键"></a>3、删除主键</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop primary key(字段名);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table users drop primary key;</span><br></pre></td></tr></table></figure>

<h3 id="4、主键自增"><a href="#4、主键自增" class="headerlink" title="4、主键自增"></a>4、主键自增</h3><blockquote>
<p><code>auto_increment</code>    表示主键自增（字段类型必须是整数类型）</p>
</blockquote>
<ol>
<li><p>创建表时指定起始值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 修改自增长的默认起始值[默认起始值是1]</span><br><span class="line">create table 表名(</span><br><span class="line">	列名 int primary key auto_increment	</span><br><span class="line">)auto_increment=起始值;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">	id int primary key auto_increment	</span><br><span class="line">)auto_increment=3;</span><br></pre></td></tr></table></figure></li>
<li><p>建表完成后修改自增长起始值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 auto_increment=起始值;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table user auto_increment=3;</span><br></pre></td></tr></table></figure></li>
<li><p><code>delete</code> 和 <code>truncate</code> 对自增长的影响：</p>
<ul>
<li><code>delete</code>：删除所有记录后，自增长没有影响，从上次记录出继续增长；</li>
<li><code>truncate</code>：删除后，自增重新从 0 开始。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="7-2、唯一约束"><a href="#7-2、唯一约束" class="headerlink" title="7.2、唯一约束"></a>7.2、唯一约束</h2><h3 id="1、语法-2"><a href="#1、语法-2" class="headerlink" title="1、语法"></a>1、语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 unique</span><br></pre></td></tr></table></figure>

<h3 id="2、某一列中存在多个NULL符合唯一约束吗？"><a href="#2、某一列中存在多个NULL符合唯一约束吗？" class="headerlink" title="2、某一列中存在多个NULL符合唯一约束吗？"></a>2、某一列中存在多个NULL符合唯一约束吗？</h3><ul>
<li>符合，<code>NULL</code>没有数据，不存在重复的问题。</li>
</ul>
<hr>
<h2 id="7-3、非空约束"><a href="#7-3、非空约束" class="headerlink" title="7.3、非空约束"></a>7.3、非空约束</h2><blockquote>
<p>某一列不能为<code>NULL</code></p>
</blockquote>
<h3 id="1、语法-3"><a href="#1、语法-3" class="headerlink" title="1、语法"></a>1、语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 NOT NULL</span><br></pre></td></tr></table></figure>

<h3 id="2、默认值"><a href="#2、默认值" class="headerlink" title="2、默认值"></a>2、默认值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 Default 默认值</span><br></pre></td></tr></table></figure>

<h3 id="3、如果一个字段设置了非空和唯一约束，该字段和主键的区别？"><a href="#3、如果一个字段设置了非空和唯一约束，该字段和主键的区别？" class="headerlink" title="3、如果一个字段设置了非空和唯一约束，该字段和主键的区别？"></a>3、如果一个字段设置了非空和唯一约束，该字段和主键的区别？</h3><ol>
<li>一个表中只能有一个主键，而可以同时有多个具有非空且唯一约束的字段(列)。【虽然主键只能有一个，但是主键可以是单个字段(列)，也可以是多个字段(列)（复合主键）】</li>
<li>自增长只能用在主键上。</li>
</ol>
<hr>
<h2 id="7-4、外键约束"><a href="#7-4、外键约束" class="headerlink" title="7.4、外键约束"></a>7.4、外键约束</h2><h3 id="1、单表保存数据的缺点"><a href="#1、单表保存数据的缺点" class="headerlink" title="1、单表保存数据的缺点"></a>1、单表保存数据的缺点</h3><ol>
<li>数据冗余。</li>
<li>增删改存在问题。</li>
</ol>
<h3 id="2、什么是外键约束"><a href="#2、什么是外键约束" class="headerlink" title="2、什么是外键约束"></a>2、什么是外键约束</h3><ol>
<li>什么是外键<ul>
<li>在从表中与主表主键对应的那一列。</li>
</ul>
</li>
<li><strong>主表</strong><ul>
<li><strong>一方</strong>，用来限制从表。</li>
</ul>
</li>
<li><strong>从表</strong><ul>
<li><strong>多方</strong>：使用主表的数据，被主表限制。【外键位于从表中】</li>
</ul>
</li>
</ol>
<h3 id="3、外键约束的语法"><a href="#3、外键约束的语法" class="headerlink" title="3、外键约束的语法"></a>3、外键约束的语法</h3><ol>
<li><p>新建表时增加外键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 外键约束与其它类型约束在格式上不同的地方在于：其它约束可以直接跟在字段类型后面，</span><br><span class="line"># 而外键约束需要另起一行专门书写，与字段之间用逗号`,`分开。</span><br><span class="line">[constraint] [外键约束名称] foreign key(外键字段名) references 主表名(主键字段名);</span><br></pre></td></tr></table></figure></li>
<li><p>已有表中增加外键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 从表名 add [constraint] [外键约束名称] foreign key(外键字段名) references 主表名(主键字段名);</span><br></pre></td></tr></table></figure></li>
<li><p>删除外键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 从表名 drop foreign key [外键约束名称];</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4、外键的级联操作"><a href="#4、外键的级联操作" class="headerlink" title="4、外键的级联操作"></a>4、外键的级联操作</h3><h4 id="4-1、是什么？"><a href="#4-1、是什么？" class="headerlink" title="4.1、是什么？"></a>4.1、是什么？</h4><ul>
<li>  <strong>在修改和删除主表的主键时，同时更新或删除从表的外键值</strong>，称为级联操作。</li>
</ul>
<h4 id="4-2、级联操作语法"><a href="#4-2、级联操作语法" class="headerlink" title="4.2、级联操作语法"></a>4.2、级联操作语法</h4><ul>
<li><strong>只能在创建表的时候创建级联关系，创建表完成之后不能再修改级联关系了</strong>。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">级联操作</th>
<th align="center">语法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">级联更新</td>
<td align="center"><code>on update cascade</code></td>
<td align="center">更新主表中的主键，从表中的外键列也自动同步更新</td>
</tr>
<tr>
<td align="center">级联删除</td>
<td align="center"><code>on delete cascade</code></td>
<td align="center">删除主表中的主键，从表中的外键列也自动同步更新</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table emp(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    dep_id int,		-- 外键列</span><br><span class="line">    foreign key (dep_id) references department(id) on update casade on delete casade</span><br><span class="line">)</span><br></pre></td></tr></table></figure>







<hr>
<h1 id="8、表与表之间的关系"><a href="#8、表与表之间的关系" class="headerlink" title="8、表与表之间的关系"></a>8、表与表之间的关系</h1><p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/%E8%A1%A8%E4%B8%8E%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB.png"></p>
<hr>
<h1 id="9、数据库设计"><a href="#9、数据库设计" class="headerlink" title="9、数据库设计"></a>9、数据库设计</h1><h2 id="9-1、数据库范化"><a href="#9-1、数据库范化" class="headerlink" title="9.1、数据库范化"></a>9.1、数据库范化</h2><h3 id="1、是什么？"><a href="#1、是什么？" class="headerlink" title="1、是什么？"></a>1、是什么？</h3><ul>
<li>  顾名思义，数据库范化就是数据库规范化。    </li>
<li>  好的数据库设计对数据库的存储性能和后期程序的开发都会产生重要的影响，建立科学的，规范的数据库就需要满足一些规范来优化数据的存储和设计，这些规范就称为范式。</li>
<li>  总结：<strong>范式就是设计一个好的、规范的数据库需要满足的规范</strong>。</li>
</ul>
<h2 id="9-2、数据库范式"><a href="#9-2、数据库范式" class="headerlink" title="9.2、数据库范式"></a>9.2、数据库范式</h2><p>目前关系型数据库共有6种范式：</p>
<blockquote>
<ul>
<li>  第一范式（1NF）</li>
<li>  第二范式（2NF）</li>
<li>  第三范式（3NF）</li>
<li>  第四范式（4NF）</li>
<li>  第五范式（5NF，又称为完美范式）</li>
<li>  巴斯-科德范式（BCNF）</li>
</ul>
</blockquote>
<ul>
<li>  一般来说，数据库设计满足第三范式（3NF）就可以了。</li>
<li>  高等级的范式必然满足低等级范式的需求。</li>
<li>  范式的等级越高，数据库越完美，但速度越慢。（满足的要求多必然是要以运行速度作为代价的）</li>
</ul>
<blockquote>
<p>  <strong>三大范式小结</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">范式</th>
<th align="left">特点</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><em>1NF</em></td>
<td align="left">原子性：表中每列不可再拆分</td>
</tr>
<tr>
<td align="center"><em>2NF</em></td>
<td align="left">消除局部依赖[，一张表只描述一件事情]</td>
</tr>
<tr>
<td align="center"><em>3NF</em></td>
<td align="left">消除传递依赖[，表中的每一列都直接依赖于主键，而不是通过其它列间接依赖于主键]</td>
</tr>
</tbody></table>
<hr>
<h2 id="9-3-三大范式"><a href="#9-3-三大范式" class="headerlink" title="9.3    三大范式"></a>9.3    三大范式</h2><blockquote>
<p>  <strong>数据库表</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">学号</th>
<th align="center">姓名</th>
<th align="center">系名</th>
<th align="center">系主任</th>
<th align="center">课程名称</th>
<th align="center">分数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1000</td>
<td align="center">黄猿</td>
<td align="center">经济系</td>
<td align="center">卡普</td>
<td align="center">高等数学</td>
<td align="center">95</td>
</tr>
<tr>
<td align="center">1000</td>
<td align="center">黄猿</td>
<td align="center">经济系</td>
<td align="center">卡普</td>
<td align="center">大学英语</td>
<td align="center">87</td>
</tr>
<tr>
<td align="center">1000</td>
<td align="center">黄猿</td>
<td align="center">经济系</td>
<td align="center">卡普</td>
<td align="center">计算机基础</td>
<td align="center">65</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">王路飞</td>
<td align="center">体育系</td>
<td align="center">三木</td>
<td align="center">人体构造学</td>
<td align="center">77</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">王路飞</td>
<td align="center">体育系</td>
<td align="center">三木</td>
<td align="center">大学英语</td>
<td align="center">87</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">王路飞</td>
<td align="center">体育系</td>
<td align="center">三木</td>
<td align="center">实践课</td>
<td align="center">79</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">王篮球</td>
<td align="center">体育系</td>
<td align="center">三木</td>
<td align="center">人体构造学</td>
<td align="center">90</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">王篮球</td>
<td align="center">体育系</td>
<td align="center">三木</td>
<td align="center">大学英语</td>
<td align="center">86</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">王篮球</td>
<td align="center">体育系</td>
<td align="center">三木</td>
<td align="center">实践课</td>
<td align="center">74</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"><del>计算机系</del></td>
<td align="center"><del>柯南</del></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p>当前数据库表的设计存在的问题：</p>
<ol>
<li><p> 存在非常严重的数据冗余：姓名、系名、系主任；</p>
</li>
<li><p> 数据添加存在问题：假设新开设系和系主任时，由于没有学生，数据不合法</p>
</li>
<li><p>数据删除存在问题：假设某一个系的所有同学都毕业了，在将这些同学的数据删除时，会将系的数据一起删除。</p>
<p> 假设体育系的所有同学（这里只有两个）全都毕业了，在删除王路飞和王篮球的个人信息后，发现表中关于体育系的全部信息也被一起删除了，这是不合理的。</p>
</li>
</ol>
<h3 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h3><blockquote>
<p>  <strong>函数依赖</strong></p>
</blockquote>
<ul>
<li>  如果通过 A 属性（属性组）的值，可以确定唯一的 B 属性的值，则称 B 依赖于 A。</li>
<li>  表示为：<code>A --&gt; B</code></li>
<li>  例如：<code>学号 --&gt; 姓名</code>    <code>（学号，课程名称） --&gt; 分数</code></li>
</ul>
<blockquote>
<p>  <strong>完全函数依赖</strong></p>
</blockquote>
<ul>
<li>  如果通过 A 属性组中所有的值，才可以确定唯一的 B 属性的值，则称 B 完全依赖于 A。</li>
<li>  表示为：<code>(A1 &amp; A2 &amp; ...) --&gt; B</code></li>
<li>  例如：<code>（学号 &amp; 课程名称） --&gt; 分数</code></li>
</ul>
<blockquote>
<p>  <strong>部分函数依赖</strong></p>
</blockquote>
<ul>
<li>  如果通过 A 属性组中的部分值，就可以确定唯一的 B 属性的值，则称 B 部分依赖于 A。</li>
<li>  表示为：<code>(A1, A2, A3) --&gt; B ，但是 (A1, A2) --&gt; B</code> </li>
<li>  例如：<code>（学号, 课程名称） --&gt; 姓名</code> ，但是仅仅只有学号也能唯一确定姓名，课程名称是可有可无的条件。</li>
</ul>
<blockquote>
<p>  <strong>传递函数依赖</strong></p>
</blockquote>
<ul>
<li>  如果通过 A 属性（属性组）的值，可以确定唯一 B 属性（属性组）的值，再通过 B 属性（属性组）的值可以确定唯一 C 属性的值，则称 C 属性（属性组）的值，则称 C 传递依赖于 A。</li>
<li>  表示为：<code>A --&gt; B, B --&gt; C  ==&gt; C 传递依赖于 A </code></li>
<li>  例如：<code>学号 --&gt; 系名，系名 --&gt; 系主任</code></li>
</ul>
<blockquote>
<p>  <strong>码</strong></p>
</blockquote>
<ul>
<li>  在一张表中，如果一个属性（属性组），被其它所有属性完全依赖，则称这个属性（属性组）为该表的码。</li>
<li>  例如：该表中的码为：<code>（学号+课程名称）</code></li>
<li>  <strong>主属性</strong>：码属性组中的所有属性。</li>
<li>  <strong>非主属性</strong>：码属性（组）之外的属性。</li>
</ul>
<h3 id="三大范式"><a href="#三大范式" class="headerlink" title="三大范式"></a>三大范式</h3><ul>
<li>  <strong>第一范式（1NF）</strong>：数据库表中的每一列都是不可分割的原子数据项。</li>
<li>  <strong>第二范式（2NF）</strong>：在 1NF 的基础上，非码属性必须完全依赖于码。[消除局部依赖]</li>
<li>  <strong>第三范式（3NF）</strong>：在 2NF 的基础上，任何非主属性不依赖于其它非主属性。[消除传递依赖]</li>
</ul>
<blockquote>
<p>  <strong>第二范式</strong></p>
</blockquote>
<p>在上文的数据库表中，存在局部依赖，所以将数据库表拆分成两张表：</p>
<ul>
<li>  <strong>成绩表</strong>[分数完全依赖于 （学号+课程名称）]</li>
</ul>
<table>
<thead>
<tr>
<th align="center">学号</th>
<th align="center">课程名称</th>
<th align="center">分数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1000</td>
<td align="center">高等数学</td>
<td align="center">95</td>
</tr>
<tr>
<td align="center">1000</td>
<td align="center">大学英语</td>
<td align="center">87</td>
</tr>
<tr>
<td align="center">1000</td>
<td align="center">计算机基础</td>
<td align="center">65</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">人体构造学</td>
<td align="center">77</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">大学英语</td>
<td align="center">87</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">实践课</td>
<td align="center">79</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">人体构造学</td>
<td align="center">90</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">大学英语</td>
<td align="center">86</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">实践课</td>
<td align="center">74</td>
</tr>
</tbody></table>
<ul>
<li>  <strong>学生表</strong>[（姓名，系名，系主任）完全依赖于学号]</li>
</ul>
<table>
<thead>
<tr>
<th align="center">学号</th>
<th align="center">姓名</th>
<th align="center">系名</th>
<th align="center">系主任</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1000</td>
<td align="center">黄猿</td>
<td align="center">经济系</td>
<td align="center">卡普</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">王路飞</td>
<td align="center">体育系</td>
<td align="center">三木</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">王篮球</td>
<td align="center">体育系</td>
<td align="center">三木</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"><del>计算机系</del></td>
<td align="center"><del>柯南</del></td>
</tr>
</tbody></table>
<p><strong>2NF 解决的问题：</strong></p>
<ol>
<li> <del>存在非常严重的数据冗余：姓名、系名、系主任</del>；</li>
<li> 数据添加存在问题：假设新开设系和系主任时，由于没有学生，数据不合法</li>
<li> 数据删除存在问题：假设某一个系的所有同学都毕业了，在将这些同学的数据删除时，会将系的数据一起删除。</li>
</ol>
<blockquote>
<p>  <strong>第三范式</strong></p>
</blockquote>
<p>第二范式解决不了的问题，可以交给第三范式来解决，在上文的学生表中还存在传递依赖：<code>学号 --&gt; 系名, 系名 --&gt; 系主任</code>，即系主任传递依赖于学号。所以可以将学生表再进行拆分：</p>
<ul>
<li>  学生表</li>
</ul>
<table>
<thead>
<tr>
<th align="center">学号</th>
<th align="center">姓名</th>
<th align="center">系名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1000</td>
<td align="center">黄猿</td>
<td align="center">经济系</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">王路飞</td>
<td align="center">体育系</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">王篮球</td>
<td align="center">体育系</td>
</tr>
</tbody></table>
<ul>
<li>  <strong>系表</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="center">系名</th>
<th align="center">系主任</th>
</tr>
</thead>
<tbody><tr>
<td align="center">经济系</td>
<td align="center">卡普</td>
</tr>
<tr>
<td align="center">体育系</td>
<td align="center">三木</td>
</tr>
<tr>
<td align="center">计算机系</td>
<td align="center">柯南</td>
</tr>
</tbody></table>
<p><strong>3NF 解决的问题：</strong></p>
<ol>
<li> <del>数据添加存在问题：假设新开设系和系主任时，由于没有学生，数据不合法</del></li>
<li> <del>数据删除存在问题：假设某一个系的所有同学都毕业了，在将这些同学的数据删除时，会将系的数据一起删除。</del></li>
</ol>
<hr>
<h1 id="10、多表查询"><a href="#10、多表查询" class="headerlink" title="10、多表查询"></a>10、多表查询</h1><h2 id="10-1、多表查询分类"><a href="#10-1、多表查询分类" class="headerlink" title="10.1、多表查询分类"></a>10.1、多表查询分类</h2><p><img src="/2020/10/09/MySql%E5%9F%BA%E7%A1%80/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB.png"></p>
<h2 id="10-2、笛卡尔积"><a href="#10-2、笛卡尔积" class="headerlink" title="10.2、笛卡尔积"></a>10.2、笛卡尔积</h2><h3 id="1、是什么"><a href="#1、是什么" class="headerlink" title="1、是什么"></a>1、是什么</h3><h3 id="2、为什么要消除笛卡尔积"><a href="#2、为什么要消除笛卡尔积" class="headerlink" title="2、为什么要消除笛卡尔积"></a>2、为什么要消除笛卡尔积</h3><ul>
<li>我们发现由并不是所有由笛卡尔积连接起来的数据组合都是有用的，所以需要通过设置条件过滤掉没有用的数据。</li>
</ul>
<h3 id="3、如何消除笛卡尔积？"><a href="#3、如何消除笛卡尔积？" class="headerlink" title="3、如何消除笛卡尔积？"></a>3、如何消除笛卡尔积？</h3><ul>
<li>使用<strong>内连接</strong>连接两张关系表。</li>
</ul>
<hr>
<h2 id="10-3、内连接"><a href="#10-3、内连接" class="headerlink" title="10.3、内连接"></a>10.3、内连接</h2><h3 id="1、隐式内连接"><a href="#1、隐式内连接" class="headerlink" title="1、隐式内连接"></a>1、隐式内连接</h3><ul>
<li>  不使用 <strong>join</strong> 关键字，而是使用 <strong>where</strong> 关键字连接两张表。</li>
</ul>
<h3 id="2、显式内连接"><a href="#2、显式内连接" class="headerlink" title="2、显式内连接"></a>2、显式内连接</h3><ul>
<li>  使用<code>[inner] join... on</code>语句连接2张关系表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表1 [inner] join 表2 on 条件</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="10-3、外连接"><a href="#10-3、外连接" class="headerlink" title="10.3、外连接"></a>10.3、外连接</h2><h3 id="1、左外连接"><a href="#1、左外连接" class="headerlink" title="1、左外连接"></a>1、左外连接</h3><blockquote>
<p>使用<code>left [outer] join... on</code>连接2张表</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表1 left [outer] join 表2 on 条件</span><br></pre></td></tr></table></figure>



<h3 id="2、右外连接"><a href="#2、右外连接" class="headerlink" title="2、右外连接"></a>2、右外连接</h3><blockquote>
<p>使用<code>right [outer] join... on</code>连接2张表</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表1 right [outer] join 表2 on 条件</span><br></pre></td></tr></table></figure>



<h3 id="3、全外连接"><a href="#3、全外连接" class="headerlink" title="3、全外连接"></a>3、全外连接</h3><hr>
<h1 id="11、子查询"><a href="#11、子查询" class="headerlink" title="11、子查询"></a>11、子查询</h1><h2 id="11-1、是什么"><a href="#11-1、是什么" class="headerlink" title="11.1、是什么"></a>11.1、是什么</h2><blockquote>
<ol>
<li>一个查询语句的结果作为另一个查询的条件；</li>
<li>有查询的嵌套，内部的查询称为子查询；</li>
<li>子查询的结果需要使用小括号括起来。</li>
</ol>
</blockquote>
<h2 id="11-1、子查询的3种情况"><a href="#11-1、子查询的3种情况" class="headerlink" title="11.1、子查询的3种情况"></a>11.1、子查询的3种情况</h2><h3 id="1、子查询的结果是单行单列"><a href="#1、子查询的结果是单行单列" class="headerlink" title="1、子查询的结果是单行单列"></a>1、子查询的结果是单行单列</h3><blockquote>
<p>子查询的结果是单行单列。肯定是在<code>where</code>后面作为条件，父查询一般使用比较运算符，如：<code>&gt;、&lt;、=、&lt;&gt;</code>等。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from 表1 </span><br><span class="line">where 字段=(子查询)</span><br></pre></td></tr></table></figure>



<h3 id="2、子查询的结果是多行单列"><a href="#2、子查询的结果是多行单列" class="headerlink" title="2、子查询的结果是多行单列"></a>2、子查询的结果是多行单列</h3><blockquote>
<p>子查询的结果是多行单列。</p>
<p>可以跟在<code>from</code>后面作为表；</p>
<p>也可以跟在<code>where</code>后面作为条件，父查询使用<code>IN</code>运算符。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select * from (子查询) 表别名</span><br><span class="line">where 字段 like %李%;</span><br><span class="line"></span><br><span class="line">-- ---------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">select * from 表1 </span><br><span class="line">where 字段 in (子查询);</span><br></pre></td></tr></table></figure>





<h3 id="3、子查询的结果是多列"><a href="#3、子查询的结果是多列" class="headerlink" title="3、子查询的结果是多列"></a>3、子查询的结果是多列</h3><blockquote>
<p>子查询的结果只要是多列，肯定在<code>from</code>后面作为表。</p>
</blockquote>
<p><strong>Tip：子查询作为表时必须为这张表取一个别名，否则这张表没有名称则无法访问表中的数据。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from (子查询) 表别名</span><br><span class="line">where 条件;</span><br></pre></td></tr></table></figure>







<hr>
<h1 id="12、事务"><a href="#12、事务" class="headerlink" title="12、事务"></a>12、事务</h1><p><a href>超链接</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/07/SpringCloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/07/SpringCloud/" class="post-title-link" itemprop="url">SpringCould</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-10-07 22:09:31" itemprop="dateCreated datePublished" datetime="2020-10-07T22:09:31+08:00">2020-10-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-09-03 22:31:09" itemprop="dateModified" datetime="2021-09-03T22:31:09+08:00">2021-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringCould/" itemprop="url" rel="index"><span itemprop="name">SpringCould</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1、系统架构演变"><a href="#1、系统架构演变" class="headerlink" title="1、系统架构演变"></a>1、系统架构演变</h1><p>随着互联网的发展，网站应用的规模不断扩大。需求的激增，带来的是技术上的压力。系统架构也因此也不断的演进、升级、迭代。从单一应用，到垂直拆分，到分布式服务，到SOA，以及现在火热的微服务架构。</p>
<p><img src="/2020/10/07/SpringCloud/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%BC%94%E5%8F%98.png"></p>
<p>​    </p>
<h2 id="1-1-集中式架构"><a href="#1-1-集中式架构" class="headerlink" title="1.1. 集中式架构"></a>1.1. 集中式架构</h2><p>当网站流量很小时，只需一个应用，就可以将所有功能都部署在一起，减少了部署节点和成本。</p>
<p><em>此时，用于简化增删改查工作量的数据访问框架(ORM)是影响项目开发的关键。</em></p>
<p> <img src="/2020/10/07/SpringCloud/1525529091749.png" alt="1525529091749"></p>
<blockquote>
<p>存在的问题：</p>
<ul>
<li>代码耦合度高，开发维护困难</li>
<li>无法针对不同模块进行针对性优化</li>
<li>无法水平扩展</li>
<li>单点容错率低，并发能力差[单点容错率低：应用程序部署在一个服务器上，一旦该服务器出现故障，那么该程序就直接挂了]</li>
</ul>
</blockquote>
<hr>
<h2 id="1-2-垂直拆分"><a href="#1-2-垂直拆分" class="headerlink" title="1.2.垂直拆分"></a>1.2.垂直拆分</h2><p>当访问量逐渐增大，单一应用无法满足需求，此时为了应对更高的并发和业务需求，我们根据业务功能对系统进行拆分：</p>
<p> <img src="/2020/10/07/SpringCloud/1525529671801.png" alt="1525529671801"></p>
<blockquote>
<p><strong>优点</strong>：</p>
<ul>
<li>不同业务功能部署在不同的服务器上，系统拆分实现了流量分担，解决了并发问题</li>
<li>可以对不同模块进行针对性优化</li>
<li>方便水平扩展，负载均衡，容错率提高</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li><em>系统间相互独立，会有很多重复开发工作，影响开发效率</em></li>
</ul>
</blockquote>
<hr>
<h2 id="1-3-分布式服务"><a href="#1-3-分布式服务" class="headerlink" title="1.3.分布式服务"></a>1.3.分布式服务</h2><p>当垂直应用越来越多，应用之间交互不可避免，将<strong>通用业务</strong>抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。</p>
<p>此时，用于提高业务复用及整合的分布式调用是关键。</p>
<p> <img src="/2020/10/07/SpringCloud/1525530657919.png" alt="1525530657919"></p>
<blockquote>
<p>优点：</p>
<ul>
<li>将基础服务进行了抽取，供系统中的其它模块调用，提高了代码复用和开发效率</li>
</ul>
<p>缺点：</p>
<ul>
<li><em>系统间耦合度变高，调用关系错综复杂，难以维护</em></li>
</ul>
</blockquote>
<h2 id="1-4-服务治理（SOA）"><a href="#1-4-服务治理（SOA）" class="headerlink" title="1.4.服务治理（SOA）"></a>1.4.服务治理（SOA）</h2><blockquote>
<p><strong><code>SOA(Service-Oriented Architecture)：面向服务的架构</code></strong> </p>
</blockquote>
<p>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的 <strong>资源调度和治理中心(SOA)</strong> 是关键。</p>
<p><img src="/2020/10/07/SpringCloud/1525530804753.png" alt="1525530804753"></p>
<blockquote>
<p><strong>Before：</strong></p>
<ul>
<li>服务越来越多，需要管理每个服务的地址</li>
<li>调用关系错综复杂，难以理清依赖关系</li>
<li>服务过多，服务状态难以管理，无法根据服务情况动态管理</li>
</ul>
<p><strong>After：</strong></p>
<ul>
<li>服务注册中心，实现了服务自动注册和发现，无需人为记录服务地址</li>
<li>服务自动订阅，服务列表自动推送，服务调用透明化，无需关心依赖关系</li>
<li>动态监控服务状态监控报告，人为控制服务状态</li>
</ul>
<p>缺点：</p>
<ul>
<li>服务间会有依赖关系，一旦某个环节出错会影响较大</li>
<li>服务关系复杂，运维、测试部署困难，不符合DevOps思想</li>
</ul>
</blockquote>
<h2 id="1-5-微服务"><a href="#1-5-微服务" class="headerlink" title="1.5.微服务"></a>1.5.微服务</h2><p>前面说的SOA，英文翻译过来是面向服务。微服务，似乎也是服务，都是对系统进行拆分。因此两者非常容易混淆，但其实缺有一些差别：</p>
<p><img src="/2020/10/07/SpringCloud/1525532344817.png" alt="1525532344817"></p>
<blockquote>
<p>微服务的特点：</p>
<ul>
<li><strong>单一职责</strong>：微服务中每一个服务都对应唯一的业务能力，做到单一职责</li>
<li>微：微服务的服务拆分粒度很小，例如一个用户管理就可以作为一个服务。每个服务虽小，但“五脏俱全”。</li>
<li><strong>面向服务</strong>：面向服务是说每个服务都对外暴露服务接口。并不关心接口调用方的技术实现，做到与平台和语言无关，也不限定用什么技术实现，只要提供Rest的接口即可。</li>
<li><strong>自治</strong>：自治是说服务间互相独立，互不干扰<ul>
<li>团队独立：每个服务都是一个独立的开发团队，人数不能过多。</li>
<li>技术独立：因为是面向服务，提供Rest接口，使用什么技术没有别人干涉</li>
<li>前后端分离：采用前后端分离开发，提供统一Rest接口，后端不用再为PC、移动段开发不同接口</li>
<li>数据库分离：每个服务都使用自己的数据源</li>
<li>部署独立，服务间虽然有调用，但要做到服务重启不影响其它服务。有利于持续集成和持续交付。每个服务都是独立的组件，可复用，可替换，降低耦合，易维护</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>微服务结构图</strong>：</p>
<p><img src="/2020/10/07/SpringCloud/1526860071166.png" alt="1526860071166"></p>
<p><strong>微服务 vs. SOA</strong></p>
<ol>
<li>微服务比SOA更细粒度。</li>
<li>每个微服务都是一个独立的服务，而每个SOA并不一定是独立的服务。</li>
</ol>
<hr>
<h1 id="2、远程调用方式"><a href="#2、远程调用方式" class="headerlink" title="2、远程调用方式"></a>2、远程调用方式</h1><p>无论是微服务还是SOA，都面临着服务间的远程调用。那么服务间的远程调用方式有哪些呢？</p>
<blockquote>
<p>常见的远程调用方式有以下几种：</p>
<ol>
<li><code>RPC(Remote Produce Call)</code>：<strong>远程过程调用</strong><ul>
<li>类似的还有RMI。自定义数据格式，基于原生TCP通信，速度快，效率高。早期的webservice，现在热门的dubbo，都是RPC的典型</li>
</ul>
</li>
<li><code>Http</code>：<ul>
<li>http其实是一种网络传输协议，基于TCP，规定了数据传输的格式。现在客户端浏览器与服务端通信基本都是采用Http协议。也可以用来进行远程服务调用。缺点是消息封装臃肿。</li>
<li>现在热门的Rest风格，就可以通过http协议来实现。</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="2-1、RPC"><a href="#2-1、RPC" class="headerlink" title="2.1、RPC"></a>2.1、RPC</h2><p>RPC是一个计算机通信协议。 该协议允许运行于一台计算机的程序调用另一台计算机的子程序，而程序员无需额外地为这个交互作用编程。说得通俗一点就是：A计算机提供一个服务，B计算机可以像调用本地服务那样调用A计算机的服务。</p>
<blockquote>
<p>通过上面的概念，我们可以知道，实现RPC主要是做到两点： </p>
<ul>
<li><strong>实现远程调用其他计算机的服务</strong>[远程调用]<ul>
<li>要实现远程调用，肯定是通过网络传输数据。A程序提供服务，B程序通过网络将请求数据传递给A，A本地执行后得到结果，再将结果返回给B程序。这里需要关注的有两点：<ul>
<li>1）采用何种网络通讯协议？<ul>
<li>现在比较流行的RPC框架，都会采用TCP作为底层传输协议</li>
</ul>
</li>
<li>2）数据传输的格式怎样？<ul>
<li>两个程序进行通讯，必须约定好数据传输格式。就好比两个人聊天，要用同一种语言，否则无法沟通。所以，我们必须定义好请求和响应的格式。另外，数据在网络中传输需要进行序列化，所以还需要约定统一的序列化的方式。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>像调用本地服务一样调用远程服务</strong> [过程调用]<ul>
<li>如果仅仅是远程调用，还不算是RPC，因为RPC强调的是过程调用，调用的过程对用户而言是应该是透明的，用户不应该关心调用的细节，可以像调用本地服务一样调用远程服务。所以RPC一定要对调用的过程进行封装。</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>RPC调用流程图</strong>：</p>
<p><img src="/2020/10/07/SpringCloud/1525568965976.png" alt="1525568965976"></p>
<h2 id="2-2、HTTP"><a href="#2-2、HTTP" class="headerlink" title="2.2、HTTP"></a>2.2、HTTP</h2><p>HTTP协议(超文本传输协议)是一种应用层协议。规定了网络传输的请求格式、响应格式、资源定位和操作的方式等。但是底层采用什么网络传输协议，并没有规定，不过现在都是采用TCP协议作为底层传输协议。说到这里，大家可能觉得，Http与RPC的远程调用非常像，都是按照某种规定好的数据格式进行网络通信，有请求，有响应。没错，在这点来看，两者非常相似，但是还是有一些细微差别。</p>
<blockquote>
<ul>
<li>RPC协议并没有规定数据传输格式，这个格式可以任意指定，不同的RPC协议，数据格式不一定相同。</li>
<li>HTTP协议中还定义了资源定位的路径，RPC中并不需要</li>
<li>RPC需要满足像调用本地服务一样调用远程服务，也就是说会在API层面对调用过程进行封装。Http协议没有这样的要求，因此请求、响应等细节需要我们自己去实现。  <strong>[Http请求没有对调用过程进行封装，也就是说，本来由浏览器进行的对Http请求和响应的封装现在要我们自己在Java代码中实现]</strong><ul>
<li>优点：RPC方式更加透明，对用户更方便。HTTP方式更灵活，没有规定API和语言，跨语言、跨平台</li>
<li>缺点：RPC方式需要在API层面进行封装，限制了开发的语言环境。</li>
</ul>
</li>
</ul>
</blockquote>
<p>例如我们通过浏览器访问网站，就是通过HTTP协议。只不过浏览器把请求封装，发起请求以及接收响应，解析响应的事情都帮我们做了。如果是不通过浏览器，那么这些事情都需要自己去完成。</p>
<p><img src="/2020/10/07/SpringCloud/1525569352313.png" alt="1525569352313"></p>
<h2 id="2-3、如何选择？"><a href="#2-3、如何选择？" class="headerlink" title="2.3、如何选择？"></a>2.3、如何选择？</h2><p>既然两种方式都可以实现远程调用，我们该如何选择呢？</p>
<ul>
<li>速度来看，RPC要比HTTP更快，虽然底层都是TCP，但是HTTP协议的信息往往比较臃肿，不过可以采用gzip压缩。</li>
<li>难度来看，RPC实现较为复杂，HTTP相对比较简单</li>
<li>灵活性来看，HTTP更胜一筹，因为它不关心实现细节，跨平台、跨语言。</li>
</ul>
<p>因此，两者都有不同的使用场景：</p>
<ul>
<li>如果对效率要求更高，并且开发过程使用统一的技术栈，那么用RPC还是不错的。</li>
<li>如果需要更加灵活，跨语言、跨平台，显然http更合适</li>
</ul>
<p>那么我们该怎么选择呢？</p>
<p>微服务，更加强调的是独立、自治、灵活。而RPC方式的限制较多，因此微服务框架中，一般都会采用基于Http的Rest风格服务。</p>
<hr>
<h1 id="3、HTTP客户端工具"><a href="#3、HTTP客户端工具" class="headerlink" title="3、HTTP客户端工具"></a>3、HTTP客户端工具</h1><blockquote>
<p>因为Spring Cloud 使用HTTP作为远程调用协议，那我们就必须自己来实现对请求和响应的处理。</p>
<p>但是开源世界已经有很多的HTTP客户端工具，已经帮我们封装好了这些功能，对外提供简单的接口。</p>
<p>常见的HTTP客户端工具有：</p>
<ul>
<li><code>HttpClient</code></li>
<li><code>OKHttp</code></li>
<li><code>URLConnection</code></li>
</ul>
<p>所以说这些HTTP客户端的作用就类似于客户端上的浏览器，发起请求和处理响应。</p>
</blockquote>
<h2 id="3-1、HttpClient"><a href="#3-1、HttpClient" class="headerlink" title="3.1、HttpClient"></a>3.1、HttpClient</h2><blockquote>
<p>HttpClient是Apache公司的产品，是HTTP Components下的一个组件。</p>
<p><a target="_blank" rel="noopener" href="http://hc.apache.org/index.html">官网地址：http://hc.apache.org/index.html</a></p>
</blockquote>
<p>特点：</p>
<ul>
<li>基于标准、纯净的Java语言。实现了Http1.0和Http1.1</li>
<li>以可扩展的面向对象的结构实现了Http全部的方法（GET, POST, PUT, DELETE, HEAD, OPTIONS, and TRACE）</li>
<li>支持HTTPS协议。</li>
<li>通过HTTP代理建立透明的连接。</li>
<li>自动处理Set-Cookie中的Cookie。</li>
</ul>
<hr>
<h3 id="3-1-1、使用"><a href="#3-1-1、使用" class="headerlink" title="3.1.1、使用"></a>3.1.1、使用</h3><ol>
<li><p>导入依赖；</p>
</li>
<li><p>发起GET请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="built_in">this</span>.httpClient.execute(request, <span class="keyword">new</span> <span class="title class_">BasicResponseHandler</span>());</span><br><span class="line">    System.out.println(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>发起Post请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPost</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://www.oschina.net/&quot;</span>);</span><br><span class="line">    request.setHeader(<span class="string">&quot;User-Agent&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="built_in">this</span>.httpClient.execute(request, <span class="keyword">new</span> <span class="title class_">BasicResponseHandler</span>());</span><br><span class="line">    System.out.println(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-1-2、Json转换工具"><a href="#3-1-2、Json转换工具" class="headerlink" title="3.1.2、Json转换工具"></a>3.1.2、Json转换工具</h3><ul>
<li><a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2020/11/25/json%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8CJava%E5%AF%B9%E8%B1%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/">传送门：json字符串和Java对象之间的相互转换</a></li>
</ul>
<blockquote>
<p>通过HTTP协议进行远程调用时传递的消息格式都是字符串格式，所以在Java程序中我们需要手动进行<strong>序列化/反序列化</strong>，我们可以使用<code>JacksonJson工具</code>来实现。    </p>
</blockquote>
<p>访问本地服务器上的项目：<code>http://localhost/hello</code>，返回结果一个User对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetPojo</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://localhost/hello&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="built_in">this</span>.httpClient.execute(request, <span class="keyword">new</span> <span class="title class_">BasicResponseHandler</span>());</span><br><span class="line">    System.out.println(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们实际得到的是一个json字符串，如果想要得到对象，我们还需要手动进行Json反序列化，这一点比较麻烦。</p>
<hr>
<h2 id="3-2、Spring的RestTemplate"><a href="#3-2、Spring的RestTemplate" class="headerlink" title="3.2、Spring的RestTemplate"></a>3.2、Spring的RestTemplate</h2><blockquote>
<p>Spring提供了一个RestTemplate模板工具类，在HTTP客户端工具的基础上再做了一次封装，简化了开发。比如：</p>
<ul>
<li>实现了对象与json的自动序列化和反序列化。</li>
</ul>
<p>RestTemplate是一个接口，并没有限定HTTP工具类的种类，而是在上层进行了抽象，目前常用的3种都有支持：</p>
<ul>
<li><code>HttpClient</code></li>
<li><code>OkHttpJDK</code></li>
<li><code>原生的URLConnection（默认的）</code></li>
</ul>
</blockquote>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><ol>
<li><p>首先在项目的Spring容器中注册一个<code>RestTemplate</code>对象，可以在启动类位置注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(HttpDemoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 默认的RestTemplate，底层是JDK的URLConnection实现方式。</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在测试类中直接<code>@Autowired</code>注入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = HttpDemoApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">httpGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 请求目标URL，并将返回的JSON字符串反序列化到User对象中</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.restTemplate.getForObject(<span class="string">&quot;http://localhost/hello&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过<code>RestTemplate对象</code>的<code>getForObject()方法</code>，传递URL地址及响应结果实体类的字节码，<code>RestTemplate</code>会自动发起请求，接收响应，并且帮我们对响应结果进行反序列化。</p>
</blockquote>
</li>
</ol>
<hr>
<h1 id="4、SpringCloud"><a href="#4、SpringCloud" class="headerlink" title="4、SpringCloud"></a>4、SpringCloud</h1><blockquote>
<p>微服务是一种架构方式，并不是具体的技术架构。</p>
<p>微服务的实现方式很多，Spring Cloud只是其中一种实现方式。</p>
</blockquote>
<h2 id="4-1、简介"><a href="#4-1、简介" class="headerlink" title="4.1、简介"></a>4.1、简介</h2><blockquote>
<p>SpringCloud是Spring旗下的项目之一。Spring最擅长的就是集成，把世界上最好的框架拿过来，集成到自己的项目中。SpringCloud也是一样，它将现在非常流行的一些技术整合到一起，实现了诸如：<strong>配置管理，服务发现，智能路由，负载均衡，熔断器，控制总线，集群状态</strong>等等功能。其主要涉及的组件包括：</p>
<ul>
<li>Eureka：注册中心</li>
<li>Zuul：服务网关</li>
<li>Ribbon：负载均衡</li>
<li>Feign：服务调用</li>
<li>Hystix：熔断器</li>
<li>……</li>
</ul>
</blockquote>
<p>以上只是其中一部分，架构图：</p>
<p><img src="/2020/10/07/SpringCloud/1525575656796.png" alt="1525575656796"></p>
<h2 id="4-2、版本"><a href="#4-2、版本" class="headerlink" title="4.2、版本"></a>4.2、版本</h2><blockquote>
<p>SpringCloud的版本命名比较特殊，因为它不是一个组件，而是许多组件的集合，它的命名是以A到Z的为首字母的一些单词组成。</p>
</blockquote>
<h1 id="5、微服务入门"><a href="#5、微服务入门" class="headerlink" title="5、微服务入门"></a>5、微服务入门</h1><h2 id="5-1-服务提供者"><a href="#5-1-服务提供者" class="headerlink" title="5.1.服务提供者"></a>5.1.服务提供者</h2><p>我们新建一个项目，对外提供查询用户的服务。</p>
<h3 id="5-1-1-Spring脚手架创建工程"><a href="#5-1-1-Spring脚手架创建工程" class="headerlink" title="5.1.1.Spring脚手架创建工程"></a>5.1.1.Spring脚手架创建工程</h3><p>借助于Spring提供的快速搭建工具：</p>
<p><img src="/2020/10/07/SpringCloud/1525576816916.png" alt="1525576816916"></p>
<p>填写项目信息：</p>
<p> <img src="/2020/10/07/SpringCloud/1525576909381.png" alt="1525576909381"></p>
<p>添加web依赖：</p>
<p><img src="/2020/10/07/SpringCloud/1525576950842.png" alt="1525576950842"></p>
<p>添加mybatis依赖：</p>
<p><img src="/2020/10/07/SpringCloud/1525576999052.png" alt="1525576999052"></p>
<p>填写项目位置：</p>
<p><img src="/2020/10/07/SpringCloud/1525577029150.png" alt="1525577029150"></p>
<p>生成的项目结构：</p>
<p> <img src="/2020/10/07/SpringCloud/1525577106711.png" alt="1525577106711"></p>
<p>依赖也已经全部自动引入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>user-service-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>user-service-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当然，因为要使用通用mapper，所以我们需要手动加一条依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-1-2-编写代码"><a href="#5-1-2-编写代码" class="headerlink" title="5.1.2.编写代码"></a>5.1.2.编写代码</h3><p>添加一个对外查询的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userService.queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">tk</span>.mybatis.mapper.common.Mapper&lt;User&gt;&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name = &quot;tb_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密码</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 姓名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 年龄</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 性别，1男性，2女性</span></span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 出生日期</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date created;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新时间</span></span><br><span class="line">    <span class="keyword">private</span> Date updated;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 备注</span></span><br><span class="line">    <span class="keyword">private</span> String note;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 。。。省略getters和setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>属性文件,这里我们采用了<code>yml</code>语法，而不是<code>properties</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mydb01</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.leyou.userservice.pojo</span></span><br></pre></td></tr></table></figure>



<p>项目结构：</p>
<p> <img src="/2020/10/07/SpringCloud/1525577911331.png" alt="1525577911331"></p>
<h3 id="5-1-3-启动并测试："><a href="#5-1-3-启动并测试：" class="headerlink" title="5.1.3.启动并测试："></a>5.1.3.启动并测试：</h3><p>启动项目，访问接口：<code>http://localhost:8081/user/7</code></p>
<p> <img src="/2020/10/07/SpringCloud/1525593139364.png" alt="1525593139364"></p>
<h2 id="5-2-服务调用者"><a href="#5-2-服务调用者" class="headerlink" title="5.2.服务调用者"></a>5.2.服务调用者</h2><h3 id="5-2-1-创建工程"><a href="#5-2-1-创建工程" class="headerlink" title="5.2.1.创建工程"></a>5.2.1.创建工程</h3><p>与上面类似，这里不再赘述，需要注意的是，我们调用user-service的功能，因此不需要mybatis相关依赖了。</p>
<p>pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>user-consumer-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>user-consumer-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加OkHttp支持 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-2-2-编写代码"><a href="#5-2-2-编写代码" class="headerlink" title="5.2.2.编写代码"></a>5.2.2.编写代码</h3><p>首先在启动类中注册<code>RestTemplate</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConsumerDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 这次我们使用了OkHttp客户端,只需要注入工厂即可</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(<span class="keyword">new</span> <span class="title class_">OkHttp3ClientHttpRequestFactory</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserConsumerDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>然后编写UserDao，注意，这里不是调用mapper查数据库，而是通过RestTemplate远程查询user-service-demo中的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + id;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.restTemplate.getForObject(response, User.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>然后编写user-service，循环查询UserDAO信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">querUserByIds</span><span class="params">(List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.userDao.queryUserById(id);</span><br><span class="line">            users.add(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;consume&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">consume</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userService.queryUserByIds(ids);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-2-3-启动测试："><a href="#5-2-3-启动测试：" class="headerlink" title="5.2.3.启动测试："></a>5.2.3.启动测试：</h3><p>因为我们没有配置端口，那么默认就是8080，我们访问：<code>http://localhost:8080/consume?ids=6,7,8</code></p>
<p> <img src="/2020/10/07/SpringCloud/1525594222408.png" alt="1525594222408"></p>
<p>一个简单的远程服务调用案例就实现了。</p>
<h2 id="5-3-有没有问题？"><a href="#5-3-有没有问题？" class="headerlink" title="5.3.有没有问题？"></a>5.3.有没有问题？</h2><p>简单回顾一下，刚才我们写了什么：</p>
<ul>
<li>use-service-demo：一个提供根据id查询用户的微服务</li>
<li>consumer-demo：一个服务调用者，通过RestTemplate远程调用user-service-demo</li>
</ul>
<p>流程如下：</p>
<p><img src="/2020/10/07/SpringCloud/1525595012668.png" alt="1525595012668"></p>
<blockquote>
<p>  存在什么问题？</p>
</blockquote>
<ul>
<li>在consumer中，我们把url地址硬编码到了代码中，不方便后期维护</li>
<li>consumer需要记忆user-service的地址，如果出现变更，可能得不到通知，地址将失效</li>
<li>consumer不清楚user-service的状态，服务宕机也不知道</li>
<li>user-service只有1台服务，容易出现单点故障问题</li>
<li>即便user-service形成集群，consumer还需自己实现负载均衡</li>
</ul>
<blockquote>
<p>  其实上面说的问题，概括一下就是分布式服务必然要面临的问题：</p>
</blockquote>
<ul>
<li><strong>服务管理</strong><ul>
<li><strong>如何自动注册和发现</strong></li>
<li><strong>如何实现状态监管</strong></li>
<li><strong>如何实现动态路由</strong></li>
</ul>
</li>
<li><strong>服务如何实现负载均衡</strong></li>
<li><strong>服务如何解决熔断问题</strong></li>
<li><strong>服务如何实现统一配置</strong></li>
</ul>
<p>以上的问题，我们都将在SpringCloud中得到答案。</p>
<hr>
<h1 id="6、Eureka注册中心"><a href="#6、Eureka注册中心" class="headerlink" title="6、Eureka注册中心"></a>6、Eureka注册中心</h1><h2 id="Eureka原理"><a href="#Eureka原理" class="headerlink" title="Eureka原理"></a>Eureka原理</h2><ul>
<li><a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2020/11/07/Eureka/">Eureka详解</a></li>
</ul>
<hr>
<h2 id="Eureka实践"><a href="#Eureka实践" class="headerlink" title="Eureka实践"></a>Eureka实践</h2><h3 id="编写EurekaServer"><a href="#编写EurekaServer" class="headerlink" title="编写EurekaServer"></a>编写EurekaServer</h3><p>接下来我们创建一个项目，启动一个EurekaServer：</p>
<p><img src="/2020/10/07/SpringCloud/1525598231170.png" alt="1525598231170"></p>
<p>选择依赖：</p>
<p><img src="/2020/10/07/SpringCloud/1525598312368.png" alt="1525598312368"></p>
<p>完整的Pom文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eureka-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>eureka-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringCloud版本 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Finchley.RC1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Eureka服务端 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- SpringCloud依赖，一定要放到dependencyManagement中，起到管理版本的作用即可 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写启动类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span> <span class="comment">// 声明这个应用是一个EurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(EurekaDemoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span> <span class="comment"># 端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment"># 应用名称，会在Eureka中显示</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># 是否注册自己的信息到EurekaServer，默认是true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># 是否拉取其它服务的信息，默认是true</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># EurekaServer的地址，现在是自己的地址，如果是集群，需要加上其它Server的地址。</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:$&#123;server.port&#125;/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动服务，并访问：<code>http://127.0.0.1:10086/eureka</code></p>
<p><img src="/2020/10/07/SpringCloud/1525604959508.png" alt="1525604959508"></p>
<p><img src="/2020/10/07/SpringCloud/1525605081129.png" alt="1525605081129"></p>
<h3 id="将user-service注册到Eureka"><a href="#将user-service注册到Eureka" class="headerlink" title="将user-service注册到Eureka"></a>将user-service注册到Eureka</h3><p>注册服务到<code>EurekaServer</code>，就是在服务上添加Eureka的客户端依赖，客户端代码会自动把服务注册到EurekaServer中。</p>
<blockquote>
<p>我们在user-service-demo中添加Eureka客户端依赖：</p>
</blockquote>
<p>先添加SpringCloud依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringCloud的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Finchley.RC1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Spring的仓库地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后是Eureka客户端：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Eureka客户端 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>在启动类上开启Eureka客户端功能</p>
</blockquote>
<p>通过添加<code>@EnableDiscoveryClient</code>来开启Eureka客户端功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">// 开启EurekaClient功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceDemoApplication</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(UserServiceDemoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>编写配置</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mydb01</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-service</span> <span class="comment"># 应用名称</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.leyou.userservice.pojo</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># EurekaServer地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 当调用getHostname获取实例的hostname时，返回ip而不是host名称</span></span><br><span class="line">    <span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment"># 指定自己的ip信息，不指定的话会自己寻找</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>这里我们添加了spring.application.name属性来指定应用名称，将来会作为应用的id使用。</li>
<li>不用指定register-with-eureka和fetch-registry，因为默认是true</li>
</ul>
<blockquote>
<p>重启项目，访问<code>Eureka监控页面</code>查看</p>
</blockquote>
<p><img src="/2020/10/07/SpringCloud/1525609225152.png" alt="1525609225152"></p>
<p>我们发现user-service服务已经注册成功了</p>
<h3 id="消费者从Eureka获取服务"><a href="#消费者从Eureka获取服务" class="headerlink" title="消费者从Eureka获取服务"></a>消费者从Eureka获取服务</h3><p>接下来我们修改consumer-demo，尝试从EurekaServer获取服务。</p>
<p>方法与消费者类似，只需要在项目中添加EurekaClient依赖，就可以通过服务名称来获取信息了！</p>
<p>1）添加依赖：</p>
<p>先添加SpringCloud依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringCloud的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Finchley.RC1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Spring的仓库地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后是Eureka客户端：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Eureka客户端 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2）在启动类开启Eureka客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">// 开启Eureka客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConsumerDemoApplication</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(<span class="keyword">new</span> <span class="title class_">OkHttp3ClientHttpRequestFactory</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserConsumerDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3）修改配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consumer</span> <span class="comment"># 应用名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># EurekaServer地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 当其它服务获取地址时提供ip而不是hostname</span></span><br><span class="line">    <span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment"># 指定自己的ip信息，不指定的话会自己寻找</span></span><br></pre></td></tr></table></figure>

<p>4）修改代码，用DiscoveryClient类的方法，根据服务名称，获取服务实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DiscoveryClient discoveryClient;	<span class="comment">// Eureka客户端对象，可以获取到服务实例信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUserByIds</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// String baseUrl = &quot;http://localhost:8081/user/&quot;;</span></span><br><span class="line">        <span class="comment">// 根据服务名称，获取服务实例</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;user-service&quot;</span>);</span><br><span class="line">        <span class="comment">// 本例中只有一个UserService,因此我们直接get(0)获取</span></span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> instances.get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 获取ip和端口信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://&quot;</span>+instance.getHost() + <span class="string">&quot;:&quot;</span> + instance.getPort()+<span class="string">&quot;/user/&quot;</span>;</span><br><span class="line">        ids.forEach(id -&gt; &#123;</span><br><span class="line">            <span class="comment">// 我们测试多次查询，</span></span><br><span class="line">            users.add(<span class="built_in">this</span>.restTemplate.getForObject(baseUrl + id, User.class));</span><br><span class="line">            <span class="comment">// 每次间隔500毫秒</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>访问成功</li>
</ol>
<hr>
<h3 id="高可用的Eureka-Server"><a href="#高可用的Eureka-Server" class="headerlink" title="高可用的Eureka Server"></a>高可用的Eureka Server</h3><p>在上面的案例中，我们只有一个EurekaServer，事实上EurekaServer也可以是一个集群，形成高可用的Eureka中心。</p>
<p>我们假设要搭建两条EurekaServer的集群，端口分别为：10086和10087</p>
<p>1）我们修改原来的EurekaServer配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span> <span class="comment"># 端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment"># 应用名称，会在Eureka中显示</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># 配置其他Eureka服务的地址，而不是自己，比如10087</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10087/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所谓的高可用注册中心，其实就是把EurekaServer自己也作为一个服务进行注册，这样多个EurekaServer之间就能互相发现对方，从而形成集群。因此我们做了以下修改：</p>
<ul>
<li>删除了register-with-eureka=false和fetch-registry=false两个配置。因为默认值是true，这样就会吧自己注册到注册中心了。</li>
<li>把service-url的值改成了另外一台EurekaServer的地址，而不是自己</li>
</ul>
<p>2）另外一台配置恰好相反：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10087</span> <span class="comment"># 端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment"># 应用名称，会在Eureka中显示</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># 配置其他Eureka服务的地址，而不是自己，比如10087</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：idea中一个应用不能启动两次，我们需要重新配置一个启动器：</p>
<p> <img src="/2020/10/07/SpringCloud/1525615070033.png" alt="1525615070033"></p>
<p> <img src="/2020/10/07/SpringCloud/1525615095693.png" alt="1525615095693"></p>
<p><img src="/2020/10/07/SpringCloud/1525615026937.png" alt="1525615026937"></p>
<p>然后启动即可。</p>
<p>3）启动测试：</p>
<p><img src="/2020/10/07/SpringCloud/1525615165157.png" alt="1525615165157"></p>
<p>4）客户端注册服务到集群</p>
<p>因为EurekaServer不止一个，因此注册服务的时候，service-url参数需要变化：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># EurekaServer地址,多个地址以&#x27;,&#x27;隔开</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eureka</span></span><br></pre></td></tr></table></figure>







<hr>
<h1 id="7、负载均衡Robbin"><a href="#7、负载均衡Robbin" class="headerlink" title="7、负载均衡Robbin"></a>7、负载均衡Robbin</h1><p>在微服务开发中，为了避免单点故障或解决网络拥塞，会为每种服务都建立一个集群（集群中包含2~3个服务器），此时<code>服务调用者</code>再从<code>注册中心</code>拉取服务列表，每种服务对应的服务器地址就会有多个，那么<code>服务调用者</code>究竟应该访问哪一个服务器呢？</p>
<p>一般这种情况下我们就需要编写负载均衡算法，在多个实例列表中进行选择。</p>
<p>不过Eureka中已经帮我们集成了负载均衡组件：Ribbon，简单修改代码即可使用。</p>
<blockquote>
<p>Ribbon是Netflix发布的<strong>一个</strong>负载均衡器。</p>
<p>它可以帮助控制HTTP和TCP客户端的行为。[在这里是帮助客户端选择要访问的服务器]</p>
<p>Ribbon从<code>EurekaServer</code>得到<code>服务提供者</code>的地址列表后，就可以根据某种负载均衡算法，自动地帮助<code>服务调用者</code>去请求<code>服务提供者</code> 。</p>
<p>Ribbon默认为我们提供了很多负载均衡的算法，例如轮询、随机等。当然，我们也可以自定义负载均衡算法。</p>
</blockquote>
<h2 id="2-1、Ribbon的代码实现"><a href="#2-1、Ribbon的代码实现" class="headerlink" title="2.1、Ribbon的代码实现"></a>2.1、Ribbon的代码实现</h2><h3 id="1、启动两个服务实例"><a href="#1、启动两个服务实例" class="headerlink" title="1、启动两个服务实例"></a>1、启动两个服务实例</h3><p>首先我们启动两个user-service实例，一个8081，一个8082。</p>
<p> <img src="/2020/10/07/SpringCloud/1525619515586.png" alt="1525619515586"></p>
<p>Eureka监控面板：</p>
<p><img src="/2020/10/07/SpringCloud/1525619546904.png" alt="1525619546904"></p>
<h3 id="2、开启负载均衡"><a href="#2、开启负载均衡" class="headerlink" title="2、开启负载均衡"></a>2、开启负载均衡</h3><p>因为Eureka中已经集成了Ribbon，所以我们无需引入新的依赖。直接修改代码：</p>
<p>在RestTemplate的配置方法上添加<code>@LoadBalanced</code>注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(<span class="keyword">new</span> <span class="title class_">OkHttp3ClientHttpRequestFactory</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3、通过服务名称调用服务提供者"><a href="#3、通过服务名称调用服务提供者" class="headerlink" title="3、通过服务名称调用服务提供者"></a>3、通过服务名称调用服务提供者</h3><p>修改调用方式，不再手动获取ip和端口，而是直接通过服务名称调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUserByIds</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 地址直接写服务名称即可</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://user-service/user/&quot;</span>;</span><br><span class="line">        ids.forEach(id -&gt; &#123;</span><br><span class="line">            <span class="comment">// 我们测试多次查询，</span></span><br><span class="line">            users.add(<span class="built_in">this</span>.restTemplate.getForObject(baseUrl + id, User.class));</span><br><span class="line">            <span class="comment">// 每次间隔500毫秒</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为什么我们只输入了service名称就可以访问了呢？之前还要获取ip和端口。</p>
<p>显然有人帮我们根据service名称，获取到了服务实例的ip和端口。它就是<code>LoadBalancerInterceptor</code>【源码部分】</p>
</blockquote>
<p>访问页面，查看结果：</p>
<p> <img src="/2020/10/07/SpringCloud/1525620305704.png" alt="1525620305704"></p>
<h2 id="2-2-修改负载均衡策略"><a href="#2-2-修改负载均衡策略" class="headerlink" title="2.2    修改负载均衡策略"></a>2.2    修改负载均衡策略</h2><blockquote>
<p>Ribbon默认的负载均衡策略是简单的轮询，SpringBoot也帮我们提供了修改负载均衡规则的配置入口。</p>
</blockquote>
<ul>
<li><p>格式：</p>
<p><code>&#123;服务名称&#125;.ribbon.NFLoadBalancerRuleClassName=Xxx</code></p>
<p>Xxx就是负载均衡规则的实现类。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user-service:</span>	<span class="comment"># 服务ID</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">  	<span class="attr">NFLoadBlancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span>	<span class="comment"># 随机算法</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="2-2-重试机制"><a href="#2-2-重试机制" class="headerlink" title="2.2    重试机制"></a>2.2    重试机制</h2><blockquote>
<ul>
<li>重试机制的前提是<code>服务提供者</code>必须是一个<strong>集群</strong>，且一定要<strong>通过服务提供者的服务名称（而不是IP地址 ）访问</strong>（即实现了负载均衡）</li>
</ul>
</blockquote>
<p>Eureka为了实现更高的服务可用性，牺牲了一定的一致性，<u>极端情况下它宁愿接收故障实例也不愿丢掉健康实例</u>，正如我们上面所说的自我保护机制。</p>
<p>但是，此时如果我们调用了这些不正常的服务，调用就会失败，从而导致其它服务不能正常工作！这显然不是我们愿意看到的。</p>
<p>我们现在关闭一个user-service实例：</p>
<p> <img src="/2020/10/07/SpringCloud/1525653565855.png" alt="1525653565855"></p>
<p>因为失效剔除的延迟，consumer并不会立即得到最新的服务列表，此时再次访问你会得到错误提示：</p>
<p><img src="/2020/10/07/SpringCloud/1525653715488.png" alt="1525653715488"></p>
<p>但是此时，8081服务其实是正常的。</p>
<p>因此Spring Cloud 整合了Spring Retry 来增强RestTemplate的重试能力，当一次服务调用失败后，不会立即抛出一次，而是再次重试另一个服务。</p>
<p>只需要简单配置即可实现Ribbon的重试：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">loadbalancer:</span></span><br><span class="line">      <span class="attr">retry:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启Spring Cloud的重试功能</span></span><br><span class="line"><span class="attr">user-service:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">ConnectTimeout:</span> <span class="number">250</span> <span class="comment"># Ribbon的连接超时时间</span></span><br><span class="line">    <span class="attr">ReadTimeout:</span> <span class="number">1000</span> <span class="comment"># Ribbon的数据读取超时时间</span></span><br><span class="line">    <span class="attr">OkToRetryOnAllOperations:</span> <span class="literal">true</span> <span class="comment"># 是否对所有操作都进行重试</span></span><br><span class="line">    <span class="attr">MaxAutoRetriesNextServer:</span> <span class="number">1</span> <span class="comment"># 切换实例的重试次数</span></span><br><span class="line">    <span class="attr">MaxAutoRetries:</span> <span class="number">1</span> <span class="comment"># 对当前实例的重试次数</span></span><br></pre></td></tr></table></figure>

<p>根据如上配置，当访问到某个服务超时后，它会再次尝试访问下一个服务实例，如果不行就再换一个实例，如果不行，则返回失败。切换次数取决于<code>MaxAutoRetriesNextServer</code>参数的值</p>
<p>引入spring-retry依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.retry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-retry<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>我们重启user-consumer-demo，测试，发现即使user-service2宕机，也能通过另一台服务实例获取到结果！</p>
<hr>
<h1 id="8、Hystrix"><a href="#8、Hystrix" class="headerlink" title="8、Hystrix"></a>8、Hystrix</h1><h2 id="8-1、Hystrix原理"><a href="#8-1、Hystrix原理" class="headerlink" title="8.1、Hystrix原理"></a>8.1、Hystrix原理</h2><ul>
<li><a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2020/11/07/Hystrix/">Hystrix详解</a></li>
</ul>
<h2 id="8-2、Hystrix实践"><a href="#8-2、Hystrix实践" class="headerlink" title="8.2、Hystrix实践"></a>8.2、Hystrix实践</h2><h3 id="1、引入依赖"><a href="#1、引入依赖" class="headerlink" title="1、引入依赖"></a>1、引入依赖</h3><blockquote>
<p>首先在user-consumer中引入Hystix依赖：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2、开启熔断"><a href="#2、开启熔断" class="headerlink" title="2、开启熔断"></a>2、开启熔断</h3><h3 id="3、改造消费者"><a href="#3、改造消费者" class="headerlink" title="3、改造消费者"></a>3、改造消费者</h3><blockquote>
<p>我们改造user-consumer，添加一个用来访问的user服务的DAO，并且声明一个失败时的回滚处理函数：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(UserDao.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;queryUserByIdFallback&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://user-service/user/&quot;</span> + id;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.restTemplate.getForObject(url, User.class);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 记录访问用时：</span></span><br><span class="line">        logger.info(<span class="string">&quot;访问用时：&#123;&#125;&quot;</span>, end - begin);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserByIdFallback</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setName(<span class="string">&quot;用户信息查询出现异常！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@HystrixCommand(fallbackMethod=&quot;queryUserByIdFallback&quot;)</code>：声明一个失败回滚处理函数queryUserByIdFallback，当queryUserById执行超时（默认是1000毫秒），就会执行fallback函数，返回错误提示。</li>
<li>为了方便查看熔断的触发时机，我们记录请求访问时间。</li>
</ul>
<p>在原来的业务逻辑中调用这个DAO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUserByIds</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        ids.forEach(id -&gt; &#123;</span><br><span class="line">            <span class="comment">// 我们测试多次查询，</span></span><br><span class="line">            users.add(<span class="built_in">this</span>.userDao.queryUserById(id));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、改造服务提供者"><a href="#4、改造服务提供者" class="headerlink" title="4、改造服务提供者"></a>4、改造服务提供者</h3><p>改造服务提供者，随机休眠一段时间，以触发熔断：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(Long id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 为了演示超时现象，我们在这里然线程休眠,时间随机 0~2000毫秒</span></span><br><span class="line">        Thread.sleep(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">2000</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5、启动测试"><a href="#5、启动测试" class="headerlink" title="5、启动测试"></a>5、启动测试</h3><p>然后运行并查看日志：</p>
<p>id为9、10、11的访问时间分别是：</p>
<p> <img src="/2020/10/07/SpringCloud/1525661641660.png" alt="1525661641660"></p>
<p>id为12的访问时间：</p>
<p> <img src="/2020/10/07/SpringCloud/1525661669136.png" alt="1525661669136"></p>
<p>因此，只有12是正常访问，其它都会触发熔断，我们来查看结果：</p>
<p><img src="/2020/10/07/SpringCloud/1525661720656.png" alt="1525661720656"></p>
<h3 id="6、优化"><a href="#6、优化" class="headerlink" title="6、优化"></a>6、优化</h3><p>虽然熔断实现了，但是我们的重试机制似乎没有生效，是这样吗？</p>
<p>其实这里是因为我们的Ribbon超时时间设置的是1000ms:</p>
<p>​    <img src="/2020/10/07/SpringCloud/1525666632542.png" alt="1525666632542"></p>
<p>而Hystix的超时时间默认也是1000ms，因此重试机制没有被触发，而是先触发了熔断。</p>
<p>所以，Ribbon的超时时间一定要小于Hystix的超时时间。</p>
<p>我们可以通过<code>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</code>来设置Hystrix超时时间。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">  	<span class="attr">default:</span></span><br><span class="line">        <span class="attr">execution:</span></span><br><span class="line">          <span class="attr">isolation:</span></span><br><span class="line">            <span class="attr">thread:</span></span><br><span class="line">              <span class="attr">timeoutInMillisecond:</span> <span class="number">6000</span> <span class="comment"># 设置hystrix的超时时间为6000ms</span></span><br></pre></td></tr></table></figure>







<h2 id="8-3-Hystrix与RIbbon重试机制的冲突"><a href="#8-3-Hystrix与RIbbon重试机制的冲突" class="headerlink" title="8.3    Hystrix与RIbbon重试机制的冲突"></a>8.3    Hystrix与RIbbon重试机制的冲突</h2><ul>
<li><p>Ribbon的重试机制是建立在集群的基础上，当集群中的某个服务请求超时后就去请求该机群中的另一个服务。一般情况下我们都会设置一个超时时间作为切换服务的标准。    </p>
</li>
<li><p><strong>冲突</strong>：当Ribbon的重试机制 和 Hystrix 在一个服务中同时生效时，如果Hystrix设置的短路时间小于Ribbon的重试时间，这时候就无法触发服务重试了，而是会直接触发熔断。</p>
</li>
<li><p>所以，<strong>Ribbon的超时时间一定要小于Hystrix的超时时间</strong>。我们可以通过<code>hystrix.command.default.isolation.thread.timeoutInMilliseconds</code>来设置Hystrix的超时时间。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix:</span> </span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">  	<span class="attr">default:</span> </span><br><span class="line">  	  <span class="attr">isolation:</span></span><br><span class="line">  	    <span class="attr">thread:</span></span><br><span class="line">  	      <span class="attr">timeoutInMilliseconds:</span> <span class="number">6000</span>	<span class="comment"># 设置Hystrix的超时时间为6000ms</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="9、Feign"><a href="#9、Feign" class="headerlink" title="9、Feign"></a>9、Feign</h1><h2 id="9-1、Feign介绍"><a href="#9-1、Feign介绍" class="headerlink" title="9.1、Feign介绍"></a>9.1、Feign介绍</h2><blockquote>
<ul>
<li><p>feign  /feɪn/  假装；装作；捏造；想象</p>
<blockquote>
<p>为什么叫伪装？</p>
<p>Feign可以把Rest的请求进行隐藏，伪装成类似SpringMVC的Controller一样，你不用再自己拼接URL，拼接参数等，一切都交给Feign去做。</p>
</blockquote>
</li>
<li><p>Feign是Netflix开发的声明式、模板化的HTTP<strong>客户端</strong>。Feign可以帮助我们更加快捷、优雅的调用HTTP API。</p>
</li>
<li><p>在SpringCould中，使用Feign非常简单：创建一个接口，并在接口上添加一些注解，代码就完成了。Feign支持多种注解，例如Feign子代的注解或者JAX-RS注解等。</p>
</li>
<li><p>SpringCould对Feign进行了增强，使Feign支持了SpringMVC注解，并整合了Ribbon和Eureka，从而让Feign的使用更加方便。 </p>
</li>
</ul>
</blockquote>
<h2 id="9-2、Feign实践"><a href="#9-2、Feign实践" class="headerlink" title="9.2、Feign实践"></a>9.2、Feign实践</h2><h3 id="1、导入依赖"><a href="#1、导入依赖" class="headerlink" title="1、导入依赖"></a>1、导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、Feign的客户端"><a href="#2、Feign的客户端" class="headerlink" title="2、Feign的客户端"></a>2、Feign的客户端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;user-service&quot;)</span> <span class="comment">// 注解中的服务名是Feign客户端要访问的服务提供者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Feign的客户端是一个<strong>接口</strong>，Feign会通过动态代理，帮我们生成实现类。这和MyBatis的mapper很像。</li>
<li><code>@FeignClient</code>，声明这是一个Feign客户端，通过<code>value</code>属性指定<code>服务提供者实例的名称</code>。</li>
<li>接口中的定义方法，完全采用SpringMVC的注解，Feign会根据注解帮我们生成URL，并访问获取结果。</li>
</ul>
</blockquote>
<p>改造原来的调用逻辑，不再使用<code>UserDao</code>，而是使用<code>UserFeignClient接口</code>去访问<code>服务提供方</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserFeignClient userFeignClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUserByIds</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        ids.forEach(id -&gt; &#123;</span><br><span class="line">            <span class="comment">// 我们测试多次查询，</span></span><br><span class="line">            users.add(<span class="built_in">this</span>.userFeignClient.queryUserById(id));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、开启Feign功能"><a href="#3、开启Feign功能" class="headerlink" title="3、开启Feign功能"></a>3、开启Feign功能</h3><p>我们在启动类上，添加注解，开启Feign功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span> <span class="comment">// 开启Feign功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConsumerDemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserConsumerDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>你会发现RestTemplate的注册被删除了。因为Feign中集成了Ribbon负载均衡，因此我们不需要自己定义RestTemplate了。</p>
</blockquote>
<h3 id="4、启动测试："><a href="#4、启动测试：" class="headerlink" title="4、启动测试："></a>4、启动测试：</h3><p>访问接口，获取结果。</p>
<hr>
<h2 id="9-3、负载均衡"><a href="#9-3、负载均衡" class="headerlink" title="9.3、负载均衡"></a>9.3、负载均衡</h2><p>Feign中已经集成了Ribbon依赖和自动配置，因此我们不需要额外引入依赖，也不需要再注册<code>RestTemplate</code>对象。</p>
<p>如果想要修改Ribbon的配置信息，可以通过<code>ribbon.xx</code>来进行全局配置。也可以通过<code>服务名.ribbon.xx</code>来对指定服务配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user-service:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">ConnectTimeout:</span> <span class="number">250</span> <span class="comment"># 连接超时时间(ms)</span></span><br><span class="line">    <span class="attr">ReadTimeout:</span> <span class="number">1000</span> <span class="comment"># 通信超时时间(ms)</span></span><br><span class="line">    <span class="attr">OkToRetryOnAllOperations:</span> <span class="literal">true</span> <span class="comment"># 是否对所有操作重试</span></span><br><span class="line">    <span class="attr">MaxAutoRetriesNextServer:</span> <span class="number">1</span> <span class="comment"># 同一服务不同实例的重试次数</span></span><br><span class="line">    <span class="attr">MaxAutoRetries:</span> <span class="number">1</span> <span class="comment"># 同一实例的重试次数</span></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="9-4、Hystix支持"><a href="#9-4、Hystix支持" class="headerlink" title="9.4、Hystix支持"></a>9.4、Hystix支持</h2><p>Feign中也集成了Hystix，只不过默认情况下是关闭的，我们需要通过配置参数信息手动开启。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启Feign的熔断功能</span></span><br></pre></td></tr></table></figure>



<h3 id="Feign中的FallBack配置"><a href="#Feign中的FallBack配置" class="headerlink" title="Feign中的FallBack配置"></a>Feign中的FallBack配置</h3><p>但是，Feign中的Fallback配置不像Ribbon中那样简单了。</p>
<ol>
<li>首先，我们要定义一个类，实现刚才编写的<code>UserFeignClient</code>，作为<code>fallback</code>的处理类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserFeignClientFallback</span> <span class="keyword">implements</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setName(<span class="string">&quot;用户查询出现异常！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后在<code>UserFeignClient</code>中，指定刚才编写的实现类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;user-service&quot;, fallback = UserFeignClientFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>重启测试：</p>
<p>关闭user-service服务，然后在页面访问：</p>
</li>
</ol>
<p><img src="/2020/10/07/SpringCloud/1525673049875.png" alt="1525673049875"></p>
<hr>
<h2 id="9-5、请求压缩"><a href="#9-5、请求压缩" class="headerlink" title="9.5、请求压缩"></a>9.5、请求压缩</h2><blockquote>
<p>Spring Cloud Feign 支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗。通过下面的参数即可开启请求与响应的压缩功能：</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">compression:</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启请求压缩</span></span><br><span class="line">    <span class="attr">response:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启响应压缩</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们也可以对请求的数据类型，以及触发压缩的大小下限进行设置：</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">compression:</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启请求压缩</span></span><br><span class="line">      <span class="attr">mime-types:</span> <span class="string">text/html,application/xml,application/json</span> <span class="comment"># 设置压缩的数据类型</span></span><br><span class="line">      <span class="attr">min-request-size:</span> <span class="number">2048</span> <span class="comment"># 设置触发压缩的大小下限</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tip：上面的数据类型、压缩大小下限均为默认值。</p>
</blockquote>
<hr>
<h2 id="9-6、日志级别"><a href="#9-6、日志级别" class="headerlink" title="9.6、日志级别"></a>9.6、日志级别</h2><blockquote>
<p>在SpringCould中，通过<code>logging.level.xx=debug</code>来设置日志级别。然而这个对Fegin客户端而言不会产生效果。因为<code>@FeignClient</code>注解修改的客户端在被代理时，都会创建一个新的Fegin.Logger实例。我们需要额外指定这个日志的级别才可以。</p>
</blockquote>
<ol>
<li>设置com.leyou包下的日志级别都为debug</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.leyou:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写配置类，定义日志级别</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里指定的Level级别是FULL，Feign支持4种级别：</p>
</blockquote>
<p>​    <img src="/2020/10/07/SpringCloud/1525674373507.png" alt="1525674373507"></p>
<blockquote>
<ul>
<li>NONE：不记录任何日志信息，这是默认值。</li>
<li>BASIC：仅记录请求的方法，URL以及响应状态码和执行时间</li>
<li>HEADERS：在BASIC的基础上，额外记录了请求和响应的头信息</li>
<li>FULL：记录所有请求和响应的明细，包括头信息、请求体、元数据。</li>
</ul>
</blockquote>
<ol start="3">
<li>在FeignClient中指定配置类：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;user-service&quot;, fallback = UserFeignClientFallback.class, configuration = FeignConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeignClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重启项目，即可看到每次访问的日志：</li>
</ol>
<p><img src="/2020/10/07/SpringCloud/1525674544569.png" alt="1525674544569"></p>
<hr>
<h1 id="10、服务网关"><a href="#10、服务网关" class="headerlink" title="10、服务网关"></a>10、服务网关</h1><h2 id="Zuul原理"><a href="#Zuul原理" class="headerlink" title="Zuul原理"></a>Zuul原理</h2><ul>
<li><a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2020/11/07/Zuul/">Zull网关详解</a></li>
</ul>
<h2 id="路由规则"><a href="#路由规则" class="headerlink" title="路由规则"></a>路由规则</h2><ul>
<li><p>映射规则</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> <span class="comment"># 当前服务的端口号</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">api-gateway</span> <span class="comment"># 当前服务名</span></span><br><span class="line"></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">  	<span class="attr">user-service:</span>	<span class="comment"># 自定义路由规则的ID</span></span><br><span class="line">  	<span class="attr">path:</span> <span class="string">/user-service/**</span> 	<span class="comment"># 定义访问路径</span></span><br><span class="line">  	<span class="attr">url:</span> <span class="string">http://127.0.0.1:8081</span>	<span class="comment"># 访问路径映射到的实际url地址</span></span><br></pre></td></tr></table></figure>

<p>我们将符合<code>path</code>规则的一切请求，都代理到<code>url</code>参数指定的地址。</p>
<p>本例中，我们将<code>/user-service/**</code>开头的请求，代理到<code>http://127.0.0.1:8081</code>。</p>
<p>此时：<code>http://localhost:10010/user-service/user/1</code> 等价于 <code>http://127.0.0.1:8081/user/1</code></p>
</li>
</ul>
<h3 id="面向服务的路由"><a href="#面向服务的路由" class="headerlink" title="面向服务的路由"></a>面向服务的路由</h3><blockquote>
<p><strong>缺点</strong>：</p>
<ul>
<li>在刚才的路由规则中，我们把访问路径对应的地址写死了！如果某个服务是采用集群实现的（有多个实例），这样做就不能充分利用集群的优势，显然是不合理的。</li>
</ul>
<p><strong>改进</strong>：</p>
<ul>
<li>我们应该根据服务的名称，去Eureka注册中心查找服务对应的所有实例列表，然后进行动态路由才对。</li>
</ul>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加Eureka配置，拉取服务列表</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">	<span class="attr">registry-fetch-interval-seconds:</span> <span class="number">5</span> <span class="comment"># 获取服务列表的周期：5s</span></span><br><span class="line">  	<span class="attr">service-url:</span></span><br><span class="line">	  <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">	<span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">	<span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改路由映射规则，通过服务名称获取路由地址</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">  	<span class="attr">user-service:</span>	<span class="comment"># 自定义路由规则的ID</span></span><br><span class="line">  	  <span class="attr">path:</span>	<span class="string">/user-service/**</span>	<span class="comment"># 访问路径</span></span><br><span class="line">  	  <span class="attr">serviceId:</span> <span class="string">user-service</span>	<span class="comment"># 指定服务名称</span></span><br></pre></td></tr></table></figure>

<h4 id="1、简化的路由配置"><a href="#1、简化的路由配置" class="headerlink" title="1、简化的路由配置"></a>1、简化的路由配置</h4><ol>
<li><p>在上面的配置中，我们的规则是这样的：</p>
<ul>
<li><code>zuul.routes.&lt;routes&gt;.path=/xxx/**</code>：来指定访问路径。<code>&lt;routes&gt;</code>是自定义的路由规则的ID。</li>
<li><code>zuul.routes.&lt;routes&gt;.serviceId=/user-service</code>：来指定服务名。</li>
</ul>
</li>
<li><p>而大多数情况下，我们的<code>&lt;routes&gt;</code>路由规则ID往往和服务名会定义成一样的，因此Zuul就提供了一种简化的配置语法：</p>
<ul>
<li><code>zuul.routes.&lt;serviceId&gt;=&lt;path&gt;</code></li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">  	<span class="attr">user-service:</span> <span class="string">/user-service/**</span>	<span class="comment"># 服务名称&amp;访问路径[省去了对路由规则ID的配置]	</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2、默认的路由规则"><a href="#2、默认的路由规则" class="headerlink" title="2、默认的路由规则"></a>2、默认的路由规则</h4><p>在使用Zuul的过程中，上述的规则已经大大简化了配置。但是当服务较多时，配置仍是比较繁琐的，因此Zuul就指定了默认的路由规则：</p>
<blockquote>
<p>默认情况下，一切服务的访问路径就是服务名本身。</p>
<ul>
<li>例如服务名为：<code>user-service</code>，则默认的访问路径就是：<code>/user-service/**</code></li>
</ul>
<p>也就是说，上面的映射规则我们完全不配置也是OK的。</p>
</blockquote>
<h4 id="3、路由前缀"><a href="#3、路由前缀" class="headerlink" title="3、路由前缀"></a>3、路由前缀</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">/api</span>	<span class="comment"># 添加路由前缀（访问路径前缀）</span></span><br><span class="line">  <span class="attr">routes:</span> </span><br><span class="line">  	<span class="attr">user-service:</span>	<span class="comment"># 路由规则ID</span></span><br><span class="line">  	  <span class="attr">path:</span> <span class="string">/user-service/**</span></span><br><span class="line">  	  <span class="attr">serviceId:</span> <span class="string">user-service</span></span><br></pre></td></tr></table></figure>

<ul>
<li>我们通过<code>zuul.prefix=/api</code>来指定了路由的前缀，这样在发起请求时，路径就要以<code>/api</code>开头</li>
</ul>
<hr>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><ul>
<li>Zuul作为网关的其中一个重要功能，就是实现请求的鉴权。而这个工作往往是通过Zuul提供的过滤器来实现的。</li>
</ul>
<h2 id="负载均衡-amp-熔断"><a href="#负载均衡-amp-熔断" class="headerlink" title="负载均衡  &amp;  熔断"></a>负载均衡  &amp;  熔断</h2><ul>
<li>Zuul中默认已经集成了Ribbon负载均衡和Hystrix熔断机制。但所有的超时策略走的都是默认值，比如熔断超时时间只有1s，很容易就触发了，因此建议手动配置。</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">retryable:</span> <span class="literal">true</span>	<span class="comment"># 开启重试机制</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">250</span> <span class="comment"># 连接超时时间(ms)</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">2000</span> <span class="comment"># 通信超时时间(ms)</span></span><br><span class="line">  <span class="attr">OkToRetryOnAllOperations:</span> <span class="literal">true</span> <span class="comment"># 是否对所有操作重试</span></span><br><span class="line">  <span class="attr">MaxAutoRetriesNextServer:</span> <span class="number">2</span> <span class="comment"># 同一服务不同实例的重试次数</span></span><br><span class="line">  <span class="attr">MaxAutoRetries:</span> <span class="number">1</span> <span class="comment"># 同一实例的重试次数</span></span><br><span class="line"></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">	<span class="attr">default:</span></span><br><span class="line">	  <span class="attr">execution:</span></span><br><span class="line">		<span class="attr">isolation:</span></span><br><span class="line">		  <span class="attr">thread:</span></span><br><span class="line">			<span class="attr">timeoutInMillisecond:</span> <span class="number">6000</span> <span class="comment"># 熔断超时时长：6000ms</span></span><br></pre></td></tr></table></figure>









<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;port&#125;</span> <span class="comment">#服务端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">itcast-microservice-eureka</span> <span class="comment">#指定服务名</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registerWithEureka:</span> <span class="literal">true</span> <span class="comment">#是否将自己注册到Eureka服务中，本身就是所有无需注册</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span> <span class="comment">#是否从Eureka中获取注册信息</span></span><br><span class="line">    <span class="attr">serviceUrl:</span> <span class="comment">#Eureka客户端与Eureka服务端进行交互的地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">$&#123;eureka.server&#125;</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span>  <span class="literal">true</span>  <span class="comment">#将自己的ip地址注册到Eureka服务中</span></span><br><span class="line">    <span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> <span class="comment">#指定实例id</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span> <span class="comment">#禁用自我保护模式</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">60000</span> <span class="comment">#清理间隔（单位毫秒，默认是60*1000）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#security:</span></span><br><span class="line"><span class="comment">#  basic:</span></span><br><span class="line"><span class="comment">#    enable: true #开启基于HTTP basic的认证</span></span><br><span class="line"><span class="comment">#  user: #配置用户的账号信息</span></span><br><span class="line"><span class="comment">#    name: itcast</span></span><br><span class="line"><span class="comment">#    password: itcast123</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">debug</span></span><br><span class="line"><span class="comment">#    org.springframework.web: DEBUG</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">/log/log/my_eureka.log</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d&#123;yyyy/MM/dd-HH:mm:ss&#125; [%thread] %-5level %logger- %msg%n&quot;</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">&quot;%d&#123;yyyy/MM/dd-HH:mm&#125; [%thread] %-5level %logger- %msg%n&quot;</span></span><br><span class="line"><span class="comment">#logging.level.root=WARN</span></span><br><span class="line"><span class="comment">#logging.level.org.springframework.web=DEBUG</span></span><br><span class="line"><span class="comment">#logging.file=/log/log/my.log</span></span><br><span class="line"><span class="comment">#logging.pattern.console=%d&#123;yyyy/MM/dd-HH:mm:ss&#125; [%thread] %-5level %logger- %msg%n</span></span><br><span class="line"><span class="comment">#logging.pattern.file=%d&#123;yyyy/MM/dd-HH:mm&#125; [%thread] %-5level %logger- %msg%n</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl + alt + B			查看实现类</span><br></pre></td></tr></table></figure>



<h2 id="Zuul实践"><a href="#Zuul实践" class="headerlink" title="Zuul实践"></a>Zuul实践</h2><h3 id="1、新建工程"><a href="#1、新建工程" class="headerlink" title="1、新建工程"></a>1、新建工程</h3><p><img src="/2020/10/07/SpringCloud/1525675928548.png" alt="1525675928548"></p>
<p>添加Zuul依赖：</p>
<p><img src="/2020/10/07/SpringCloud/1525675991833.png" alt="1525675991833"></p>
<h3 id="2、编写启动类"><a href="#2、编写启动类" class="headerlink" title="2、编写启动类"></a>2、编写启动类</h3><p>通过<code>@EnableZuulProxy </code>注解开启Zuul的功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span> <span class="comment">// 开启Zuul的网关功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZuulDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(ZuulDemoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、编写配置"><a href="#3、编写配置" class="headerlink" title="3、编写配置"></a>3、编写配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> 	<span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">application:</span>  </span><br><span class="line">    <span class="attr">name:</span> <span class="string">api-gateway</span> <span class="comment">#指定服务实例ID</span></span><br></pre></td></tr></table></figure>

<h3 id="4、编写路由规则"><a href="#4、编写路由规则" class="headerlink" title="4、编写路由规则"></a>4、编写路由规则</h3><p>我们需要用Zuul来代理<code>user-service</code>服务，先看一下控制面板中的服务状态：</p>
<p><img src="/2020/10/07/SpringCloud/1525676797879.png" alt="1525676797879"></p>
<blockquote>
<ul>
<li>IP：127.0.0.1</li>
<li>端口号：8081</li>
</ul>
</blockquote>
<p>映射规则：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">user-service:</span> <span class="comment"># 这里是路由id，随意写</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/user-service/**</span> <span class="comment"># 这里是映射路径</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://127.0.0.1:8081</span> <span class="comment"># 映射路径对应的实际url地址</span></span><br></pre></td></tr></table></figure>

<p>我们将符合<code>path</code> 规则的一切请求，都代理到 <code>url</code>参数指定的地址</p>
<p>本例中，我们将 <code>/user-service/**</code>开头的请求，代理到<code>http://127.0.0.1:8081</code></p>
<h3 id="3-3-5-启动测试"><a href="#3-3-5-启动测试" class="headerlink" title="3.3.5.启动测试"></a>3.3.5.启动测试</h3><p>访问的路径中需要加上配置规则的映射路径，我们访问：<code>http://127.0.0.1:8081/user-service/user/10</code></p>
<p>​    <img src="/2020/10/07/SpringCloud/1525677046705.png" alt="1525677046705"></p>
<h2 id="3-4-面向服务的路由"><a href="#3-4-面向服务的路由" class="headerlink" title="3.4.面向服务的路由"></a>3.4.面向服务的路由</h2><p>在刚才的路由规则中，我们把路径对应的服务地址写死了！如果同一服务有多个实例的话，这样做显然就不合理了。</p>
<p>我们应该根据服务的名称，去Eureka注册中心查找 服务对应的所有实例列表，然后进行动态路由才对！</p>
<h3 id="3-4-1-添加Eureka客户端依赖"><a href="#3-4-1-添加Eureka客户端依赖" class="headerlink" title="3.4.1.添加Eureka客户端依赖"></a>3.4.1.添加Eureka客户端依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4-2-开启Eureka客户端发现功能"><a href="#3-4-2-开启Eureka客户端发现功能" class="headerlink" title="3.4.2.开启Eureka客户端发现功能"></a>3.4.2.开启Eureka客户端发现功能</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span> <span class="comment">// 开启Zuul的网关功能</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZuulDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(ZuulDemoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-添加Eureka配置，获取服务信息"><a href="#3-4-3-添加Eureka配置，获取服务信息" class="headerlink" title="3.4.3.添加Eureka配置，获取服务信息"></a>3.4.3.添加Eureka配置，获取服务信息</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registry-fetch-interval-seconds:</span> <span class="number">5</span> <span class="comment"># 获取服务列表的周期：5s</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-修改映射配置，通过服务名称获取"><a href="#3-4-4-修改映射配置，通过服务名称获取" class="headerlink" title="3.4.4.修改映射配置，通过服务名称获取"></a>3.4.4.修改映射配置，通过服务名称获取</h3><p>因为已经有了Eureka客户端，我们可以从Eureka获取服务的地址信息，因此映射时无需指定IP地址，而是通过服务名称来访问，而且Zuul已经集成了Ribbon的负载均衡功能。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">user-service:</span> <span class="comment"># 这里是路由id，随意写</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/user-service/**</span> <span class="comment"># 这里是映射路径</span></span><br><span class="line">      <span class="attr">serviceId:</span> <span class="string">user-service</span> <span class="comment"># 指定服务名称</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4-5-启动测试"><a href="#3-4-5-启动测试" class="headerlink" title="3.4.5.启动测试"></a>3.4.5.启动测试</h3><p>再次启动，这次Zuul进行代理时，会利用Ribbon进行负载均衡访问：</p>
<p>​    <img src="/2020/10/07/SpringCloud/1525677821212.png" alt="1525677821212"></p>
<p>日志中可以看到使用了负载均衡器：</p>
<p><img src="/2020/10/07/SpringCloud/1525677891119.png" alt="1525677891119"></p>
<h2 id="3-5-简化的路由配置"><a href="#3-5-简化的路由配置" class="headerlink" title="3.5.简化的路由配置"></a>3.5.简化的路由配置</h2><p>在刚才的配置中，我们的规则是这样的：</p>
<ul>
<li><code>zuul.routes.&lt;route&gt;.path=/xxx/**</code>： 来指定映射路径。<code>&lt;route&gt;</code>是自定义的路由名</li>
<li><code>zuul.routes.&lt;route&gt;.serviceId=/user-service</code>：来指定服务名。</li>
</ul>
<p>而大多数情况下，我们的<code>&lt;route&gt;</code>路由名称往往和 服务名会写成一样的。因此Zuul就提供了一种简化的配置语法：<code>zuul.routes.&lt;serviceId&gt;=&lt;path&gt;</code></p>
<p>比方说上面我们关于user-service的配置可以简化为一条：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">user-service:</span> <span class="string">/user-service/**</span> <span class="comment"># 这里是映射路径</span></span><br></pre></td></tr></table></figure>

<p>省去了对服务名称的配置。</p>
<h2 id="3-6-默认的路由规则"><a href="#3-6-默认的路由规则" class="headerlink" title="3.6.默认的路由规则"></a>3.6.默认的路由规则</h2><p>在使用Zuul的过程中，上面讲述的规则已经大大的简化了配置项。但是当服务较多时，配置也是比较繁琐的。因此Zuul就指定了默认的路由规则：</p>
<ul>
<li>默认情况下，一切服务的映射路径就是服务名本身。<ul>
<li>例如服务名为：<code>user-service</code>，则默认的映射路径就是：<code>/user-service/**</code></li>
</ul>
</li>
</ul>
<p>也就是说，刚才的映射规则我们完全不配置也是OK的，不信就试试看。</p>
<h2 id="3-7-路由前缀"><a href="#3-7-路由前缀" class="headerlink" title="3.7.路由前缀"></a>3.7.路由前缀</h2><p>配置示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">/api</span> <span class="comment"># 添加路由前缀</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">      <span class="attr">user-service:</span> <span class="comment"># 这里是路由id，随意写</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/user-service/**</span> <span class="comment"># 这里是映射路径</span></span><br><span class="line">        <span class="attr">service-id:</span> <span class="string">user-service</span> <span class="comment"># 指定服务名称</span></span><br></pre></td></tr></table></figure>

<p>我们通过<code>zuul.prefix=/api</code>来指定了路由的前缀，这样在发起请求时，路径就要以/api开头。</p>
<p>路径<code>/api/user-service/user/1</code>将会被代理到<code>/user-service/user/1</code></p>
<h2 id="3-8-过滤器"><a href="#3-8-过滤器" class="headerlink" title="3.8.过滤器"></a>3.8.过滤器</h2><p>Zuul作为网关的其中一个重要功能，就是实现请求的鉴权。而这个动作我们往往是通过Zuul提供的过滤器来实现的。</p>
<h3 id="3-8-1-ZuulFilter"><a href="#3-8-1-ZuulFilter" class="headerlink" title="3.8.1.ZuulFilter"></a>3.8.1.ZuulFilter</h3><p>ZuulFilter是过滤器的顶级父类。在这里我们看一下其中定义的4个最重要的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> ZuulFilter <span class="keyword">implements</span> <span class="title class_">IZuulFilter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title function_">filterType</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">filterOrder</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shouldFilter</span><span class="params">()</span>;<span class="comment">// 来自IZuulFilter</span></span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException;<span class="comment">// IZuulFilter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>shouldFilter</code>：返回一个<code>Boolean</code>值，判断该过滤器是否需要执行。返回true执行，返回false不执行。</li>
<li><code>run</code>：过滤器的具体业务逻辑。</li>
<li><code>filterType</code>：返回字符串，代表过滤器的类型。包含以下4种：<ul>
<li><code>pre</code>：请求在被路由之前执行</li>
<li><code>routing</code>：在路由请求时调用</li>
<li><code>post</code>：在routing和errror过滤器之后调用</li>
<li><code>error</code>：处理请求时发生错误调用</li>
</ul>
</li>
<li><code>filterOrder</code>：通过返回的int值来定义过滤器的执行顺序，数字越小优先级越高。</li>
</ul>
<h3 id="3-8-2-过滤器执行生命周期："><a href="#3-8-2-过滤器执行生命周期：" class="headerlink" title="3.8.2.过滤器执行生命周期："></a>3.8.2.过滤器执行生命周期：</h3><p>这张是Zuul官网提供的请求生命周期图，清晰的表现了一个请求在各个过滤器的执行顺序。</p>
<p>​    <img src="/2020/10/07/SpringCloud/1525681866862.png" alt="1525681866862"></p>
<ul>
<li>正常流程：<ul>
<li>请求到达首先会经过pre类型过滤器，而后到达routing类型，进行路由，请求就到达真正的服务提供者，执行请求，返回结果后，会到达post过滤器。而后返回响应。</li>
</ul>
</li>
<li>异常流程：<ul>
<li>整个过程中，pre或者routing过滤器出现异常，都会直接进入error过滤器，再error处理完毕后，会将请求交给POST过滤器，最后返回给用户。</li>
<li>如果是error过滤器自己出现异常，最终也会进入POST过滤器，而后返回。</li>
<li>如果是POST过滤器出现异常，会跳转到error过滤器，但是与pre和routing不同的时，请求不会再到达POST过滤器了。</li>
</ul>
</li>
</ul>
<p>所有内置过滤器列表：</p>
<p>​    <img src="/2020/10/07/SpringCloud/1525682427811.png" alt="1525682427811"></p>
<h3 id="3-8-3-使用场景"><a href="#3-8-3-使用场景" class="headerlink" title="3.8.3.使用场景"></a>3.8.3.使用场景</h3><p>场景非常多：</p>
<ul>
<li>请求鉴权：一般放在pre类型，如果发现没有访问权限，直接就拦截了</li>
<li>异常处理：一般会在error类型和post类型过滤器中结合来处理。</li>
<li>服务调用时长统计：pre和post结合使用。</li>
</ul>
<h2 id="3-9-自定义过滤器"><a href="#3-9-自定义过滤器" class="headerlink" title="3.9.自定义过滤器"></a>3.9.自定义过滤器</h2><p>接下来我们来自定义一个过滤器，模拟一个登录的校验。基本逻辑：如果请求中有access-token参数，则认为请求有效，放行。</p>
<h3 id="3-9-1-定义过滤器类"><a href="#3-9-1-定义过滤器类" class="headerlink" title="3.9.1.定义过滤器类"></a>3.9.1.定义过滤器类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">extends</span> <span class="title class_">ZuulFilter</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 登录校验，肯定是在前置拦截</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pre&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">filterOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 顺序设置为1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 返回true，代表过滤器生效。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException &#123;</span><br><span class="line">        <span class="comment">// 登录校验逻辑。</span></span><br><span class="line">        <span class="comment">// 1）获取Zuul提供的请求上下文对象</span></span><br><span class="line">        <span class="type">RequestContext</span> <span class="variable">ctx</span> <span class="operator">=</span> RequestContext.getCurrentContext();</span><br><span class="line">        <span class="comment">// 2) 从上下文中获取request对象</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> ctx.getRequest();</span><br><span class="line">        <span class="comment">// 3) 从请求中获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;access-token&quot;</span>);</span><br><span class="line">        <span class="comment">// 4) 判断</span></span><br><span class="line">        <span class="keyword">if</span>(token == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(token.trim()))&#123;</span><br><span class="line">            <span class="comment">// 没有token，登录校验失败，拦截</span></span><br><span class="line">            ctx.setSendZuulResponse(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">// 返回401状态码。也可以考虑重定向到登录页。</span></span><br><span class="line">            ctx.setResponseStatusCode(HttpStatus.UNAUTHORIZED.value());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 校验通过，可以考虑把用户信息放入上下文，继续向后执行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-9-2-测试"><a href="#3-9-2-测试" class="headerlink" title="3.9.2.测试"></a>3.9.2.测试</h3><p>没有token参数时，访问失败：</p>
<p>​    <img src="/2020/10/07/SpringCloud/1525683285697.png" alt="1525683285697"></p>
<p>添加token参数后：</p>
<p>​    <img src="/2020/10/07/SpringCloud/1525683354113.png" alt="1525683354113"></p>
<h2 id="3-10-负载均衡和熔断"><a href="#3-10-负载均衡和熔断" class="headerlink" title="3.10.负载均衡和熔断"></a>3.10.负载均衡和熔断</h2><p>Zuul中默认就已经集成了Ribbon负载均衡和Hystix熔断机制。但是所有的超时策略都是走的默认值，比如熔断超时时间只有1S，很容易就触发了。因此建议我们手动进行配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">retryable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">250</span> <span class="comment"># 连接超时时间(ms)</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">2000</span> <span class="comment"># 通信超时时间(ms)</span></span><br><span class="line">  <span class="attr">OkToRetryOnAllOperations:</span> <span class="literal">true</span> <span class="comment"># 是否对所有操作重试</span></span><br><span class="line">  <span class="attr">MaxAutoRetriesNextServer:</span> <span class="number">2</span> <span class="comment"># 同一服务不同实例的重试次数</span></span><br><span class="line">  <span class="attr">MaxAutoRetries:</span> <span class="number">1</span> <span class="comment"># 同一实例的重试次数</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">  	<span class="attr">default:</span></span><br><span class="line">        <span class="attr">execution:</span></span><br><span class="line">          <span class="attr">isolation:</span></span><br><span class="line">            <span class="attr">thread:</span></span><br><span class="line">              <span class="attr">timeoutInMillisecond:</span> <span class="number">6000</span> <span class="comment"># 熔断超时时长：6000ms</span></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/01/Java%E9%9D%A2%E8%AF%95%E9%A2%98%E7%B2%BE%E9%80%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/01/Java%E9%9D%A2%E8%AF%95%E9%A2%98%E7%B2%BE%E9%80%89/" class="post-title-link" itemprop="url">Java面试题精选</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-10-01 10:15:19" itemprop="dateCreated datePublished" datetime="2020-10-01T10:15:19+08:00">2020-10-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2020-12-03 11:35:44" itemprop="dateModified" datetime="2020-12-03T11:35:44+08:00">2020-12-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaSE/" itemprop="url" rel="index"><span itemprop="name">JavaSE</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1、JavaSE"><a href="#1、JavaSE" class="headerlink" title="1、JavaSE"></a>1、JavaSE</h1><hr>
<h2 id="Java中创建对象的5种方式"><a href="#Java中创建对象的5种方式" class="headerlink" title="Java中创建对象的5种方式"></a>Java中创建对象的5种方式</h2><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">创建方式</th>
<th align="center">是否调用构造函数</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">使用<code>new</code>关键字</td>
<td align="center">是</td>
<td></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">使用Class类的<code>newInstance()</code>方法</td>
<td align="center">是</td>
<td></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">使用Constructor类的<code>newInstance()</code></td>
<td align="center">是</td>
<td></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">使用<code>clone()</code>方法</td>
<td align="center">否</td>
<td></td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">使用反序列化</td>
<td align="center">否</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>第2种和第3种方式都利用了反射机制。</p>
</blockquote>
<h2 id="Java当中的四种引用"><a href="#Java当中的四种引用" class="headerlink" title="Java当中的四种引用"></a>Java当中的四种引用</h2><ul>
<li><p><code>强引用&gt; 软引用&gt; 弱引用&gt; 虚引用</code>。    不同的引用类型主要体现在<strong>GC</strong>上。</p>
<ol>
<li><p>强引用：</p>
<p>​    如果一个对象具有强引用，他就不会被垃圾回收器回收，即使当前内存空间不足，JVM也不会回收它，而是抛出<code>OutOfMemoryError</code>错误，使程序因出现异常而终止。    </p>
<p>​    如果想中断强引用和某个对象之间的关联，可以显式的将引用值赋为<code>null</code>，这样一来的话，JVM就会在合适的时间回收该对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;	<span class="comment">// 强引用[，不可变对象]</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;		<span class="comment">// 取消强引用 </span></span><br></pre></td></tr></table></figure></li>
<li><p>软引用：</p>
<p>​    在使用软引用时，如果内存空间足够，软引用就能继续被使用，而不会被垃圾回收器回收。只有内存不足时，软应用才会被垃圾回收器回收。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SoftReference</span> <span class="variable">softName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(<span class="string">&quot;张三&quot;</span>)；</span><br></pre></td></tr></table></figure></li>
<li><p>弱引用</p>
<p>​    具有弱引用的对象的拥有的生命周期更短暂。    因为当JVM进行垃圾回收，一旦发现弱引用对象，无论当前内存空间是否充足，都会将弱引用回收。    不过由于垃圾回收器是一个优先级较低的线程，所以并不一定能迅速发现弱引用对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WeakReference</span> <span class="variable">weakName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;String&gt;(<span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>虚引用</p>
<p>​    顾名思义，就是形同虚设。如果一个对象仅持有虚引用，那么它相当于没有引用，任何时候都可能被垃圾回收器回收。</p>
</li>
</ol>
</li>
</ul>
<hr>
<h2 id="为什么要有不同的引用类型？"><a href="#为什么要有不同的引用类型？" class="headerlink" title="为什么要有不同的引用类型？"></a>为什么要有不同的引用类型？</h2><p>​    在C语言中，我们可以完全手动控制内存的申请和释放。    而在Java中有时候我们需要适当的控制对象的回收时机，因此就诞生了不同的引用类型。可以说不同的引用类型实际上是对GC机制的一种衍生。</p>
<p>​    有以下几个场景可以充分的说明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 利用软引用和弱引用解决OOM（Out Of Memory）问题：</span><br><span class="line">    用一个HashMap来保存图片的路径和相应的图片对象关联的软引用之间的映射关系，在内存不足时，JVM会自动回收这些缓存图片对象所占用的空间，从而有效地避免了OOM的问题。</span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span> 通过软引用实现Java对象的高速缓存：</span><br><span class="line">    比如我们创建了一个Person的类，如果每次查询一个人的信息时都需要重新构建一个实例，哪怕是几秒钟之前刚刚查询过的，这将引起大量Person对象的消耗，并且由于这些对象生命周期较短，会引起多次GC影响性能。此时，通过软引用和HashMap的结合可以构建高速缓存，提高性能。【？？？】</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="Java中-和equals-的区别？equals-和hashCode的区别？"><a href="#Java中-和equals-的区别？equals-和hashCode的区别？" class="headerlink" title="Java中==和equals()的区别？equals()和hashCode的区别？"></a>Java中<code>==</code>和<code>equals()</code>的区别？<code>equals()</code>和<code>hashCode</code>的区别？</h2><h3 id="1、"><a href="#1、" class="headerlink" title="1、=="></a>1、==</h3><ol>
<li><p><code>==</code>比较的是两个对象的内存地址。    但是我们又常常碰到这样一个问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line">System.out.println(x==y);   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line">System.out.println(s1==s2);   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">System.out.println(s1==s3);     <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>既然<code>==</code>比较的是地址，那么<code>int、String</code>等数据类型的地址是怎样的呢？</p>
<p>​    对于基本数据类型（<code>byte、char、short、int、long、float、double、boolean</code>）来说，它们是作为常量在方法区中的常量池中以HashSet策略存储起来的。在常量池中，一个常量只会对应一个地址，因此不管再多的<code>123、&quot;123&quot;</code>这样的数据都保存在某一个地址中，即它们的引用指向的是内存中的同一块地址，因此基本类型和String类型的常量是可以通过<code>==</code>来直接比较其是否相等的。</p>
</li>
<li><p>另外，对于基本数据的包装类型（除了Float和Double），其它6种都是实现了常量池的，因此对于这些数据类型而言，我们<strong>一般</strong>以可以直接通过<code>==</code>来判断是否相等。</p>
</li>
<li><p>特殊情况如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line">System.out.println(i1==i2);     <span class="comment">// true</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">System.out.println(i3==i4);     <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>​    因为Integer在常量池中的存储范围是<code>[-128, 127]</code>，127在范围内，因此是直接存储在常量池中的，而128不在范围内，所以会在堆内存中创建一个新的对象来保存这个值，所以<code>i3、i4</code>分别指向了两个不同的内存地址，所以导致了不相等。</p>
</li>
</ul>
</li>
</ol>
<h3 id="2、equals"><a href="#2、equals" class="headerlink" title="2、equals()"></a>2、equals()</h3><ul>
<li><code>equals()</code>是超类<code>Object</code>类中的方法，用于比较两个对象是否相等。<ol>
<li>默认按两个对象的地址比较，此时和<code>==</code>的结果一样。</li>
<li>如果需要按对象的内容比较，需要重写<code>equals()</code>方法。</li>
</ol>
</li>
</ul>
<h3 id="3、hashCode"><a href="#3、hashCode" class="headerlink" title="3、hashCode"></a>3、hashCode</h3><ol>
<li><p>哈希表：</p>
<p>​    Hash表是一种数据结构，在JDK1.8之前，Hash表底层采用<code>数组+链表</code>实现，即使用链表处理冲突，同一Hash值的对象都存储在一个链表里。    但是当位于一个桶中的元素较多，即Hash值相等的元素较多时，通过key值依次查找的效率较低。    而在JDK1.8中，Hash表存储采用了<code>数组+链表+红黑树</code>实现，当链表长度超过阀值（默认为8）时，将链表转换为红黑树，这样大大减少了查找时间。</p>
<p><img src="/2020/10/01/Java%E9%9D%A2%E8%AF%95%E9%A2%98%E7%B2%BE%E9%80%89/image-20200927103816987.png"></p>
<p><img src="/2020/10/01/Java%E9%9D%A2%E8%AF%95%E9%A2%98%E7%B2%BE%E9%80%89/image-20200927104116199.png"></p>
</li>
<li><p><code>hashCode()</code>是<code>Object</code>类的一个方法，返回一个<code>int</code>类型的整数，从方法名上就可以看出，其作用就是生成一个Hash码（散列码）。    所有的Hash函数都有如下一个基本特性：</p>
<ul>
<li>如果<code>a=b</code>，则<code>h(a)=h(b)</code>；</li>
<li>如果<code>a!=b</code>，则<code>h(a)</code>与<code>h(b)</code>可能得到相同的hash值。</li>
</ul>
</li>
<li><p>HashCode的作用：</p>
<p>​    要想明白HashCode的作用，必须先知道Java中的集合。    总的来说，Java中的集合（Collection）分为两类，一类是List，另一类是Set。List集合中的元素时有序的，可以重复。<strong>Set</strong>集合中元素是无序的，不可以重复。</p>
<p>​    那么两个元素是否重复应该根据什么依据来判断呢？    显然我们可以使用<code>Object.equals()</code>方法。但是，如果每增加一个元素就检查一次，如果集合中现在已经有1000个元素，那么第1001个元素加入的时候，它就要调用1000次<code>equals()</code>方法，这显然效率非常低。于是，Java采取了Hash表的原理。</p>
<p>​    此时，当集合要添加新元素时，首先调用这个元素的<code>HashCode()</code>方法，就能一下子定位到它本应该存放的位置上。如果这个位置上没有元素，他就可以直接存储在这个位置上。    如果这个位置上已经有元素了，就调用该元素的<code>equals()</code>方法与新元素进行比较，相同的话就不存储新元素，不相同的话就存储在该位置的链表(或红黑树)上。这样一来实际调用<code>equals()</code>方法的次数就大大降低了。</p>
</li>
</ol>
<h2 id="可以在hashCode中使用随机数字吗？"><a href="#可以在hashCode中使用随机数字吗？" class="headerlink" title="可以在hashCode中使用随机数字吗？"></a>可以在hashCode中使用随机数字吗？</h2><ul>
<li>不行，为了保证同一对象的hashCode值必须相同。</li>
</ul>
<h2 id="3-0-1-0-3返回值是什么？"><a href="#3-0-1-0-3返回值是什么？" class="headerlink" title="3*0.1==0.3返回值是什么？"></a>3*0.1==0.3返回值是什么？</h2><ul>
<li>false，因为有些浮点数不能完全精确的表示出来。</li>
</ul>
<h2 id="符号的扩展"><a href="#符号的扩展" class="headerlink" title="+=符号的扩展"></a>+=符号的扩展</h2><p>​    <code>+=</code>操作符会进行隐式的自动类型转换。    如<code>a+=b</code>会先计算出<code>a+b</code>的结果，再将得到的结果强转为与<code>a</code>相同的类型并赋值给<code>a</code>，而<code>a=a+b</code>则不会进行自动类型转换。如： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">short</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    s+=<span class="number">1</span>;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	s+=1逻辑上看作是s=s+1，计算结果被提升为int类型，再想short类型赋值时发生错误，因为不能将取值范围大的类型赋值给取值范围小的类型。	</span></span><br><span class="line"><span class="comment">	但是，s=s+1实际上进行2次运算，而s+=1只进行1此运算，并带有强制转换的特点，也就是说s+=1等价于s=(short)(s+1)，因此程序可以正常运行。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h2 id="常量和变量的运算"><a href="#常量和变量的运算" class="headerlink" title="常量和变量的运算"></a>常量和变量的运算</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    <span class="type">byte</span> b1=<span class="number">1</span>;</span><br><span class="line">    <span class="type">byte</span> b2=<span class="number">2</span>;</span><br><span class="line">    <span class="type">byte</span> b3=<span class="number">1</span> + <span class="number">2</span>;		<span class="comment">// ok</span></span><br><span class="line">    <span class="type">byte</span> b4=b1 + b2;	<span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>b3=1 + 2</code>，1和2是常量，为固定不变的数据，在编译的时候，已经确定了<code>1+2</code>的结果并没有超过<code>byte</code>类型的取值范围，可以赋值给变量<code>b3</code>，因此<code>b3=1 + 2</code>是正确的。</li>
<li><code>b3=b2 + b3</code>，<code>b2</code>和<code>b3</code>是变量，变量的值是可能变化的，在编译的时候，编译器不能确定<code>b2+b3</code>的结果是什么，因此会将结果以<code>int</code>类型进行处理，所以<code>int</code>类型不能赋值给<code>byte</code>l类型，因此编译失败。</li>
</ul>
<h2 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h2><p>​    Java程序要求参与计算的数据的类型必须一致，如果数据类型不一致将发生数据类型的转换。</p>
<h3 id="1、自动转换"><a href="#1、自动转换" class="headerlink" title="1、自动转换"></a>1、自动转换</h3><ul>
<li><p>自动转换：将取值范围小的类型自动提升为取值范围大的类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// byte x = b + i; // 报错</span></span><br><span class="line">    <span class="comment">//int类型和byte类型运算，首先会将byte类型转换为int类型数据，所以结果是int类型</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> b + i;</span><br><span class="line">    System.out.println(j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2、强制转换"><a href="#2、强制转换" class="headerlink" title="2、强制转换"></a>2、强制转换</h3><ul>
<li>强制类型转换：将取值范围的类型强制转换为取值范围小的类型。<ol>
<li>浮点数转换为整数，直接取消小数点，可能造成数据损失精确度。</li>
<li><code>int</code>强制转换成<code>short</code>，砍掉2个字节，可能造成数据丢失。</li>
</ol>
</li>
</ul>
<h2 id="数据类型相关"><a href="#数据类型相关" class="headerlink" title="数据类型相关"></a>数据类型相关</h2><h3 id="1、64位的JVM中，int类型的长度是多少？"><a href="#1、64位的JVM中，int类型的长度是多少？" class="headerlink" title="1、64位的JVM中，int类型的长度是多少？"></a>1、64位的JVM中，int类型的长度是多少？</h3><ul>
<li>Java中，<code>int</code>类型变量的长度是一个固定值，与平台无关，都是32位。    也就是说，在32为和64位的Java虚拟机中，<code>int</code>类型的长度是相同的。</li>
</ul>
<h3 id="2、int和Integer的区别"><a href="#2、int和Integer的区别" class="headerlink" title="2、int和Integer的区别"></a>2、int和Integer的区别</h3><ul>
<li><code>Integer</code>是<code>int</code>的包装类型，在拆箱和装箱过程中，二者自动转换。<code>int</code>是基本类型，直接存数值，而<code>Integer</code>是对象，用一个引用指向这个对象。</li>
</ul>
<h3 id="3、int和Integer谁占用的内存更多？"><a href="#3、int和Integer谁占用的内存更多？" class="headerlink" title="3、int和Integer谁占用的内存更多？"></a>3、int和Integer谁占用的内存更多？</h3><ul>
<li><code>int</code>占用4个字节，存放在栈里面；而<code>Integer</code>占用16个字节存放在堆中。</li>
</ul>
<h3 id="4、String、StringBuffer和StringBuilder的区别"><a href="#4、String、StringBuffer和StringBuilder的区别" class="headerlink" title="4、String、StringBuffer和StringBuilder的区别"></a>4、String、StringBuffer和StringBuilder的区别</h3><ul>
<li><p><code>String</code>是字符串常量，<code>final</code>修饰；</p>
<p>​    <code>String</code>和<code>StringBuffer</code>主要区别是性能，<code>String</code>是不可变对象，每次对<code>String</code>类型进行操作就相当于产生了一个新的<code>String</code>对象，然后指向新的<code>String</code>对象。所以尽量不要对<code>String</code>进行大量的拼接操作，否则会产生很多临时对象，导致<code>GC</code>开始工作，影响系统性能。</p>
</li>
<li><p><code>StringBuffer</code>是字符串变量（线程安全）；</p>
<p>​    <code>StringBuffer</code>是对对象本身操作，而不是产生新的对象，因此在有大量拼接的情况下，我们建议使用<code>StringBuffer</code>。</p>
<p>​    注意：<code>JVM</code>会对<code>String</code>拼接做一定的优化，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;This is a&quot;</span> + <span class="string">&quot;simple&quot;</span> + <span class="string">&quot;test&quot;</span>;</span><br><span class="line"><span class="comment">// 会被JVM直接优化成：</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;This is a simple test&quot;</span>;</span><br><span class="line"><span class="comment">// 此时就不存在拼接过程</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>StringBuilder</code>是字符串变量（线程不安全）。</p>
<p>​    <code>StringBuffer</code>是线程安全的可变字符串，其内部实现是可变数组。<code>StringBuilder</code>是<code>JDK1.5</code>新增的，其功能和<code>StringBuffer</code>相似，但是非线程安全。因此，在没有多线程问题的前提下，使用<code>StringBuilder</code>会取得更好的性能。</p>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## 线程安全和线程不安全：</span></span><br><span class="line"><span class="bullet">1.</span> 线程安全</span><br><span class="line"><span class="code">	线程安全就是多线程访问时，采用了加锁机制，当一个线程访问该类的某个数据时进行保护，其它线程不能访问直到该线程读取完，其它线程才可以使用。不会出现数据不一致或者数据污染。</span></span><br><span class="line"><span class="code">	</span></span><br><span class="line"><span class="code">2. 线程不安全</span></span><br><span class="line"><span class="code">	线程不安全就是不提供数据访问保护，有可能出现多个线程先后更改数据，造成所得到的数据时脏数据。</span></span><br></pre></td></tr></table></figure>





<h3 id="5、什么是编译期常量？使用它有什么风险？"><a href="#5、什么是编译期常量？使用它有什么风险？" class="headerlink" title="5、什么是编译期常量？使用它有什么风险？"></a>5、什么是编译期常量？使用它有什么风险？</h3><ol>
<li><p>编译期常量 vs. 运行时常量</p>
<p>​    在Java程序中，常量用关键字**<code>static final</code>**修饰，常量又分为：<code>1.编译期常量</code>；<code>2.运行期常量</code>。</p>
<ul>
<li><p>编译期常量的特点就是：它的值在编译期就可以确定。比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">99</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>对于运行时常量，它的值虽然在运行时初始化后不再发生变化，但它的初始值必须等到运行时才能确定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(<span class="number">47</span>);</span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">ii</span> <span class="operator">=</span> rand.nextInt(<span class="number">20</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	虽然ii的值在程序初始化后就不会再发生变化，但是编译器无法在编译时确定它的值。[编译期只是做了一个翻译的工作，即将程序员编写的代码转化成机器能够识别的二进制代码]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>编译期常量不依赖类，不会引起类的初始化；而运行期常量依赖类，会引起类的初始化。</strong></p>
</li>
<li><p>公共静态不可变变量<code>[public] static final</code>也就是我们常说的编译器常量。</p>
</li>
</ul>
</li>
<li><p>编译期常量使用的风险</p>
<p>​    由于在编译时，常量会被替换为字面量，这是<code>JVM</code>提高运行效率优化代码的一种方式。但有时也会带来一定的麻烦。</p>
<p>​    如果我们的项目过大，项目整个编译一次特别耗费时间，那么我们有可能只编译代码修改的部分，此时如果我们一旦修改了常量A，且没有重新编译所有引用A常量的部分，那么未编译的部分代码仍会继续使用A的旧值，将会导致程序出错。</p>
</li>
</ol>
<h2 id="关于垃圾回收"><a href="#关于垃圾回收" class="headerlink" title="关于垃圾回收"></a>关于垃圾回收</h2><h3 id="1、你知道哪些垃圾回收算法"><a href="#1、你知道哪些垃圾回收算法" class="headerlink" title="1、你知道哪些垃圾回收算法"></a>1、你知道哪些垃圾回收算法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 标记-清除</span><br><span class="line"><span class="bullet">2.</span> 标记-复制</span><br><span class="line"><span class="bullet">3.</span> 标记-整理</span><br><span class="line"><span class="bullet">4.</span> 分代回收</span><br></pre></td></tr></table></figure>





<h1 id="2、JavaWeb"><a href="#2、JavaWeb" class="headerlink" title="2、JavaWeb"></a>2、JavaWeb</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/20/SpringBoot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/20/SpringBoot/" class="post-title-link" itemprop="url">SpringBoot</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-20 10:11:15" itemprop="dateCreated datePublished" datetime="2020-09-20T10:11:15+08:00">2020-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-29 10:14:35" itemprop="dateModified" datetime="2022-04-29T10:14:35+08:00">2022-04-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/2020/09/20/SpringBoot/SpringBoot.png"></p>
<h1 id="1、SpringBoot简介"><a href="#1、SpringBoot简介" class="headerlink" title="1、SpringBoot简介"></a>1、SpringBoot简介</h1><h2 id="1-1、为什么要学习SpringBoot"><a href="#1-1、为什么要学习SpringBoot" class="headerlink" title="1.1、为什么要学习SpringBoot"></a>1.1、为什么要学习SpringBoot</h2><p>因为 Spring 框架存在一些缺点，而 SpringBoot 框架在一定程度上很好的解决了这些缺点，所以我们需要学习 SpringBoot。</p>
<h3 id="1-1-1、Spring的缺点"><a href="#1-1-1、Spring的缺点" class="headerlink" title="1.1.1、Spring的缺点"></a>1.1.1、Spring的缺点</h3><ul>
<li><strong>配置复杂</strong>。虽然使用 Spring 开发的业务代码是轻量级的，但它的配置代码却是重量级的。Spring 中配置代码的发展可分为3个阶段：<ul>
<li>  （1）XML配置</li>
<li>  （2）注解配置</li>
<li>  （3）基于Java类的配置</li>
</ul>
</li>
<li><strong>依赖管理复杂</strong>。在搭建 Spring项目时，需要分析：<ul>
<li>  （1）要导入哪些库的坐标，以及与直接导入的库有依赖关系的库的坐标。</li>
<li>  （2）库与库之间的版本是否会产生冲突。</li>
</ul>
</li>
</ul>
<h3 id="1-1-2、SpringBoot-解决-Spring-的缺点"><a href="#1-1-2、SpringBoot-解决-Spring-的缺点" class="headerlink" title="1.1.2、SpringBoot 解决 Spring 的缺点"></a>1.1.2、SpringBoot 解决 Spring 的缺点</h3><p>SpringBoot 可以在很大程度上解决 Spring 的这2个缺点！</p>
<p>Spring Boot 推崇的<strong>约定大于配置</strong>的方式可以让我们很快地配置一个可以运行的程序。</p>
<ul>
<li>  SpringBoot 提供了约定俗成的配置文件信息，当然根据需求也可以覆盖默认配置信息。</li>
<li>  SpringBoot 框架实现了对绝大多数框架的依赖管理和依赖版本管理。</li>
</ul>
<h2 id="1-2、什么是SpringBoot"><a href="#1-2、什么是SpringBoot" class="headerlink" title="1.2、什么是SpringBoot"></a>1.2、什么是SpringBoot</h2><p>SpringBoot 是 Spring 项目的一个子工程，支持用一些固定的方式来构建生产级别的 Spring 应用。SpringBoot 推崇的<strong>约定大于配置</strong>的方式可以让你能够尽可能快速创建一个可以运行的程序。</p>
<p>其实人们把 SpringBoot 称为搭建程序的<code>脚手架</code>。其最主要作用就是帮我们<strong>快速的构建生产级别的Spring项目，并且尽可能的减少一切 XML 配置，做到开箱即用，迅速上手，让我们关注与业务而非配置</strong>。</p>
<p>SpringBoot 简化了基于 Spring 的应用开发，只需要“run”就能启动一个独立的、生产级别的 Spring 应用。SpringBoot 为 Spring 平台及大多数第三方库提供开箱即用的设置（<strong>提供默认设置</strong>）。多数 Spring Boot 应用只需要很少的 Spring 配置。</p>
<h2 id="1-3、SpringBoot的核心功能"><a href="#1-3、SpringBoot的核心功能" class="headerlink" title="1.3、SpringBoot的核心功能"></a>1.3、SpringBoot的核心功能</h2><ul>
<li>  <strong>起步依赖</strong></li>
<li>  <strong>自动配置</strong></li>
</ul>
<h3 id="1-3-1、起步依赖"><a href="#1-3-1、起步依赖" class="headerlink" title="1.3.1、起步依赖"></a>1.3.1、起步依赖</h3><p>起步依赖就是将某种场景需要使用到的依赖打包在一起，使用一个坐标，导入这一个坐标就相当于引入了一系列依赖。</p>
<p>比如，在 Web 场景中，我们可能要使用到 Servlet、jsp、SpringMVC 等等依赖，而 SpringBoot 就会把我们可能用到的依赖的坐标整合起来，并管理依赖的版本问题，只对外提供一个新的依赖坐标 <code>spring-boot-starter-web</code>。这样我们在使用时只需要导入 <code>spring-boot-starter-web</code> 依赖即可，而且无需管理版本问题。</p>
<h3 id="1-3-2、自动配置"><a href="#1-3-2、自动配置" class="headerlink" title="1.3.2、自动配置"></a>1.3.2、自动配置</h3><ul>
<li>  见下文</li>
</ul>
<hr>
<h1 id="2、SpringBoot快速入门"><a href="#2、SpringBoot快速入门" class="headerlink" title="2、SpringBoot快速入门"></a>2、SpringBoot快速入门</h1><h2 id="2-1-使用-Maven-创建-SpringBoot-项目"><a href="#2-1-使用-Maven-创建-SpringBoot-项目" class="headerlink" title="2.1 使用 Maven 创建 SpringBoot 项目"></a>2.1 使用 Maven 创建 SpringBoot 项目</h2><ol>
<li><p> 创建一个普通的 Maven 工程</p>
</li>
<li><p>在<code>pom.xml</code>文件中添加依赖。</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!--JDK版本管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!--SpringBoot中所有依赖的版本管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!--Web启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写一个启动类。SpringBoot 项目通过 main 函数启动，我们需要创建一个<strong>启动类</strong>：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写一个Controller</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello, spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>启动测试。接下来，我们运行main函数，查看控制台，我们可以看到监听的端口信息：</p>
<ul>
<li>  服务器默认提供的访问端口号是8080；</li>
<li>  前端控制器拦截的路径是：<code>/</code>；</li>
<li>  <code>/hello</code>访问路径映射到了<code>HelloController</code>中的<code>hello()</code>方法。</li>
</ul>
</li>
</ol>
<p><img src="/2020/09/20/SpringBoot/1525487705460.png" alt="1525487705460"></p>
<ol start="6">
<li> 在浏览器中访问。</li>
</ol>
<p><img src="/2020/09/20/SpringBoot/1525487820824.png" alt="1525487820824"></p>
<ol start="7">
<li><p>简化部署。将源代码编译成一个可执行的jar包。</p>
<ul>
<li>  通常而言，Web 项目都会被打成一个 war 包，运行这个 war 包需要 TomCat 服务器。而导入了 <code>spring-boot-maven-plugin</code> 的插件，则可以将应用打成一个jar包，这样无需安装在目标服务器中安装TomCat该Web项目也可以正常运行。</li>
<li>  该插件的原理就是：集成了一个默认的 TomCat，将可执行文件 war 和 TomCat 一起打成一个 jar 包。</li>
</ul>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个插件，可以将应用打包成一个可执行的jar包；无需在目标服务器中安装TomCat等--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 将这个应用打成 jar 包，使用 <code>java -jar</code> 命令运行 jar 包。</p>
<ul>
<li><p>（1）打包</p>
<p>  <img src="/2020/09/20/SpringBoot/image-20210103112702556.png" alt="image-20210103112702556"></p>
</li>
<li><p>（2）jar包所在的目录</p>
<p>  <img src="/2020/09/20/SpringBoot/image-20210103112807935.png" alt="image-20210103112807935"></p>
</li>
<li><p>（3）在 jar 包所在目录下，使用 <code>java-jar</code> 的命令运行jar包</p>
<p>  <img src="/2020/09/20/SpringBoot/image-20210103113115811.png" alt="image-20210103113115811"></p>
</li>
<li><p>  （4）通过浏览器访问。</p>
</li>
</ul>
</li>
</ol>
<ol start="8">
<li> SpringBoot 在执行完打包命令后得到一个jar包，可以看到这个jar包也是一个压缩文件，在其<code>BOOT-INF/lib</code>目录下，我们可以看到已经导入了依赖和嵌入式的 TomCat，所以我们的目标环境就可以无需自己安装 TomCat 服务器也可正常运行。</li>
</ol>
<p><img src="/2020/09/20/SpringBoot/image-20210103113305223.png" alt="image-20210103113305223"></p>
<hr>
<h2 id="2-2-快速入门分析"><a href="#2-2-快速入门分析" class="headerlink" title="2.2 快速入门分析"></a>2.2 快速入门分析</h2><h3 id="2-2-1-POM文件"><a href="#2-2-1-POM文件" class="headerlink" title="2.2.1 POM文件"></a>2.2.1 POM文件</h3><h4 id="1、JDK版本管理"><a href="#1、JDK版本管理" class="headerlink" title="1、JDK版本管理"></a>1、JDK版本管理</h4><p>当前项目使用的 MAVEN 版本是 <code>apache-maven-3.5.2</code>，该版本默认使用 JDK1.5 对源码进行编译。</p>
<p>而项目开发使用的是 JDK 版本是 1.8，因此我们需要修改 Maven 编译时的 JDK 版本为 1.8。</p>
<ul>
<li>  <strong>全局修改</strong>：修改 Maven 的配置文件 <code>setting.xml</code>，一次修改，永久生效。</li>
</ul>
<p>做法：在<code>setting.xml</code>配置文件中的<code>&lt;profiles&gt;</code>标签下添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>  <strong>局部修改</strong>：针对具体的某个Maven项目的设置。每创建一个新项目都要重新设置。</li>
</ul>
<p>做法：在当前 Maven 工程的<code>pom.xml</code>文件中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>





<hr>
<h4 id="2、SpringBoot的版本管理器（父项目）"><a href="#2、SpringBoot的版本管理器（父项目）" class="headerlink" title="2、SpringBoot的版本管理器（父项目）"></a>2、SpringBoot的版本管理器（父项目）</h4><ul>
<li>  <code>spring-boot-starter-parent</code>：只管理版本信息，并没有导入真正的jar包。</li>
</ul>
<p>所有的 SpringBoot 项目都会依赖一个名为<code>spring-boot-starter-parent</code>的启动器，这个启动器里面已经对常用的各种依赖（并非全部）的版本进行了管理，我们的项目只需以这个项目为父工程，就不用操心依赖的版本问题了，需要什么依赖，直接引入坐标即可。</p>
<p>以后我们导入依赖默认不需要写版本（没有在<code>spring-boot-dependencies</code>项目中声明的依赖自然还需要手动声明版本号）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringBoot依赖一个父启动器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">&lt;!--SpringBoot的父启动器继续依赖一个父项目--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">&lt;!--该项目（SpringBoot的爷爷项目）用来管理SpringBoot应用里面的所有依赖版本。只是用来管理版本，并没有导入具体的依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activemq.version</span>&gt;</span>5.16.0<span class="tag">&lt;/<span class="name">activemq.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">antlr2.version</span>&gt;</span>2.7.7<span class="tag">&lt;/<span class="name">antlr2.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bitronix.version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">bitronix.version</span>&gt;</span></span><br><span class="line">    ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h4 id="3、场景启动器"><a href="#3、场景启动器" class="headerlink" title="3、场景启动器"></a>3、场景启动器</h4><ul>
<li>  <code>spring-boot-starter-xxx</code>：SpringBoot 的场景启动器，真正导入 jar 包。</li>
</ul>
<p>SpringBoot 已经帮我们将开发中常见的场景所需的依赖抽取出来，制作成一个个的 <strong>starter（启动器）</strong>，只需要在项目里引入这些 starter，相关场景所有的直接/间接依赖就都会导入进来。我们需要使用什么功能就导入什么场景的启动器。</p>
<p>比如要创建一个 Web 项目，只需导入 SpringBoot 提供的 Web 启动器，该启动器会自动帮我们导入 Web 功能正常运行所依赖的所有依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--需要注意的是，我们并没有在这里指定版本信息。因为SpringBoot的爷爷工程已经对版本进行了管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个时候，我们会发现项目中多出了大量的依赖：</p>
<ul>
<li>  这些都是 SpringBoot 根据 <code>spring-boot-starter-web</code> 这个依赖自动引入的，而且所有的版本都已经管理好，不会出现依赖冲突。</li>
<li>  SpringBoot 集成了大部分主流的框架并且制作了启动器，部分没有收录的框架如 MyBatis 则是自己实现了 SpringBoot 的启动器。</li>
</ul>
<p> <img src="/2020/09/20/SpringBoot/1525486980765.png" alt="1525486980765"></p>
<hr>
<h3 id="2-2-2-启动类-自动配置原理分析"><a href="#2-2-2-启动类-自动配置原理分析" class="headerlink" title="2.2.2 启动类 (自动配置原理分析)"></a>2.2.2 启动类 (自动配置原理分析)</h3><p><img src="/2020/09/20/SpringBoot/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86.png"></p>
<p>在 SpringBoot 的启动类中有2个特殊的地方：</p>
<ul>
<li>  <strong>@SpringBootApplication</strong>：该注解标注在某个类上就说明这个类是 SpringBoot 项目的启动类，SpringBoot 应该运行这个类的 main 方法来启动 SpringBoot 应用。</li>
<li>  <strong>SpringApplication.run(Xxx.class, args)</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> ，用来声明该应用是一个 SpringBoot 应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>	<span class="comment">// 1️⃣</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动SpringBoot应用</span></span><br><span class="line">        SpringApplication.run(Application.class, args);	<span class="comment">// 2️⃣</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="1、-SpringBootApplication"><a href="#1、-SpringBootApplication" class="headerlink" title="1、@SpringBootApplication"></a>1、@SpringBootApplication</h4><p>查看源码：</p>
<p><img src="/2020/09/20/SpringBoot/1525488226710.png" alt="1525488226710"></p>
<blockquote>
<p>  <strong>@SpringBootConfiguration</strong></p>
</blockquote>
<p><code>@SpringBootConfiguration</code> 就是 <code>@Configuration</code>，表示该类是一个配置类，只不过在 SpringBoot 项目中为了更加语义化将其命名为 <code>@SpringBootConfiguration</code>。</p>
<ul>
<li>  查看源码：</li>
</ul>
<p><img src="/2020/09/20/SpringBoot/1525488518514.png" alt="1525488518514"></p>
<p>我们可以到，在这个注解中又有一个<code>@Configuration</code>注解。这个注解的作用就是声明当前类是一个配置类，项目启动时会将该类注册到容器中，并自动加载配置类中的配置信息。</p>
<p>配置类 <code>&lt;==&gt;</code> 配置文件，配置类也是容器中的一个组件，所以<code>@Configuration</code>注解的源码中也有<code>@Component</code>注解，即只使用<code>@Configuration</code>注解后也会被扫描添加到容器中。</p>
<img src="/2020/09/20/SpringBoot/image-20210909103358197.png" alt="image-20210909103358197" style="zoom:67%;">



<hr>
<blockquote>
<p>  <strong>@EnableAutoConfiguration</strong></p>
</blockquote>
<p><code>@EnableAutoConfiguration</code> 的作用就是开启 SpringBoot 的自动配置功能，就是根据项目中引入的依赖来生成对应的默认配置。</p>
<ul>
<li><p>自动配置的原理就是：SpringBoot 根据项目添加的依赖，提供这些依赖的约定成俗的默认配置。比如我们引入了<code>spring-boot-starter-web</code>起步依赖，这个起步依赖中又包含了<code>tomcat</code>、<code>SpringMVC</code>和<code>Servlet</code>等依赖，此时 SpringBoot 自动配置就会提供<code>tomcat</code>、<code>SpringMVC</code>和<code>Servlet</code>等组件的默认配置信息。</p>
</li>
<li><p>总结：SpringBoot 内部对大量的第三方库或 Spring 内部库进行了默认配置，这些配置是否生效，取决于我们是否引入了对应库所需的依赖，如果有那么默认配置就会生效。</p>
</li>
<li><p>所以，我们使用 SpringBoot 构建一个项目，只需要引入所需框架的依赖，配置就可以交给 SpringBoot 处理了。如果你不希望使用SpringBoot 的默认配置，它也提供了自定义配置的入口。</p>
</li>
</ul>
<blockquote>
<p>  <strong>@ComponentScan</strong></p>
</blockquote>
<ul>
<li>  查看源码：</li>
</ul>
<p> <img src="/2020/09/20/SpringBoot/1525498265579.png" alt="1525498265579"></p>
<ul>
<li>  配置组件扫描的指令。提供了类似与<code>&lt;context:component-scan&gt;</code>标签相似的作用。</li>
<li>  通过<code>basePackageClasses</code>或者<code>basePackages</code>属性来指定要扫描的包。如果没有指定这些属性，默认从使用该注解的类所在的包开始，扫描当前包及其子包。</li>
<li>  <code>@ComponentScan注解</code>是<code>@SpringBootApplication注解</code>的子注解，而<code>@SpringBootApplication注解</code>作用在启动类上，因此<strong>扫描的包是启动类所在包及其子包</strong>。因此，一般启动类会放在一个比较靠前的包目录中。</li>
</ul>
<hr>
<h2 id="2-3-使用Spring-Initializer快速创建-SpringBoot-项目"><a href="#2-3-使用Spring-Initializer快速创建-SpringBoot-项目" class="headerlink" title="2.3    使用Spring Initializer快速创建 SpringBoot 项目"></a>2.3    使用Spring Initializer快速创建 SpringBoot 项目</h2><blockquote>
<p>  默认 SpringBoot 项目的目录结构：</p>
</blockquote>
<ul>
<li>  启动类（主程序）已经生成好了，我们只需要实现自己的业务逻辑</li>
<li><code>resources</code>文件夹中的目录结构：<ul>
<li>  <code>static</code>：保存所有的静态资源；</li>
<li>  <code>templates</code>：保存所有的模板页面；（SpringBoot 默认jar包使用嵌入式的TomCat，默认不支持JSP页面），可以使用的模板引擎（freemarker、thymeleaf）；</li>
<li>  <code>application.properties</code>：应用配置文件。</li>
</ul>
</li>
</ul>
<hr>
<h1 id="3、SpringBoot原理分析"><a href="#3、SpringBoot原理分析" class="headerlink" title="3、SpringBoot原理分析"></a>3、SpringBoot原理分析</h1><p>SpringBoot 为我们提供了默认配置，而默认配置生效的条件一般有两个：</p>
<ul>
<li>你引入了相关依赖</li>
<li>你自己没有配置</li>
</ul>
<blockquote>
<ol>
<li> <strong>启动依赖</strong></li>
</ol>
</blockquote>
<ul>
<li>  所以，我们如果不想手动配置，只需要引入依赖即可，而依赖版本我们也不用操心，因为只要引入了 <code>spring-bbot-starter-parent</code>，就会自动管理依赖及版本了。</li>
<li>  因此，使用SpringBoot的第一件事情，就是找启动器，SpringBoot提供了大量的默认启动器。</li>
</ul>
<blockquote>
<ol start="2">
<li> <strong>全局配置</strong></li>
</ol>
</blockquote>
<ul>
<li>  另外，SpringBoot 提供了默认配置，而默认配置可以通过改写 <code>application.properties</code> 配置文件来进行覆盖。</li>
<li>  因此，使用SpringBoot的第二件事情，就是通过<code>application.properties</code>来覆盖默认配置，所以我们需要知道 SpringBoot 配置属性的 key。</li>
<li>  SpringBoot 默认会从类路径下的加载 <code>application.properties</code> 或者 <code>application.yml</code> 文件。</li>
</ul>
<hr>
<h1 id="4、Java配置"><a href="#4、Java配置" class="headerlink" title="4、Java配置"></a>4、Java配置</h1><ul>
<li>  在 SpringBoot 中，我们可以不编写任何配置文件，就能实现一个 SpringMVC 的项目了。</li>
<li>  但是如果没有任何的 XML，那么我们如果要配置一个 Bean 该怎么办？</li>
<li>  比如我们要配置一个数据库连接池对象，在 Spring 中我们可以使用 XML 配置文件配置对象信息，在项目启动时将对应的 Class 对象加载到容器中。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  那么在 SpringBoot 中是如何实现对象注入容器的呢？我们可以使用Java配置。</li>
</ul>
<h2 id="4-1、使用Java配置"><a href="#4-1、使用Java配置" class="headerlink" title="4.1、使用Java配置"></a>4.1、使用Java配置</h2><p>Java 配置就是：通过使用 Java 类和一些注解，代替配置文件保存配置信息。比较常用的注解有：</p>
<ul>
<li><code>@Configuration</code>：作用在类上，声明该类是一个配置类，用于代替 XML 配置文件；</li>
<li><code>@Bean</code>：作用在方法上，将方法的返回值添加到 Spring 容器中，用于代替<code>&lt;bean&gt;</code>标签；</li>
<li><code>@value</code>：作用在属性上，属性注入；</li>
<li><code>@PropertySource</code>：作用在类上，用来指定外部属性文件中的路径。</li>
</ul>
<h3 id="例子：用Java配置实现数据库连接池的配置："><a href="#例子：用Java配置实现数据库连接池的配置：" class="headerlink" title="例子：用Java配置实现数据库连接池的配置："></a>例子：用Java配置实现数据库连接池的配置：</h3><ol>
<li>首先引入Druid连接池依赖：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建一个jdbc.properties文件，编写jdbc属性：</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/leyou</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写配置类代码：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driverClassName&#125;&quot;)</span></span><br><span class="line">    String driverClassName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setDriverClassName(driverClassName);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  <strong>分析：</strong></p>
</blockquote>
<ul>
<li><code>@Configuration</code>：声明<code>JdbcConfig类</code>是一个配置类</li>
<li><code>@PropertySource</code>：指定属性文件的路径是:<code>classpath:jdbc.properties</code></li>
<li>通过<code>@Value</code>为属性注入值</li>
<li>通过<code>@Bean</code>注解将 <code>dataSource()</code>方法的返回值加入 Spring 容器中。</li>
<li>然后我们就可以在任意位置通过<code>@Autowired</code>注入DataSource了。</li>
</ul>
<ol start="4">
<li>编写测试类：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello, spring boot!&quot;</span> + dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后Debug运行并查看：</p>
<p><img src="/2020/09/20/SpringBoot/1525492528558.png" alt="1525492528558"></p>
<p>属性注入成功了！</p>
<hr>
<h2 id="4-2、SpringBoot的属性注入"><a href="#4-2、SpringBoot的属性注入" class="headerlink" title="4.2、SpringBoot的属性注入"></a>4.2、SpringBoot的属性注入</h2><ul>
<li>  在上面的案例中，我们使用了 Java 类的配置方式。不过属性注入使用的是 <code>@Value</code> 注解。这种方式虽然可行，但是不够强大，因为它只能注入基本类型和 String 类型变量。[<code>@Value</code>注解是Spring中通用的注解]</li>
<li>  <strong>在SpringBoot中，提供了一种新的属性注入方式，支持各种 Java 基本数据类型及复杂类型的注入。</strong></li>
<li><code>@ConfigurationProperties(prefix = &quot;xxx&quot;)--&gt;&gt; @EnableConfigurationProperties(xxx.class)</code><ol>
<li>将基本属性注入到一个类A中；</li>
<li>将类A通过反射注入到类B中。</li>
</ol>
</li>
</ul>
<blockquote>
<ol>
<li> 我们定义一个<code>JdbcProperties类</code>，用来进行属性注入：</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;jdbc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// ... 略</span></span><br><span class="line">    <span class="comment">// getters 和 setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>@ConfigurationProperties</strong> 注解默认读取的是类路径下的 <code>application.yml</code> 配置文件，<code>prefix=&quot;jdbc&quot;</code>，通过注解的属性<code>prefix</code>限定读取的数据，在这里是读取属性文件中，前缀为 jdbc 的值。</p>
</li>
<li><p>要求类中定义的各个属性名称必须与<code>application.yml</code>属性文件中的<code>jdbc.</code>后面部分一致</p>
</li>
<li><p>需要注意的是，这里我们并没有指定属性文件的地址，所以我们需要把<code>jdbc.properties</code>名称改为<code>application.properties</code>，这是SpringBoot默认读取的属性文件名：</p>
</li>
</ul>
<p><img src="/2020/09/20/SpringBoot/1525496325572.png" alt="1525496325572"></p>
<blockquote>
<ol start="2">
<li> 在<code>JdbcConfig类</code>中使用<code>JdbcProperties对象</code>：</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(JdbcProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(JdbcProperties jdbc)</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setUrl(jdbc.getUrl());</span><br><span class="line">        dataSource.setDriverClassName(jdbc.getDriverClassName());</span><br><span class="line">        dataSource.setUsername(jdbc.getUsername());</span><br><span class="line">        dataSource.setPassword(jdbc.getPassword());</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>**@EnableConfigurationProperties(JdbcProperties.class)**：表明该类要使用 <code>JdbcProperties</code>类的实例对象。</li>
<li>通过反射的方式动态的生成<code>JdbcProperties</code>对象，可以在该类的方法中直接使用：</li>
</ol>
<blockquote>
<ol start="3">
<li> 测试结果：</li>
</ol>
</blockquote>
<p><img src="/2020/09/20/SpringBoot/1525492528558.png" alt="1525492528558"></p>
<hr>
<h2 id="4-3、更简单的注入"><a href="#4-3、更简单的注入" class="headerlink" title="4.3、更简单的注入"></a>4.3、更简单的注入</h2><ul>
<li>  事实上，如果一段属性（配置信息）只被一个Bean需要，我们无需将先其注入到一个类（<code>JdbcProperties</code>）中。而是直接在需要的地方使用<code>@ConfigurationProperties注解</code>声明即可。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// 声明要注入的属性前缀，SpringBoot会自动把相关属性通过set方法注入到DataSource中</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;jdbc&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  我们直接把<code>@ConfigurationProperties(prefix = &quot;jdbc&quot;)</code>声明在需要使用该段属性的<code>@Bean</code>的方法上，然后SpringBoot就会自动调用这个Bean（此处是DataSource）的set方法，然后完成注入。</li>
<li>  使用的前提是：<strong>该类必须有对应属性的set方法！</strong></li>
</ul>
<hr>
<h1 id="5、SpringBoot整合SpringMVC"><a href="#5、SpringBoot整合SpringMVC" class="headerlink" title="5、SpringBoot整合SpringMVC"></a>5、SpringBoot整合SpringMVC</h1><h2 id="5-1、添加起步依赖"><a href="#5-1、添加起步依赖" class="headerlink" title="5.1、添加起步依赖"></a>5.1、添加起步依赖</h2><p>直接引入<code>spring-boot-starter-web</code>启动依赖即可。</p>
<h2 id="5-2、自定义配置信息"><a href="#5-2、自定义配置信息" class="headerlink" title="5.2、自定义配置信息"></a>5.2、自定义配置信息</h2><blockquote>
<ol>
<li> <strong>修改端口号</strong></li>
</ol>
</blockquote>
<ul>
<li>  查看SpringBoot的全局属性可知，端口通过以下方式配置：</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 映射端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure>



<blockquote>
<ol start="2">
<li> <strong>访问静态资源</strong></li>
</ol>
</blockquote>
<p>默认的静态资源路径为：</p>
<ul>
<li>classpath:/META-INF/resources/</li>
<li>classpath:/resources/</li>
<li>classpath:/static/</li>
<li>classpath:/public</li>
</ul>
<p>只要静态资源放在这些目录中任何一个，SpringMVC 都会帮我们处理。我们习惯会把静态资源放在<code>classpath:/static/</code>目录下。</p>
<p> <img src="/2020/09/20/SpringBoot/1525512196866.png" alt="1525512196866"></p>
<blockquote>
<ol start="3">
<li> <strong>添加拦截器</strong></li>
</ol>
</blockquote>
<ul>
<li><p>如果你想要保持 SpringBoot 的一些默认 MVC 特征，同时又想自定义一些MVC配置（包括：拦截器，格式化器、视图控制器、类型转换器 等等），你应该：</p>
<ol>
<li>让一个类实现<code>WebMvcConfigurer</code>，</li>
<li>并且添加<code>@Configuration</code>注解，但是<strong>千万不要</strong>加<code>@EnableWebMvc</code>注解。</li>
</ol>
<p>  如果你想要自定义<code>HandlerMapping</code>、<code>HandlerAdapter</code>、<code>ExceptionResolver</code>等组件，你可以创建一个<code>WebMvcRegistrationsAdapter</code>实例 来提供以上组件。</p>
</li>
<li><p>如果你想要完全自定义 SpringMVC，不保留SpringBoot提供的一切特征，你可以自己定义类并且添加<code>@Configuration</code>注解和<code>@EnableWebMvc</code>注解</p>
</li>
<li><p>总结：通过实现<code>WebMvcConfigurer</code>类并添加<code>@Configuration</code>注解来实现自定义部分 SpringMVC 配置。</p>
</li>
</ul>
<blockquote>
<ol>
<li> 首先我们定义一个拦截器：</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LoginInterceptor.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;preHandle method is now running!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;postHandle method is now running!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;afterCompletion method is now running!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<ol start="2">
<li> 然后，我们定义配置类，注册拦截器：</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过<span class="doctag">@Bean</span>注解，将我们定义的拦截器注册到Spring容器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LoginInterceptor <span class="title function_">loginInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写接口中的addInterceptors方法，添加自定义拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过registry来注册拦截器，通过addPathPatterns来添加拦截路径</span></span><br><span class="line">        registry.addInterceptor(<span class="built_in">this</span>.loginInterceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构如下：</p>
<p> <img src="/2020/09/20/SpringBoot/1525513555179.png" alt="1525513555179"></p>
<p>接下来运行并查看日志：</p>
<p>你会发现日志中什么都没有，因为我们记录的log级别是debug，默认是显示info以上，我们需要进行配置。</p>
<p>SpringBoot通过<code>logging.level.*=debug</code>来配置日志级别，*填写包名</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置com.leyou包的日志级别为debug</span></span><br><span class="line"><span class="attr">logging.level.com.leyou</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure>

<p>再次运行查看：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>-<span class="number">05</span>-<span class="number">05</span> <span class="number">17</span>:<span class="number">50</span>:<span class="number">01</span><span class="variable">.811</span> DEBUG <span class="number">4548</span> --- [p-nio-<span class="number">80</span>-exec-<span class="number">1</span>] com<span class="variable">.leyou</span><span class="variable">.interceptor</span><span class="variable">.LoginInterceptor</span>   : preHandle method is now running!</span><br><span class="line"><span class="number">2018</span>-<span class="number">05</span>-<span class="number">05</span> <span class="number">17</span>:<span class="number">50</span>:<span class="number">01</span><span class="variable">.854</span> DEBUG <span class="number">4548</span> --- [p-nio-<span class="number">80</span>-exec-<span class="number">1</span>] com<span class="variable">.leyou</span><span class="variable">.interceptor</span><span class="variable">.LoginInterceptor</span>   : postHandle method is now running!</span><br><span class="line"><span class="number">2018</span>-<span class="number">05</span>-<span class="number">05</span> <span class="number">17</span>:<span class="number">50</span>:<span class="number">01</span><span class="variable">.854</span> DEBUG <span class="number">4548</span> --- [p-nio-<span class="number">80</span>-exec-<span class="number">1</span>] com<span class="variable">.leyou</span><span class="variable">.interceptor</span><span class="variable">.LoginInterceptor</span>   : afterCompletion method is now running!</span><br></pre></td></tr></table></figure>





<hr>
<h1 id="6、SpringBoot整合JDBC和事务"><a href="#6、SpringBoot整合JDBC和事务" class="headerlink" title="6、SpringBoot整合JDBC和事务"></a>6、SpringBoot整合JDBC和事务</h1><p>Spring 中的 JDBC 连接和事务是配置中的重要一环，在 SpringBoot 中该如何处理呢？</p>
<ul>
<li>  答案是不需要处理，我们只要找到SpringBoot提供的启动器即可：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  当然，不要忘了数据库驱动，SpringBoot并不知道我们用的什么数据库，这里我们选择MySQL：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  至于事务，SpringBoot 中通过注解来控制。就是我们熟知的 <code>@Transactional</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.userMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h1 id="7、SpringBoot整合连接池"><a href="#7、SpringBoot整合连接池" class="headerlink" title="7、SpringBoot整合连接池"></a>7、SpringBoot整合连接池</h1><h2 id="7-1、默认DataBase"><a href="#7-1、默认DataBase" class="headerlink" title="7.1、默认DataBase"></a>7.1、默认DataBase</h2><p>事实上，在引入JDBC启动器的时候，SpringBoot已经自动帮我们引入了一个数据库连接池。因此，我们只需要指定连接池参数即可：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接四大参数</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/heima</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"># 可省略，SpringBoot自动推断</span></span><br><span class="line"><span class="attr">spring.datasource.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.datasource.hikari.idle-timeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.maximum-pool-size</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.minimum-idle</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>



<h2 id="7-2、手动引入DataBase"><a href="#7-2、手动引入DataBase" class="headerlink" title="7.2、手动引入DataBase"></a>7.2、手动引入DataBase</h2><p>当然，如果你更喜欢Druid连接池，也可以使用Druid官方提供的启动器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Druid连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置接信息。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#初始化连接数</span></span><br><span class="line"><span class="attr">spring.datasource.druid.initial-size</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#最小空闲连接</span></span><br><span class="line"><span class="attr">spring.datasource.druid.min-idle</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#最大活动连接</span></span><br><span class="line"><span class="attr">spring.datasource.druid.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="comment">#获取连接时测试是否可用</span></span><br><span class="line"><span class="attr">spring.datasource.druid.test-on-borrow</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#监控页面启动</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.allow</span>=<span class="string">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<hr>
<h1 id="8、SpringBoot整合MyBatis"><a href="#8、SpringBoot整合MyBatis" class="headerlink" title="8、SpringBoot整合MyBatis"></a>8、SpringBoot整合MyBatis</h1><h2 id="8-1、MyBatis"><a href="#8-1、MyBatis" class="headerlink" title="8.1、MyBatis"></a>8.1、MyBatis</h2><blockquote>
<p>SpringBoot官方并没有提供Mybatis的启动器，不过Mybatis自己实现了：</p>
</blockquote>
<ol>
<li>添加MyBatis起步依赖</li>
<li>添加数据库驱动坐标</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--mysql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>添加数据库连接信息</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis 别名扫描</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.heima.pojo</span></span><br><span class="line"><span class="comment"># mapper.xml文件位置,如果没有映射文件，请注释掉</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:mappers/*.xml</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tip：这里面没有配置mapper接口扫描包，因此我们需要给每一个Mapper接口添加<code>@Mapper</code>注解，才能被识别。</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="8-2、SpringBoot整合通用Mapper"><a href="#8-2、SpringBoot整合通用Mapper" class="headerlink" title="8.2、SpringBoot整合通用Mapper"></a>8.2、SpringBoot整合通用Mapper</h2><blockquote>
<p>超链接：<a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2020/09/07/%E9%80%9A%E7%94%A8Mapper%E7%9A%84%E8%AF%A6%E8%A7%A3/">通用Mapper详解</a></p>
</blockquote>
<hr>
<h1 id="9、SpringBoot整合Junit"><a href="#9、SpringBoot整合Junit" class="headerlink" title="9、SpringBoot整合Junit"></a>9、SpringBoot整合Junit</h1><ol>
<li><p>添加<code>Junit</code>起步依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = MySpringBootApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span>()&#123;</span><br><span class="line">    <span class="comment">// 测试逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>@RunWith()</code>的作用是替换单元测试模块为SpringBoot的单元测试模块</li>
<li><code>@SpringBootTest()</code>的属性指定的启动类的字节码对象。</li>
</ul>
</blockquote>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/" class="post-title-link" itemprop="url">通过虚拟机安装CentOS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-17 23:03:08" itemprop="dateCreated datePublished" datetime="2020-09-17T23:03:08+08:00">2020-09-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-11-20 17:30:14" itemprop="dateModified" datetime="2021-11-20T17:30:14+08:00">2021-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux-安装"><a href="#Linux-安装" class="headerlink" title="Linux 安装"></a>Linux 安装</h1><p>两个概念： 物理机和虚拟机。</p>
<p>创建虚拟机需要一台<strong>支持虚拟化</strong>的物理机和虚拟化软件（如VMWare）。需要先当前物理机开启虚拟化支持。</p>
<p>步骤大体分两步，第一步使用虚拟化软件（VMWara）虚拟出一台虚拟机，然后再为这台虚拟机安装操作系统！</p>
<h2 id="查看虚拟化支持"><a href="#查看虚拟化支持" class="headerlink" title="查看虚拟化支持"></a>查看虚拟化支持</h2><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20211119221353669.png" alt="image-20211119221353669" style="zoom: 50%;">





<h1 id="1-安装-VMvare-虚拟化软件"><a href="#1-安装-VMvare-虚拟化软件" class="headerlink" title="1    安装 VMvare 虚拟化软件"></a>1    安装 VMvare 虚拟化软件</h1><h2 id="1-1-什么是虚拟软件"><a href="#1-1-什么是虚拟软件" class="headerlink" title="1.1    什么是虚拟软件"></a>1.1    什么是虚拟软件</h2><p>虚拟化软件是一个可以使你在一台机器上同时运行两个或更多的 Windows、LINUX 等系统。它可以模拟一个标准PC环境。这个环境和真实的计算机一样，都有芯片组、CPU、内存、显卡、声卡、网卡、软驱、硬盘、光驱、串口、并口、USB控制器等。</p>
<h2 id="1-2-常用的虚拟原件"><a href="#1-2-常用的虚拟原件" class="headerlink" title="1.2    常用的虚拟原件"></a>1.2    常用的虚拟原件</h2><ul>
<li><code>VMware workstation</code></li>
<li><code>VirtualBox</code></li>
</ul>
<h2 id="1-3-VMware-workstation安装"><a href="#1-3-VMware-workstation安装" class="headerlink" title="1.3    VMware workstation安装"></a>1.3    VMware workstation安装</h2><ol start="2">
<li><p>点击next进行安装</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps1.jpg" alt="img"></p>
</li>
<li><p> 选择安装方式</p>
</li>
</ol>
<p>   <img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps2.jpg" alt="img"></p>
<ul>
<li>Typical：典型安装</li>
<li>Custom：自定义安装</li>
</ul>
<ol start="4">
<li><p>选择程序安装位置</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps3.jpg" alt="img"></p>
<p>点击 change 选择程序安装位置，然后点击 next</p>
</li>
<li><p>选择是否自动检测更新</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps4.jpg" alt="img"></p>
</li>
<li><p>创建快捷方式，选择后点击 next。</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps5.jpg" alt="img"></p>
</li>
<li><p>配置完成，开始安装程序</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps6.jpg" alt="img"></p>
</li>
<li><p>开始安装虚拟原件</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps7.jpg" alt="img"></p>
</li>
<li><p>完成。</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps8.jpg" alt="img"></p>
</li>
</ol>
<hr>
<h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps9.jpg" alt="img"></p>
<p>虚拟软件安装完成后会在 <code>控制面板\网络和Internet\网络连接</code> 下多出来两个虚拟网卡<code>VMware Network Adapter VMnet1</code>和<code>VMware Network Adapter VMnet8</code>，需要将这两个网卡禁用。</p>
<ul>
<li><p>选中VMnet1和VMnet8，右键点击禁用</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps10.jpg" alt="img"> </p>
</li>
</ul>
<hr>
<h1 id="2-安装-CentOS"><a href="#2-安装-CentOS" class="headerlink" title="2    安装 CentOS"></a>2    安装 CentOS</h1><ul>
<li>环境：Windows7 , VMware Workstation10, CentOS6.4</li>
<li>为什么选择 CentOS ?<ol>
<li>主流： 目前的Linux操作系统主要应用于生产环境，主流企业级Linux系统仍旧是RedHat或者CentOS</li>
<li>免费： RedHat 和CentOS差别不大，CentOS是一个基于Red Hat Linux 提供的可自由使用源代码的企业级 Linux 发行版本</li>
<li>更新方便：CentOS独有的yum命令支持在线升级，可以即时更新系统，不像RED HAT那样需要花钱购买支持服务！</li>
</ol>
</li>
</ul>
<hr>
<h2 id="2-1-安装步骤"><a href="#2-1-安装步骤" class="headerlink" title="2.1 安装步骤"></a>2.1 安装步骤</h2><ol>
<li><p>打开 <code>VMware Workstation</code>。</p>
</li>
<li><p><code>文件 → 新建虚拟机</code> 或 直接点击 <code>创建新的虚拟机</code>图标。</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps1-1600356028741.jpg" alt="img"></p>
</li>
<li><p>选择 <code>典型（推荐）→ 下一步 </code></p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps2-1600356057469.jpg" alt="img"></p>
</li>
<li><p>稍后安装操作系统</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps3-1600356078993.jpg" alt="img"></p>
</li>
<li><p>选择操作系统和版本</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps4-1600356106544.jpg" alt="img"></p>
</li>
<li><p>输入虚拟机名称和安装路径</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps5-1600356118626.jpg" alt="img"></p>
</li>
<li><p>设置磁盘大小</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps6-1600356132029.jpg" alt="img"></p>
</li>
<li><p>自定义硬件</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps7-1600356150025.jpg" alt="img"></p>
</li>
<li><p>选择CentOS安装镜像文件</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps8-1600356164481.jpg" alt="img"></p>
</li>
<li><p>点击完成</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps9-1600356185973.jpg" alt="img"></p>
</li>
<li><p>启动虚拟机</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps10-1600356210771.jpg" alt="img"></p>
</li>
<li><p>选择第一项，安装全新操作系统或升级现有操作系统</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps11.jpg" alt="img"></p>
</li>
<li><p>Tab键进行选择，选择Skip，退出检测</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps12.jpg" alt="img"></p>
</li>
<li><p>点击Next</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps13.jpg" alt="img"></p>
</li>
<li><p>选择语言，这里选择的是中文简体</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps14.jpg" alt="img"></p>
</li>
<li><p>选择键盘样式</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps15.jpg" alt="img"></p>
</li>
<li><p>选择存储设备</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps16.jpg" alt="img"></p>
<p>如果以前安装过虚拟机，会出现这个警告，选择是，忽略所有数据</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps17.jpg" alt="img"></p>
</li>
<li><p>输入主机名</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps18.jpg" alt="img"></p>
</li>
<li><p>配置网络</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps19.jpg" alt="img"></p>
</li>
<li><p>设置时区，勾选使用UTC时间</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps20.jpg" alt="img"></p>
</li>
<li><p>输入根用户（root）的密码</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps21.jpg" alt="img"></p>
<p>如果密码过于简单会出现提示，点击无论如何都使用</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps22.jpg" alt="img"></p>
</li>
<li><p>根据此Linux具体功能，选择不同的方式</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps23.jpg" alt="img"></p>
</li>
<li><p>选择现在自定义，自定义安装需要的软件，如桌面配置[这一步可以根据需求选择是否跳过]</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps24.jpg" alt="img"></p>
<p>可以根据具体的情况来配置，如可安Eclipse</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps25.jpg" alt="img"></p>
<p>还可以安装Java平台、Perl支持等</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps26.jpg" alt="img"></p>
<p>选择语言支持</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps27.jpg" alt="img"></p>
</li>
<li><p>点击下一步，开始安装</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps28.jpg" alt="img"></p>
</li>
<li><p>安装完成后，点击重新导引</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps29.jpg" alt="img"></p>
</li>
<li><p>点击前进按钮</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps30.jpg" alt="img"></p>
</li>
<li><p>点击是，同意许可，再点击前进按钮</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps31.jpg" alt="img"></p>
</li>
<li><p>创建用户</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps32.jpg" alt="img"></p>
</li>
<li><p>设置日期和时间，如果可以上网，勾选在网上同步日期和时间</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/wps33.jpg" alt="img"></p>
<p>最后点击前进，完成安装！</p>
</li>
</ol>
<h1 id="3、基本操作"><a href="#3、基本操作" class="headerlink" title="3、基本操作"></a>3、基本操作</h1><ul>
<li><p>快捷键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + Alt      切换Windows桌面和虚拟机桌面</span><br></pre></td></tr></table></figure></li>
<li><p>本机Linux账户密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">管理员用户：</span><br><span class="line">    username： root</span><br><span class="line">    password： itcast</span><br><span class="line">普通用户：</span><br><span class="line">    username： itcast</span><br><span class="line">    password： itcast</span><br></pre></td></tr></table></figure></li>
<li><p>本机中Linux系统的安装位置：<code>D:\CentOS\Linux.vmx.lck</code></p>
</li>
<li><p><code>ifcofig</code>：Linux中查看本机的IP地址。本机中Linux虚拟机的地址<code>192.168.64.128</code></p>
</li>
<li><p>CRT窗口中的复制粘贴：选中内容后点击右键即可完成复制粘贴</p>
</li>
</ul>
<hr>
<h1 id="VirtualBox安装CentOS7"><a href="#VirtualBox安装CentOS7" class="headerlink" title="VirtualBox安装CentOS7"></a>VirtualBox安装CentOS7</h1><h2 id="1、VirtualBox安装CentOS7"><a href="#1、VirtualBox安装CentOS7" class="headerlink" title="1、VirtualBox安装CentOS7"></a>1、VirtualBox安装CentOS7</h2><ol>
<li><p>下载安装VirtualBox。官网：<a target="_blank" rel="noopener" href="https://www.virtualbox.org/">https://www.virtualbox.org</a></p>
</li>
<li><p>打开VirtualBox –&gt; 新建；</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127103545039.png" alt="image-20210127103545039"></p>
<blockquote>
<p>因为Centos其实是RedHat的克隆版，所以版本类型选择RedHat（64-bit）</p>
</blockquote>
</li>
<li><p>下一步，选择默认配置就好</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127103717711.png" alt="image-20210127103717711"></p>
</li>
<li><p>下一步，</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127103754923.png" alt="image-20210127103754923"></p>
</li>
<li><p>创建；</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127104004000.png" alt="image-20210127104004000"></p>
<blockquote>
<p>在选择磁盘文件类型的时候主要考虑该Centos 7是否要被其他虚拟化软件(如vmware)使用</p>
<ul>
<li>VDI：被VirtualBox使用</li>
<li>VHD：被Microsoft Virtual PC使用</li>
<li>VMDK：被Vmware使用</li>
</ul>
</blockquote>
</li>
<li><p>这里选择VDI类型，点击下一步</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127104135785.png" alt="image-20210127104135785"></p>
</li>
<li><p>选择动态分配，下一步</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127104316650.png" alt="image-20210127104316650"></p>
</li>
<li><p>点击创建，完成对虚拟机的创建</p>
</li>
</ol>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127104421814.png" alt="image-20210127104421814"></p>
<h2 id="2、将CentOS7-iso文件与该虚拟机关联起来"><a href="#2、将CentOS7-iso文件与该虚拟机关联起来" class="headerlink" title="2、将CentOS7.iso文件与该虚拟机关联起来"></a>2、将CentOS7.iso文件与该虚拟机关联起来</h2><ol>
<li><p>点击设置 -&gt; 存储–&gt; 选择虚拟盘</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127104828201.png" alt="image-20210127104828201"></p>
</li>
<li><p>系统–&gt;主板，将光驱启动设置为第一项，点击 OK</p>
<p><img src="/2020/09/17/%E9%80%9A%E8%BF%87%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85CentOS/image-20210127105012031.png" alt="image-20210127105012031"></p>
</li>
<li><p>点击启动，开始安装过程</p>
</li>
<li><p>选择Install Centos Linux 7</p>
</li>
<li><p>参考如下博客</p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/alsodzy/p/9811175.html">https://www.cnblogs.com/alsodzy/p/9811175.html</a></p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/16/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6PageHelper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/16/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6PageHelper/" class="post-title-link" itemprop="url">如何使用分页插件PageHelper</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-16 14:33:23" itemprop="dateCreated datePublished" datetime="2020-09-16T14:33:23+08:00">2020-09-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-04-11 23:31:04" itemprop="dateModified" datetime="2021-04-11T23:31:04+08:00">2021-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-PageHelper简介"><a href="#1-PageHelper简介" class="headerlink" title="1    PageHelper简介"></a>1    PageHelper简介</h1><p>​    <code>PageHelper</code>是<code>GitHub</code>上开源的<code>MyBatis</code>的分页插件，使用起来非常简单、方便，并且支持任何复杂的单表、多表分页。</p>
<p>​    <code>GitHub</code>地址：<a target="_blank" rel="noopener" href="https://pagehelper.github.io/">https://pagehelper.github.io/</a></p>
<h1 id="2-引入分页插件"><a href="#2-引入分页插件" class="headerlink" title="2    引入分页插件"></a>2    引入分页插件</h1><p>​    引入分页插件有下面2种方式，推荐使用Maven方式。</p>
<h2 id="2-1-引入Jar包"><a href="#2-1-引入Jar包" class="headerlink" title="2.1    引入Jar包"></a>2.1    引入Jar包</h2><ol>
<li>从中央仓库或阿里云仓库下载最新版本的jar包；</li>
<li>由于使用了SQL解析工具，还需要下载<code>jsqlparser.jar</code>。</li>
</ol>
<h2 id="1-2-使用Maven"><a href="#1-2-使用Maven" class="headerlink" title="1.2    使用Maven"></a>1.2    使用Maven</h2><ul>
<li><p>在<code>pom.xml</code>中添加如下依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>最新版本<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="3-配置拦截器插件"><a href="#3-配置拦截器插件" class="headerlink" title="3    配置拦截器插件"></a>3    配置拦截器插件</h1><ul>
<li>特别注意，新版拦截器是 <code>com.github.pagehelper.PageInterceptor</code>。 <code>com.github.pagehelper.PageHelper</code> 现在是一个特殊的 <code>dialect</code> 实现类，是分页插件的默认实现类，提供了和以前相同的用法。</li>
</ul>
<h2 id="3-1-在MyBatis的XML文件中配置拦截器插件"><a href="#3-1-在MyBatis的XML文件中配置拦截器插件" class="headerlink" title="3.1    在MyBatis的XML文件中配置拦截器插件"></a>3.1    在MyBatis的XML文件中配置拦截器插件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    plugins在配置文件中的位置必须符合要求，否则会报错，顺序如下:</span></span><br><span class="line"><span class="comment">    properties?, settings?,</span></span><br><span class="line"><span class="comment">    typeAliases?, typeHandlers?,</span></span><br><span class="line"><span class="comment">    objectFactory?,objectWrapperFactory?,</span></span><br><span class="line"><span class="comment">    plugins?,</span></span><br><span class="line"><span class="comment">    environments?, databaseIdProvider?, mappers?</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用下面的方式配置参数，后面会有所有的参数介绍 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;param1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value1&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-2-在Spring配置文件中配置拦截器插件"><a href="#3-2-在Spring配置文件中配置拦截器插件" class="headerlink" title="3.2    在Spring配置文件中配置拦截器插件"></a>3.2    在Spring配置文件中配置拦截器插件</h2><ul>
<li><p>使用Spring的属性配置方式，可以使用<code>plugins</code>属性像下面这样配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注意其他配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;plugins&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--使用下面的方式配置参数，一行配置一个 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            params=value1</span><br><span class="line">          <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="4-分页插件参数介绍"><a href="#4-分页插件参数介绍" class="headerlink" title="4    分页插件参数介绍"></a>4    分页插件参数介绍</h1><p>分页插件提供了多个可选参数，这些参数使用时，按照上面两种配置方式种的示例配置接口。</p>
<p>分页插件的可选配置参数如下：</p>
<ul>
<li><p><code>dialect</code>：默认情况下会使用PageHelper定义的方式进行分页，如果想要实现自己的分页逻辑，可以实现<code>Dialect（com.github.pagehelper.Dialect）</code>接口，然后配置该属性为实现类的全限定类名。</p>
<hr>
</li>
</ul>
<p><strong>下面几个参数都是针对默认dialect情况下的参数。使用自定义dialect实现时，下面的参数没有任何作用。</strong></p>
<ol>
<li><p><code>helperDialect</code></p>
<p>​    分页插件会自动检测当前数据库链接，自动选择合适的分页方式。你可以配置<code>helpDialect</code>属性来指定分页插件使用哪种方言。配置时，可以使用下面的缩写值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oracle,mysql,mariadb,sqlite,hsqldb,postgresql,db2,sqlserver,informix,h2,sqlserver2012,derby</span><br></pre></td></tr></table></figure>

<p>​    你也可以实现<code>AbstractHelperDialect</code>，然后配置该属性为实现类的全限定类名即可使用自定义的实现方法。</p>
</li>
<li><p><code>offsetAsPageNum</code></p>
<p>​    默认值为<code>false</code></p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
<li><p>``</p>
</li>
</ol>
<h1 id="5-MyBatis集成PageHelper"><a href="#5-MyBatis集成PageHelper" class="headerlink" title="5    MyBatis集成PageHelper"></a>5    MyBatis集成PageHelper</h1><h1 id="6-Spring集成PageHelper"><a href="#6-Spring集成PageHelper" class="headerlink" title="6    Spring集成PageHelper"></a>6    Spring集成PageHelper</h1><h1 id="7-SpringBoot集成PageHelper"><a href="#7-SpringBoot集成PageHelper" class="headerlink" title="7    SpringBoot集成PageHelper"></a>7    SpringBoot集成PageHelper</h1><h2 id="7-1-导入依赖"><a href="#7-1-导入依赖" class="headerlink" title="7.1    导入依赖"></a>7.1    导入依赖</h2><p>在pom文件中导入两个jar：</p>
<ol>
<li>SpringBoot对MyBatis的支持jar；</li>
<li>SpringBoot对pagehelper的支持jar；</li>
</ol>
<h2 id="7-2-配置PageHelper方言"><a href="#7-2-配置PageHelper方言" class="headerlink" title="7.2    配置PageHelper方言"></a>7.2    配置PageHelper方言</h2><p>在项目配置文件<code>application.yml</code>文件中配置<code>pagehelper</code>方言为<code>mysql</code>（如果你使用的数据库是<code>MYSQL</code>）</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="attr">helperDialect:</span> <span class="string">mysql</span></span><br></pre></td></tr></table></figure>



<h2 id="7-3-编写业务逻辑代码"><a href="#7-3-编写业务逻辑代码" class="headerlink" title="7.3    编写业务逻辑代码"></a>7.3    编写业务逻辑代码</h2><p>使用<code>pagehelper</code>非常简单，只需要在你想要分页的查询逻辑<strong>前</strong>加一行代码即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PageHelper.startPage(pageNum, pageSize)</span><br><span class="line">    pageNum：页数（第几页）</span><br><span class="line">	pageSize：每页的数据行数</span><br><span class="line"></span><br><span class="line"><span class="comment">// 源代码：</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开始分页</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNum  页码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize 每页显示数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; Page&lt;E&gt; <span class="title function_">startPage</span><span class="params">(<span class="type">int</span> pageNum, <span class="type">int</span> pageSize)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> startPage(pageNum, pageSize, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="7-4-PageInfo类"><a href="#7-4-PageInfo类" class="headerlink" title="7.4    PageInfo类"></a>7.4    PageInfo类</h2><p><code>PageInfo</code>是<code>PageHelper</code>已经封装好的一个类，里面有一些我们做分页表时常用的属性。如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> pageNum;	<span class="comment">//当前页为第几页</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> pageSize;	<span class="comment">//每页的数据行数</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> startRow;	<span class="comment">//当前页面第一个元素在数据库中的行号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> endRow;		<span class="comment">//当前页面最后一个元素在数据库中的行号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> size;	<span class="comment">//当前页的数量</span></span><br><span class="line"><span class="comment">//由于startRow和endRow不常用，这里说个具体的用法</span></span><br><span class="line"><span class="comment">//可以在页面中&quot;显示startRow到endRow 共size条数据&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> total;		<span class="comment">//总记录数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> pages;		<span class="comment">//总页数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;T&gt; list;		<span class="comment">//结果集</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> prePage;	<span class="comment">//前一页页码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> nextPage;	<span class="comment">//下一页页码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> isFirstPage;	<span class="comment">//是否为第一页</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> isLastPage;		<span class="comment">//是否为最后一页</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> hasPreviousPage;	<span class="comment">//是否有前一页</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> hasNextPage;	<span class="comment">//是否有下一页</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> navigatePages;		<span class="comment">//导航页码数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] navigatepageNums;		<span class="comment">//所有导航页号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> navigateFirstPage;		<span class="comment">//导航条上的第一页</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> navigateLastPage;		<span class="comment">//导航条上的最后一页</span></span><br></pre></td></tr></table></figure>



<h2 id="7-7-7"><a href="#7-7-7" class="headerlink" title="7.7.7"></a>7.7.7</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/15/SpringMVC%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%A4%84%E7%90%86HTTP%E5%93%8D%E5%BA%94%E7%9A%84%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/15/SpringMVC%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%A4%84%E7%90%86HTTP%E5%93%8D%E5%BA%94%E7%9A%84%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">SpringMVC中常见的处理HTTP响应的方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-15 09:32:31" itemprop="dateCreated datePublished" datetime="2020-09-15T09:32:31+08:00">2020-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-04-15 23:59:45" itemprop="dateModified" datetime="2021-04-15T23:59:45+08:00">2021-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringMVC/" itemprop="url" rel="index"><span itemprop="name">SpringMVC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Spring中处理Http响应的方式有多种，主要有以下几种：</p>
<blockquote>
<ul>
<li>ResponseEntity：表示一个完整的Http响应消息。包括：状态码、响应头和响应体。因此，我们可以用使用它来完全配置Http响应。</li>
<li>@ResponseBody：返回json格式的结果。</li>
<li>@ResponseStatus：返回状态码。</li>
</ul>
</blockquote>
<hr>
<h1 id="1-使用ResponseEntity处理Http响应"><a href="#1-使用ResponseEntity处理Http响应" class="headerlink" title="1    使用ResponseEntity处理Http响应"></a>1    使用ResponseEntity处理Http响应</h1><blockquote>
<ul>
<li><p><code>ResponseEntity</code>表示一个完整的Http响应消息，包括了：</p>
<ol>
<li>状态码（HttpStatus）</li>
<li>头部信息（HttpHeaders）</li>
<li>响应体内容，</li>
</ol>
<p>因此我们可以使用该对象配置Http响应消息中的任一部分的内容。</p>
</li>
<li><p><code>ResponseEntity</code>必须放在返回值的位置处使用。</p>
</li>
<li><p><code>ResponseEntity</code>是一种泛型类型，因此我们可以使用任意类型作为响应体。</p>
</li>
</ul>
</blockquote>
<ol>
<li><p><strong>设置响应体和响应状态码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">ResponseEntity&lt;String&gt; <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(<span class="string">&quot;Hello World!&quot;</span>, HttpStatus.OK);		<span class="comment">// 响应体|响应状态码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这里设置字符串&quot;Hello World&quot;作为字符串返回给请求客户端</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果响应体是一个对象，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">ResponseEntity&lt;String&gt; <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">User</span>(), HttpStatus.OK);		<span class="comment">// 响应体|响应状态码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>则返回的是json字符串。</p>
</li>
</ul>
</li>
<li><p><strong>设置响应头信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/customHeader&quot;)</span></span><br><span class="line">ResponseEntity&lt;String&gt; <span class="title function_">customHeader</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 设置自定义响应头</span></span><br><span class="line">    <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">    headers.add(<span class="string">&quot;Custom-Header&quot;</span>, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(</span><br><span class="line">      <span class="string">&quot;Custom header set&quot;</span>, headers, HttpStatus.OK);	<span class="comment">// 响应体|响应头信息|响应状态码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>另一种设置方式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/customHeader&quot;)</span></span><br><span class="line">ResponseEntity&lt;String&gt; <span class="title function_">customHeader</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity</span><br><span class="line">        .ok()</span><br><span class="line">        .header(<span class="string">&quot;Custom-Header&quot;</span>, <span class="string">&quot;foo&quot;</span>)</span><br><span class="line">        .body(<span class="string">&quot;Custom header set&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 该方法的效果与上面方法相同，但是使用的是ResponseEntity中的静态方法。</span></span><br></pre></td></tr></table></figure></li>
<li><p>ResponseEntity类有多个构造函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、ResponseEntity(HttpStatus)</span><br><span class="line"><span class="number">2</span>、ResponseEntity(T, HttpStatus)</span><br><span class="line"><span class="number">3</span>、ResponseEntity(MultiValueMap&lt;String, String&gt;, HttpStatus)</span><br><span class="line"><span class="number">4</span>、ResponseEntity(T, MultiValueMap&lt;String, String&gt;, HttpStatus)</span><br><span class="line"><span class="number">5</span>、ResponseEntity(T, MultiValueMap&lt;String, String&gt;, Object)</span><br></pre></td></tr></table></figure></li>
<li><p>尽管ResponseEntity非常强大，但不应该过度使用。在一些简单的情况下，还有其他方法能满足我们的需求，使代码更整洁。</p>
</li>
</ol>
<hr>
<h1 id="2-ResponseBody"><a href="#2-ResponseBody" class="headerlink" title="2    @ResponseBody"></a>2    @ResponseBody</h1><blockquote>
<ul>
<li><p><code>@ResponseBody</code>注解的作用范围：方法上</p>
</li>
<li><p><code>@ResponseBody</code>注解的作用：将方法的返回值序列化为JSON字符串，并添加到Http响应消息的响应体中响应给客户端浏览器。</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">postResponseController</span><span class="params">(<span class="meta">@RequestBody</span> LoginForm loginForm)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果在类上使用了<code>@RestController</code>注解，那我们就不需要使用<code>@ResponseBody</code>了。</p>
<p>因为<code>@RestController = @Controller + @ResponseBody</code>。</p>
</li>
</ul>
<hr>
<h1 id="3-ResponseStatus"><a href="#3-ResponseStatus" class="headerlink" title="3    @ResponseStatus"></a>3    @ResponseStatus</h1><blockquote>
<ul>
<li><code>@ResponseStatus</code>注解的作用范围：方法上</li>
<li><code>@ResponseStatus</code>注解的作用：将响应状态码序列化为字符串并添加到响应消息中响应给客户端。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XXXController</span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ResponseStatus(HttpStatus.FOUND)</span></span><br><span class="line"> <span class="keyword">public</span> User <span class="title function_">postResponseController</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Thanks For Posting!!!&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h1 id="4-直接操控响应"><a href="#4-直接操控响应" class="headerlink" title="4    直接操控响应"></a>4    直接操控响应</h1><blockquote>
<p>Spring允许我们直接使用<code>javax.servlet.http.HttpServletResponse</code>对象，我们只需要将它声明为方法参数即可。</p>
<p>但不推荐使用。因为Spring在底层之上提供了抽象和附加功能，因此如果以这种方式直接操作响应，会失去很多Spring提供的封装好的方便的功能。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/manual&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">manual</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      response.setHeader(<span class="string">&quot;Custom-Header&quot;</span>, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line">      response.setStatus(<span class="number">200</span>);</span><br><span class="line">      response.getWriter().println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    </p>
<hr>
<h1 id="5-ResponseEntity，-ResponseBody，-ResponseStatus比较"><a href="#5-ResponseEntity，-ResponseBody，-ResponseStatus比较" class="headerlink" title="5    ResponseEntity，@ResponseBody，@ResponseStatus比较"></a>5    ResponseEntity，@ResponseBody，@ResponseStatus比较</h1><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">ResponseEntity</th>
<th align="center">@ResponseBody</th>
<th align="center">@ResponseStatus</th>
</tr>
</thead>
<tbody><tr>
<td align="center">本质</td>
<td align="center">对象</td>
<td align="center">注解</td>
<td align="center">注解</td>
</tr>
<tr>
<td align="center">作用范围</td>
<td align="center">作为方法的返回值</td>
<td align="center">作用在方法上</td>
<td align="center">作用在方法上</td>
</tr>
<tr>
<td align="center">含义</td>
<td align="center">表示整个响应消息</td>
<td align="center">表示响应消息中的响应体</td>
<td align="center">表示响应消息中的响应状态码</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/14/Java%E4%B8%ADComparable%E6%8E%A5%E5%8F%A3%E5%92%8CComparator%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/14/Java%E4%B8%ADComparable%E6%8E%A5%E5%8F%A3%E5%92%8CComparator%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">Java比较器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-14 21:51:56" itemprop="dateCreated datePublished" datetime="2020-09-14T21:51:56+08:00">2020-09-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-08-01 17:01:02" itemprop="dateModified" datetime="2021-08-01T17:01:02+08:00">2021-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaSE/" itemprop="url" rel="index"><span itemprop="name">JavaSE</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Java-比较器的使用背景"><a href="#Java-比较器的使用背景" class="headerlink" title="Java 比较器的使用背景"></a>Java 比较器的使用背景</h1><ul>
<li>  Java 中的对象，正常情况下只能进行 <code>==</code> 或 <code>!=</code> 的比较，不能使用 <code>&gt;</code> 或 <code>&lt;</code> 进行比较。【因为对象是引用类型，默认比较的是两个对象的地址值，只存在相等或不等，而没有一个标准用来比较大小】。</li>
<li>  但是在开发场景中，我们有时需要对多个对象进行排序，言外之意，就需要比较对象的大小。</li>
<li>  如何实现？使用两个接口中的任何一个：<strong>Comparable</strong> 或 <strong>Comparator</strong></li>
</ul>
<hr>
<h1 id="Comparable-接口"><a href="#Comparable-接口" class="headerlink" title="Comparable 接口"></a>Comparable 接口</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Comparable接口的源代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Comparable</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(T o)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>Comparable</code>被叫做<strong>内比较器</strong>，实现了该接口的类，必须重写接口中的<code>compareTo()</code>方法，并在方法中自定义比较的规则。</li>
<li>  也就是说，如果一个类实现了 <code>Comparable</code> 接口，由该类创建的一组子类实例对象，就可以根据自定义的规则对这些实例对象进行排序。</li>
</ul>
<blockquote>
<p>  <strong>比较规则：</strong></p>
</blockquote>
<p><code>compareTo()</code>方法的返回值是 int 类型，有3种情况：</p>
<p>​    1、<code>this对象 &gt; 方法参数对象</code>，返回正整数；<br>​    2、<code>this对象 = 方法参数对象</code>，返回 0；<br>​    3、<code>this对象 &lt; 方法参数对象</code>，返回正负整数；</p>
<h2 id="1-实现-Comparable-接口的原生类"><a href="#1-实现-Comparable-接口的原生类" class="headerlink" title="1    实现 Comparable 接口的原生类"></a>1    实现 Comparable 接口的原生类</h2><p>​        Java 中存在着一些原生的类，这些类在设计时就已经实现了<code>Comparable</code>接口，并重写了接口中的<code>compareTo()</code>方法。对于这些类可以直接调用它的<code>CompareTo()</code>方法进行比较。</p>
<p>如：</p>
<ul>
<li>  <strong>String</strong>、<strong>包装类</strong>等已经实现了<code>Comparable</code>接口，即重写了<code>compareTo(obj)</code>方法，给出了比较两个对象大小的方式。</li>
<li>  String、包装类重写 <code>compareTo()</code> 方法以后，进行了<strong>从小到大</strong>的排列。</li>
<li>  String、包装类等可以直接调用类中的<code>compareTo()</code>方法进行比较。</li>
</ul>
<blockquote>
<p>  <strong>String类</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  <strong>测试</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;Z&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a.compareTo(b);</span><br><span class="line">    System.out.println(result);     <span class="comment">// -25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="2-自定义类实现Comparable接口"><a href="#2-自定义类实现Comparable接口" class="headerlink" title="2    自定义类实现Comparable接口"></a>2    自定义类实现Comparable接口</h2><p>​        对于自定义类来说，如果需要对类的实例对象进行排序，我们可以让自定义类实现 <code>Comparable</code> 接口，重写 <code>compareTo(obj)</code>方法，在 <code>compareTo(obj)</code> 方法中自定义比较的规则，指明要如何排序。</p>
<blockquote>
<ol>
<li>实现 <code>Comparable</code> 接口，</li>
<li>重写接口中的<code>compareTo()</code>方法，。</li>
</ol>
</blockquote>
<h3 id="2-1-Demo"><a href="#2-1-Demo" class="headerlink" title="2.1    Demo"></a>2.1    Demo</h3><ol>
<li><p>定义一个<code>Student</code>类，实现<code>comparable</code>接口，重写<code>compareTo()</code>方法；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Object&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">// get/set方法</span></span><br><span class="line">    <span class="comment">// toString方法</span></span><br><span class="line">    <span class="comment">// &lt;init&gt;()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写compareTo方法，定义比较的规则</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Student)&#123;</span><br><span class="line">            <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) o;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getAge() - student.getAge();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;传入的数据类型不一致！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">st1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">23</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">st2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Student</span> <span class="variable">maxStu</span> <span class="operator">=</span> getMax(st1, st2);</span><br><span class="line">        System.out.println(maxStu);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 比较两个学生对象，根据规则选出较大的一个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> st1   学生1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> st2   学生2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Student <span class="title function_">getMax</span><span class="params">(Student st1, Student st2)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> st1.compareTo(st2);</span><br><span class="line">        <span class="keyword">if</span> (result&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> st1;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> st2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Comparator-接口"><a href="#Comparator-接口" class="headerlink" title="Comparator 接口"></a>Comparator 接口</h1><p><code>Comparator</code>接口又叫做<strong>外比较器</strong>，如果我们需要比较由某个类创建出来的<strong>两个</strong>实例对象的大小，并且这个类本身不支持比较（即没有实现<code>Comparable</code>接口），那么我们可以通过定义一个工具类作为“该类的<strong>比较器</strong>”，用于对这个类的实例对象进行比较。</p>
<p>这个<code>比较器</code>需要实现<code>Comparator</code>接口并重写接口中的<code>compare(T o1, T o2)</code>方法，然后就可以通过这个<code>比较器</code>对目标类的实例对象进行比较。</p>
<blockquote>
<p>  <strong>compare() 方法</strong></p>
</blockquote>
<p><code>int compare(T o1, T o2)</code> 方法，返回值是 <code>int</code> 类型，有 3 种情况：</p>
<ul>
<li>  <strong>o1 &gt; o2</strong>，返回正整数；</li>
<li>  <strong>o1 = o2</strong>，返回 0 ；</li>
<li>  <strong>o1 &lt; o2</strong>，返回负整数。</li>
</ul>
<blockquote>
<p>  <strong><code>Compartor</code> 接口的适用场景：</strong></p>
</blockquote>
<ol>
<li>同一类的实例对象之间不支持互相比较（即<strong>没有实现<code>Comparable</code>接口），但又想对两个对象进行比较。</strong></li>
<li>实例对象的类上实现了<code>Comparable</code>接口，但开发者认为<code>compareTo()</code>方法中的比较规则并不是自己想要的，又不想破坏原有结构，就可以使用<code>Comparable</code>接口。</li>
</ol>
<hr>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><ol>
<li><p>创建一个 Student 类（复用上文的 Student 类）</p>
</li>
<li><p>创建一个 <code>StudentComparator</code> 类，这是一个<strong>比较器类</strong>，用于定义比较规则；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="comment">// 1、实现Comparator&lt;T&gt;接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;Object&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2、重写compare()方法，定义比较规则</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Object o1, Object o2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Student &amp;&amp; o2 <span class="keyword">instanceof</span> Student)&#123;</span><br><span class="line">            <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> (Student)o1;</span><br><span class="line">            <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> (Student)o2;</span><br><span class="line">            <span class="keyword">return</span> s1.getAge() - s2.getAge();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;输入的数据类型不一致&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 主方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">st1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">23</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">st2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Student</span> <span class="variable">maxStu</span> <span class="operator">=</span> getMax(st1, st2);</span><br><span class="line">        System.out.println(maxStu);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 比较两个学生对象，根据规则选出较大的一个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> st1   学生1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> st2   学生2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Student <span class="title function_">getMax</span><span class="params">(Student st1, Student st2)</span>&#123;</span><br><span class="line">        <span class="type">StudentComparator</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentComparator</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sc.compare(st1, st2);</span><br><span class="line">        <span class="keyword">if</span> (result&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> st1;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> st2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h1><ul>
<li>  对于 <code>Comparable</code> 接口而言，需要待比较对象的类来实现这个接口。</li>
<li>  而对于<code>Comparator</code> 接口来说，待比较对象的类无需实现 <code>Comparator</code>接口，而是通过额外定义一个比较器来实现<code>Comparator</code>接口。</li>
<li>  实现 <code>Comparable</code> 接口的方式能保证 <code>Comparable</code> 接口的实现类的对象在随时随地都可以比较大小。</li>
<li>  <code>Comparator</code>接口属于临时性的比较。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/07/%E9%80%9A%E7%94%A8Mapper%E7%9A%84%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/07/%E9%80%9A%E7%94%A8Mapper%E7%9A%84%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">通用Mapper的详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-07 10:35:42" itemprop="dateCreated datePublished" datetime="2020-09-07T10:35:42+08:00">2020-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-01-22 20:32:29" itemprop="dateModified" datetime="2021-01-22T20:32:29+08:00">2021-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>集成通用Mapper</li>
<li>对象关系映射</li>
<li>配置介绍</li>
<li>代码生成器</li>
<li>扩展通用接口</li>
<li>Example用法</li>
<li>其它配置和用法</li>
</ol>
<h1 id="1、集成通用Mapper"><a href="#1、集成通用Mapper" class="headerlink" title="1、集成通用Mapper"></a>1、集成通用Mapper</h1><h2 id="1-1-Java编码方式"><a href="#1-1-Java编码方式" class="headerlink" title="1.1    Java编码方式"></a>1.1    Java编码方式</h2><h2 id="1-2-和Spring集成"><a href="#1-2-和Spring集成" class="headerlink" title="1.2    和Spring集成"></a>1.2    和Spring集成</h2><h2 id="1-3-和SpringBoot集成"><a href="#1-3-和SpringBoot集成" class="headerlink" title="1.3    和SpringBoot集成"></a>1.3    和SpringBoot集成</h2><blockquote>
<p>和MyBatis一样，SpringBoot集成通用Mapper和的方式可分为2种：</p>
<ol>
<li><code>@Mapper</code>注解</li>
<li><code>@MapperScan</code>注解的手动配置</li>
</ol>
</blockquote>
<h3 id="1-3-1-Mapper"><a href="#1-3-1-Mapper" class="headerlink" title="1.3.1    @Mapper"></a>1.3.1    @Mapper</h3><blockquote>
<p><strong>如果没有使用<code>@MapperScan</code>注解，就必须在Mapper/Dao接口上添加<code>@Mapper</code>注解，否则Spring容器无法判断扫描装配哪些接口。</strong></p>
</blockquote>
<h3 id="1-3-2-MapperScan"><a href="#1-3-2-MapperScan" class="headerlink" title="1.3.2    @MapperScan"></a>1.3.2    @MapperScan</h3><blockquote>
<p><strong>或者可以在带有<code>@Configuration</code>的类上添加<code>@MapperScan</code>注解</strong>，或直接配置到SpringBoot的启动类上，如：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@tk</span>.mybatis.spring.annotation.MapperScan(basePackages = <span class="string">&quot;扫描包&quot;</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SampleMapperApplication</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br></pre></td></tr></table></figure>

<p><em>Tip：与SpringBoot整合MyBatis不同的是：通用Mapper使用<code>tk.mybatis.spring.annotation.MapperScan</code>包下的<code>@MapperScan</code>注解，MyBatis的<code>org.mybatis.spring.annotation.MapperScan</code>包下的<code>@MapperScan</code>注解。</em></p>
<h3 id="1-3-3-实现步骤"><a href="#1-3-3-实现步骤" class="headerlink" title="1.3.3    实现步骤"></a>1.3.3    实现步骤</h3><ol>
<li><p>创建项目，添加通用Mapper依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>版本号<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>@Mapper/@MapperScan</code>注解</p>
</li>
<li><p>如果需要覆盖通用Mapper的默认配置，可以在<code>application.yml</code>文件中进行。如：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mapper:</span></span><br><span class="line">  <span class="attr">mappers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tk.mybatis.mapper.common.Mapper</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tk.mybatis.mapper.common.Mapper2</span></span><br><span class="line">  <span class="attr">notEmpty:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="2、对象关系映射"><a href="#2、对象关系映射" class="headerlink" title="2、对象关系映射"></a>2、对象关系映射</h1><h2 id="2-1-简单入门"><a href="#2-1-简单入门" class="headerlink" title="2.1    简单入门"></a>2.1    简单入门</h2><ol>
<li><p>数据库表（MySQL）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `country` (</span><br><span class="line">    `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键&#x27;,</span><br><span class="line">    `countryname` varchar(255) DEFAULT NULL COMMENT &#x27;名称&#x27;,</span><br><span class="line">    `countrycode` varchar(255) DEFAULT NULL COMMENT &#x27;代码&#x27;,</span><br><span class="line">    PRIMARY KEY (`Id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=10011 DEFAULT CHARSET=utf8 COMMENT=&#x27;国家信息&#x27;;</span><br></pre></td></tr></table></figure></li>
<li><p>对应的Java实体类型如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Country</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String  countryname;</span><br><span class="line">    <span class="keyword">private</span> String  countrycode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略 getter 和 setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最简单的情况下，数据库中的字段名和是JavaBean中的属性名是完全相同的，可以直接产生一一映射关系，只需要添加一个<code>@Id</code>注解标记当前属性为主键数据库中的主键字段即可。</p>
<blockquote>
<p><strong>Tip：如果实体类中没有一个标记为<code>@Id</code>的字段，当你使用带有<code>ByPrimaryKey</code>的方法时，所有的字段会作为联合主键来使用。</strong></p>
</blockquote>
</li>
<li><p>通用Mapper接口提供了大量已封装好的方法，我们自定义的Mapper接口只需要继承该接口就能调用这些方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tk.mybatis.mapper.common.Mapper;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	前提：该接口必须实现 @Mapper 或 @MapperScan  注解</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CountryMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;Country&gt; &#123;	<span class="comment">// 继承通用Mapper接口必须指定接口的泛型类型是与数据库表对应的实体类的类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通用Mapper接口中常见的方法：</p>
<ul>
<li><code>selectOne</code></li>
<li><code>select</code></li>
<li><code>selectAll</code></li>
<li><code>selectCount</code></li>
<li><code>selectByPrimaryKey</code></li>
<li><code>...</code></li>
</ul>
</blockquote>
</li>
<li><p>使用该接口的类对象调用接口中的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取 countryMapper 对象，并调用 selectAll 方法</span></span><br><span class="line">List&lt;Country&gt; countries = countryMapper.selectAll();</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据主键查询</span></span><br><span class="line"><span class="type">Country</span> <span class="variable">country</span> <span class="operator">=</span> countryMapper.selectByPrimaryKey(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者使用对象传参，适用于1个字段或者多个字段联合主键使用。通用Mapper的会把对象中的所有非空属性联合起来作为一个主键查询</span></span><br><span class="line"><span class="type">Country</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Country</span>();</span><br><span class="line">query.setId(<span class="number">1</span>);</span><br><span class="line">country = countryMapper.selectByPrimaryKey(query);</span><br></pre></td></tr></table></figure></li>
<li><p>如果想要自定义操作数据库的方法，可以直接在<code>CountryMapper</code>中增加。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> tk.mybatis.mapper.common.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CountryMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;Country&gt; &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from country where countryname = #&#123;countryname&#125;&quot;)</span></span><br><span class="line">    Country <span class="title function_">selectByCountryName</span><span class="params">(String countryname)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-2-数据库映射"><a href="#2-2-数据库映射" class="headerlink" title="2.2    数据库映射"></a>2.2    数据库映射</h2><blockquote>
<p>在2.1中看到的是最简单的情况，实际使用过程中也不会更复杂，下面是更详细的映射配置。</p>
</blockquote>
<ul>
<li><p>通用Mapper中，默认情况下是将实体类字段按照<strong>驼峰转下划线</strong>的形式与数据库表中的列名进行映射。</p>
<p>如：实体类的<code>userName</code>可以映射到表的<code>user_name</code>上。</p>
<p>如果想要修改默认的转换方式，可以在后续的配置中，修改<code>style</code>全局配置；</p>
<p>也可以使用通用Mapper提供的一些注解进行修改。</p>
</li>
</ul>
<h3 id="2-2-1-NameStyle注解"><a href="#2-2-1-NameStyle注解" class="headerlink" title="2.2.1    @NameStyle注解"></a>2.2.1    <code>@NameStyle</code>注解</h3><ul>
<li><p>这个注解可以在类上进行配置，优先级高于对应的<code>style</code>全局配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">normal,                     <span class="comment">//原值</span></span><br><span class="line">camelhump,                  <span class="comment">//驼峰转下划线</span></span><br><span class="line">uppercase,                  <span class="comment">//转换为大写</span></span><br><span class="line">lowercase,                  <span class="comment">//转换为小写</span></span><br><span class="line">camelhumpAndUppercase,      <span class="comment">//驼峰转下划线大写形式</span></span><br><span class="line">camelhumpAndLowercase,      <span class="comment">//驼峰转下划线小写形式</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用时，直接在类上配置即可。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NameStyle(Style.camelhumpAndUppercase)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Country</span></span><br></pre></td></tr></table></figure>

<p>配置该注解后，对该类和其中的字段进行转换时，会将形如<code>userName</code>的字段转换为表中的<code>user_name</code>字段。</p>
</li>
</ul>
<h3 id="2-2-2-Table注解"><a href="#2-2-2-Table注解" class="headerlink" title="2.2.2    @Table注解"></a>2.2.2    <code>@Table</code>注解</h3><ul>
<li><p><code>@Table</code>注解可以配置<code>name</code>、<code>catalog</code>和<code>schema</code>三个属性，配置<code>name</code>属性后，直接使用提供的表名，不再根据实体类名进行转换。其它的2个属性中，同时配置时，<code>catalog</code>优先级高于<code>scheam</code>，也就是说只有<code>catalog</code>会生效。</p>
</li>
<li><p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name = &quot;sys_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span></span><br></pre></td></tr></table></figure>

<p>将<code>User</code>实体类映射到<code>sys_user</code>表。</p>
</li>
</ul>
<h3 id="2-2-3-Column注解"><a href="#2-2-3-Column注解" class="headerlink" title="2.2.3    @Column注解"></a>2.2.3    <code>@Column</code>注解</h3><ul>
<li><p><code>@Colum</code>注解支持<code>name</code>、<code>insertable</code>和<code>updateable</code>3个属性。</p>
<p><code>name</code>配置映射的列名。</p>
<p><code>insertable</code>对提供的<code>insert</code>方法有效，如果设置为<code>false</code>后就不会出现在SQL中。</p>
<p><code>updateable</code>对提供的<code>update</code>方法有效，如果设置为<code>false</code>后就不会出现在SQL中。</p>
</li>
<li><p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column(name = &quot;user_name&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure>

<p>直接映射<code>name</code>到<code>user_name</code>。</p>
</li>
</ul>
<h3 id="2-2-4-ColumnType注解"><a href="#2-2-4-ColumnType注解" class="headerlink" title="2.2.4    @ColumnType注解"></a>2.2.4    <code>@ColumnType</code>注解</h3><ul>
<li><p>这个注解提供的<code>column</code>属性和<code>@Column</code>中的<code>name</code>作用相同，但是<code>@Column</code>的优先级更高。除了<code>name</code>属性外，这个注解主要提供了<code>jdbcType</code>属性和<code>typeHandler</code>属性。</p>
<p><code>jdbcType</code>用于设置特殊数据库类型时指定数据库中的<code>jdbcType</code>。</p>
<p><code>typeHandler</code>用于设置特殊类型处理器，常见的是枚举。</p>
</li>
<li><p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ColumnType(</span></span><br><span class="line"><span class="meta">        column = &quot;countryname&quot;,</span></span><br><span class="line"><span class="meta">        jdbcType = JdbcType.VARCHAR,</span></span><br><span class="line"><span class="meta">        typeHandler = StringTypeHandler.class)</span></span><br><span class="line"><span class="keyword">private</span> String  countryname;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-5-Transient注解"><a href="#2-2-5-Transient注解" class="headerlink" title="2.2.5    @Transient注解"></a>2.2.5    <code>@Transient</code>注解</h3><ul>
<li><p>一般情况下，实体中的字段和数据库中的字段是一一对应的，但是有时候我们会在实体类中定义一些额外的属性并希望这些属性不会与数据库表中的字段产生映射，这种情况下，就需要使用<code>@Transient</code>注解来告诉通用Mapper这不是表中的字段。</p>
</li>
<li><p>默认情况下，只有简单类型会被自动认为是表中的字段（可以通过配置中的<code>useSimpleType</code>控制）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 这里说的简单类型不包含Java中的8种类基本型：</span><br><span class="line">byte、short、int、long、float、double、char、boolean</span><br><span class="line"> 这是因为在类中，基本类型会有默认值，而MyBatis中经常会要判断属性值是否为空，所以不要在类中使用基本类型，否则会遇到莫名其妙的错误。</span><br><span class="line"> 如果要使用基本类型的数据，应该使用其包装类。	</span><br></pre></td></tr></table></figure>

<p>对于类中的复杂对象，以及<code>Map</code>、<code>List</code>等属性不需要配置这个注解。</p>
<p>对于枚举类型作为数据库字段的情况，需要看配置中的<code>enumAsSimpleType</code>参数</p>
</li>
<li><p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> String otherThings; <span class="comment">//非数据库表中字段</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-6-Id注解"><a href="#2-2-6-Id注解" class="headerlink" title="2.2.6    @Id注解"></a>2.2.6    <code>@Id</code>注解</h3><ul>
<li><p>上面的几个注解都涉及到映射。<code>@Id</code>注解和映射无关，它是一个特殊的标记，用于标识数据库中的主键字段。</p>
</li>
<li><p>正常情况下，一个实体类中至少需要一个标记<code>@Id</code>注解的字段，存在联合主键时可以标记多个。</p>
</li>
<li><p>如果表中没有主键，类中就可以不标记。</p>
</li>
<li><p>当类中没有存在标记了<code>@Id</code>注解的字段时，你可以理解为类中的所有字段是联合主键。使用所有的<code>ByPrimaryKey</code>相关的方法时，有<code>where</code>条件的地方，会将所有列作为条件。</p>
</li>
<li><p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br></pre></td></tr></table></figure>

<p>或联合主键：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="keyword">private</span> Integer userId;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="keyword">private</span> Integer roleId;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-7-KeySql注解"><a href="#2-2-7-KeySql注解" class="headerlink" title="2.2.7    @KeySql注解"></a>2.2.7    <code>@KeySql</code>注解</h3><ul>
<li>主键策略注解，用于配置如何生成主键。</li>
<li>这是通用Mapper的自定义注解，该注解的目的就是替换<code>@GenerateValue</code>注解。</li>
<li>详见<strong>2.3主键策略</strong>。</li>
</ul>
<h3 id="2-2-8-GenerateValue注解"><a href="#2-2-8-GenerateValue注解" class="headerlink" title="2.2.8    @GenerateValue注解"></a>2.2.8    <code>@GenerateValue</code>注解</h3><ul>
<li>主键策略注解，用于配置如何生成主键。</li>
<li>不同数据库的配置不同，详见<strong>2.3主键策略</strong>。</li>
</ul>
<h3 id="2-2-9-Version注解"><a href="#2-2-9-Version注解" class="headerlink" title="2.2.9    @Version注解"></a>2.2.9    <code>@Version</code>注解</h3><ul>
<li><code>@Version</code>是实现乐观锁的一个注解，大多数人都不需要。</li>
<li>详见<strong>2.4乐观锁</strong>。</li>
</ul>
<h3 id="2-2-10-RegisterMapper注解"><a href="#2-2-10-RegisterMapper注解" class="headerlink" title="2.2.10    @RegisterMapper注解"></a>2.2.10    <code>@RegisterMapper</code>注解</h3><ul>
<li>为了解决通用Mapper中最常见的一个错误而增加的注解标记，该注解仅用于开发用用接口，不是实体类上使用的，这里和其它注解一起介绍了。</li>
<li>4.0 版本提供的所有通用接口上都标记了该注解，因此自带的通用接口时，不需要配置 <code>mappers</code> 参数，该注解的具体用法会在 <strong>第五章 扩展通用接口</strong> 中介绍。</li>
</ul>
<hr>
<h2 id="2-3-主键策略"><a href="#2-3-主键策略" class="headerlink" title="2.3    主键策略"></a>2.3    主键策略</h2><p>​    在2.2中介绍了所有其它注解的作用和用法，由于主键策略比较复杂，单独用一节来阐述。</p>
<p>​    首先主键策略和数据库关系很大，有些数据库支持主键自增，而有些数据库只能通过序列来获得主键。</p>
<p>​    新增的<code>@KeySql</code>注解用于替换<code>@GeneratedValue</code>注解，因此<code>@KeySql</code>能以更简单的方式实现原来的功能。下面的示例都先使用<code>@KeySql</code>进行配置，然后再使用<code>@GeneratedValue</code>，大家可以自行选择。</p>
<h3 id="2-3-1-JDBC支持通过getGeneratedValue方法取回主键的情况"><a href="#2-3-1-JDBC支持通过getGeneratedValue方法取回主键的情况" class="headerlink" title="2.3.1    JDBC支持通过getGeneratedValue方法取回主键的情况"></a>2.3.1    JDBC支持通过<code>getGeneratedValue</code>方法取回主键的情况</h3><ul>
<li><p>这种情况首先需要数据库支持自增长，其次数据库提供的JDBC支持<code>getGeneratedKeys</code>方法。</p>
</li>
<li><p>常见的如MySql、SqlServer支持这种模式。</p>
</li>
<li><p>这种情况下，配置主键策略最简单。用法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@KeySql(useGeneratedKeys = true)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<p>或：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<ul>
<li>SqlServer中使用时，需要设置<code>id</code>的<code>insertable=false</code></li>
</ul>
</li>
</ul>
<h2 id="2-4-乐观锁"><a href="#2-4-乐观锁" class="headerlink" title="2.4    乐观锁"></a>2.4    乐观锁</h2><h2 id="2-5-全局主键"><a href="#2-5-全局主键" class="headerlink" title="2.5    全局主键"></a>2.5    全局主键</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/28/SpringMVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/28/SpringMVC/" class="post-title-link" itemprop="url">SpringMVC</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-08-28 10:05:13" itemprop="dateCreated datePublished" datetime="2020-08-28T10:05:13+08:00">2020-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-05-08 20:44:28" itemprop="dateModified" datetime="2022-05-08T20:44:28+08:00">2022-05-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringMVC/" itemprop="url" rel="index"><span itemprop="name">SpringMVC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="三层架构和MVC"><a href="#三层架构和MVC" class="headerlink" title="三层架构和MVC"></a>三层架构和MVC</h1><h2 id="1-三层架构"><a href="#1-三层架构" class="headerlink" title="1 三层架构"></a>1 三层架构</h2><p><img src="/2020/08/28/SpringMVC/%E5%BC%80%E5%8F%91%E6%9E%B6%E6%9E%84.png"></p>
<p>在B/S架构中，系统标准的三层架构包括：表现层、业务层、持久层。 </p>
<p><strong>表现层（Web层）</strong></p>
<ul>
<li>  Web 层最核心的功能是<strong>接收客户端提交的请求，给客户端返回响应结果</strong>。</li>
<li>  常用的数据传输协议是 HTTP 协议，即 Web 层需要接收 HTTP 请求，返回 HTTP 响应。</li>
<li>Web层中又包含展示层和控制层：<ol>
<li><strong>控制层</strong>负责接收请求，处理业务的逻辑。</li>
<li><strong>展示层</strong>负责结果的展示。</li>
</ol>
</li>
<li>  Web 层依赖 Service 层，接收到客户端请求一般都会转发到业务层进行业务处理。</li>
<li>  <strong>Web 层的设计一般都使用MVC模型。（MVC 是 Web 层的设计模型，和其他层没有关系）</strong> </li>
</ul>
<p><strong>业务层（service层）</strong></p>
<ul>
<li>  负责业务逻辑处理。</li>
<li>  业务层在业务处理时可能会依赖持久层。在对数据持久化时需要保证事务一致性。（也就是我们说的，事务应该放到业务层来控制） </li>
</ul>
<p><strong>持久层（Dao层）</strong></p>
<ul>
<li>  负责数据持久化。</li>
<li>  数据库是对数据进行持久化的载体，通俗的讲，持久层就是和数据库交互，对数据库表进行增删改查的。</li>
</ul>
<hr>
<h2 id="2-MVC模型"><a href="#2-MVC模型" class="headerlink" title="2 MVC模型"></a>2 MVC模型</h2><blockquote>
<p><strong>MVC；Model View Controller；模型-视图-控制器</strong></p>
</blockquote>
<p>MVC 是一种用于设计 WEB 应用表现层的模型。</p>
<p>MVC中每个部分各司其职：</p>
<p><strong>Model（模型）</strong>：</p>
<ul>
<li>通常指数据模型。</li>
<li>作用：一般情况下用于封装数据。</li>
<li>网络中数据传输一般使用 JSON 字符串。所以说 HTTP 协议携带的请求数据往往是 JSON 字符串，请求到达服务器时，会根据需要将 JSON 字符串反序列化为 Java 对象；服务器作出响应时，首先会把响应消息序列化为 JSON 字符串，再传递给客户端。</li>
</ul>
<p><strong>View（视图）</strong>：</p>
<ul>
<li>终端显示层，各个端的模板渲染并执行显示的层。通常指的就是我们的 JSP 或 HTML。</li>
<li>视图层负责将从Model（模型）中得到的数据渲染到View（视图）上。</li>
<li>在前后端分离的项目开发中，后端开发人员不再需要关注 View（视图）。</li>
</ul>
<p><strong>Controller（控制器）</strong>：</p>
<ul>
<li>它是应用程序中处理用户交互的部分。作用一般是处理程序逻辑的</li>
</ul>
<hr>
<h1 id="SpringMVC-概述"><a href="#SpringMVC-概述" class="headerlink" title="SpringMVC 概述"></a>SpringMVC 概述</h1><h2 id="1-是什么"><a href="#1-是什么" class="headerlink" title="1 是什么"></a>1 是什么</h2><ul>
<li>SpringMVC 是 MVC 模型的一种落地实现框架。常见的 MVC 模型的实现框架还有 Struts1，Struts2 等。</li>
<li>SpringMVC 通过一套注解，让一个简单的 Java 类成为处理请求的控制器，而无需实现任何接口。</li>
<li>同时它还支持 RESTful 编程风格的请求。</li>
</ul>
<h2 id="2-SpringMVC的优势"><a href="#2-SpringMVC的优势" class="headerlink" title="2 SpringMVC的优势"></a>2 SpringMVC的优势</h2><h3 id="2-1-清晰的角色划分"><a href="#2-1-清晰的角色划分" class="headerlink" title="2.1 清晰的角色划分"></a>2.1 清晰的角色划分</h3><table>
<thead>
<tr>
<th>英文名称</th>
<th>中文名称</th>
</tr>
</thead>
<tbody><tr>
<td>DispatcherServlet</td>
<td>前端控制器；分发器</td>
</tr>
<tr>
<td>HandlerMapping</td>
<td>处理器映射器</td>
</tr>
<tr>
<td>HandlerAdapter</td>
<td>处理器适配器</td>
</tr>
<tr>
<td>ViewResolver</td>
<td>视图解析器</td>
</tr>
<tr>
<td>Controller</td>
<td>处理器或页面控制器</td>
</tr>
<tr>
<td>Validator</td>
<td>验证器</td>
</tr>
<tr>
<td>Command</td>
<td>命令对象：请求参数要绑定的对象就是命令对象</td>
</tr>
<tr>
<td>FormObject</td>
<td>表单对象：提供给表单展示的对象叫做表单对象</td>
</tr>
</tbody></table>
<hr>
<h2 id="3-SpringMVC入门案例"><a href="#3-SpringMVC入门案例" class="headerlink" title="3 SpringMVC入门案例"></a>3 SpringMVC入门案例</h2><h3 id="1、项目初始化"><a href="#1、项目初始化" class="headerlink" title="1、项目初始化"></a>1、项目初始化</h3><h4 id="1-1-新建一个-Maven-工程，引入开发所需依赖的坐标"><a href="#1-1-新建一个-Maven-工程，引入开发所需依赖的坐标" class="headerlink" title="1.1 新建一个 Maven 工程，引入开发所需依赖的坐标"></a>1.1 新建一个 Maven 工程，引入开发所需依赖的坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Spring基本框架--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Spring Web框架--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Spring webmvc框架--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Servlet_API--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--jsp_API--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-新建一个-index-jsp-文件用于发送请求"><a href="#1-2-新建一个-index-jsp-文件用于发送请求" class="headerlink" title="1.2 新建一个 index.jsp 文件用于发送请求"></a>1.2 新建一个 index.jsp 文件用于发送请求</h4><p>在 Maven 工程中新建一个<code>webapp/index.jsp</code>页面用于发送请求。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;入门案例&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h3&gt;SpringMVC入门案例&lt;/h3&gt;&lt;br/&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/hello&quot;</span>&gt;SpringMVC入门案例&lt;/a&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h4 id="1-3-新建一个-success-jsp-文件以备后用"><a href="#1-3-新建一个-success-jsp-文件以备后用" class="headerlink" title="1.3 新建一个 success.jsp 文件以备后用"></a>1.3 新建一个 success.jsp 文件以备后用</h4><p>编写一个<code>/WEB-INF/pages/success.jsp</code>。</p>
<p>根据视图解析器解析的解析的转发地址编写一个页面，前端控制器会将的页面内容传递给终端显示器。终端显示器（一般是浏览器）解析并展示给用户。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;success&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h3&gt;入门成功！！！&lt;/h3&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>





<h3 id="2、项目核心配置文件"><a href="#2、项目核心配置文件" class="headerlink" title="2、项目核心配置文件"></a>2、项目核心配置文件</h3><h4 id="2-1-配置前端控制器-DispatcherServlet"><a href="#2-1-配置前端控制器-DispatcherServlet" class="headerlink" title="2.1 配置前端控制器 DispatcherServlet"></a>2.1 配置前端控制器 DispatcherServlet</h4><p>DispatcherServlet 是 SpringMVC 项目的核心组件，需要在配置文件（<code>webapp/WEB-INF/web.xml</code>）中进行配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--添加SpringMVC的前端控制器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置初始化参数：指定DispatcherServlet实例创建时加载的配置文件。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:SpringMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置DispatcherServlet实例对象创建的时间点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span> <span class="comment">&lt;!--（1）取值为0：应用加载时创建；（2）取值为非0正整数：Tomcat启动时就创建--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--设置前端控制器要拦截哪些请求（根据请求URL匹配，这里设置了拦截所有请求）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  服务器上保存着很多资源（静态资源和接口），所有访问服务器上的资源的请求首先都会被 DispatcherServlet 拦截，然后再由 DispatcherServlet 转发到对应的服务中去，所以 DispatherServlet 又被称为“转发器”。</li>
<li>  DispatcherServlet 是请求进入服务器的第一道拦截路径。</li>
<li>  <code>&lt;url-pattern&gt;</code> 标签中配置的是 DispatcherServlet 要拦截的请求的 URL 路径。</li>
</ul>
<h4 id="2-2-创建SpringMVC的配置文件-SpringMVC-xml"><a href="#2-2-创建SpringMVC的配置文件-SpringMVC-xml" class="headerlink" title="2.2 创建SpringMVC的配置文件 SpringMVC.xml"></a>2.2 创建SpringMVC的配置文件 SpringMVC.xml</h4><p>在上一节中，我们配置了 DispatherServlet 在创建实例时加载的配置文件的保存路径。 </p>
<p>这个配置文件是 SpringMVC 的另一个核心配置文件，它对命名无特殊要求，可在 web.xml 配置文件中自行指定。这里我们将其命名为 SpringMVC.xml。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--指定应用程序启动后要扫描的包，并将其中符合规则（一般是添加了@Component注解的类）的组件添加到Spring容器中--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.xsyu&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--开启SpringMVC对注解的支持。（如果项目中使用了SpringMVC中特有的注，则必须开启此配置项，否则这些注解就无法生效）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/28/SpringMVC/%E9%85%8D%E7%BD%AESpringMVC_xml.png"></p>
<h3 id="3、代码测试：编写控制器并使用注解配置"><a href="#3、代码测试：编写控制器并使用注解配置" class="headerlink" title="3、代码测试：编写控制器并使用注解配置"></a>3、代码测试：编写控制器并使用注解配置</h3><h4 id="Case1：不含-ResponseBody-注解"><a href="#Case1：不含-ResponseBody-注解" class="headerlink" title="Case1：不含 @ResponseBody 注解"></a>Case1：不含 @ResponseBody 注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/hello&quot;)</span> <span class="comment">//SpringMVC特有的注解，必须开启SpringMVC对注解的支持后才可以使用</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello SpringMVC&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;   <span class="comment">// 相当于一个转发</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们在控制器方法上没有使用 @ResponseBody 注解，那么控制器方法中返回字符串的操作就相当于一个“转发操作”。字符串字面量将会返回给项目中配置的视图解析器，并根据视图解析器的解析规则拼接上一个前缀 <code>/WEB-INF/pages/</code> 和一个后缀 <code>.jsp</code>，组成一个具体页面的地址 <code>/WEB-INF/pages/success.jsp</code>，给浏览器显示改地址的页面内容。</p>
<h4 id="Case2：含-ResponseBody-注解"><a href="#Case2：含-ResponseBody-注解" class="headerlink" title="Case2：含 @ResponseBody 注解"></a>Case2：含 @ResponseBody 注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ResponseBody</span>			<span class="comment">// ！！！</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/hello&quot;)</span>   </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello SpringMVC&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们在控制器方法上使用了 @ResponseBody 注解后，将不再执行转发的操作，而是直接返回 “success” 字面量给浏览器显示。</p>
<hr>
<h2 id="4-入门案例的执行流程分析"><a href="#4-入门案例的执行流程分析" class="headerlink" title="4 入门案例的执行流程分析"></a>4 入门案例的执行流程分析</h2><h3 id="入门案例的执行流程"><a href="#入门案例的执行流程" class="headerlink" title="入门案例的执行流程"></a>入门案例的执行流程</h3><p><img src="/2020/08/28/SpringMVC/%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.svg" alt="入门案例执行流程"></p>
<ol>
<li>Web 应用启动后，会自动读取配置文件 <code>web.xml</code> 中的配置项，尝试实例化一个 <code>DispatherServlet</code> 对象。</li>
<li>[可选]如果配置文件 <code>web.xml</code> 中关于 <code>DispatherServlet</code> 的配置项关联了 <code>SpringMVC.xml</code> 配置文件的话，继续读取 <code>SpringMVC.xml</code> 配置文件的内容。</li>
<li>根据两个配置文件的配置项，实例化对应的组件。<ul>
<li>  根据 <code>web.xml</code> 配置文件，实例化 <code>DispatherServlet</code> 组件；</li>
<li>  根据 <code>SpringMVC.xml</code> 配置文件，实例化 <code>&lt;context:component-scan base-package=&quot;&quot;/&gt;</code> 指定包下的组件；</li>
<li>  实例化视图解析器组件 InternalResourceViewResolver；</li>
<li>  ……</li>
</ul>
</li>
<li>客户端浏览器向服务器发送请求；</li>
<li>请求首先会被服务器上的 <code>DispatherServlet</code> 拦截；</li>
<li><code>DispatherServlet</code> 并不处理请求，而是把请求转发给 Controller。<ul>
<li>转发的路径是根据请求的 URL，匹配 <code>@RequestMapping</code> 注解的 value 值。</li>
<li><code>@RequestMapping</code> 注解位于 <code>Handler[控制器]</code>模块中，匹配成功后，执行控制器中对应的方法。</li>
<li>执行 HelloController 中对应的方法，该方法有一个返回值，是一个逻辑转发路径（返回值为String类型，且方法上不加<code>@ResponseBody</code>注解）。</li>
</ul>
</li>
<li>根据这个转发路径，经过 <code>InternalResourceViewResolver[视图解析器]</code> 解析，形成一个完整的访问路径。</li>
<li>将对应访问路径下的网页内容响应给浏览器。浏览器解析网页内容，展示给用户。</li>
</ol>
<h3 id="SpringMVC-的请求响应流程"><a href="#SpringMVC-的请求响应流程" class="headerlink" title="SpringMVC 的请求响应流程"></a>SpringMVC 的请求响应流程</h3><p><img src="/2020/08/28/SpringMVC/%E5%9F%BA%E4%BA%8ESpringMVC%E7%BB%84%E4%BB%B6%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png" alt="基于SpringMVC组件的请求处理流程"></p>
<ol>
<li>客户端（浏览器）向服务器发送 HTTP 请求，首先被 DispatherServlet 拦截；</li>
<li>DispatherServlet 会将请求消息中的 URL 与 HandlerMapping 中保存的 Controller 的地址逐一进行比对。<ul>
<li><p>如果能找到对应的 Controller，则返回一个执行链给 DispatherServlet；</p>
</li>
<li><p>如果找不到对应的 Controller，则返回错误信息。</p>
</li>
<li><p>Request 请求中携带的 URL 只是一串字符串字面量，并不能直接定位到 Controller。这些字符串字面量经过 HandlerMapping 处理后返回给 DispatherServlet 的执行链才是 Controller 真正的地址。</p>
</li>
</ul>
</li>
<li>返回执行链给 Controller；</li>
<li>根据执行链调用 Controller 的过程中，请求消息首先会被 HandlerAdapter 接收，再交由 Controller 处理；<ul>
<li>  <em>SpringMVC 中的 HandlerAdapter 是一个接口，Controller 是该接口的实现类。类似于 Service 和 ServiceImpl。</em></li>
</ul>
</li>
<li>HandlerAdapter 调用 Controller，执行业务处理逻辑；</li>
<li>Controller 处理完具体的业务后，将业务的执行结果（也就是 ModelAndView）交给 HandlerAdapter 代为返回；</li>
<li>HandlerAdapter 将 ModelAndView 对象交给 DispatherServlet 统一调度；</li>
<li>DispatherServlet 将 ModelAndView 对象转发给 ViewResolver 进行解析；</li>
<li>ViewResolver 拼接 ModelAndView 中的信息得到物理视图地址，并将视图地址转发给 DispatherServlet 统一调度。（相当于原先只知道一个逻辑地址，在视图解析器中先拼接成一个静态页面物理地址）</li>
<li>在第 9 步中，我们得到了一个静态页面地址，如果这个页面中还有动态数据。根据这个地址，DispatherServlet 还会将 ModelAndView 中的数据信息传递给静态页面，进行页面的渲染；</li>
<li>DispatherServlet 将渲染完成后的页面数据响应给客户端，客户端使用浏览器加载并展示页面。</li>
</ol>
<hr>
<h1 id="SpringMVC中的的组件"><a href="#SpringMVC中的的组件" class="headerlink" title="SpringMVC中的的组件"></a>SpringMVC中的的组件</h1><h2 id="1-DispatherServlet：前端控制器"><a href="#1-DispatherServlet：前端控制器" class="headerlink" title="1 DispatherServlet：前端控制器"></a>1 DispatherServlet：前端控制器</h2><p>DispatherServlet 是客户端和服务器数据传输的中枢，主要负责：</p>
<ul>
<li>  接收客户端的请求，并转发请求给其它组件处理；</li>
<li>  将处理后的响应结果返回给客户端。</li>
</ul>
<p>DispatherServlet 是整个流程的控制中心，由它调用其它组件处理用户的请求。</p>
<p>DispatherServlet 的存在降低了组件间的耦合性。</p>
<blockquote>
<p>  <strong>总结：</strong></p>
<p>  前端控制器就是一个拦截器，如果将拦截的路径设置为 <code>/</code> 的话，所有访问服务器的请求都会被该前端控制器拦截。请求被拦截后由前端控制器负责筛选，将筛选后符合要求的请求转发给 SpringMVC 中的其它组件，继续业务流程。</p>
</blockquote>
<h2 id="2-HandlerMapping：处理器映射器"><a href="#2-HandlerMapping：处理器映射器" class="headerlink" title="2 HandlerMapping：处理器映射器"></a>2 HandlerMapping：处理器映射器</h2><p>DispatherServlet 会把请求消息转发给 HandlerMapping，HandlerMapping 根据请求消息中的 URL 匹配对应的 Controller 的执行链，并返回给 DispatherServlet 。</p>
<p>SpringMVC 提供了不同的映射器实现方式。如：配置文件方式、实现接口方式、注解方式等。</p>
<h2 id="3-HandlerAdapter：处理器适配器"><a href="#3-HandlerAdapter：处理器适配器" class="headerlink" title="3 HandlerAdapter：处理器适配器"></a>3 HandlerAdapter：处理器适配器</h2><p>HandlerAdapter 的设计采用了设计模式中的适配器模式。</p>
<p>HandlerAdapter 可以理解为“接口”，是对很多个 Controller 更高层次的抽象，但程序在真正执行时调用的还是底层的 Controller。</p>
<p>DispatherServlet 知道了要执行哪一个 Controller 后，在将请求转发给 Controller 时，并不会调用“具体”而是会调用“抽象”，这个所谓的抽象就是 HandlerAdapter。举个例子就是：</p>
<ul>
<li>  DispatherServlet 类的代码中会将请求转发给 HandlerAdapter，而代码运行时实际是由 HandlerAdapter 的实现类 Controller 来接收的（就是接口与实现类的关系，用到了多态语法）。</li>
<li>  在 Controller 中执行具体的业务。</li>
<li>  Controller 中的业务代码执行完毕之后，返回一个 ModelAndView 对象。从代码底层来看是由 Controller 返回的，但是从 DispatherServlet 的角度来看是 HandlerAdapter 返回的。</li>
</ul>
<h3 id="为什么要使用处理器适配器？"><a href="#为什么要使用处理器适配器？" class="headerlink" title="为什么要使用处理器适配器？"></a>为什么要使用处理器适配器？</h3><p>在 MVC 框架中，DispatherServlet 负责接收请求消息和响应结果，HandlerMapping 负责找到对应的执行链，HandlerAdapter 规定了 Controller 的编写标准，Controller 负责真正的业务逻辑。</p>
<ul>
<li><p><strong>不使用处理器适配器：</strong></p>
<p>  如果我们不使用 HandlerAdapter，由 Controller 直接接收请求信息，显然耦合度非常高，一旦需求发生改变，我们除了要更改Controller 中的代码，还需要更改 Controller 依赖的和被依赖的一系列的代码，显然耦合度非常高。</p>
</li>
<li><p><strong>使用处理器适配器：</strong></p>
<p>  为了解决这个问题，SpringMVC 定义了一个 HandlerAdapter，我们在调用时候都使用适配器接口，通过多态的方式去调用真正的处理器类。这样，即使处理请求消息的 Controller 发生了变化，我们也无需修改所有的代码，只需要根据适配器接口添加一个新的处理器类即可。</p>
</li>
</ul>
<p>所以说，<strong>HandlerAdapter 是一个接口，Controller 是这个接口的实现类，它们之间是一对多的关系</strong>。</p>
<p><img src="/2020/08/28/SpringMVC/HandlerAdapter.png"></p>
<h2 id="4-Controller-Handler：处理器"><a href="#4-Controller-Handler：处理器" class="headerlink" title="4 Controller/Handler：处理器"></a>4 Controller/Handler：处理器</h2><p>Controller/Handler 的作用是处理业务逻辑。</p>
<h2 id="5-ViewResolver：视图解析器"><a href="#5-ViewResolver：视图解析器" class="headerlink" title="5 ViewResolver：视图解析器"></a>5 ViewResolver：视图解析器</h2><p>DispatherServlet 会把逻辑视图（字符串字面量）发送给视图解析器进行解析，</p>
<ol>
<li>（可选）ViewResolver 首先会把逻辑视图解析为完整的视图地址（一般是拼接前缀、后缀）；</li>
<li>再根据完整的视图地址找到物理视图（View）；</li>
<li>（可选）如果是动态页面，还要根据 ModeAndView 中的数据对 View 进行渲染；</li>
<li>最后将 View 数据转发到 DispatherServlet 统一调度。</li>
</ol>
<h2 id="6-View：视图"><a href="#6-View：视图" class="headerlink" title="6 View：视图"></a>6 View：视图</h2><p>SpringMVC 框架提供了很多的 View 视图类型的支持，包括 jsp、freemarker、Thymeleaf  等。</p>
<p>一般情况下会通过页面标签或页面模板技术将模型数据通过页面展示给用户，需要程序员根据业务需求开发具体的页面。</p>
<h2 id="7-HandlerExceptionResolver：异常处理器"><a href="#7-HandlerExceptionResolver：异常处理器" class="headerlink" title="7 HandlerExceptionResolver：异常处理器"></a>7 HandlerExceptionResolver：异常处理器</h2><h3 id="7-1-理论基础"><a href="#7-1-理论基础" class="headerlink" title="7.1 理论基础"></a>7.1 理论基础</h3><p><img src="/2020/08/28/SpringMVC/SpringMVC%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-1651810035436.png" alt="SpringMVC异常处理"></p>
<p>默认地，应用的 Dao、Service、Controller、DispatcherServlet 中出现异常的解决方案都是向上一级抛出。</p>
<p>这种情况下，如果程序运行的过程中某一步出现了异常，那么最终响应给客户端浏览器的就是将程序报错信息展示在浏览器页面上，这对于用户是十分不友好的。</p>
<p>SpringMVC 中提供了一种异常处理机制：在程序运行过程中出现的异常一路向上抛出，直到到达 DispatcherServlet 时，由 DispatcherServlet 将异常信息交给 HandlerExceptionResolver 来处理，通过 HandlerExceptionResolver 跳转到一个提前写好的、友好的错误提示页面返回给客户端。</p>
<h3 id="7-2-实现步骤"><a href="#7-2-实现步骤" class="headerlink" title="7.2 实现步骤"></a>7.2 实现步骤</h3><img src="/2020/08/28/SpringMVC/SpringMVC%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8.png" style="zoom: 67%;">

<h4 id="1、编写访问页面"><a href="#1、编写访问页面" class="headerlink" title="1、编写访问页面"></a>1、编写访问页面</h4><ul>
<li>index.jsp</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;user/testException&quot;</span>&gt;异常处理&lt;/a&gt;</span><br></pre></td></tr></table></figure>



<h4 id="2、编写控制器Controller"><a href="#2、编写控制器Controller" class="headerlink" title="2、编写控制器Controller"></a>2、编写控制器Controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testException&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testException</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行&quot;</span>)</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;    <span class="comment">// 模拟异常</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在出现异常后，Controller 会自动向上层抛出异常，最后展示给用户的是一个很不友好的错误页面。</li>
<li>为了解决这个问题，我们使用自定义的异常处理器处理异常。</li>
</ul>
<h4 id="3、编写异常类（自定义异常类）"><a href="#3、编写异常类（自定义异常类）" class="headerlink" title="3、编写异常类（自定义异常类）"></a>3、编写异常类（自定义异常类）</h4><p>我们可以使用自定义的“友好的”异常信息来代替原生的“不友好的”异常信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义的异常类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存储提示信息的字符串</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4、修改Controller控制器中的代码"><a href="#4、修改Controller控制器中的代码" class="headerlink" title="4、修改Controller控制器中的代码"></a>4、修改Controller控制器中的代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testException&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testException</span><span class="params">()</span> <span class="keyword">throws</span> MyException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;    <span class="comment">// 模拟异常</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 在控制台打印异常信息</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// 抛出自定义异常信息(由于定义了异常处理器，此处是抛给异常处理器处理)</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyException</span>(<span class="string">&quot;服务器崩溃了&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5、自定义异常处理器"><a href="#5、自定义异常处理器" class="headerlink" title="5、自定义异常处理器"></a>5、自定义异常处理器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常处理器</span></span><br><span class="line"><span class="comment"> * 异常处理器必须实现`HandlerExceptionResolver`接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerExceptionResolver</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理异常的业务逻辑</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e 接收下一级返回的异常信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveException</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取异常对象</span></span><br><span class="line">        <span class="type">MyException</span> <span class="variable">exception</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 如果从Controller中接收异常信息是MyException类型，就直接接收，否则就自定义一个MyException异常类型</span></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MyException)&#123;</span><br><span class="line">            exception = (MyException)e;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            exception = <span class="keyword">new</span> <span class="title class_">MyException</span>(<span class="string">&quot;系统正在维护&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建ModelAndView对象</span></span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        <span class="comment">// 从自定义的异常类中拿到提示信息，并转发到error页面</span></span><br><span class="line">        mv.addObject(<span class="string">&quot;errorMessage&quot;</span>, exception.getMessage());</span><br><span class="line">        mv.setViewName(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	1. 接收从Controller控制器中抛出的异常信息 `Exception e`;</span></span><br><span class="line"><span class="comment">	2. 创建一个返回页面`error.jsp`；</span></span><br><span class="line"><span class="comment">	 并将从Controller控制器中得到的异常信息转发到`error.jsp`中。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h4 id="6、自定义展示给用户的错误信息页面"><a href="#6、自定义展示给用户的错误信息页面" class="headerlink" title="6、自定义展示给用户的错误信息页面"></a>6、自定义展示给用户的错误信息页面</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;错误提示页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    $&#123;errorMessage&#125;		&lt;!--从异常处理器中拿到的错误信息数据--&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="7、注册异常处理器"><a href="#7、注册异常处理器" class="headerlink" title="7、注册异常处理器"></a>7、注册异常处理器</h4><ul>
<li><code>SpringMVC.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置异常处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;MyExceptionResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.xsyu.exception.MyExceptionResolver&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	启用异常处理器的工作由 &lt;mvc:annotation-driven&gt; 帮助我们完成了</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="7-3-小总结"><a href="#7-3-小总结" class="headerlink" title="7.3 小总结"></a>7.3 小总结</h3><p>如果程序在运行过程中出现了异常，那么异常必然会层层向上抛出，直到到达<strong>前端控制器（DispatherServlet）</strong>，前端控制器如果发现接收的消息中含有异常，就会转发给异常处理器，在异常处理器中，可以改变默认的异常处理逻辑，比如：改变返回给用户的异常信息，也可以转发到一个友好的异常展示页面中去。</p>
<hr>
<h2 id="8-HandlerInterceptor：处理器拦截器"><a href="#8-HandlerInterceptor：处理器拦截器" class="headerlink" title="8 HandlerInterceptor：处理器拦截器"></a>8 HandlerInterceptor：处理器拦截器</h2><h3 id="8-1-拦截器的作用"><a href="#8-1-拦截器的作用" class="headerlink" title="8.1 拦截器的作用"></a>8.1 拦截器的作用</h3><ul>
<li>SpringMVC 中的 HandlerInterceptor 类似于 Servlet 开发中的过滤器 Filter，<strong>用于对请求消息进行预处理，对响应消息进行后处理</strong>。</li>
<li>SpringMVC 支持用户自定义一些拦截器来实现特定的功能。</li>
<li>开发人员自定义的拦截器必须实现 HandlerInterceptor 接口</li>
</ul>
<h4 id="8-1-1-拦截器链"><a href="#8-1-1-拦截器链" class="headerlink" title="8.1.1 拦截器链"></a>8.1.1 拦截器链</h4><p><strong>拦截器链</strong>：拦截器链就是将拦截器按一定的顺序连成一条链。在请求被拦截时，拦截器链中的拦截器就会按照定义的顺序被调用。</p>
<h4 id="8-1-2-拦截器vs-过滤器"><a href="#8-1-2-拦截器vs-过滤器" class="headerlink" title="8.1.2 拦截器vs.过滤器"></a>8.1.2 拦截器vs.过滤器</h4><table>
<thead>
<tr>
<th></th>
<th>过滤器（Filter）</th>
<th>拦截器（HandlerInterceptor）</th>
</tr>
</thead>
<tbody><tr>
<td>使用范围</td>
<td>Filter 是 Servlet 规范中的一部分，在任何JavaWeb 工程中都可以使用。</td>
<td>HandlerInterceptor 是 SpringMVC 框架特有的，只能在 SpringMVC 项目中使用。</td>
</tr>
<tr>
<td>使用规则</td>
<td>Filter 在 <code>url-pattern</code> 中配置了 <code>/*</code> 之后，会拦截访问所有资源的请求。</td>
<td><strong>拦截器只会拦截访问 Controller 的请求</strong>，如果访问的是 jsp、image、js 等静态资源，是不会进行拦截的。</td>
</tr>
</tbody></table>
<hr>
<h3 id="8-2-自定义拦截器的步骤"><a href="#8-2-自定义拦截器的步骤" class="headerlink" title="8.2 自定义拦截器的步骤"></a>8.2 自定义拦截器的步骤</h3><h4 id="1、编写一个可提供访问服务的SpringMVC项目"><a href="#1、编写一个可提供访问服务的SpringMVC项目" class="headerlink" title="1、编写一个可提供访问服务的SpringMVC项目"></a>1、编写一个可提供访问服务的SpringMVC项目</h4><h4 id="2、编写一个自定义拦截器类（HandlerInterceptor接口的实现类）"><a href="#2、编写一个自定义拦截器类（HandlerInterceptor接口的实现类）" class="headerlink" title="2、编写一个自定义拦截器类（HandlerInterceptor接口的实现类）"></a>2、编写一个自定义拦截器类（HandlerInterceptor接口的实现类）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 预处理：返回值为true，表示执行完拦截器中的方法后放行；</span></span><br><span class="line"><span class="comment">     * 返回值为false，表示执行完拦截器中的方法后仍不放行。</span></span><br><span class="line"><span class="comment">     * Tip：预处理、后处理、最终处理拦截器是一次性放行的</span></span><br><span class="line"><span class="comment">     *  	</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;预处理拦截器&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后处理拦截器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;最终处理拦截器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3、注册拦截器"><a href="#3、注册拦截器" class="headerlink" title="3、注册拦截器"></a>3、注册拦截器</h4><ul>
<li><code>SpringMVC.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册拦截器链--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span>   <span class="comment">&lt;!--配置拦截器要拦截的路径：这里设置拦截所有所有访问Controller的请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;HandlerInterceptor1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.xsyu.MyHandlerInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;HandlerInterceptor2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.xsyu.MyHandlerInterceptor2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4、结果测试"><a href="#4、结果测试" class="headerlink" title="4、结果测试"></a>4、结果测试</h4><hr>
<h3 id="8-3-拦截器细节"><a href="#8-3-拦截器细节" class="headerlink" title="8.3 拦截器细节"></a>8.3 拦截器细节</h3><ul>
<li>  <strong>拦截器的放行：</strong></li>
</ul>
<p>放行的含义是指，如果有下一个拦截器就执行下一个拦截器，如果该拦截器处于拦截器链上的最后一个，则执行 Controller 中的方法。</p>
<ul>
<li>  <strong>拦截器的作用路径</strong></li>
</ul>
<p>作用路径可以通过在配置文件中设置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span>   <span class="comment">&lt;!--指定拦截的URL--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span>	<span class="comment">&lt;!--指定不拦截的URL--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这2个标签的作用相反，只要写一个即可--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;HandlerInterceptor1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.xsyu.MyHandlerInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="9-Converter：类型转换器"><a href="#9-Converter：类型转换器" class="headerlink" title="9 Converter：类型转换器"></a>9 Converter：类型转换器</h2><blockquote>
<p>  <strong>自定义类型转换器</strong></p>
</blockquote>
<h3 id="1-类型转换器的使用场景"><a href="#1-类型转换器的使用场景" class="headerlink" title="1 类型转换器的使用场景"></a>1 类型转换器的使用场景</h3><p>客户端浏览器向服务器发送的请求中包含一个日期字符串，但是这个字符串格式却不符合 JVM 内置的字符串格式。</p>
<ul>
<li>  如果服务器使用 String 类型来接收这个字符串，自然可以接收成功；</li>
<li>  但是服务器使用 Date 数据类型来接收这个字符串，就会出现<strong>类型转换失败</strong>的情况。</li>
</ul>
<p>如果我们能够在请求到达 Controller 前，将请求消息中的日期格式改为符合 JVM 标准的格式，如 <code>date=2020/07/14</code>，在 Controller 中就可以直接使用 Date 数据类型来接收这个字符串。这就是所谓的“类型转换”。</p>
<p>这种情况下就需要我们手动实现自定义类型转换。</p>
<p>自定义的类型转换器需要实现 Converter 接口，Convert 接口的源码如下所示：</p>
<blockquote>
<p>  Convert接口源码：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span>	<span class="comment">// 函数式接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Converter</span>&lt;S, T&gt; &#123;	<span class="comment">// 该接口有2个泛型，S表示接收的类型，T表示目标类型</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Convert the source object of type &#123;<span class="doctag">@code</span> S&#125; to target type &#123;<span class="doctag">@code</span> T&#125;.</span></span><br><span class="line"><span class="comment">	 * 实现类型转换的方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">convert</span><span class="params">(S source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-使用步骤"><a href="#2-使用步骤" class="headerlink" title="2 使用步骤"></a>2 使用步骤</h3><ol>
<li><p>客户端浏览器发送请求的代码：<code>index.jsp</code></p>
 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;自定义类型转换器&lt;/h3&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/account/deleteAccount?date=2020-07-14&quot;</span>&gt;根据日期删除用户&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>服务器 Controller 层代码</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller(value = &quot;accountController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;deleteAccount&quot;)</span></span><br><span class="line">    <span class="comment">// public String deleteAccount(String date)&#123;</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteAccount</span><span class="params">(Date date)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除了账户&quot;</span>+date);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  如果使用 String 类型接收客户端传递的 date 变量，可以成功接收。因为 date 在传递过程中就是以字符串格式流转的。</li>
<li>  但是如果使用 Date 类型接收客户端传递的 date 变量会出现 <strong>[400 – Bad Request]</strong> 错误，因为字符串 “2020-07-14” 不能自动转换为 Date 类型。此时，我们需要自定义一个类型转换器，将接收到的 date 字符串转换为 Date 类型的对象。</li>
</ul>
</li>
<li><p>自定义一个 Converter 接口的实现类，重写接口中的 <code>convert(S source)</code> 方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToDateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, Date&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (source == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;请输入要转换的日期！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">DateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">            <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> dateFormat.parse(source);</span><br><span class="line">            <span class="keyword">return</span> date;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在 <code>SpringMVC.xml</code> 配置文件中注册类型转换器</p>
<ul>
<li>  SpringMVC 中，类型转换器（Converter）可以有多个，被一个类型转换器工厂（ConversionServiceFactoryBean）统一管理。</li>
<li>  SpringMVC 配置 Converter 的机制是，将自定义的类型转换器注册（添加）到类型转换工厂维护的的类型转换器服务中。</li>
</ul>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置类型转换器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--1.配置类型转换工厂--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionServiceFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2.给工厂注入一个新的类型转换器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myConverter01&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置自定义类型转换器--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;cn.xsyu.utils.StringToDateConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	一个类型转换工厂中可以有多个类型转换器</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在<code>SpringMVC.xml</code>配置文件中，使用<code>&lt;annotation-driven&gt;</code>标签启用<code>类型转换器工厂</code>。</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Spring开启注解MVC的支持 + 引用自定义的类型转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionServiceFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p> 配置完成，类型转换器生效后。在 Controller 的接口中就可以直接使用 Date 类型的变量来接收 String 类型的日期值了。</p>
</li>
</ol>
<hr>
<h2 id="10-lt-mvc-annotation-driven-gt"><a href="#10-lt-mvc-annotation-driven-gt" class="headerlink" title="10 &lt;mvc:annotation-driven&gt;"></a>10 <code>&lt;mvc:annotation-driven&gt;</code></h2><p>在 SpringMVC 项目中，<strong>HandlerMapping、HandlerAdapter、ViewResolver</strong> 等都是 SpringMVC 特有的组件。</p>
<p>如果在配置文件 <code>SpringMVC.xml</code> 中配置了 <code>&lt;mvc:annotation-driven&gt;</code> 标签，就会默认使用 SpringMVC 源码中定义的HandlerMapping、HandlerAdapter 等组件。</p>
<p>也就是说如果使用了 <code>&lt;mvc:annotation-driven&gt;</code> 标签，如无特殊需求，就无需再手动配置 HandlerMapping、HandlerAdapter 等组件了。</p>
<p>它就相当于在 <code>SpringMVC.xml</code> 中配置了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">---------------------------------<span class="comment">&lt;!--等价于--&gt;</span>-----------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置处理器映射器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置处理器适配器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置处理器异常解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>







<hr>
<h1 id="请求参数的绑定"><a href="#请求参数的绑定" class="headerlink" title="请求参数的绑定"></a>请求参数的绑定</h1><h2 id="1-绑定说明"><a href="#1-绑定说明" class="headerlink" title="1 绑定说明"></a>1 绑定说明</h2><h3 id="1-1-绑定的机制"><a href="#1-1-绑定的机制" class="headerlink" title="1.1 绑定的机制"></a>1.1 绑定的机制</h3><ol>
<li><p>我们都知道，前端页面中表单的请求参数默认是以 <code>key=value</code> 的格式传输的。</p>
<ul>
<li>  HTML中表单默认的传输数据类型 <code>&lt;form enctype=&quot;application/x-www-form-urlencoded&quot;&gt;</code></li>
</ul>
</li>
<li><p>SpringMVC 中，绑定请求参数就是把表单提交的数据赋值给 Controller 中接口方法的形参。也就是将表单中请求参数的 key 和 Controller 中接口方法的形参名进行映射。</p>
</li>
</ol>
<h3 id="1-2-支持绑定的数据类型"><a href="#1-2-支持绑定的数据类型" class="headerlink" title="1.2 支持绑定的数据类型"></a>1.2 支持绑定的数据类型</h3><ul>
<li>  基本类型 &amp; String 类型</li>
<li>  POJO 类型参数：包括实体类，以及关联的实体类</li>
<li>  数组和集合类型参数：包括List结构和Map结构的集合（包括数组）</li>
</ul>
<hr>
<h2 id="2-自动绑定"><a href="#2-自动绑定" class="headerlink" title="2 自动绑定"></a>2 自动绑定</h2><p>SpringMVC 支持请求参数的自动绑定机制，但前提是请求参数必须 SpringMVC 制定的标准。</p>
<h3 id="2-1-原理"><a href="#2-1-原理" class="headerlink" title="2.1 原理"></a>2.1 原理</h3><ol>
<li><p>如果是<strong>基本类型或 String 类型</strong>：</p>
<ul>
<li>要求我们的请求参数的 key 必须和 Controller 中接口方法的形参名称一致。（严格区分大小写）</li>
</ul>
</li>
<li><p>如果是 <strong>POJO 类型</strong>，或者它的关联对象：</p>
<ul>
<li>要求 Controller 中方法对应的参数类型是 POJO 类型。</li>
<li>并且要求 POJO 类提供公共的 setXxx() 方法。</li>
<li>注意：表单中请求参数的 key 要和 setXxx() 方法中的 xxx 保持一致。</li>
</ul>
</li>
<li><p>如果是<strong>集合类型</strong>，有2种方式：</p>
<ul>
<li><p>第1种：集合类型的请求参数在 POJO 中。</p>
<ul>
<li>此时，要求表单中的请求参数的 key 和 POJO 中集合的 setXxx() 方法中的 xxx 名称相同。</li>
<li>给 List 形式的集合中的元素赋值，使用下标。</li>
<li>给 Map 形式的集合中的元素赋值，使用键值对。</li>
</ul>
</li>
<li><p>第2种：接收的请求参数是 json 格式数据。</p>
<ul>
<li>  接收 json 字符串之后，使用 json 转换工具将 json 字符串转换成对应的 POJO 对象。</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-2-代码演示"><a href="#2-2-代码演示" class="headerlink" title="2.2 代码演示"></a>2.2 代码演示</h3><h4 id="1、基本类型-String类型的请求参数"><a href="#1、基本类型-String类型的请求参数" class="headerlink" title="1、基本类型/String类型的请求参数"></a>1、基本类型/String类型的请求参数</h4><ol>
<li><p>客户端请求页面：<code>index.jsp</code></p>
 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/hello&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        密码：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交POST请求&quot;</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	在index.jsp页面中键入：</span><br><span class="line">		username=zhangsan, password=<span class="number">123456</span></span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Controller</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello SpringMVC： &quot;</span>+username+<span class="string">&quot;=&quot;</span>+password);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	控制台输出：</span></span><br><span class="line"><span class="comment">		Hello SpringMVC： zhangsan=123456</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h4 id="2、POJO-类型的请求参数"><a href="#2、POJO-类型的请求参数" class="headerlink" title="2、POJO 类型的请求参数"></a>2、POJO 类型的请求参数</h4><ol>
<li><p>实体类代码</p>
<ul>
<li>  Account类</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Float money;</span><br><span class="line">    <span class="comment">// 省略 getter、setter、toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  User类</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> Account account;	<span class="comment">// 关联的实体类</span></span><br><span class="line">    <span class="comment">// 省略 getter、setter、toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="2">
<li><p>客户端浏览器<code>index.jsp</code>代码</p>
 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;请求参数的绑定（User类型及关联的Account实体类）&lt;/h3&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/saveUser&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        性别：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;gender&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        年龄：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;age&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;account.username&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        密码：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;account.password&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        余额：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;account.money&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

</li>
<li><p>Controller 层代码</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;userController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;saveUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveAccount</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;保存成功&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">执行结果：</span></span><br><span class="line"><span class="comment">	User&#123;name=&#x27;张三&#x27;, gender=&#x27;男&#x27;, age=&#x27;29&#x27;, </span></span><br><span class="line"><span class="comment">		account=Account&#123;username=&#x27;zhangsan@qq.com&#x27;, password=&#x27;123&#x27;, money=666.66&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h4 id="3、POJO类中包含集合类型参数"><a href="#3、POJO类中包含集合类型参数" class="headerlink" title="3、POJO类中包含集合类型参数"></a>3、POJO类中包含集合类型参数</h4><blockquote>
<ol>
<li> 实体类代码</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Account&gt; map;</span><br><span class="line">	<span class="comment">// get&amp;set</span></span><br><span class="line">    <span class="comment">// toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<ol start="2">
<li> 客户端浏览器<code>index.jsp</code>代码</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>请求参数的绑定（POJO类中包含集合类型参数）<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/saveUser&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        用户姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        用户性别：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        用户年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        账户名1：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;list[0].username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        账户密码1：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;list[0].password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        账户余额1：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;list[0].money&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        账户名2：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;map[&#x27;one&#x27;].username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        账户密码2：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;map[&#x27;one&#x27;].password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        账户余额2：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;map[&#x27;one&#x27;].money&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="3">
<li> 控制器代码</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;userController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;saveUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveAccount</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;保存成功&quot;</span>);</span><br><span class="line">     System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	执行结果：</span></span><br><span class="line"><span class="comment">	User&#123;name=&#x27;张三&#x27;, gender=&#x27;男&#x27;, age=&#x27;29&#x27;, </span></span><br><span class="line"><span class="comment">	list=[Account&#123;username=&#x27;zhangsan@qq.com&#x27;, password=&#x27;123&#x27;, money=66.6&#125;], </span></span><br><span class="line"><span class="comment">	map=&#123;one=Account&#123;username=&#x27;zhangsan@163.com&#x27;, password=&#x27;456&#x27;, money=0.63&#125;&#125;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>




<hr>
<h3 id="2-3-请求参数乱码问题"><a href="#2-3-请求参数乱码问题" class="headerlink" title="2.3 请求参数乱码问题"></a>2.3 请求参数乱码问题</h3><h4 id="Q1：POST-请求参数中文乱码的问题"><a href="#Q1：POST-请求参数中文乱码的问题" class="headerlink" title="Q1：POST 请求参数中文乱码的问题"></a>Q1：POST 请求参数中文乱码的问题</h4><blockquote>
<p>  <strong>问题</strong></p>
</blockquote>
<p>当请求参数为中文时，</p>
<ul>
<li>如果使用 GET 请求，不会出现乱码的问题，</li>
<li>但是当我们使用 POST 请求时，则会出现中文乱码的问题。</li>
</ul>
<blockquote>
<p>  <strong>解决思路：</strong></p>
</blockquote>
<ul>
<li>添加一个过滤器 Filter，将所有的请求和响应消息的编码都设置为 UTF-8。</li>
<li>同理，也可以考虑使用 SpringMVC 特有的 HandlerInterceptor 来实现。</li>
</ul>
<blockquote>
<p>  <strong>解决方案：</strong></p>
</blockquote>
<ul>
<li>  在配置文件 web.xml 中添加一个过滤器</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置CharacterEncodingFilter过滤器中的属性值encoding=utf-8 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>setEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>   <span class="comment">&lt;!--过滤所有请求--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>





<hr>
<h3 id="2-4-接收Servlet原生的API作为方法参数"><a href="#2-4-接收Servlet原生的API作为方法参数" class="headerlink" title="2.4 接收Servlet原生的API作为方法参数"></a>2.4 接收Servlet原生的API作为方法参数</h3><p>SpringMVC 还支持使用原生的 Servlet API 对象作为 controller 中接口方法的入参。支持的原生 Servlet API 对象包括：</p>
<ul>
<li>  <code>HttpServletRequest</code></li>
<li>  <code>HttpServletResponse</code></li>
<li>  <code>HttpSession</code></li>
<li>  <code>java.security.Principal</code></li>
<li>  <code>Locale</code></li>
<li>  <code>InputStream</code></li>
<li>  <code>OutputStream</code></li>
<li>  <code>Reader</code></li>
<li>  <code>Writer</code></li>
</ul>
<p>上述对象，都可以直接映射到 Controller 中的方法的同名形参上。</p>
<h4 id="部分示例代码："><a href="#部分示例代码：" class="headerlink" title="部分示例代码："></a>部分示例代码：</h4><ol>
<li><p>客户端浏览器的访问请求代码：<code>index.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--原始ServletAPI作为控制器参数--&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testServletAPI&quot;</span>&gt;测试访问ServletAPI&lt;/a&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testServletAPI&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testServletAPI</span><span class="params">(HttpServletRequest request, HttpSession session)</span>&#123;</span><br><span class="line">        System.out.println(request);</span><br><span class="line">        System.out.println(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	输出结果：</span></span><br><span class="line"><span class="comment">		org.apache.catalina.connector.RequestFacade@2d9079c9</span></span><br><span class="line"><span class="comment">		org.apache.catalina.session.StandardSessionFacade@4be66770</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="3-通过注解绑定"><a href="#3-通过注解绑定" class="headerlink" title="3 通过注解绑定"></a>3 通过注解绑定</h2><p>HTTP 请求中能够携带请求参数的地方无非就三个地方：</p>
<ul>
<li>  在 GET 请求的 URL 中拼接请求参数；</li>
<li>  在 GET 请求中使用占位符携带请求参数；</li>
<li>  在 POST 请求的请求体中携带请求参数。</li>
</ul>
<p>针对这三个地方的请求数据，SpringMVC 分别提供了 @RequestParam、@PathVariable 和 @RequestBody 三个注解进行请求参数的解析。</p>
<h3 id="1-RequestParam"><a href="#1-RequestParam" class="headerlink" title="1 @RequestParam"></a>1 @RequestParam</h3><blockquote>
<p>  <strong>使用说明</strong></p>
</blockquote>
<ul>
<li>  <strong>作用</strong>：把 HTTP 请求中指定名称的请求参数赋值给 Controller 中接口方法的形参（此时不强制要求请求参数的名称与 Controller 方法中形参的名称相同）。</li>
<li>属性：<ul>
<li>  <code>value</code>：HTTP 请求消息中参数的 key。</li>
<li>  <code>required</code>：请求参数中是否必须提供此参数（默认为True）。</li>
</ul>
</li>
</ul>
<blockquote>
<p>  <strong>使用示例</strong></p>
</blockquote>
<ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--requestParam注解的使用--&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testRequestParam?name=张三&quot;</span>&gt;</span><br><span class="line">    测试RequestParam注解</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;br&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testRequestParam&quot;)</span>		</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRequestParam</span><span class="params">(<span class="meta">@RequestParam(value = &quot;name&quot;)</span> String username)</span>&#123;	<span class="comment">// 将请求参数中的name赋值给本方法的username参数</span></span><br><span class="line">        System.out.println(username);	<span class="comment">// 张三</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li>  如果此时 HTTP 请求的请求参数中没有 key 为 name 的属性，得到的 username 不是 null，而是会直接报错：400 – Bad Request。</li>
<li>  如果想要得到结果为 null，则需要设置：<code>@RequestParam(value = &quot;name&quot;, required = false)</code></li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-RequestBody"><a href="#2-RequestBody" class="headerlink" title="2 @RequestBody"></a>2 @RequestBody</h3><blockquote>
<p>  <strong>使用说明</strong></p>
</blockquote>
<ul>
<li><p>作用：</p>
<ul>
<li>  <strong>用于获取 POST 请求消息中请求体的内容，GET 请求方式不适用。</strong></li>
<li>  直接使用得到的是 <code>key=value&amp;key=value......</code> 结构的 String 类型的数据。</li>
</ul>
</li>
<li><p>属性：</p>
<ul>
<li>  <code>required</code>：是否必须有请求体（默认为True）。    -   如果 required=true，GET 请求方式会报错。    -   如果 required=false，GET 请求不会报错，但是 Controller 中接口方法得到数据是 null。</li>
</ul>
</li>
</ul>
<blockquote>
<p>  <strong>使用示例</strong></p>
</blockquote>
<ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--RequestBody注解测试--%&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/testRequestBody&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    用户姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    用户性别：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;gender&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    用户年龄：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;age&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;userController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;testRequestBody&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRequestBody</span><span class="params">(<span class="meta">@RequestBody(required = false)</span> String body)</span>&#123;	<span class="comment">// 此处的变量名可以自定义</span></span><br><span class="line">        System.out.println(body);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	输出结果：</span></span><br><span class="line"><span class="comment">		name=zs&amp;gender=nan&amp;age=29</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="3-PathVaribale"><a href="#3-PathVaribale" class="headerlink" title="3 @PathVaribale"></a>3 @PathVaribale</h3><blockquote>
<p>  <strong>使用说明</strong></p>
</blockquote>
<ul>
<li>  作用：</li>
<li>用于绑定 HTTP 请求中请求 URL 中的占位符。</li>
<li>例如，<code>$&#123;pageContext.request.contextPath&#125;/delete/&#123;id&#125;</code> 请求 URL 中的 <code>&#123;id&#125;</code> 就是占位符。</li>
<li>URL 占位符是 Spring3.0+ 之后加入的。是 SpringMVC 支持 Restful 风格 URL 的一个重要标志。</li>
<li>  属性：</li>
<li><code>value</code>：用于指定 URL 中占位符名称。</li>
<li><code>required</code>：是否必须提供占位符。</li>
</ul>
<blockquote>
<p>  <strong>使用示例</strong></p>
</blockquote>
<ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--PathVariable注解测试--%&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testPathVariable/lisi&quot;</span>&gt;测试PathVariable注解&lt;/a&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testPathVariable/&#123;name&#125;&quot;)</span><span class="comment">//从请求URL中截取部分作为请求参数传递</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testPathVariable</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String name)</span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	执行结果：lisi</span></span><br><span class="line"><span class="comment">* /</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="4-ModelAttribute"><a href="#4-ModelAttribute" class="headerlink" title="4 @ModelAttribute"></a>4 @ModelAttribute</h3><blockquote>
<p>  <strong>使用说明</strong></p>
</blockquote>
<ul>
<li><p>  作用：</p>
</li>
<li><p>该注解是 SpringMVC4.3 版本之后新加入的，它可以用于<strong>修饰方法和参数</strong>。</p>
</li>
<li><p>在方法上使用时，被该注解修饰的方法会先于本该被执行的方法执行。</p>
</li>
<li><p>在参数上使用时，表示使用 HTTP 请求中指定的数据给参数赋值。</p>
</li>
<li><p>  属性：</p>
</li>
<li><p><code>value</code>：用于获取数据的 key。[key可以是POJO的属性名称，也可以是Map结构的key]</p>
</li>
<li><p>  应用场景：</p>
</li>
<li><p>当表单提交的数据不是完整的实体类数据时，可以保证没有提交数据的字段使用数据库对象中原有的数据。</p>
</li>
<li><p>例如：当我们在编辑一个用户时，用户有一个创建信息字段，该字段的值是不被允许修改的。在表单提交数据时，是肯定没有此字段的内容，此时，正常情况下，一旦更新用户数据就会把该字段内容置位 null，这时就可以使用此注解保留原始数据中该字段的内容。</p>
</li>
</ul>
<blockquote>
<p>  <strong>使用示例</strong></p>
</blockquote>
<h4 id="Case1：-ModelAttribute-修饰方法"><a href="#Case1：-ModelAttribute-修饰方法" class="headerlink" title="Case1：@ModelAttribute 修饰方法"></a>Case1：@ModelAttribute 修饰方法</h4><p>需求：要求修改用户信息，但是用户的名不能被修改</p>
<ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ModelAttribute注解测试--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/updateUser&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    用户编号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    用户性别：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    用户年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在表单页面键入：id=01，gender=男，age=23。</p>
</li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;userController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该方法会先于本该执行的方法执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  从数据库中查询到的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">showUser</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        <span class="comment">// 模拟查询数据库</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> findUserById(id);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟根据id从数据库中查询数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据id从数据库中查询数据并返回：&quot;</span>+id);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;管理员&quot;</span>);</span><br><span class="line">        user.setGender(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">        user.setAge(<span class="string">&quot;46&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    输出结果：User&#123;name=&#x27;管理员&#x27;, gender=&#x27;男&#x27;, age=&#x27;23&#x27;, list=null, map=null&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">分析：</span><br><span class="line">   </span><br><span class="line">   -   在 updateUser 方法中，用户上传的数据只有 `id`、`gender` 和 `age` 字段，但是输出结果中却还有 `name` 字段，是因为 `name` 属性沿用了数据库中的数据。</span><br><span class="line">   -   使用 `@ModelAttribute` 注解提前从数据库中获取 user 对象，然后再将用户新提交的数据赋值给 user 对象，这时新提交的数据将会覆盖原先 user 对象中对应的字段，而剩余的字段将会沿用从数据库中取出的 user 对象中的值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### Case2：@ModelAttribute 修饰参数</span><br><span class="line"></span><br><span class="line">需求：要求修改用户信息，但是用户的用户名不能被修改</span><br><span class="line"></span><br><span class="line">1. 客户端浏览器的请求页面：`index.jsp`</span><br><span class="line"></span><br><span class="line">   ```xml</span><br><span class="line">   &lt;!-- 修改用户信息 --&gt;</span><br><span class="line">   &lt;form action=&quot;$&#123;pageContext.request.contextPath&#125;/user/updateUser&quot; method=&quot;post&quot;&gt;</span><br><span class="line">       用户编号：&lt;input type=&quot;text&quot; name=&quot;id&quot;/&gt;&lt;br&gt;</span><br><span class="line">       用户性别：&lt;input type=&quot;text&quot; name=&quot;gender&quot;/&gt;&lt;br&gt;</span><br><span class="line">       用户年龄：&lt;input type=&quot;text&quot; name=&quot;age&quot;/&gt;&lt;br&gt;</span><br><span class="line">       &lt;input type=&quot;submit&quot; value=&quot;提交&quot;/&gt;</span><br><span class="line">   &lt;/form&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;userController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该方法会先执行,</span></span><br><span class="line"><span class="comment">     * 根据ID从数据库中查询用户，并将用户存入Map集合中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showUser</span><span class="params">(Integer id, Map&lt;String, User&gt; map)</span>&#123;</span><br><span class="line">        <span class="comment">// 模拟查询数据库</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> findUserById(id);</span><br><span class="line">        map.put(<span class="string">&quot;abc&quot;</span>, user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">(<span class="meta">@ModelAttribute(&quot;abc&quot;)</span> User user)</span>&#123; <span class="comment">// 根据Map集合的key获取value，并给user参数赋值</span></span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟根据id从数据库中查询数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据id从数据库中查询数据并返回：&quot;</span>+id);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;管理员&quot;</span>);</span><br><span class="line">        user.setGender(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">        user.setAge(<span class="string">&quot;46&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h1><h2 id="1-RequestMapping注解"><a href="#1-RequestMapping注解" class="headerlink" title="1 @RequestMapping注解"></a>1 @RequestMapping注解</h2><h3 id="1-1-说明"><a href="#1-1-说明" class="headerlink" title="1.1 说明"></a>1.1 说明</h3><p><strong>作用：</strong>用于建立请求 URL 和处理请求的方法之间的联系。[HandlerMapping 的管辖范围]</p>
<p><strong>使用位置：</strong></p>
<ul>
<li><p>类上</p>
<ul>
<li>  请求 URL 的第一级访问目录。此处不写的话，就相当于 URL 为工程路径下的根目录，写的话需要以 <code>/</code> 开头。</li>
<li>  它出现的目的是为了使我们的 URL 可以按照模块化管理。例如：</li>
</ul>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">账户模块：</span><br><span class="line">	/account/add</span><br><span class="line">	/account/update</span><br><span class="line">	...</span><br><span class="line">订单模块:</span><br><span class="line">	/order/add</span><br><span class="line">	/order/update</span><br><span class="line">	...</span><br><span class="line">......</span><br></pre></td></tr></table></figure></li>
<li><p>  方法上：请求 URL 的第二级访问目录。</p>
</li>
</ul>
<p><strong>属性：</strong></p>
<ul>
<li><p><code>value[]</code>：用于限定请求的 URL，和 <code>path</code> 属性的作用是一样的。只有这一个属性时可以省略 key。</p>
</li>
<li><p><code>path[]</code>：用于限定请求的 URL，和 <code>value</code> 属性的作用是一样的。只有这一个属性时可以省略key。</p>
</li>
<li><p><code>method[]</code>：用于限定请求的方式。</p>
</li>
<li><p><code>params[]</code>：用于限定请求参数。它支持简单的表达式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如：</span></span><br><span class="line">params = &#123;<span class="string">&quot;username&quot;</span>&#125;	<span class="comment">// 要求参数中必须有`username`。</span></span><br><span class="line">params = &#123;<span class="string">&quot;password != 123&quot;</span>&#125;;	<span class="comment">// 要求参数中必须有`password`，且对应的value不能为`123`。</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>headers</code>：用于限定请求消息的请求头。</p>
</li>
</ul>
<hr>
<h3 id="1-2-示例"><a href="#1-2-示例" class="headerlink" title="1.2 示例"></a>1.2 示例</h3><h4 id="1、value-path-属性测试"><a href="#1、value-path-属性测试" class="headerlink" title="1、value/path 属性测试"></a>1、value/path 属性测试</h4><ul>
<li>控制器代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/the&quot;)</span>                     <span class="comment">// 一级路径</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span>               <span class="comment">// 二级路径</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello SpringMVC&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>客户端浏览器<code>jsp</code>中的代码</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;入门案例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">    </span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;SpringMVC入门案例&lt;/h3&gt;&lt;br/&gt;</span><br><span class="line">    &lt;!--第<span class="number">1</span>种查询方式--&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/hello&quot;</span>&gt;SpringMVC入门案例&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">---------------------------------&lt;!--等价于--&gt;-------------------------------------</span><br><span class="line">	&lt;!--第<span class="number">2</span>种查询方式--&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;the/hello&quot;</span>&gt;SpringMVC入门案例&lt;/a&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	当我们使用第<span class="number">2</span>种方式配置时，一定不要在URL前面加`/`，否则无法找到资源</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>





<h4 id="2、method属性测试"><a href="#2、method属性测试" class="headerlink" title="2、method属性测试"></a>2、method属性测试</h4><blockquote>
<p>  <strong>源码</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// method的取值类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RequestMethod</span> &#123;</span><br><span class="line">	GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li><p>控制器代码</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &amp;quot;/the&amp;quot;, method = &#123;RequestMethod.POST&#125;)</span>	<span class="comment">// 请求方式限定为POST</span></span><br><span class="line"><span class="meta">@Controller(value = &amp;quot;helloController&amp;quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&amp;quot;/hello&amp;quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(&amp;quot;Hello SpringMVC&amp;quot;);</span><br><span class="line">        <span class="keyword">return</span> &amp;quot;success&amp;quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  限定了请求方式后，如果继续以 GET 请求的方式请求服务器资源，会出现：<strong>HTTP Status 405 – Method Not Allowed</strong> 错误。表示方法不支持 GET 请求。</li>
</ul>
</li>
</ol>
<p><img src="/2020/08/28/SpringMVC/image-20200713101251171.png" alt="image-20200713101251171"></p>
<ol start="2">
<li> 改造 <code>index.jsp</code> 代码：修改 GET 请求为 POST 请求。</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;入门案例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;SpringMVC入门案例&lt;/h3&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;the/hello&quot;</span>&gt;SpringMVC入门案例（GET请求）&lt;/a&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/hello&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交POST请求&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">	当使用GET请求时，会出现<span class="number">405</span>访问异常；</span><br><span class="line">	当使用POST请求时，可以成功访问到资源</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3、params属性测试"><a href="#3、params属性测试" class="headerlink" title="3、params属性测试"></a>3、params属性测试</h4><ol>
<li><p>控制器的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数中必须有`username`和`password`，且`password`的值不能为`123`；</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;, params = &#123;&quot;username&quot;, &quot;password!=123&quot;&#125;)</span>	</span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello SpringMVC&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>index.jsp</code>的代码</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;入门案例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/hello&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        密码：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交POST请求&quot;</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当我们在<code>index.jsp</code>页面键入<code>username</code>和<code>password</code>后，如果<code>password</code>的值不为<code>123</code>，则可以成功请求到服务器资源。</p>
</li>
<li><p>如果<code>password</code>的值键入<code>123</code>，则会出现下述错误：**<code>400-Bad Request</code>**，</p>
<p><img src="/2020/08/28/SpringMVC/image-20200713102859647.png" alt="image-20200713102859647"></p>
</li>
</ul>
</li>
</ol>
<h4 id="4、headers属性测试"><a href="#4、headers属性测试" class="headerlink" title="4、headers属性测试"></a>4、headers属性测试</h4><ol>
<li><p>HTTP Request Headers Demo</p>
 <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Request Headers</span><br><span class="line">    Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">    Accept-Encoding:gzip, deflate, sdch</span><br><span class="line">    Accept-Language:zh-CN,zh;q=0.8</span><br><span class="line">    Cache-Control:max-age=0</span><br><span class="line">    Connection:keep-alive</span><br><span class="line">    Cookie:JSESSIONID=210075B5E521CWE3CDE938076295A57A</span><br><span class="line">    Host:localhost:8080</span><br><span class="line">    Upgrade-Insecure-Requests:1</span><br><span class="line">    User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93</span><br></pre></td></tr></table></figure></li>
<li><p>Controller中的代码</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span>	</span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="comment">// 限定请求头中的IP信息和端口信息。这里是只接收本机8080端口传来的请求</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;, headers=&quot;Host=localhost:8080&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello SpringMVC&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-HiddenHttpMethodFilter"><a href="#2-HiddenHttpMethodFilter" class="headerlink" title="2 HiddenHttpMethodFilter"></a>2 HiddenHttpMethodFilter</h2><p><strong>作用：</strong></p>
<ul>
<li>  由于 HTML 页面的 form 表单只支持 GET 和 POST 请求，并不支持 DELETE、PUT 等提交方式。所以 Spring 在 3.0 版本新增了一个过滤器，这个过滤器的作用就是拦截浏览器的 GET 和 POST 请求，并将请求方式修改写为服务器指定的请求方式（如 Delete、Put 等）后再发送给我们的处理器 Controller。</li>
<li>  <strong>HiddenHttpMethodFilter</strong>：隐藏 HTTP 请求方式的过滤器，就是通过过滤器，将 GET/POST 请求转换为 PUT、DELETE 等请求方式。</li>
</ul>
<hr>
<h2 id="3-RequestHeader"><a href="#3-RequestHeader" class="headerlink" title="3 @RequestHeader"></a>3 @RequestHeader</h2><h3 id="3-1-使用说明"><a href="#3-1-使用说明" class="headerlink" title="3.1 使用说明"></a>3.1 使用说明</h3><ul>
<li>  <strong>作用</strong>：用于获取请求消息中的请求头数据。</li>
<li><strong>属性</strong>：<ul>
<li>  <code>value</code>：提供请求头的 key 名称。</li>
</ul>
</li>
</ul>
<h3 id="3-2-使用示例"><a href="#3-2-使用示例" class="headerlink" title="3.2 使用示例"></a>3.2 使用示例</h3><ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--RequestHeader注解测试--&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testRequestHeader&quot;</span>&gt;测试获取请求消息的请求头&lt;/a&gt;</span><br></pre></td></tr></table></figure>

</li>
<li><p>控制器中的代码：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testRequestHeader&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testPathVariable</span><span class="params">(<span class="meta">@RequestHeader(value = &quot;User-Agent&quot;, required = false)</span> String userAgent)</span>&#123;</span><br><span class="line">        System.out.println(userAgent);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	输出结果：</span></span><br><span class="line"><span class="comment">		Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="4-CookieValue"><a href="#4-CookieValue" class="headerlink" title="4 @CookieValue"></a>4 @CookieValue</h2><h3 id="4-1-使用说明"><a href="#4-1-使用说明" class="headerlink" title="4.1 使用说明"></a>4.1 使用说明</h3><ul>
<li><p><strong>作用</strong>：客户端在首次访问服务器时，服务器会将一次会话间的共享数据以键值对的形式响应并保存在客户端，这就是 cookie 缓存。在本次会话中，客户端继续向服务器发送请求时，请求头中会携带 cookie 缓存的数据。</p>
<ul>
<li>  <code>@CookieValue</code> 注解的作用就是通过 key 获取 cookie 中的 value。</li>
</ul>
</li>
<li><p><strong>属性</strong>：</p>
<ul>
<li>  <code>value</code>：指定 cookie 的 key 的名称。</li>
<li>  <code>required</code>：是否必须有此 cookie。</li>
</ul>
</li>
</ul>
<h3 id="4-2-使用示例"><a href="#4-2-使用示例" class="headerlink" title="4.2 使用示例"></a>4.2 使用示例</h3><ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--CookieValue注解测试--%&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testCookieValue&quot;</span>&gt;</span><br><span class="line">    获取指定键名称的Cookie的值</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;br&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testCookieValue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testPathVariable</span><span class="params">(<span class="meta">@CookieValue(value = &quot;JSESSIONID&quot;, required = false)</span> String cookieValue)</span>&#123;</span><br><span class="line">        System.out.println(cookieValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	输出结果：6B73CA84FD25F96DA4FA530DC8481550</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="5-SessionAttribute"><a href="#5-SessionAttribute" class="headerlink" title="5 @SessionAttribute"></a>5 @SessionAttribute</h2><h3 id="5-1-使用说明"><a href="#5-1-使用说明" class="headerlink" title="5.1 使用说明"></a>5.1 使用说明</h3><ul>
<li><p>  <strong>作用</strong>：操作一个 Session 域中共享的数据</p>
</li>
<li><p><strong>属性</strong>：</p>
<ul>
<li>  <code>value</code>：用于指定存入 session 域的属性名称</li>
<li>  <code>type</code>：用于指定存入 session 域的数据类型</li>
</ul>
</li>
</ul>
<h3 id="5-2-使用示例"><a href="#5-2-使用示例" class="headerlink" title="5.2 使用示例"></a>5.2 使用示例</h3><ol>
<li><p>客户端浏览器的请求页面：<code>index.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;SessionAttribute注解测试&lt;/h3&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testPut&quot;</span>&gt;将数据存入Session域中&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testGet&quot;</span>&gt;将数据从Session域中取出&lt;/a&gt;&lt;br&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/the/testClean&quot;</span>&gt;将数据从Session域中删除&lt;/a&gt;&lt;br&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/the&quot;)</span></span><br><span class="line"><span class="meta">@Controller(value = &quot;helloController&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(value = &#123;&quot;username&quot;,&quot;password&quot;&#125;,types = &#123;Integer.class&#125;)</span>	<span class="comment">// 注解中的属性表示存入SessionAttribute中的第1、2个属性名为`username`和`password`，第3个属性的类型为Integer类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把数据存入SessionAttribute中【即存入Session域中】</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model：Model 是 Spring 提供的一个接口，该接口有一个实现类 ExtendModelMap，该类继承了ModelMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;testPut&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testPut</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">        <span class="comment">// 将数据保存到SessionAttribute中</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;泰斯特&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;age&quot;</span>,<span class="number">31</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;数据保存成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ModelMap 是 Model 接口的一个实现类，Model 接口中没有get方法，ModelMap 中有get方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;testGet&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testGet</span><span class="params">(ModelMap model)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String) model.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> (String) model.get(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">age</span> <span class="operator">=</span> (Integer) model.get(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        System.out.println(username+<span class="string">&quot;:&quot;</span>+password+<span class="string">&quot;:&quot;</span>+age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清除SessionAttribute中的全部缓存数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sessionStatus</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;testClean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testClean</span><span class="params">(SessionStatus sessionStatus)</span>&#123;</span><br><span class="line">        sessionStatus.setComplete();</span><br><span class="line">        System.out.println(<span class="string">&quot;格式化Session域成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="6-ResponseBody"><a href="#6-ResponseBody" class="headerlink" title="6 @ResponseBody"></a>6 @ResponseBody</h2><ul>
<li>见下一章 <code>@ResponseBody注解</code></li>
</ul>
<hr>
<h1 id="响应数据和结果视图"><a href="#响应数据和结果视图" class="headerlink" title="响应数据和结果视图"></a>响应数据和结果视图</h1><h2 id="1-返回值分类"><a href="#1-返回值分类" class="headerlink" title="1 返回值分类"></a>1 返回值分类</h2><h3 id="1-1-返回值为：字符串"><a href="#1-1-返回值为：字符串" class="headerlink" title="1.1 返回值为：字符串"></a>1.1 返回值为：字符串</h3><p>处理器（Controller）中方法的返回值如果是 String 类型：</p>
<ul>
<li>  可以返回逻辑视图名称，再通过 ViewResolver 视图解析器拼接为物理视图地址。</li>
<li>  可以直接返回 String 字符串字面量给客户端（+<code>@ResponseBody</code>注解即可实现）。</li>
</ul>
<p><strong>测试：</strong></p>
<ol>
<li><p>客户端：<code>index.jsp</code>页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;主页&lt;/h3&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/returnValue/testReturnString&quot;</span>&gt;testReturnString&lt;/a&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>服务器中的 Controller 模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/returnValue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReturnValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testReturnString&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testReturnString</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testReturnString方法执行了&quot;</span>);</span><br><span class="line">        <span class="comment">// 模拟从数据库查询数据</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;里番&quot;</span>);</span><br><span class="line">        user.setGender(<span class="string">&quot;男&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加到SessionAttribute域</span></span><br><span class="line">        model.addAttribute(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  Controller 方法返回值字符串指定逻辑视图为 <code>success</code>；经过 ViewResolver 解析后的物理视图地址为 <code>/WEB-INF/pages/success.jsp</code>，并将 jsp 页面经 View 渲染后响应给用户。</li>
</ul>
</li>
<li><p>跳转到的页面：<code>success.jsp</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;执行成功&lt;/h3&gt;</span><br><span class="line">    $&#123;user.name&#125;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    $&#123;user.gender&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="1-2-返回值为：void"><a href="#1-2-返回值为：void" class="headerlink" title="1.2 返回值为：void"></a>1.2 返回值为：void</h3><p>我们已经知道 Servlet 原生 API 可以作为控制器 Controller 中方法的参数。当返回值为 void 时，我们可以使用 <code>Request</code> 对象中的转发方法或 <code>Response</code> 对象中的重定向方法给用户响应结果视图。</p>
<ol>
<li><p>客户端：<code>index.jsp</code>页面</p>
<ul>
<li>同上</li>
</ul>
</li>
<li><p>服务器中的 Controller 模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/returnValue&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReturnValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testReturnVoid&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReturnVoid</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testReturnVoid方法执行了&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.使用Request对象转发到指定页面</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/WEB-INF/pages/success.jsp&quot;</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.使用Response对象重定向到指定页面【用户无法直接访问WEB-INF目录下的静态资源】</span></span><br><span class="line">        <span class="comment">// response.sendRedirect(&quot;/D02/index.jsp&quot;);		// 或</span></span><br><span class="line">        response.sendRedirect(request.getContextPath()+<span class="string">&quot;/index.jsp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 也可以通过Response对象直接在当前页面展示数据，并响应数据给用户浏览器</span></span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;&lt;h3&gt;你好&lt;/h3&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	以上3种方式同时只能运行一种</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li><p>跳转到的页面：<code>success.jsp</code></p>
<ul>
<li>同上</li>
</ul>
</li>
</ol>
<hr>
<h3 id="1-3-返回值为：ModelAndView"><a href="#1-3-返回值为：ModelAndView" class="headerlink" title="1.3 返回值为：ModelAndView"></a>1.3 返回值为：ModelAndView</h3><p><code>ModelAndView</code> 是 SpringMVC 提供的一个内置类，该类的实例对象也可以当作控制器方法的返回值。</p>
<ol>
<li><p>客户端：<code>index.jsp</code>页面</p>
<ul>
<li>同上</li>
</ul>
</li>
<li><p>服务器中的Controller模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/returnValue&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReturnValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;testReturnModelAndView&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">testReturnModelAndView</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testReturnModelAndView方法被执行了&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建ModelAndView对象</span></span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        <span class="comment">// 将数据添加到 mv 对象中</span></span><br><span class="line">        mv.addObject(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        <span class="comment">// 响应给客户端浏览器视图View的逻辑地址</span></span><br><span class="line">        mv.setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>跳转到的页面：<code>success.jsp</code></p>
<ul>
<li>同上</li>
</ul>
</li>
</ol>
<hr>
<h2 id="2-转发和重定向"><a href="#2-转发和重定向" class="headerlink" title="2 转发和重定向"></a>2 转发和重定向</h2><h3 id="2-1-forward转发"><a href="#2-1-forward转发" class="headerlink" title="2.1 forward转发"></a>2.1 forward转发</h3><p>Controller 中的方法在将返回值设置为 String 类型时，默认就是请求转发。当然我们也可以显式声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;returnValue&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReturnValue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testForward&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testForward</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testForward方法执行了&quot;</span>);</span><br><span class="line"><span class="comment">//        return &quot;success&quot;; // 默认方式</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/WEB-INF/pages/success.jsp&quot;</span>; <span class="comment">// 显式声明</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	需要注意的是：如果用了`forward`；则路径必须写成物理视图的地址，而不能写成逻辑视图名称。</span></span><br><span class="line"><span class="comment">	它相于：</span></span><br><span class="line"><span class="comment">&quot;request.getRequestDispatcher(&quot;/WEBINF/pages/success.jsp&quot;).forward(request,response);&quot;</span></span><br><span class="line"><span class="comment">	使用请求转发，既可以转发到jsp，也可以转发到控制器Controller中的其它方法。	</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>注意事项：</p>
<ol>
<li>如果使用 <code>forward</code> 关键字显式指定转发；则转发路径必须写成完整的视图地址，而不能写成逻辑视图名称。</li>
<li>使用请求转发，既可以转发到 jsp 页面，也可以转发到 Controller 中的其它方法。</li>
</ol>
</li>
</ul>
<hr>
<h3 id="2-2-Redirect重定向"><a href="#2-2-Redirect重定向" class="headerlink" title="2.2 Redirect重定向"></a>2.2 Redirect重定向</h3><p>Controller 控制器中的方法在将返回值设置为 String 类型时，默认就是请求转发，当然也可以手动将其设置为重定向。</p>
<p>Controller 控制器中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/returnValue&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReturnValue</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testRedirect&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRedirect</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testRedirect方法执行了&quot;</span>);</span><br><span class="line"><span class="comment">//        return &quot;redirect:/index.jsp&quot;;   // 重定向到jsp页面中</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/returnValue/testForward&quot;</span>;	<span class="comment">// 重定向到Controller控制器中的其它方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">	* 它相当于`response.sendRedirect(url)`。</span></span><br><span class="line"><span class="comment">	* 使用返回值关键字进行跳转时，可以不用添加工程路径，因为SpringMVC框架的底层实现已经帮我们添加过了</span></span><br><span class="line"><span class="comment">	* 需要注意的是：如果重定向到jsp页面，则jsp页面不能写在WEB-INF目录中。</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure>

<p><strong>注意事项：</strong></p>
<ul>
<li>  使用返回值关键字进行跳转时，可以不用添加工程路径，因为 SpringMVC 框架的底层实现已经帮我们添加过了。</li>
<li>  使用重定向，既可以转发到 jsp 页面中，也可以转发到任意 Controller 中的任意方法。</li>
<li>  如果重定向到 jsp 页面，则 jsp 页面不能写在 WEB-INF 目录中。</li>
</ul>
<hr>
<h2 id="3-ResponseBody注解"><a href="#3-ResponseBody注解" class="headerlink" title="3 @ResponseBody注解"></a>3 @ResponseBody注解</h2><p><strong>作用</strong>：该注解用于将 Controller 控制器中方法的响应信息（即方法的返回值数据），通过 HttpMessageConvert 接口转换为指定格式的数据（如：json字符串、xml字符串等），再添加到 HTTP 的响应消息 Response 中响应给客户端。</p>
<ul>
<li>  step1： JavaBean –&gt;&gt; json字符串</li>
<li>  step2： json字符串 –&gt;&gt; 客户端</li>
</ul>
<h3 id="3-1-使用示例"><a href="#3-1-使用示例" class="headerlink" title="3.1 使用示例"></a>3.1 使用示例</h3><h4 id="1、需求"><a href="#1、需求" class="headerlink" title="1、需求"></a>1、需求</h4><ul>
<li>客户端向服务器发送 Ajax 异步请求；</li>
<li>服务器执行业务逻辑</li>
<li>服务器使用 @ResponseBody 注解实现将 Controller 中方法的返回值转换为 json 字符串，并响应给客户端。</li>
</ul>
<h4 id="2、SpringMVC-配置访问资源白名单"><a href="#2、SpringMVC-配置访问资源白名单" class="headerlink" title="2、SpringMVC 配置访问资源白名单"></a>2、SpringMVC 配置访问资源白名单</h4><ul>
<li>  <code>&lt;mvc:resources&gt;</code> 标签</li>
<li>  功能：配置静态资源在服务器中的目录以及暴露给客户端访问的 URL</li>
<li>属性：<ul>
<li>  <code>location</code>：服务器 webapp 目录下的的资源路径。</li>
<li>  <code>mapping</code>：客户端访问静态资源时的请求 URL。</li>
</ul>
</li>
</ul>
<p><strong>配置访问资源白名单</strong></p>
<p><img src="/2020/08/28/SpringMVC/SpringMVC%E7%9A%84%E8%AF%B7%E6%B1%82%E4%B8%AD%E5%BC%95%E5%85%A5%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90.png"></p>
<ol>
<li><p>前端控制器 DispatcherServlet 拦截了所有访问服务器资源的请求 URL。</p>
</li>
<li><p>有时候，客户端的打开的请求页面(如 jsp 页面)使用了服务器上的静态资源(如 css/js/images等),以 JQuery 为例，如果请求页面是用 JQuery 写的，而 JQuery 依赖的类库又保存在服务器中的 webapp 目录下，这时我们就需要先拿到 JQuery 的类库，然后客户端浏览器才能看懂(解析)请求页面，才能在请求页面上完成后续操作。</p>
</li>
<li><p>所以我们需要设置一些目录白名单来跳过 DispatherServlet 的拦截，让其可以直接请求到服务器中的资源。</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在SpringMVC.xml文件中配置访问资源白名单--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置静态资源路径。</span></span><br><span class="line"><span class="comment">	location表示资源在webapp下的路径，mapping表示客户端的请求路径，**表示该目录下的文件以及子目录的文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/css/**&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/**&quot;</span>/&gt;</span>	<span class="comment">&lt;!--工程路径下的js文件夹中的所有子文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/images/&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/images/**&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	配置完成后，需要在请求页面`index.jsp`中导入JQuery类库的URL(或者叫mapping地址)。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">------------------------------index.jsp------------------------------------------------</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		导入JQuery依赖；</span></span><br><span class="line"><span class="comment">		src是SpringMVC.xml中&lt;mvc:resources&gt;标签中的的 `mapping`属性 </span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="4、JSON-字符串与-JavaBean-的转换"><a href="#4、JSON-字符串与-JavaBean-的转换" class="headerlink" title="4、JSON 字符串与 JavaBean 的转换"></a>4、JSON 字符串与 JavaBean 的转换</h4><p>SpringMVC 默认使用 MappingJacksonHttpMessageConvert 接口实现 json 数据与 JavaBean 之间的转换。需要导入其具体实现工具 <code>jackson</code> 的 jar 包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入以下3个依赖的目的是：让Spring后台自动将客户端传递的json字符串转换为JavaBean对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3、代码演示"><a href="#3、代码演示" class="headerlink" title="3、代码演示"></a>3、代码演示</h4><ol>
<li><p>使用 <code>index.jsp</code> 向服务器发送异步请求。</p>
<ul>
<li>  这里使用 JQuery 向服务器发送 Ajax 异步请求，所以必须导入 JQuery 类库。</li>
<li>  JQuery 是 JS 框架，其类库是静态资源，我们一般把它放在 <code>webapp/js/jquerymin.js</code> 目录下。</li>
</ul>
 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">        &lt;!--导入JQuery依赖--&gt;</span><br><span class="line">        &lt;script src=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/js/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">        &lt;script&gt;</span><br><span class="line">            <span class="comment">// 页面加载，绑定单击事件</span></span><br><span class="line">            <span class="comment">// 页面加载</span></span><br><span class="line">            $(function () &#123;</span><br><span class="line">                <span class="comment">// 绑定单击事件</span></span><br><span class="line">                $(<span class="string">&quot;#btn&quot;</span>).click(function () &#123;</span><br><span class="line">                    <span class="comment">//发送Ajax请求</span></span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        <span class="comment">// 编写json格式的请求</span></span><br><span class="line">                        url:<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/testAjax&quot;</span>,</span><br><span class="line">                        contentType:<span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line">                        data:<span class="string">&#x27;&#123;&quot;name&quot;:&quot;派大星&quot;,&quot;gender&quot;=&quot;男&quot;,&quot;hobby&quot;=&quot;篮球&quot;&#125;&#x27;</span>,</span><br><span class="line">                        type:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">                        success:function (data) &#123;   <span class="comment">// 回调函数，data：服务器响应的json数据</span></span><br><span class="line">                            alert(data);</span><br><span class="line">                            alert(data.username);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &lt;/script&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;发送Ajax请求,响应json&quot;</span> id=<span class="string">&quot;btn&quot;</span>&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
<li><p>控制器 Controller 接收用户的请求，并返回响应结果</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/testAjax&quot;)</span></span><br><span class="line"><span class="comment">//    public void testAjax(@RequestBody String body)&#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> User <span class="title function_">testAjax</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        <span class="comment">// 客户端发送ajax的请求，传的是json字符串，@RequestBody把json字符串封装到user对象中</span></span><br><span class="line">        System.out.println(<span class="string">&quot;异步请求&quot;</span>+user);</span><br><span class="line">        user.setHobby(<span class="string">&quot;海绵宝宝&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  <strong>@RequestBody</strong>：负责接收客户端的请求数据的请求体(的字符串格式)</li>
<li>  <strong>@ResponseBody</strong> 注解：负责将控制器 Controller 中的方法的返回值结果转换为 JSON 格式响应给客户端。</li>
<li>  如果在 Maven 工程中引入 <code>Jackson</code> 相关的依赖，就可以自动完成 JSON 字符串和 JavaBean 对象的互相转换。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/21/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/23/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
