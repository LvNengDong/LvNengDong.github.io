<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">224</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/10/%E6%89%8B%E5%86%99Spring-%E5%A4%A7%E7%BA%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/10/%E6%89%8B%E5%86%99Spring-%E5%A4%A7%E7%BA%B2/" class="post-title-link" itemprop="url">手写Spring-大纲</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-10 11:32:18 / Modified: 20:15:52" itemprop="dateCreated datePublished" datetime="2022-04-10T11:32:18+08:00">2022-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="学习目的"><a href="#学习目的" class="headerlink" title="学习目的"></a>学习目的</h2><p>本系列课程的学习目的是：通过手写简化的 Spring 实现来抓住 Spring 源码的核心思想，为阅读 Spring 源码奠定基础。</p>
<p>学习本课程需要有一定的 Spring 基础。</p>
<h2 id="课程大纲"><a href="#课程大纲" class="headerlink" title="课程大纲"></a>课程大纲</h2><p><img src="/2022/04/10/%E6%89%8B%E5%86%99Spring-%E5%A4%A7%E7%BA%B2/%E6%89%8B%E5%86%99Spring%E8%AF%BE%E7%A8%8B%E5%A4%A7%E7%BA%B2.png" alt="手写Spring课程大纲"></p>
<blockquote>
<p>  图片地址：<a target="_blank" rel="noopener" href="https://www.processon.com/view/link/625250755653bb0743cc6b1c">https://www.processon.com/view/link/625250755653bb0743cc6b1c</a></p>
</blockquote>
<h2 id="课程目录"><a href="#课程目录" class="headerlink" title="课程目录"></a>课程目录</h2><ul>
<li>  <a href>模拟 Spring 扫描底层实现</a></li>
<li>  <a href>模拟 BeanDefinition 的生成</a></li>
<li>  <a href>模拟 getBean 方法的底层实现</a></li>
<li>  <a href>模拟 Bean 创建流程</a></li>
<li>  <a href>模拟依赖注入</a></li>
<li>  <a href>模拟 Aware 回调机制</a></li>
<li>  <a href>模拟 Spring 初始化机制</a></li>
<li>  <a href>模拟 BeanPostProcessor 机制</a></li>
<li>  <a href>模拟 SpringAOP 机制</a></li>
</ul>
<h2 id="课程源码地址"><a href="#课程源码地址" class="headerlink" title="课程源码地址"></a>课程源码地址</h2><p><a href>课程源码地址</a></p>
<h2 id="后续课程：Spring-源码解读"><a href="#后续课程：Spring-源码解读" class="headerlink" title="后续课程：Spring 源码解读"></a>后续课程：Spring 源码解读</h2><ul>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
<li>  <a href>TODO</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/10/%E6%89%8B%E5%86%99Spring-Part01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/10/%E6%89%8B%E5%86%99Spring-Part01/" class="post-title-link" itemprop="url">手写Spring-Part01</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-10 11:29:29" itemprop="dateCreated datePublished" datetime="2022-04-10T11:29:29+08:00">2022-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-11 12:16:47" itemprop="dateModified" datetime="2022-04-11T12:16:47+08:00">2022-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>在正式编写 Spring 核心代码之前，首先需要完成以下准备工作：</p>
<ol>
<li><p>创建一个 JavaSE 项目，项目结构如下图所示。</p>
<p> <img src="/2022/04/10/%E6%89%8B%E5%86%99Spring-Part01/image-20220410114651862.png" alt="image-20220410114651862"></p>
<p> 其中，service 包用来保存业务代码；spring 包用来保存我们手写模拟的 spring 核心实现代码。</p>
</li>
<li><p> 在 service 包下创建 2 个类，Test 类和 UserService 类。Test 类是一个包含 mian 方法的启动类，UserService 是一个普通的业务类。</p>
</li>
<li><p>在 spring 包下创建 MyApplicationContext 类，这是一个自定义的 Spring 顶级容器类。 </p>
<ul>
<li>  UserService 类</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lnd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/4/10 8:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 业务类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  Test 类</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lnd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/4/10 8:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 包含 main 方法的启动类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>  MyApplicationContext 类</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.spring;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> lnd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2022/4/10 8:34</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 自定义的 Spring 顶级容器类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContext</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h1 id="模拟-Spring"><a href="#模拟-Spring" class="headerlink" title="模拟 Spring"></a>模拟 Spring</h1><p>完成准备工作后，我们就可以正式开始手写模拟 Spring 了。</p>
<p>我们知道，在真实的 Spring 项目中，使用 Spring 总是从创建一个保存 Bean 实例的容器开始，在代码中的具体体现就是：<code>new XxxApplicationContext()</code>。并且，我们在创建 Bean 容器的时候，往往是通过加载一个配置文件或者配置类的方式，根据配置信息完成容器的初始化。</p>
<p>我们在这里使用的是配置类的方式，在 MyApplicationContext 的构造方法中通过传入一个配置类完成容器的初始化。并调用容器提供的 getBean() 方法根据 beanName 获取对象实例。具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Spring容器根据配置类初始化容器</span></span><br><span class="line">        <span class="type">MyApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyApplicationContext</span>(MyConfig.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 依赖查找</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，这段代码存在两个问题。</p>
<ul>
<li>  第一个是：在创建自定义容器 MyApplicationContext 实例的时候需要加载配置类，而目前我们的项目中没有这个配置类。</li>
<li>  第二个是：自定义容器 MyApplicationContext 类中提供了根据 beanName 获取实例的 getBean 方法，而目前 MyApplicationContext 类中没有定义这个方法。</li>
</ul>
<p>为了让工程中的代码可以正常编译运行，我们需要完成以下工作：</p>
<ul>
<li><p>在 service 包下创建我们自己的配置类 MyConfig</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在 MyApplicationContext 类中添加新的构造方法、成员变量和成员方法。具体代码如下：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class configClass; <span class="comment">// 保存配置类的信息 </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyApplicationContext</span><span class="params">(Class configClass)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configClass = configClass;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>目前为止，该项目已经可以正常编译运行了。接下来，我们就来研究一下，项目启动时 Spring 容器替我们完成了哪些工作吧。</p>
<hr>
<h1 id="模拟-Spring-扫描的底层实现"><a href="#模拟-Spring-扫描的底层实现" class="headerlink" title="模拟 Spring 扫描的底层实现"></a>模拟 Spring 扫描的底层实现</h1><p>Spring 项目启动时，首先执行的操作就是“扫描”，需要将扫描到的 Bean 实例化并加入容器中。</p>
<p>而关于扫描操作又有非常多的细节。比如：要扫描哪些 Bean ？这就需要得到一个扫描路径。对于扫描到的 Bean，是立即创建还是延迟创建？诸如此类的问题还有很多。这里我们首先来看第一个问题，即 <strong>Spring 容器在启动时要扫描哪些 Bean ？</strong></p>
<p>要执行扫描 Bean 的操作，首先就要拿到『<strong>扫描路径</strong>』；在 Spring 中，扫描路径是在『配置类』中定义的，由配置类上的 @ComponentScan 注解指定。所以，我们需要完成以下工作：</p>
<ul>
<li><p>在项目的 spring 包下创建注解类 ComponentScan。[注意：这里的 @ComponentScan 注解是我们自己定义的]</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Component &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>; <span class="comment">// 注解中的变量 value，同时也是默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在 service 包下的 MyConfig 类上添加 @ComponentScan 注解，并指定 Spring 容器要扫描的包。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;cn.xsyu.service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>接下来，我们就可以在自定义的 Spring 容器类 MyApplicationContext 的构造函数内，解析这个配置类，并根据配置类的注解信息，确定容器要扫描的真实路径。其整体的实现思路如下：</p>
<h2 id="1、加载配置类"><a href="#1、加载配置类" class="headerlink" title="1、加载配置类"></a>1、加载配置类</h2><p>首先，我们可以看到 MyApplicationContext 的构造函数的入参是 <code>Class configClass</code>，结合上面 Test 类的代码的运行过程，真正的入参就是 <code>MyConfig.class</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// MyApplicationContext 类的构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyApplicationContext</span><span class="params">(Class configClass)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.configClass = configClass;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="2、提取-ComponentScan-注解中的包名"><a href="#2、提取-ComponentScan-注解中的包名" class="headerlink" title="2、提取 @ComponentScan 注解中的包名"></a>2、提取 @ComponentScan 注解中的包名</h2><p>在拿到配置类之后，我们首先应该检查配置类上是否存在 @ComponentScan 注解，如果含有，则获取该注解的值。如果没有，则使用默认值（为了简化代码，我们在代码中没有使用默认值这一分支）。</p>
<p>在 MyApplicationContext 构造函数中添加如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 断言配置类 MyConfig 上是否存在 @ComponentScan 注解</span></span><br><span class="line"><span class="keyword">if</span> (configClass.isAnnotationPresent(ComponentScan.class))&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 如果存在，获取注解中 value 变量的值作为容器要扫描的包路径</span></span><br><span class="line">    <span class="type">ComponentScan</span> <span class="variable">componentScanAnnotation</span> <span class="operator">=</span> (ComponentScan)configClass.getAnnotation(ComponentScan.class); <span class="comment">// 获取注解类实例。</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScanAnnotation.value(); <span class="comment">// 获取注解类中的 value 值</span></span><br><span class="line">    System.out.println(path); <span class="comment">// 输出结果：cn.xsyu.service</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// TODO 如果不存在，使用默认扫描的包路径，这里不做实现</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从代码中我们可以看到，目前得到的 path 变量是一个包名『cn.xsyu.service』，它就是配置类的 @ComponentScan 注解中的 value 值。但是它只是一个包名，既不是一个相对路径，也不是一个绝对路径。也就是说我们无法将 path 作为一个扫描路径。</p>
<p>那我们接下来要做的工作就比较清晰了，就是把 path 变量转变成一个可以被扫描的路径。</p>
<h2 id="3、将包名转换为可被扫描的路径"><a href="#3、将包名转换为可被扫描的路径" class="headerlink" title="3、将包名转换为可被扫描的路径"></a>3、将包名转换为可被扫描的路径</h2><p>在进行 <code>包名 -&gt; 路径</code> 的转换之前，我们需要先考虑这样一些问题：</p>
<ul>
<li>  （1）我们应该扫描源码包下的 .java 文件还是编译后的包下的 .class 文件 ？</li>
<li>  （2）我们该如何确定编译后包的路径？应该使用绝对路径还是相对路径 ？</li>
</ul>
<p>上面第一个问题比较简单，JVM 在创建对象时依赖的是 .class 文件而非 .java 文件，所以我们的扫描的也应该是编译后的包。</p>
<p>那我们如何确定编译后包的路径呢？我们可以先进行一个简单的编译测试。运行 Test 类中的 main 程序，程序运行时会自动执行编译操作。执行结束后，我们可以看到当前目录中多出了一个 out 目录，我们编译后的 .class 文件就保存在这个目录下，并且这个目录拥有和源代码相似的目录结构。</p>
<p><img src="/2022/04/10/%E6%89%8B%E5%86%99Spring-Part01/image-20220410211214557.png" alt="image-20220410211214557"></p>
<p>但相似始终不是相等，虽然我们这里编译后相比于源代码多出了 <code>out/production</code> 两级父目录，但不一定所有的项目都遵循这个规则，或许有的规则会把编译后的代码放在 target 目录中。</p>
<p>也就是说，我们在获取『扫描路径』时，一定不能把路径写死。而是要根据编译的规则来动态获取『扫描路径』。</p>
<p>关于如何动态获取扫描路径，我们接着往下看。</p>
<p>可以看到，在 main 程序执行结束后，控制台上会打印这样一段代码。</p>
<p><img src="/2022/04/10/%E6%89%8B%E5%86%99Spring-Part01/image-20220410211926383.png" alt="image-20220410211926383"></p>
<p>我们把这段代码展开复制出来是这样的（我们在几个关键字上加了着重号表示）：</p>
<blockquote>
<p>  D:\Software\Dev\Java\jdk1.8.0_162\bin\『java.exe』</p>
<p>  “『-javaagent』:D:\Software\Dev\IDEA\IntelliJ IDEA 2020.3.2\lib\idea_rt.jar=60605:D:\Software\Dev\IDEA\IntelliJ IDEA 2020.3.2\bin” </p>
<p>  『-Dfile.encoding』=UTF-8 </p>
<p>  『-classpath 』</p>
<p>  D:\Software\Dev\Java\jdk1.8.0_162\jre\lib\charsets.jar;</p>
<p>  D:\Software\Dev\Java\jdk1.8.0_162\jre\lib\ext\zipfs.jar;</p>
<p>  ……（省略大多数 JDK 内置的 jar 包）</p>
<p>  D:\Software\Dev\Java\jdk1.8.0_162\jre\lib\resources.jar;</p>
<p>  E:\workspace_java\simple-spring\out\production\simple-spring cn.xsyu.service.Test</p>
</blockquote>
<ul>
<li>  第一个关键字是 <code>java.exe</code>，这是一个编译操作，用于将 .java 文件编译成 .class 文件。该关键字之前的部分是当前机器的 %JAVA_HOME%\bin 目录，表示在该目录下执行编译操作。</li>
<li>  第二个关键字是 <code>-javaagent</code>，包含了一些 IDEA 代理信息（非重点）。</li>
<li>  第三个关键字是 <code>-Dfile.encoding</code>，用于设置编码格式（非重点）。</li>
<li>第四个关键字是 <code>-classpath</code>，这是本节要讨论的重点。可以看到 classpath 的值有多个，可以理解为一个数组，数组中包含当前项目正常运行所需的依赖，可以看到，这些依赖可分为两类：<ul>
<li>  一类是 JDK 自带的 jar 包，来源于 JAVA_HOME 目录下；（为了简化排版，这里省略了很多 jar 包）</li>
<li>  另一类是我们刚刚编写的含有 main 方法的 Test 类编译后的文件所在的『classpath + 全限定类名』的字符串组合。也就是 E:\workspace_java\simple-spring\out\production\simple-spring cn.xsyu.service.Test</li>
</ul>
</li>
</ul>
<p>不知道你发现了没有，对于这个字符串，只要将原先字符串中 main 方法所在类的 “全限定类名” 替换成上面第 2 小节得到的 path 变量，就变成了 <code>E:\workspace_java\simple-spring\out\production\simple-spring cn.xsyu.service</code>，我们只需要再进行简单的字符串处理，就能得到要扫描的包目录的绝对路径，即 <code>E:\workspace_java\simple-spring\out\production\simple-spring\cn\xsyu\service</code>。</p>
<p><em>为了完成本小节的代码，我们需要在这里额外学习一些小知识。</em></p>
<blockquote>
<p>  Class.getResource() 与 ClassLoader.getResource() 的区别：</p>
<p>  一句话先说明白：</p>
<ul>
<li>  Class.getResource(String name)：在当前调用类的同一路径下查找该资源</li>
<li>  ClassLoader.getResource(String name)：在根目录下查找该资源（根目录即 classpath 目录），找到后返回资源的 URL</li>
</ul>
<p>  原文地址：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33591903/article/details/91444342">https://blog.csdn.net/qq_33591903/article/details/91444342</a></p>
</blockquote>
<p>继续在 MyApplicationContext 的构造函数中进行操作，本小节内容对应的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 path 表示的包名转换成相对路径格式 </span></span><br><span class="line">path = path.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;/&quot;</span>); <span class="comment">// cn.xsyu.service -&gt; cn/xsyu/service</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 classpath 下查找资源 path，若找到则返回 path 对应资源的完整 URL</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> MyApplicationContext.class.getClassLoader();</span><br><span class="line"><span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> classLoader.getResource(path);</span><br><span class="line">System.out.println(<span class="string">&quot;resource=&quot;</span> + resource); <span class="comment">// resource=file:/E:/workspace_java/simple-spring/out/production/simple-spring/cn/xsyu/service</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>  <strong>一句话总结：</strong></p>
</blockquote>
<p>此时，就完成了根据 @ComponentScan 注解中的 value 值（cn.xsyu.service）获取 cn.xsyu.service 源代码包编译后所在包的目录的绝对路径（file:/E:/workspace_java/simple-spring/out/production/simple-spring/cn/xsyu/service）的功能。</p>
<h2 id="4、获取可被装载的-Bean"><a href="#4、获取可被装载的-Bean" class="headerlink" title="4、获取可被装载的 Bean"></a>4、获取可被装载的 Bean</h2><p>上一节我们得到了要被扫描的 Bean 所在的路径，那么接下来我们可以直接把该路径下的所有资源统统装载进容器吗吗？答案是不可以的。</p>
<p>虽然现在我们项目的扫描路径下只有 .class 文件，但这不代表所有项目的扫描路径下都只有 .class 文件。所以，我们在获取到『扫描路径』后，接下来就应该考虑如何把 .class 文件和其它文件区分开来。</p>
<blockquote>
<p>  『问题』：那么，该如何判断 .class 资源和其它资源呢？</p>
</blockquote>
<p>最简单的思路就是“遍历”，遍历该目录下所有的文件，通过判断文件是否以 <code>.class</code> 为后缀来进行区分。</p>
<blockquote>
<p>  『Tip』：</p>
</blockquote>
<p>在正式进入编程之前，我们可能一直忽略了一个细节。那就是：为什么如此笃定我们在上一节获取到的 resource 变量代表的是一个目录呢？</p>
<p>这里其实我们犯了先入为主的错误，因为在我们的项目中配置的是一个目录，所以我们就想当然的认为 resource 变量应该是一个目录。但其实并不然，@ComponentScan 的 value 值是 String 类型的，我们完全可以配置一个全限定类名，这样获取到的 resource 变量就表示一个文件的 URL。</p>
<p>所以我们首先需要将 URL 转为一个 File（File 既可以表示文件也可以表示目录），然后再去判断 File 是文件还是目录。</p>
<p>上面两个步骤的具体代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 URL resource 获取 File</span></span><br><span class="line"><span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> resource.getFile();</span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file.isDirectory())&#123; <span class="comment">// file是目录的情况</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前目录下的所有文件。并且我们只关心 .class 文件</span></span><br><span class="line">    File[] files = file.listFiles();</span><br><span class="line">    <span class="keyword">for</span> (File aFile : files) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">absolutePath</span> <span class="operator">=</span> aFile.getAbsolutePath();</span><br><span class="line">        System.out.println(<span class="string">&quot;absolutePath=&quot;</span> + absolutePath);   <span class="comment">// absolutePath=E:\workspace_java\simple-spring\out\production\simple-spring\cn\xsyu\service\MyConfig.class</span></span><br><span class="line">		</span><br><span class="line">        <span class="keyword">if</span> (absolutePath.endsWith(<span class="string">&quot;.class&quot;</span>))&#123; <span class="comment">// 筛选出所有的 .class 文件</span></span><br><span class="line">            <span class="comment">// TODO 判断当前 .class 文件是否是一个 Bean</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="comment">// file 是文件的情况</span></span><br><span class="line">	<span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在筛选得到了所有的 <code>.class</code> 文件后，我们就能为其创建 Bean 实例了吗？还是不能。因为我们只能将标注了 @Component 注解的类实例化到容器中，所以我们还需要继续筛选。</p>
<p>筛选的思路是：</p>
<ul>
<li>  （1）判断这个类上是否标注了 “@Component” 注解[ -&gt; 使用反射 -&gt; 如果要使用反射的话，先要拿到 Class 对象]</li>
<li>  （2）只有标注了 @Component 注解的类，才是一个可被容器管理的 Bean</li>
</ul>
<blockquote>
<p>  在进行逻辑判断前，我们继续来完善一下我们的代码。</p>
</blockquote>
<ul>
<li><p>在 spring 包下创建 Component 注解类：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.spring;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Component &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在 UserService 类上添加 @Component 注解</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>判断 .class 文件是否是一个 Bean 的具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标：判断当前 .class 文件是否是一个 Bean</span></span><br><span class="line"><span class="comment">// 思路：判断这个类上是否标注了 “@Component” 注解 -&gt; 使用反射 -&gt; 如果要使用反射的话，先要拿到 Class 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类加载器入参的格式：类的全限定类名，如 cn.xsyu.service.UserService。</span></span><br><span class="line"><span class="comment">// 所以我们首先要将上面得到的 absolutePath 转为全限定类名。如 cn.xsyu.service.UserService</span></span><br><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> absolutePath.substring(absolutePath.indexOf(<span class="string">&quot;cn&quot;</span>), absolutePath.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">className = className.replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;className：&quot;</span> + className); <span class="comment">// className：cn.xsyu.service.MyConfig</span></span><br><span class="line"><span class="comment">// 根据全限定类名获取 Class 对象</span></span><br><span class="line">Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (clazz.isAnnotationPresent(Component.class)) &#123; <span class="comment">// 如果 Class 对象上含有 @Component 注解</span></span><br><span class="line">	<span class="comment">// TODO 未完待续...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>现在，我们已经得到了指定扫描路径下标注了 @Component 注解的类，那接下来是不是就可以直接创建 Bean 实例了呢？还是不行。具体的内容我们将在下一小节详细展开。</p>
<hr>
<h1 id="模拟-BeanDefinition-的生成"><a href="#模拟-BeanDefinition-的生成" class="headerlink" title="模拟 BeanDefinition 的生成"></a>模拟 BeanDefinition 的生成</h1><p>在上一小节中，我们已经得到了扫描路径，并获取到了该路径下所有标注了 @Component 注解的类，那为什么不能直接根据这些类创建实例 Bean 并加入容器呢？</p>
<p>因为 Spring 容器中，不同类型的 Bean 的生命周期是不一样的，对于单例 Bean 来说，它的生命周期和整个工程的生命周期相同，对于原型 Bean 来说，它的生命周期则是不固定的，它在使用时才创建，并且在项目运行期间如果满足 GC 条件会被定期清除。所以，这里就涉及到了一个延迟加载的问题。</p>
<p>并且，Spring 容器为我们提供了 getBean 方法，通过 beanName 获取 bean 实例。如果在 getBean 方法中，每次都根据 beanName 去调用 MyApplicationContext 的构造方法，在构造方法中判断是单例还是多例，这种情况每次都需要执行根据 beanName 字符串解析 Class 对象，再判断 Class 对象是否含有 Scope 注解，注解中的值是单例还是多例的过程。显然，会拖慢程序的性能。</p>
<p>为了解决这个问题，Spring 官方提供的解决思路就是：在容器初始化时，虽然不会根据扫描到的 Class 对象创建实例 Bean，但是会创建一个对象用于保存这些 Class 对象的关键信息。这个对象就是 BeanDefinitionMap，Map 中的每个元素是 <code>&lt;beanName, beanDefinition&gt;</code> 这样格式的对象，beanDefinition 实例中保存了当前 bean 的一些关键信息。</p>
<p>根据这样的数据结构，在调用 getBean 方法时，我们就可以很容易的判断 beanName 对应的 bean 实例是一个单例对象还是原型对象。如果是单例对象，就可以先从某一缓冲池中去拿，拿不到再去创建；如果是多例对象，直接创建即可。</p>
<p>也就是说，为了满足延迟加载和其它的一些特殊需求，当扫描到一个类上标注了 @Component 注解时，只能确定开发人员在这里定义了一个 Bean，但并不会立即根据反射为其创建 bean 实例，只是根据反射将 Class 中的一些信息保存到了 BeanDefinition 对象中，将真正创建 Bean 的时机延后了。</p>
<p>至于 Bean 何时创建，如何创建，这些相关的关键信息都会保存到 BeanDefinition 中，在真正创建 Bean 实力时只需要读取 BeanDefinition 即可获取到关键信息。</p>
<p>所以在这里，我们只需要为每一个 Class 对象创建一个 BeanDefinition 实例即可。当然，对于每一个 BeanDefinition 对象，我们需要将它与对应的 beanName 对应起来并保存在内存中，以供后续使用，所以我们还需要在 MyApplicationContext 类中新添加一个成员变量 beanDefinitionMap。</p>
<p>相关代码如下：</p>
<ul>
<li><p>为了区分单例、多例对象，我们首先需要新增一个 Scope 注解。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.spring;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Scope &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>  在 UserService 类上添加 @Scope(“prototype”) 注解，表明这是一个原型对象</p>
</li>
<li><p>  在 MyConfig 类上添加 @Scope(“singleton”) 注解，表明这是一个单例对象</p>
</li>
<li><p>在 spring 包下创建一个 BeanDefinition 对象</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.spring;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lnd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/4/10 10:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  对 Bean 的描述，比如：</span></span><br><span class="line"><span class="comment"> *      * 当前 Bean 的类型是什么？</span></span><br><span class="line"><span class="comment"> *      * 当前 Bean 是一个单例对象还是多例对象？</span></span><br><span class="line"><span class="comment"> *      * ......</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanDefinition</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class type;</span><br><span class="line">    <span class="keyword">private</span> String scope;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(Class type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> scope;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScope</span><span class="params">(String scope)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.scope = scope;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
<li><p>完善 MyApplicationContext 的构造方法</p>
<ul>
<li>  新增一个成员变量 beanDefinitionMap 用于保存所有的 BeanDefinition 信息</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ConcurrentHashMap&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyApplicationContext</span><span class="params">(Class configClass)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">if</span> (clazz.isAnnotationPresent(Component.class)) &#123; <span class="comment">// 如果 Class 对象上含有 @Component 注解</span></span><br><span class="line">        <span class="comment">// 创建 BeanDefinition 实例</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinition</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 beanDefinition 的 type 属性</span></span><br><span class="line">        beanDefinition.setType(clazz);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 beanDefinition 的 scope 属性</span></span><br><span class="line">        <span class="keyword">if</span> (clazz.isAnnotationPresent(Scope.class)) &#123;</span><br><span class="line">            <span class="type">Scope</span> <span class="variable">myScopeAnnotation</span> <span class="operator">=</span> clazz.getAnnotation(Scope.class);</span><br><span class="line">            beanDefinition.setScope(myScopeAnnotation.value());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            beanDefinition.setScope(<span class="string">&quot;singleton&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 &lt;beanName，beanDefinition&gt; 加入 beanDefinitionMap</span></span><br><span class="line">        <span class="type">Component</span> <span class="variable">componentAnnotation</span> <span class="operator">=</span> clazz.getAnnotation(Component.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> componentAnnotation.value();</span><br><span class="line">        <span class="built_in">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/" class="post-title-link" itemprop="url">Maven学习-第三阶段</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-08 09:58:19" itemprop="dateCreated datePublished" datetime="2022-04-08T09:58:19+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-26 09:46:25" itemprop="dateModified" datetime="2022-04-26T09:46:25+08:00">2022-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第9章-POM-深入与强化"><a href="#第9章-POM-深入与强化" class="headerlink" title="第9章 POM 深入与强化"></a>第9章 POM 深入与强化</h1><h2 id="第2节-POM的四个层次"><a href="#第2节-POM的四个层次" class="headerlink" title="第2节 POM的四个层次"></a>第2节 POM的四个层次</h2><h3 id="1、超级POM"><a href="#1、超级POM" class="headerlink" title="1、超级POM"></a>1、超级POM</h3><p>经过前面的学习，我们看到 Maven 在构建过程中有很多默认的设定。例如：源文件存放的目录、测试源文件存放的目录、构建输出的目录……等等。但是其实这些要素也是被 Maven 定义过的。定义的位置就是：<strong>超级 POM</strong></p>
<p>关于超级 POM，Maven 官网是这样介绍的：</p>
<blockquote>
<p>  The Super POM is Maven’s default POM. All POMs extend the Super POM unless explicitly set, meaning the configuration specified in the Super POM is inherited by the POMs you created for your projects.</p>
<p>  译文：超级 POM 是 Maven 的默认 POM。除非显式设置，否则所有的 POM 都会扩展超级 POM，这就意味着超级 POM 中指定的配置会被你为项目创建的 POM 所继承。</p>
</blockquote>
<p>所以，即便我们自己的 POM 没有显式地指定一个父工程（父 POM），其实也默认继承了 Super POM。就好比一个 Java 类默认继承 Object 类一样。</p>
<p>那么 Super POM 中定义了哪些东西呢？我们可以来看一下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Central Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Central Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>never<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/target<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/classes<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;-$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testOutputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/test-classes<span class="tag">&lt;/<span class="name">testOutputDirectory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scriptSourceDirectory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/scripts<span class="tag">&lt;/<span class="name">scriptSourceDirectory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>$&#123;project.basedir&#125;/src/test/java<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/test/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- <span class="doctag">NOTE:</span> These plugins will be removed from future versions of the super POM --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- They are kept for the moment as they are very unlikely to conflict with lifecycle mappings (MNG-4453) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2-beta-5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-release-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/site<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- <span class="doctag">NOTE:</span> The release profile will be removed from future versions of the super POM --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>release-profile<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>performRelease<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar-no-fork<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-javadocs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">updateReleaseInfo</span>&gt;</span>true<span class="tag">&lt;/<span class="name">updateReleaseInfo</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="2、父POM"><a href="#2、父POM" class="headerlink" title="2、父POM"></a>2、父POM</h3><p>和 Java 类一样，POM 之间也是<strong>单继承</strong>的，但是可以存在多级继承。如果我们给一个 POM 指定了父 POM，它的继承关系如下图所示：</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/image-20220409225240991.png" alt="image-20220409225240991"></p>
<h3 id="3、有效POM"><a href="#3、有效POM" class="headerlink" title="3、有效POM"></a>3、有效POM</h3><p><strong>1、概念</strong></p>
<p>有效 POM 的英文名称是 “Effective POM”。它的概念是这样的：在 POM 的继承关系中，子 POM 可以覆盖父 POM 中的配置；如果子 POM 没有覆盖，那么父 POM 中的配置将会被继承。按照这个规则，继承关系中的所有 POM 叠加到一起，就得到了一个最终生效的 POM。</p>
<p>显然，Maven 在实际运行过程中，执行构建操作就是按照这个最终 POM 来运行的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/" class="post-title-link" itemprop="url">Maven学习-第二阶段</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-08 09:58:15" itemprop="dateCreated datePublished" datetime="2022-04-08T09:58:15+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-09 22:39:09" itemprop="dateModified" datetime="2022-04-09T22:39:09+08:00">2022-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/" class="post-title-link" itemprop="url">Maven学习-第一阶段</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-08 09:58:11" itemprop="dateCreated datePublished" datetime="2022-04-08T09:58:11+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-09 22:26:29" itemprop="dateModified" datetime="2022-04-09T22:26:29+08:00">2022-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第一章-Maven概述"><a href="#第一章-Maven概述" class="headerlink" title="第一章 Maven概述"></a>第一章 Maven概述</h1><h2 id="第一节-Why？为什么要学Maven？"><a href="#第一节-Why？为什么要学Maven？" class="headerlink" title="第一节 Why？为什么要学Maven？"></a>第一节 Why？为什么要学Maven？</h2><h3 id="一、Maven-作为依赖管理工具"><a href="#一、Maven-作为依赖管理工具" class="headerlink" title="一、Maven 作为依赖管理工具"></a>一、Maven 作为依赖管理工具</h3><h4 id="1、jar包的规模"><a href="#1、jar包的规模" class="headerlink" title="1、jar包的规模"></a>1、jar包的规模</h4><p>随着我们使用越来越多的框架，或者框架封装程度越来越高，项目中使用的 jar 包也越来越多。项目中，一个模块里面用到上百个 jar 包是非常正常的。</p>
<p>比如下面的例子，我们只用到 SpringBoot、SpringCloud 框架中的三个功能：</p>
<ul>
<li>  Nacos 服务注册发现</li>
<li>  Web 框架环境</li>
<li>  图模板技术 Thymeleaf</li>
</ul>
<p>最终却导入了 106 个 jar 包：</p>
<blockquote>
<p>  org.springframework.security:spring-security-rsa:jar:1.0.9.RELEASE:compile<br>  com.netflix.ribbon: ribbon:jar:2.3.0:compile<br>  org.springframework.boot:spring-boot-starter-thymeleaf:jar:2.3.6.RELEASE:compile</p>
<p>  ……(省略其它)</p>
<p>  org.springframework.cloud:spring-cloud-netflix-ribbon:jar:2.2.6.RELEASE:compile<br>  org.springframework:spring-expression:jar:5.2.11.RELEASE:compile<br>  org.springframework.cloud:spring-cloud-netflix-archaius:jar:2.2.6.RELEASE:compile</p>
</blockquote>
<p>而如果使用 Maven 来引入这些 jar 包只需要配置三个『<strong>依赖</strong>』：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Nacos 服务注册发现启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- web启动器依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 视图模板技术 thymeleaf --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2、jar-包的来源"><a href="#2、jar-包的来源" class="headerlink" title="2、jar 包的来源"></a>2、jar 包的来源</h4><p>这些 jar 包所属技术的官网，通常是英文界面，并且网站的结构互相独立，不尽相同，甚至找到后，下载链接还发现需要通过特殊的工具下载。</p>
<p>当然我们也可以通过第三方网站提供的下载链接进行下载，但这些非官方的网站提供的 jar 包在使用过程中会出现各种问题。存在的问题可能源自于以下这些方面：</p>
<ul>
<li>  jar包的名称</li>
<li>  jar包的版本</li>
<li>  jar包内的具体细节</li>
</ul>
<p>而使用 Maven 后，依赖对应的 jar 包能够<strong>自动下载</strong>，方便、快捷又规范。</p>
<h4 id="3、jar包之间的依赖关系"><a href="#3、jar包之间的依赖关系" class="headerlink" title="3、jar包之间的依赖关系"></a>3、jar包之间的依赖关系</h4><p>框架中使用的 jar 包，不仅数量庞大，而且彼此之间存在错综复杂的依赖关系。依赖关系的复杂程度，已经上升到了完全不能靠人力手动解决的程度。另外，jar 包之间有可能产生冲突。进一步增加了我们在 jar 包使用过程中的难度。</p>
<p>下面是前面例子中 jar 包之间的依赖关系：</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/img006.ab4f2e31.png" alt="images"></p>
<p>而实际上 jar 包之间的依赖关系是普遍存在的，如果要由程序员手动梳理无疑会增加极高的学习成本，而这些工作又对实现业务功能毫无帮助。</p>
<p>而使用 Maven 则几乎不需要管理这些关系，极个别的地方调整一下即可，极大的减轻了我们的工作量。</p>
<h3 id="二、Maven-作为构建管理工具"><a href="#二、Maven-作为构建管理工具" class="headerlink" title="二、Maven 作为构建管理工具"></a>二、Maven 作为构建管理工具</h3><h4 id="1、你没有注意过的构建"><a href="#1、你没有注意过的构建" class="headerlink" title="1、你没有注意过的构建"></a>1、你没有注意过的构建</h4><p>你可以不使用 Maven，但是构建必须要做。当我们使用 IDEA 进行开发时，构建是 IDEA 替我们做的。</p>
<h4 id="2、脱离-IDE-环境仍需构建"><a href="#2、脱离-IDE-环境仍需构建" class="headerlink" title="2、脱离 IDE 环境仍需构建"></a>2、脱离 IDE 环境仍需构建</h4><p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/img010.74e515e5.png" alt="images"></p>
<h3 id="三、结论"><a href="#三、结论" class="headerlink" title="三、结论"></a>三、结论</h3><ul>
<li>  <strong>管理规模庞大的 jar 包，需要专门工具。</strong></li>
<li>  <strong>脱离 IDE 环境执行构建操作，需要专门工具。</strong></li>
</ul>
<hr>
<h2 id="第二节-What？什么是Maven？"><a href="#第二节-What？什么是Maven？" class="headerlink" title="第二节 What？什么是Maven？"></a>第二节 What？什么是Maven？</h2><p>Maven 是 Apache 基金会维护的一款专门为 Java 项目提供<strong>构建</strong>和<strong>依赖管理</strong>支持的工具。</p>
<h3 id="一、构建"><a href="#一、构建" class="headerlink" title="一、构建"></a>一、构建</h3><p>Java 项目开发过程中，构建指的是使用<strong>『原材料生产产品』</strong>的过程。</p>
<ul>
<li>原材料<ul>
<li>  Java源代码</li>
<li>  配置文件</li>
<li>  基于 HTML 的 Thymeleaf 文件</li>
<li>  图片</li>
<li>  ……</li>
</ul>
</li>
<li>产品<ul>
<li>  一个可以在服务器上运行的项目</li>
</ul>
</li>
</ul>
<p>构建过程包含的主要环节：</p>
<ol>
<li> 清理：删除上一次构建的结果，为下一次构建做好准备</li>
<li> 编译：将 Java 源程序编译成 <code>.class</code> 字节码文件</li>
<li> 测试：运行提前准备好的测试程序</li>
<li> 报告：针对刚才测试的结果生成一个全面的信息</li>
<li>打包：<ul>
<li>  Java工程：jar包</li>
<li>  Web工程：war包</li>
</ul>
</li>
<li> 安装：把一个 Maven 工程经过打包操作生成的 jar 包或 war 包存入 Maven 仓库</li>
<li>部署：<ul>
<li>  部署jar包：把一个jar包部署到Nexus私服服务器上</li>
<li>  部署war包：借助相关Maven插件（例如cargo），将war包部署到Tomcat服务器上。</li>
</ul>
</li>
</ol>
<h3 id="二、依赖管理"><a href="#二、依赖管理" class="headerlink" title="二、依赖管理"></a>二、依赖管理</h3><p>如果 A 工程里面用到了 B 工程的类、接口、配置文件等等这样的资源，那么我们就可以说 A 依赖 B。例如：</p>
<ul>
<li>  junit-4.12 依赖 hamcrest-core-1.3</li>
<li>thymeleaf-3.0.12.RELEASE 依赖 ognl-3.1.26<ul>
<li>  ognl-3.1.26 依赖 javassist-3.20.0-GA</li>
</ul>
</li>
<li>  thymeleaf-3.0.12.RELEASE 依赖 attoparser-2.0.5.RELEASE</li>
<li>  thymeleaf-3.0.12.RELEASE 依赖 unbescape-1.1.6.RELEASE</li>
<li>  thymeleaf-3.0.12.RELEASE 依赖 slf4j-api-1.7.26</li>
</ul>
<p>依赖管理中要解决的具体问题：</p>
<ul>
<li>  jar 包的下载：使用 Maven 之后，jar 包会从规范的远程仓库下载到本地</li>
<li>  jar 包之间的依赖：通过依赖的传递性自动完成</li>
<li>  jar 包之间的冲突：通过对依赖的配置进行调整，让某些jar包不会被导入</li>
</ul>
<h3 id="三、Maven-的工作机制"><a href="#三、Maven-的工作机制" class="headerlink" title="三、Maven 的工作机制"></a>三、Maven 的工作机制</h3><p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/img003.f9cc536c.png" alt="./images"></p>
<hr>
<h1 id="第二章-Maven核心程序的安装与配置"><a href="#第二章-Maven核心程序的安装与配置" class="headerlink" title="第二章 Maven核心程序的安装与配置"></a>第二章 Maven核心程序的安装与配置</h1><h2 id="第一节-Maven核心程序安装与配置"><a href="#第一节-Maven核心程序安装与配置" class="headerlink" title="第一节 Maven核心程序安装与配置"></a>第一节 Maven核心程序安装与配置</h2><h3 id="1、Maven官网地址"><a href="#1、Maven官网地址" class="headerlink" title="1、Maven官网地址"></a>1、Maven官网地址</h3><p>首页：</p>
<p><a target="_blank" rel="noopener" href="https://maven.apache.org/">Maven – Welcome to Apache Maven</a></p>
<p>下载页面：</p>
<p><a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">Maven – Download Apache Maven</a></p>
<p>下载链接：</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408110007419.png" alt="image-20220408110007419"></p>
<blockquote>
<ul>
<li>注意：<ul>
<li>  如果你是一个 IDEA 用户，请一定要注意 IDEA 和 Maven 版本的兼容性。</li>
<li>  我自己的 IDEA 版本是 IntelliJ IDEA 2020.3.2，该版本只能使用 apache-maven-3.6.3 及其之前的版本。</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="2、解压Maven核心程序"><a href="#2、解压Maven核心程序" class="headerlink" title="2、解压Maven核心程序"></a>2、解压Maven核心程序</h3><p>将核心程序压缩包<code>apache-maven-3.8.5-bin.zip</code>，解压到<strong>非中文、没有空格</strong>的目录。</p>
<p>在解压目录中，我们需要着重关注 Maven 的核心配置文件：<strong>conf/settings.xml</strong></p>
<img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408110550592.png" alt="image-20220408110550592" style="zoom:67%;">



<h3 id="3、指定本地仓库"><a href="#3、指定本地仓库" class="headerlink" title="3、指定本地仓库"></a>3、指定本地仓库</h3><p>本地仓库默认值：<code>用户家目录/.m2/repository</code>。由于本地仓库的默认位置是在用户的家目录下，而家目录往往是在 C 盘，也就是系统盘。将来 Maven 仓库中 jar 包越来越多，仓库体积越来越大，可能会拖慢 C 盘运行速度，影响系统性能。所以建议将 Maven 的本地仓库放在其他盘符下。配置方式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">| The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">&lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:\Software\Dev\maven-repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>本地仓库这个目录，我们手动创建一个空的目录即可。</p>
<p><strong>记住</strong>：一定要把 localRepository 标签<strong>从注释中拿出来</strong>。</p>
<p><strong>注意</strong>：本地仓库本身也需要使用一个<strong>非中文、没有空格</strong>的目录。</p>
<h3 id="4、配置阿里云提供的镜像仓库"><a href="#4、配置阿里云提供的镜像仓库" class="headerlink" title="4、配置阿里云提供的镜像仓库"></a>4、配置阿里云提供的镜像仓库</h3><p>Maven 下载 jar 包默认访问境外的中央仓库，而国外网站速度很慢。改成阿里云提供的镜像仓库，<strong>访问国内网站</strong>，可以让 Maven 下载 jar 包的时候速度更快。配置的方式是：</p>
<h4 id="1、将原有的例子配置注释掉"><a href="#1、将原有的例子配置注释掉" class="headerlink" title="1、将原有的例子配置注释掉"></a>1、将原有的例子配置注释掉</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">  &lt;id&gt;maven-default-http-blocker&lt;/id&gt;</span></span><br><span class="line"><span class="comment">  &lt;mirrorOf&gt;external:http:*&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">  &lt;name&gt;Pseudo repository to mirror external repositories initially using HTTP.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">  &lt;url&gt;http://0.0.0.0/&lt;/url&gt;</span></span><br><span class="line"><span class="comment">  &lt;blocked&gt;true&lt;/blocked&gt;</span></span><br><span class="line"><span class="comment">&lt;/mirror&gt; --&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2、加入我们的配置"><a href="#2、加入我们的配置" class="headerlink" title="2、加入我们的配置"></a>2、加入我们的配置</h4><p>将下面 mirror 标签整体复制到 settings.xml 文件的 mirrors 标签的内部。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="5、配置-Maven-工程的基础-JDK-版本"><a href="#5、配置-Maven-工程的基础-JDK-版本" class="headerlink" title="5、配置 Maven 工程的基础 JDK 版本"></a>5、配置 Maven 工程的基础 JDK 版本</h3><p>如果按照默认配置运行，Java 工程使用的默认 JDK 版本是 1.5，而我们熟悉和常用的是 JDK 1.8 版本。修改配置的方式是：将 profile 标签整个复制到 settings.xml 文件的 profiles 标签内。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>









<hr>
<h2 id="第二节-配置环境变量"><a href="#第二节-配置环境变量" class="headerlink" title="第二节 配置环境变量"></a>第二节 配置环境变量</h2><ul>
<li>  1、检查 JAVA_HOME 配置是否正确</li>
<li>  2、配置 MAVEN_HOME</li>
<li>  3、配置PATH</li>
<li>  4、验证</li>
</ul>
<h3 id="1、检查-JAVA-HOME-配置是否正确"><a href="#1、检查-JAVA-HOME-配置是否正确" class="headerlink" title="1、检查 JAVA_HOME 配置是否正确"></a>1、检查 JAVA_HOME 配置是否正确</h3><p>Maven 是一个用 Java 语言开发的程序，它必须基于 JDK 来运行，需要通过 JAVA_HOME 来找到 JDK 的安装位置。</p>
<img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408114249657.png" alt="image-20220408114249657" style="zoom: 67%;">



<p>可以使用下面的命令验证：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;echo %JAVA_HOME%</span><br><span class="line">D:\Software\Dev\Java\jdk1.8.0_162</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;java -version</span><br><span class="line">java version &quot;1.8.0_162&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_162-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)</span><br></pre></td></tr></table></figure>



<h3 id="2、配置-MAVEN-HOME"><a href="#2、配置-MAVEN-HOME" class="headerlink" title="2、配置 MAVEN_HOME"></a>2、配置 MAVEN_HOME</h3><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408114553733.png" alt="image-20220408114553733" style="zoom:67%;">



<blockquote>
<p>  TIP:</p>
<p>  配置环境变量的规律：</p>
<ul>
<li>  XXX_HOME 通常指向的是 bin 目录的上一级</li>
<li>  PATH 指向的是 bin 目录</li>
</ul>
</blockquote>
<h3 id="3、配置PATH"><a href="#3、配置PATH" class="headerlink" title="3、配置PATH"></a>3、配置PATH</h3><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408115112790.png" alt="image-20220408115112790" style="zoom: 67%;">

<h3 id="4、验证"><a href="#4、验证" class="headerlink" title="4、验证"></a>4、验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\admin&gt;mvn -v</span><br><span class="line">Apache Maven 3.8.5 (3599d3414f046de2324203b78ddcf9b5e4388aa0)</span><br><span class="line">Maven home: D:\Software\Dev\apache-maven-3.8.5</span><br><span class="line">Java version: 1.8.0_162, vendor: Oracle Corporation, runtime: D:\Software\Dev\Java\jdk1.8.0_162\jre</span><br><span class="line">Default locale: zh_CN, platform encoding: GBK</span><br><span class="line">OS name: <span class="string">&quot;windows 10&quot;</span>, version: <span class="string">&quot;10.0&quot;</span>, <span class="built_in">arch</span>: <span class="string">&quot;amd64&quot;</span>, family: <span class="string">&quot;windows&quot;</span></span><br></pre></td></tr></table></figure>





<hr>
<h1 id="第三章-使用Maven：命令行环境"><a href="#第三章-使用Maven：命令行环境" class="headerlink" title="第三章 使用Maven：命令行环境"></a>第三章 使用Maven：命令行环境</h1><p>第一节 实验一：根据坐标创建 Maven 工程</p>
<p>第二节 实验二：在 Maven 工程中编写代码</p>
<p>第三节 实验三：执行 Maven 的构建命令</p>
<p>第四节 实验四：创建 Maven 版的 Web 工程</p>
<p>第五节 实验五：让 Web 工程依赖 Java 工程</p>
<p>第六节 实验六：测试依赖范围</p>
<p>第七节 实验七：测试依赖的传递性</p>
<p>第八节 实验八：测试依赖的排除</p>
<p>第九节 实验九：继承</p>
<p>第十节 实验十：聚合</p>
<h2 id="第一节-实验一：根据坐标创建Maven工程"><a href="#第一节-实验一：根据坐标创建Maven工程" class="headerlink" title="第一节 实验一：根据坐标创建Maven工程"></a>第一节 实验一：根据坐标创建Maven工程</h2><h3 id="一、Maven核心概念：坐标"><a href="#一、Maven核心概念：坐标" class="headerlink" title="一、Maven核心概念：坐标"></a>一、Maven核心概念：坐标</h3><h4 id="1、数学中的坐标"><a href="#1、数学中的坐标" class="headerlink" title="1、数学中的坐标"></a>1、数学中的坐标</h4><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408160611025.png" alt="image-20220408160611025" style="zoom: 50%;">

<p>使用 x、y、z 三个<strong>『向量』</strong>作为空间的坐标系，可以在<strong>『空间』</strong>中唯一定位到一个<strong>『点』</strong>。</p>
<h4 id="2、Maven中的坐标"><a href="#2、Maven中的坐标" class="headerlink" title="2、Maven中的坐标"></a>2、Maven中的坐标</h4><p>（1）向量说明：</p>
<p>使用三个<strong>『向量』</strong>在<strong>『Maven仓库』</strong>中唯一定位到一个<strong>『jar』</strong>包。</p>
<ul>
<li>  <code>groupId</code>：公司或组织的id</li>
<li>  <code>artifactId</code>：一个项目或者是项目中的一个模块的id</li>
<li>  <code>version</code>：版本号</li>
</ul>
<p>（2）三个向量的取值方式</p>
<ul>
<li><code>groupId</code>：公司或组织域名的倒序，通常也会加上项目名称。<ul>
<li>  例如：com.github.penggle</li>
</ul>
</li>
<li>  <code>artifactId</code>：模块的名称，将来作为Maven工程的工程名</li>
<li><code>version</code>：模块的版本号，根据自己的需要设定。<ul>
<li>  例如：SNAPSHOT 表示快照版本，正在迭代过程中，不稳定的版本</li>
<li>  例如：RELEASE 表示正式版本</li>
</ul>
</li>
</ul>
<p>举例：</p>
<ul>
<li>  <code>groupId</code>：com.github.penggle</li>
<li>  <code>artifactId</code>：kaptcha</li>
<li>  <code>version</code>：2.3.2</li>
</ul>
<h4 id="3、坐标和仓库中jar包的存储路径之间的对应关系"><a href="#3、坐标和仓库中jar包的存储路径之间的对应关系" class="headerlink" title="3、坐标和仓库中jar包的存储路径之间的对应关系"></a>3、坐标和仓库中jar包的存储路径之间的对应关系</h4><p>坐标：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--验证码生成器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面坐标对应的jar包在Maven本地仓库中的位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;Maven本地仓库的根目录&#125;/com/github/penggle/kaptcha/kaptcha-2.3.2.jar</span><br></pre></td></tr></table></figure>

<p>一定要学会根据坐标到本地仓库中找对应的jar包。</p>
<hr>
<h3 id="二、实验操作"><a href="#二、实验操作" class="headerlink" title="二、实验操作"></a>二、实验操作</h3><h4 id="1、创建目录作为后面操作的工作空间"><a href="#1、创建目录作为后面操作的工作空间" class="headerlink" title="1、创建目录作为后面操作的工作空间"></a>1、创建目录作为后面操作的工作空间</h4><p>例如：E:\workspace-maven\space202204</p>
<blockquote>
<p>  WARNING</p>
<p>  此时我们已经有了三个目录，分别是：</p>
<ul>
<li>  Maven 核心程序：中军大帐</li>
<li>  Maven 本地仓库：兵营</li>
<li>  本地工作空间：战场</li>
</ul>
</blockquote>
<h4 id="2、在工作空间目录下打开命令行窗口"><a href="#2、在工作空间目录下打开命令行窗口" class="headerlink" title="2、在工作空间目录下打开命令行窗口"></a>2、在工作空间目录下打开命令行窗口</h4><h4 id="3、使用命令生成Maven工程"><a href="#3、使用命令生成Maven工程" class="headerlink" title="3、使用命令生成Maven工程"></a>3、使用命令生成Maven工程</h4><p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408163058811.png" alt="image-20220408163058811"></p>
<ol>
<li><p> 运行 <code>mvn archetype:generate</code> 命令，创建一个脚手架。archetype 是一个插件的名字，可以理解为就是一个jar包，generate 是插件提供的一个功能。</p>
</li>
<li><p>在下载完依赖的jar包后，根据下面提示操作：</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Choose a number or apply filter (format: [groupId:]artifactId, <span class="keyword">case</span> sensitive contains): 7: <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line"></span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;groupId&#x27;</span>: cn.xsyu.maven</span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;artifactId&#x27;</span>: pro01-maven-java</span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;version&#x27;</span> 1.0-SNAPSHOT: : <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;package&#x27;</span> cn.xsyu.maven: : <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line">Confirm properties configuration:</span><br><span class="line">groupId: cn.xsyu.maven</span><br><span class="line">artifactId: pro01-maven-java</span><br><span class="line">version: 1.0-SNAPSHOT</span><br><span class="line">package: cn.xsyu.maven</span><br><span class="line"> Y: : <span class="comment"># 直接回车，表示确认。如果前面有输入错误，想要重新输入，则输入 N 再回车。</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="4、调整"><a href="#4、调整" class="headerlink" title="4、调整"></a>4、调整</h4><ul>
<li>  Maven 默认生成的工程，使用的 junit 依赖jar是较低的 3.8.1 版本，我们可以改成较高的 4.12 版本，以方便后续测试使用。</li>
<li>  自动生成的 App.java 和 AppTest.java 可以删除</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 依赖信息配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- dependencies复数标签：里面包含dependency单数标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- dependency单数标签：配置一个具体的依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 通过坐标来依赖其他jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 依赖的范围 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="5、自动生成的-pom-xml-解读"><a href="#5、自动生成的-pom-xml-解读" class="headerlink" title="5、自动生成的 pom.xml 解读"></a>5、自动生成的 pom.xml 解读</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 当前Maven工程的坐标 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro01-maven-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!-- 当前Maven工程的打包方式，可选值有下面三种： --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- jar：表示这个工程是一个Java工程  --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- war：表示这个工程是一个Web工程 --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- pom：表示这个工程是“管理其他工程”的工程 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>pro01-maven-java<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 工程构建过程中读取源码时使用的字符集 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- 当前工程所依赖的jar包 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用dependency配置一个具体的依赖 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 在dependency标签内使用具体的坐标依赖我们需要的一个jar包 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- scope标签配置依赖的范围 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="三、Maven核心概念：POM"><a href="#三、Maven核心概念：POM" class="headerlink" title="三、Maven核心概念：POM"></a>三、Maven核心概念：POM</h3><h4 id="1、含义"><a href="#1、含义" class="headerlink" title="1、含义"></a>1、含义</h4><p>POM（<strong>P</strong>roject <strong>O</strong>bject <strong>M</strong>odel），项目对象化模型。和 POM 类似的有 DOM（Document Object Model），文档对象模型。它们都是模型化思想的具体体现。</p>
<h4 id="2、模型化思想"><a href="#2、模型化思想" class="headerlink" title="2、模型化思想"></a>2、模型化思想</h4><p>POM 表示将工程抽象为一个模型，再用程序中的对象来描述这个模型。这样我们就可以用程序来管理项目了。我们在开发过程中，最基本的做法就是将现实生活中的事物抽象为模型，然后封装模型相关的数据作为一个对象，这样就可以在程序中计算与现实事物相关的数据。</p>
<h4 id="3、对应的配置文件"><a href="#3、对应的配置文件" class="headerlink" title="3、对应的配置文件"></a>3、对应的配置文件</h4><p>POM 理念集中体现在 Maven 工程根目录下的 <code>pom.xml</code> 这个配置文件中。所以这个 pom.xml 配置文件就是 Maven 工程的核心配置文件。其实学习 Maven 就是学习这个文件怎么配置，各个配置有什么用。</p>
<h3 id="四、Maven核心概念：约定的目录结构"><a href="#四、Maven核心概念：约定的目录结构" class="headerlink" title="四、Maven核心概念：约定的目录结构"></a>四、Maven核心概念：约定的目录结构</h3><h4 id="1、各个目录的作用"><a href="#1、各个目录的作用" class="headerlink" title="1、各个目录的作用"></a>1、各个目录的作用</h4><p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408170538989.png" alt="image-20220408170538989"></p>
<p>另外还有一个 <code>target</code> 目录专门存放构建操作输出的结果。</p>
<h4 id="2、约定目录结构的意义"><a href="#2、约定目录结构的意义" class="headerlink" title="2、约定目录结构的意义"></a>2、约定目录结构的意义</h4><p>为了让构建过程尽可能自动化完成，Maven 也采用了“约定大于配置”的思想，在底层约定了目录结构的作用。</p>
<p>例如：Maven 执行编译操作，必须先去 Java 源程序目录读取 Java 源代码，然后执行编译，最后把编译结果放在 target 目录。</p>
<h4 id="3、约定大于配置"><a href="#3、约定大于配置" class="headerlink" title="3、约定大于配置"></a>3、约定大于配置</h4><p>Maven 对于目录结构这个问题，没有采用基于配置的方式，而是基于约定。这样会让我们在开发过程中非常方便。如果每次创建 Maven 工程后，还需要针对各个目录的位置及保存的文件类型进行详细的配置，那肯定非常麻烦。</p>
<p>目前开发领域的技术发展趋势就是：约定大于配置，配置大于编码。</p>
<hr>
<h2 id="第二节-实验二：在-Maven-工程中编写代码"><a href="#第二节-实验二：在-Maven-工程中编写代码" class="headerlink" title="第二节 实验二：在 Maven 工程中编写代码"></a>第二节 实验二：在 Maven 工程中编写代码</h2><p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408172504131.png" alt="image-20220408172504131"></p>
<h3 id="1、主体程序"><a href="#1、主体程序" class="headerlink" title="1、主体程序"></a>1、主体程序</h3><p>在主体程序目录中创建 Calculator 类。</p>
<p>主体程序指的是被测试的程序，同时也是将来在项目中真正要使用的程序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.maven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2、测试程序"><a href="#2、测试程序" class="headerlink" title="2、测试程序"></a>2、测试程序</h3><p>在测试程序目录中创建 CalculatorTest 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.maven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态导入的效果是将 org.junit.Assert 类中的静态资源导入当前类</span></span><br><span class="line"><span class="comment">// 这样一来，在当前类中就可以直接使用 org.junit.Assert 类中的静态资源，不需要写类名</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSum</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1.创建Calculator对象</span></span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.调用Calculator对象的方法，获取到程序运行实际的结果</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">actualResult</span> <span class="operator">=</span> calculator.sum(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.声明一个变量，表示程序运行期待的结果</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">expectedResult</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.使用断言来判断实际结果和期待结果是否一致</span></span><br><span class="line">        <span class="comment">// 如果一致：测试通过，不会抛出异常</span></span><br><span class="line">        <span class="comment">// 如果不一致：通过底层源码抛出异常，测试失败</span></span><br><span class="line">        assertEquals(expectedResult, actualResult);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="第三节-实验三：执行-Maven-的构建命令"><a href="#第三节-实验三：执行-Maven-的构建命令" class="headerlink" title="第三节 实验三：执行 Maven 的构建命令"></a>第三节 实验三：执行 Maven 的构建命令</h2><h3 id="1、要求"><a href="#1、要求" class="headerlink" title="1、要求"></a>1、要求</h3><p><u>运行 Maven 中和构建操作相关的命令时，必须进入到 pom.xml 所在的目录。</u>如果没有在 pom.xml 所在的目录运行 Maven 构建命令，那么会看到下面的错误信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The goal you specified requires a project to execute but there is no POM <span class="keyword">in</span> this directory</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  Tip：</p>
<p>  <code>mvn -v</code> 命令和构建操作无关，只要正确配置了 PATH，在任何目录下执行都可以。而构建相关的命令要在 pom.xml 所在目录下运行，操作哪个工程，就进入这个工程的 pom.xml 目录。</p>
</blockquote>
<h3 id="2、清理操作"><a href="#2、清理操作" class="headerlink" title="2、清理操作"></a>2、清理操作</h3><p><code>mvn clean</code></p>
<p>效果：删除 target 目录</p>
<h3 id="3、编译操作"><a href="#3、编译操作" class="headerlink" title="3、编译操作"></a>3、编译操作</h3><ul>
<li>  主程序编译：<code>mvn compile</code></li>
<li>  测试程序编译：<code>mvn test-compile</code></li>
<li>  主体程序编译结果存放的目录：<code>target/classes</code></li>
<li>  测试程序编译结果存放的目录：<code>target/test-classes</code></li>
</ul>
<h3 id="4、测试操作"><a href="#4、测试操作" class="headerlink" title="4、测试操作"></a>4、测试操作</h3><p><code>mvn-test</code></p>
<p>测试报告存放的目录：<code>target/surefire-reports</code></p>
<h3 id="5、打包操作"><a href="#5、打包操作" class="headerlink" title="5、打包操作"></a>5、打包操作</h3><p><code>mvn package</code></p>
<p>打包的结果：生成 jar 包，</p>
<p>jar 包的存放的目录：<code>target</code></p>
<h3 id="6、安装操作"><a href="#6、安装操作" class="headerlink" title="6、安装操作"></a>6、安装操作</h3><p><code>mvn install</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将jar包存入本地仓库</span></span><br><span class="line">[INFO] Installing E:\workspace-maven\space202204\pro01-maven-java\target\pro01-maven-java-<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT<span class="variable">.jar</span> to D:\maven-repository\cn\xsyu\maven\pro01-maven-java\<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT\pro01-maven-java-<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT<span class="variable">.jar</span></span><br><span class="line"><span class="comment">// pom.xml -&gt; Xxx.pom</span></span><br><span class="line">[INFO] Installing E:\workspace-maven\space202204\pro01-maven-java\pom<span class="variable">.xml</span> to D:\maven-repository\cn\xsyu\maven\pro01-maven-java\<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT\pro01-maven-java-<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT<span class="variable">.pom</span></span><br></pre></td></tr></table></figure>

<p>安装的效果是将本地构建过程中生成的 jar 包存入 Maven 本地仓库。这个 jar 包在 Maven 仓库中的路径是根据它的坐标来生成的。</p>
<p>坐标信息如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro01-maven-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 Maven 仓库中生成的 jar 包的路径如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\maven-repository\cn\xsyu\maven\pro01-maven-java\1.0-SNAPSHOT\pro01-maven-java-1.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>另外，<u>安装操作还会将 pom.xml 文件转换为 Xxx.pom 文件一起存入本地仓库。</u>所以，我们在 Maven 的本地仓库想要查看一个 jar 包的原始 pom.xml 文件时，直接查看对应的 Xxx.pom 即可。它们只是名字发生了改变，本质上是同一个文件。</p>
<hr>
<h2 id="第四节-实验四：创建-Maven-版的-Web-工程"><a href="#第四节-实验四：创建-Maven-版的-Web-工程" class="headerlink" title="第四节 实验四：创建 Maven 版的 Web 工程"></a>第四节 实验四：创建 Maven 版的 Web 工程</h2><h3 id="1、说明"><a href="#1、说明" class="headerlink" title="1、说明"></a>1、说明</h3><p>使用 <code>mvn archetype:generate</code> 命令生成 Web 工程时，需要使用一个专门的 archetype。这个专门生成 Web 工程的骨架 archetype 可以参照官网看到它的用法。</p>
<p>TODO…</p>
<p>参数 archetypeGroupId、archetypeArtifactId、archetypeVersion 用来指定现在使用的 maven-archetype-webapp 的坐标。</p>
<h3 id="2、操作"><a href="#2、操作" class="headerlink" title="2、操作"></a>2、操作</h3><p><strong>注意：</strong>如果在上一个工程目录下执行 <code>mvn archetype:generate</code> 命令，那么 Maven 会报错：不能在一个非 pom 工程下再创建其它工程。</p>
<blockquote>
<p>  Unable to add module to the current project as it is not of packaging type ‘pom’</p>
</blockquote>
<p>所以，不要在刚才创建的工程里再创建新的 Maven 工程。请回到工作空间的根目录来操作。</p>
<p>然后，运行生成工程的命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DarchetypeVersion=1.4</span><br></pre></td></tr></table></figure>

<p>下面的操作按照提示执行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;groupId&#x27;</span>: cn.xsyu.maven</span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;artifactId&#x27;</span>: pro02-maven-web</span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;version&#x27;</span> 1.0-SNAPSHOT: :</span><br><span class="line">Define value <span class="keyword">for</span> property <span class="string">&#x27;package&#x27;</span> cn.xsyu.maven: : <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line">Confirm properties configuration:</span><br><span class="line">groupId: cn.xsyu.maven <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line">artifactId: pro02-maven-web <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line">version: 1.0-SNAPSHOT <span class="comment"># 直接回车，使用默认值</span></span><br><span class="line">package: cn.xsyu.maven</span><br><span class="line"> Y: : <span class="comment"># 直接回车，表示确认</span></span><br></pre></td></tr></table></figure>



<h3 id="3、生成的-pom-xml"><a href="#3、生成的-pom-xml" class="headerlink" title="3、生成的 pom.xml"></a>3、生成的 pom.xml</h3><p>确认打包的方式是 war 包形式。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="4、生成的-Web-工程的目录结构"><a href="#4、生成的-Web-工程的目录结构" class="headerlink" title="4、生成的 Web 工程的目录结构"></a>4、生成的 Web 工程的目录结构</h3><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408184141206.png" alt="image-20220408184141206" style="zoom:67%;">

<ul>
<li>  webapp 目录下有 index.jsp</li>
<li>  WEB-INF 目录下有 web.xml</li>
</ul>
<h3 id="5、创建Servlet"><a href="#5、创建Servlet" class="headerlink" title="5、创建Servlet"></a>5、创建Servlet</h3><ol>
<li><p> 在 main 目录下创建 java 目录</p>
</li>
<li><p> 在 java 目录下创建 Servlet 类所在的包的目录</p>
</li>
<li><p>导入对 <code>servlet-api.jar</code> 包的依赖</p>
<ul>
<li>  对于不知道详细信息的依赖可以到 <a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a> 网站查询。使用关键词搜索，然后在搜索结果列表中选择适合的使用。</li>
<li>  比如，我们找到的 servlet-api 的依赖信息：</li>
</ul>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在包下创建 Servlet 类</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.maven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;hello maven web&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在 web.xml 中注册 Servlet</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>helloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>cn.xsyu.maven.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>helloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/helloServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>在 index.jsp 页面编写超链接</p>
 <figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h2&gt;Hello World!&lt;/h2&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;/helloServlet&quot;</span>&gt;Access Servlet&lt;/a&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408190148655.png" alt="image-20220408190148655" style="zoom:67%;">





<h3 id="6、编译"><a href="#6、编译" class="headerlink" title="6、编译"></a>6、编译</h3><p><code>mvn compile</code></p>
<h3 id="7、将-Web-工程打包为-war-包"><a href="#7、将-Web-工程打包为-war-包" class="headerlink" title="7、将 Web 工程打包为 war 包"></a>7、将 Web 工程打包为 war 包</h3><p>运行 <code>mvn package</code> 命令，生成的 war 包的位置如下图所示：</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408190831519.png" alt="image-20220408190831519"></p>
<h3 id="8、将-war-包部署到-Tomcat-上运行"><a href="#8、将-war-包部署到-Tomcat-上运行" class="headerlink" title="8、将 war 包部署到 Tomcat 上运行"></a>8、将 war 包部署到 Tomcat 上运行</h3><p>（1）将 war 包复制到 Tomcat/webapps 目录下</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408191725052.png" alt="image-20220408191725052"></p>
<p>（2）启动 Tomcat</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408191836572.png" alt="image-20220408191836572"></p>
<p>此时，再去访问 webapps 目录，可以发现 Tomcat 启动后会自动解压 war 包。</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408192152959.png" alt="image-20220408192152959"></p>
<p>（3）通过浏览器尝试访问：<a target="_blank" rel="noopener" href="http://localhost:8080/pro02-maven-web/index.jsp">http://localhost:8080/pro02-maven-web/index.jsp</a></p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408192341212.png" alt="image-20220408192341212"></p>
<hr>
<h2 id="第五节-实验五：让-Web-工程依赖-Java-工程"><a href="#第五节-实验五：让-Web-工程依赖-Java-工程" class="headerlink" title="第五节 实验五：让 Web 工程依赖 Java 工程"></a>第五节 实验五：让 Web 工程依赖 Java 工程</h2><h3 id="1、观念"><a href="#1、观念" class="headerlink" title="1、观念"></a>1、观念</h3><p>明确一个意识：从来只有 Web 工程依赖 Java 工程，没有 Java 工程依赖 Web 工程。</p>
<p>本质上来说，Web 工程依赖的 Java 工程其实就是 Web 工程里面导入的 jar 包。也就是说，Java 工程最终会变成 jar 包，放在 Web 工程的 WEB-INF/lib 目录下。</p>
<h3 id="2、操作-1"><a href="#2、操作-1" class="headerlink" title="2、操作"></a>2、操作</h3><p>在 pro02-maven-web 工程的 pom.xml 中，添加如下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置对Java工程pro01-maven-java的依赖--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 具体的配置方式：在dependency标签内使用坐标实现依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro01-maven-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3、在-Web-工程中，编写测试代码"><a href="#3、在-Web-工程中，编写测试代码" class="headerlink" title="3、在 Web 工程中，编写测试代码"></a>3、在 Web 工程中，编写测试代码</h3><ol>
<li><p>补充创建目录：<code>pro02-maven-web/src/test/java/cn/xsyu/maven</code></p>
 <img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408205004283.png" alt="image-20220408205004283" style="zoom:67%;">

<ul>
<li>  可以看出，test 目录和 main 目录属于同一级目录，一个负责保存主体程序的源代码，一个负责保存测试程序的源代码。</li>
</ul>
</li>
<li><p>确认 Web 工程依赖了 Junit</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>创建测试类。</p>
<p> 把 Java 工程中的  CalculatorTest.java 类复制到 pro02-maven-wb<strong>\src\test\java\com\atguigu\maven</strong> 目录下。</p>
</li>
</ol>
<h3 id="4、执行-Maven-命令"><a href="#4、执行-Maven-命令" class="headerlink" title="4、执行 Maven 命令"></a>4、执行 Maven 命令</h3><ol>
<li><p><strong>测试命令</strong></p>
<p> <code>mvn test</code></p>
<p> 说明：执行测试操作时，会提前自动执行编译操作，测试能够成功就说明编译也是成功的。</p>
</li>
<li><p><strong>打包命令</strong></p>
<p> <code>mvn package</code></p>
 <img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408210807337.png" alt="image-20220408210807337" style="zoom:67%;">

<p> 通过查看 war 包内的结构，我们看到 Web 工程依赖的 Java 工程确实会变成 Web 工程的 <code>WEB-INF/lib</code> 目录下的 jar 包。</p>
<p> <img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408210700458.png" alt="image-20220408210700458"></p>
</li>
<li><p><strong>查看当前 Web 工程所依赖的 jar 包的列表</strong></p>
<p> <code>mvn dependency:list</code></p>
 <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] The following files have been resolved:</span><br><span class="line">[INFO]    org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br><span class="line">[INFO]    javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br><span class="line">[INFO]    junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO]    cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT:compile</span><br></pre></td></tr></table></figure>

<p> 说明：以 <code>javax.servlet:javax.servlet-api:jar:3.1.0:provided</code> 为例，这段信息显示的是一个 jar 包的坐标信息。具体格式为：</p>
<blockquote>
<p>  {groupId}:{artifactId}:{打包方式}:{版本号}:{依赖的范围}</p>
</blockquote>
<p> 这样的格式虽然和我们的 XML 配置文件中坐标的格式不同，但是本质上还是坐标信息。我们需要能够认识这样的格式，将来从 Maven 命令的日志或错误信息中看到这样格式的信息，就能够识别出来这是坐标。进而根据坐标到 Maven 仓库找到对应的 jar 包，用这样的方式解决我们遇到的问题。</p>
</li>
<li><p>以树形结构查看当前 Web 工程的依赖信息</p>
<p> <code>mvn dependency:tree</code></p>
 <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro02-maven-web:war:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO] |  \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br><span class="line">[INFO] +- javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br><span class="line">[INFO] \- cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT:compile</span><br></pre></td></tr></table></figure>

<p> 我们在 pom.xml 中并没有依赖 hamcrest-core，但是它却被加入到了我们的依赖类表。</p>
<p> 原因是：junit 依赖了 hamcrest-core。基于依赖的传递性，hamcrest-core 就被我们的项目间接的依赖了。</p>
</li>
</ol>
<hr>
<h2 id="第六节-实验六：测试依赖范围"><a href="#第六节-实验六：测试依赖范围" class="headerlink" title="第六节 实验六：测试依赖范围"></a>第六节 实验六：测试依赖范围</h2><h3 id="1、依赖范围"><a href="#1、依赖范围" class="headerlink" title="1、依赖范围"></a>1、依赖范围</h3><ul>
<li>  标签的位置：dependencies/dependency/<strong>scope</strong></li>
<li>  标签的可选值：<strong>compile/test/provided</strong>/system/runtime/<strong>import</strong></li>
</ul>
<h4 id="（1）compile-和-test-对比"><a href="#（1）compile-和-test-对比" class="headerlink" title="（1）compile 和 test 对比"></a>（1）compile 和 test 对比</h4><p>从时间和空间两个维度进行分析：</p>
<table>
<thead>
<tr>
<th></th>
<th>main目录（空间）</th>
<th>test目录（空间）</th>
<th>开发过程（时间）</th>
<th>部署到服务器（时间）</th>
</tr>
</thead>
<tbody><tr>
<td>compile</td>
<td>有效</td>
<td>有效</td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td>test</td>
<td><strong>无效</strong></td>
<td>有效</td>
<td>有效</td>
<td><strong>无效</strong></td>
</tr>
</tbody></table>
<blockquote>
<ul>
<li>助记：<ul>
<li>  compile 翻译过来是“编译”的意思，通过前面的学习，我们知道了编译既能作用于 main 目录，也能作用于 test 目录，所以从空间维度上来讲，compile 既能作用于 main 目录，也能作用于 test 目录。</li>
<li>  test 翻译过来是“测试”，顾名思义，我们可以想当然的认为 test 只能作用于 test 目录。</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="（2）compile-与-provided-对比"><a href="#（2）compile-与-provided-对比" class="headerlink" title="（2）compile 与 provided 对比"></a>（2）compile 与 provided 对比</h4><table>
<thead>
<tr>
<th></th>
<th>main目录（空间）</th>
<th>test目录（空间）</th>
<th>开发过程（时间）</th>
<th>部署到服务器（时间）</th>
</tr>
</thead>
<tbody><tr>
<td>compile</td>
<td>有效</td>
<td>有效</td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td>provided</td>
<td>无效</td>
<td>有效</td>
<td>有效</td>
<td><strong>无效</strong></td>
</tr>
</tbody></table>
<h4 id="（3）结论"><a href="#（3）结论" class="headerlink" title="（3）结论"></a>（3）结论</h4><ul>
<li>  <strong>compile</strong>：通常在项目实际运行时要用到的 jar 包都是以 compile 范围进行依赖的。并且 compile 可以认为是最大依赖范围，能适用于任何场景。</li>
<li>  <strong>test</strong>：只在测试过程中使用的 jar 包，最好以 test 范围进行依赖。默认情况下，在打包部署的时候会自动跳过这些 test 范围的依赖。比如 junit。</li>
<li>  <strong>provided</strong>：只在开发过程中使用的 jar 包通常以 provided 范围进行依赖。常见的有：在开发过程中用到的“服务器上的jar包”，比如 servlet-api、jsp-api 等等。而这个范围的 jar 包之所以不参与部署，不放入 war 包，就是避免和服务器上已有的同类 jar 包产生冲突，同时减轻服务器的负担。说白了就是“<strong>服务器上已经有了，你就别带了！</strong>”</li>
</ul>
<h3 id="2、测试"><a href="#2、测试" class="headerlink" title="2、测试"></a>2、测试</h3><h4 id="（1）验证-compile-范围对-main-目录有效"><a href="#（1）验证-compile-范围对-main-目录有效" class="headerlink" title="（1）验证 compile 范围对 main 目录有效"></a>（1）验证 compile 范围对 main 目录有效</h4><p>pro02-maven-web 项目中，main 目录下的类 HelloServlet 使用 compile 范围导入的依赖：pro01-maven-java</p>
<ul>
<li>  验证：使用 compile 范围导入的类对 main 目录下的类来说是有效的</li>
<li>  有效：HelloServlet 能够使用 pro01-maven-java 工程中的 Calculator 类</li>
<li>  验证方式：在 HelloServlet 类中导入 Calculator 类，如果编译成功就说明有效。</li>
</ul>
<h4 id="（2）验证-test-范围对-main-目录无效"><a href="#（2）验证-test-范围对-main-目录无效" class="headerlink" title="（2）验证 test 范围对 main 目录无效"></a>（2）验证 test 范围对 main 目录无效</h4><ul>
<li><p>  测试方式：在主体程序中导入 org.juit.Test 注解，然后执行编译。如果编译失败则证明 test 范围的 jar 包对 main 目录无效。</p>
</li>
<li><p>具体操作：</p>
<ul>
<li>  引入 org.juit.Test 注解</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.maven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 org.juit.Test 注解</span></span><br><span class="line"><span class="keyword">import</span> org.junit.Test; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;hello maven web&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>  执行编译命令</li>
</ul>
  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] /E:/workspace-maven/space202204/pro02-maven-web/src/main/java/cn/xsyu/maven/HelloServlet<span class="variable">.java</span>:[<span class="number">8</span>,<span class="number">17</span>] 程序包org<span class="variable">.junit</span>不存在</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="（3）验证-test-和-provided-范围不参与服务器部署"><a href="#（3）验证-test-和-provided-范围不参与服务器部署" class="headerlink" title="（3）验证 test 和 provided 范围不参与服务器部署"></a>（3）验证 test 和 provided 范围不参与服务器部署</h4><p>其实就是验证：通过 compile 范围依赖的 jar 包会放入 war 包，而通过 test 和 provided 范围依赖的 jar 包不会放入 war 包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  <span class="comment">&lt;!-- 没有放进 war 包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro01-maven-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  <span class="comment">&lt;!-- 放进了 war 包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  <span class="comment">&lt;!-- 没有放进 war 包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220408222403247.png" alt="image-20220408222403247" style="zoom:67%;">

 

<h4 id="（4）验证-provided-范围对测试程序有效"><a href="#（4）验证-provided-范围对测试程序有效" class="headerlink" title="（4）验证 provided 范围对测试程序有效"></a>（4）验证 provided 范围对测试程序有效</h4><ul>
<li><p>测试方式：在 pro02-maven-web 的测试程序中加入 servlet-api.jar 包中的类。</p>
<ul>
<li><p>修改：<code>pro02-maven-web\src\test\java\com\atguigu\maven\CalculatorTest.java</code></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.maven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 servlet-api.jar 包中的类</span></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSum</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1.创建Calculator对象</span></span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.调用Calculator对象的方法，获取到程序运行实际的结果</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">actualResult</span> <span class="operator">=</span> calculator.sum(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.声明一个变量，表示程序运行期待的结果</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">expectedResult</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.使用断言来判断实际结果和期待结果是否一致</span></span><br><span class="line">        <span class="comment">// 如果一致：测试通过，不会抛出异常</span></span><br><span class="line">        <span class="comment">// 如果不一致：通过底层源码抛出异常，测试失败</span></span><br><span class="line">        assertEquals(expectedResult, actualResult);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;测试成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>  重新编译</p>
</li>
<li><p>如果编译成功，则证明 provided 范围的依赖对测试程序有效</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="第七节-实验七：测试依赖的传递性"><a href="#第七节-实验七：测试依赖的传递性" class="headerlink" title="第七节 实验七：测试依赖的传递性"></a>第七节 实验七：测试依赖的传递性</h2><h3 id="1、依赖的传递性"><a href="#1、依赖的传递性" class="headerlink" title="1、依赖的传递性"></a>1、依赖的传递性</h3><h4 id="（1）概念"><a href="#（1）概念" class="headerlink" title="（1）概念"></a>（1）概念</h4><p>A 依赖 B，B 依赖 C，那么在 A 没有显式配置依赖 C 的情况下，A 里面能不能直接使用 C？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">已知：</span><br><span class="line">    A -&gt; B -&gt; C</span><br><span class="line">    A !-&gt; C</span><br><span class="line">问：</span><br><span class="line">	A use C ？</span><br></pre></td></tr></table></figure>



<h4 id="（2）传递的原则"><a href="#（2）传递的原则" class="headerlink" title="（2）传递的原则"></a>（2）传递的原则</h4><p>在 A 依赖 B，B 依赖 C 的前提下，C 是否能够传递到 A，取决于 B 依赖 C 时使用的依赖范围。</p>
<p><strong>结论：</strong></p>
<ul>
<li><p>  如果 B 依赖 C 时使用 compile 范围，可以传递。</p>
</li>
<li><p>如果 B 依赖 C 时使用 test 或 provided 范围：不能传递。</p>
<p>  所以在使用这样的 jar 包时，就必须在需要的地方显式声明依赖才可以。</p>
</li>
</ul>
<p><strong>分析：</strong></p>
<ul>
<li>  如果依赖范围是 compile，根据 B 依赖 C 可知，B.jar 会将 C.jar 保存在自己的 lib 目录中，所以 A 可以直接使用 C.jar。</li>
<li>  如果依赖范围是 test 或 provided，虽然 B 依赖 C，但是在打包的时候，C.jar 不会保存在 B.jar 的 lib 目录中，自然 A 就不可以使用 C.jar 了。</li>
</ul>
<h3 id="2、使用-compile-范围依赖-spring-core"><a href="#2、使用-compile-范围依赖-spring-core" class="headerlink" title="2、使用 compile 范围依赖 spring-core"></a>2、使用 compile 范围依赖 spring-core</h3><ul>
<li><p>测试方法：让 pro01-maven-java 工程依赖 spring-core</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用 <code>mvn dependency:tree</code> 命令查看效果：</p>
  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO] |  \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br><span class="line">[INFO] \- org<span class="variable">.springframework</span>:spring-core:jar:<span class="number">4</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.RELEASE</span>:compile</span><br><span class="line">[INFO]    \- commons-logging:commons-logging:jar:<span class="number">1</span><span class="variable">.1</span><span class="variable">.1</span>:compile</span><br></pre></td></tr></table></figure></li>
<li><p>将 pro01-maven-java 项目重新打包到本地仓库</p>
<p>  <code>mvn install</code></p>
</li>
<li><p>在 pro02-maven-web 使用 <code>mvn dependency:tree</code> 命令查看效果</p>
  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro02-maven-web:war:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br><span class="line">[INFO] +- cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT:compile</span><br><span class="line">[INFO] |  \- org<span class="variable">.springframework</span>:spring-core:jar:<span class="number">4</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.RELEASE</span>:compile</span><br><span class="line">[INFO] |     \- commons-logging:commons-logging:jar:<span class="number">1</span><span class="variable">.1</span><span class="variable">.1</span>:compile</span><br><span class="line">[INFO] \- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO]    \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br></pre></td></tr></table></figure>

<p>  发现 pro01-maven-java 项目中使用的 junit 依赖并没有传递过来，此处的 junit jar 包是 pro02-maven-web 项目自己显式导入的依赖。 </p>
</li>
</ul>
<h3 id="3、验证-test-和-provided-范围不能传递"><a href="#3、验证-test-和-provided-范围不能传递" class="headerlink" title="3、验证 test 和 provided 范围不能传递"></a>3、验证 test 和 provided 范围不能传递</h3><p>从上面的例子已经能够看出，pro01-maven-java 依赖了 junit，但是在 pro02-maven-web 工程中查看依赖树的时候并没有看到 junit，这就证明了 test 范围不能传递。</p>
<p>要验证 provided 范围不能传递，可以在 pro01-maven-java 工程中加入 servlet-api 的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后将 pro01-maven-java 工程的 jar 包重新上传到本地仓库，查看 pro02-maven-web 工程的依赖树结构。</p>
<ul>
<li><p>pro01-maven-java 工程的依赖树。</p>
  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO] |  \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br><span class="line">[INFO] +- org<span class="variable">.springframework</span>:spring-core:jar:<span class="number">4</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.RELEASE</span>:compile</span><br><span class="line">[INFO] |  \- commons-logging:commons-logging:jar:<span class="number">1</span><span class="variable">.1</span><span class="variable">.1</span>:compile</span><br><span class="line">[INFO] \- javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br></pre></td></tr></table></figure>

<p>  可以看到已经导入了 javax.servlet-api 依赖，且依赖范围为 provided。</p>
</li>
<li><p>pro02-maven-web 工程的依赖树</p>
  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro02-maven-web:war:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br><span class="line">[INFO] +- cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT:compile</span><br><span class="line">[INFO] |  \- org<span class="variable">.springframework</span>:spring-core:jar:<span class="number">4</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.RELEASE</span>:compile</span><br><span class="line">[INFO] |     \- commons-logging:commons-logging:jar:<span class="number">1</span><span class="variable">.1</span><span class="variable">.1</span>:compile</span><br><span class="line">[INFO] \- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO]    \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br></pre></td></tr></table></figure>

<p>  可以看到虽然也存在 javax.servlet-api 依赖，但这个依赖是 pro02-maven-web 工程显式依赖的，并非从 pro01-maven-java 工程中传递依赖进来的。</p>
</li>
</ul>
<h2 id="第八节-实验八：测试依赖的排除"><a href="#第八节-实验八：测试依赖的排除" class="headerlink" title="第八节 实验八：测试依赖的排除"></a>第八节 实验八：测试依赖的排除</h2><h3 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h3><p>当 A 依赖 B，B 依赖 C，而且 C 可以传递到 A 的时候，A 如果不想要 C，需要在 A 里面把 C 排除掉。</p>
<p>这种情况一般是为了解决 jar 包之间的冲突问题。</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220409182216350.png" alt="image-20220409182216350"></p>
<p><strong>所谓的“配置依赖排除”就是阻止某些 jar 包的传递</strong>。因为有些 jar 包传递过来可能会和其它 jar 包产生冲突。</p>
<h3 id="2、配置方式"><a href="#2、配置方式" class="headerlink" title="2、配置方式"></a>2、配置方式</h3><ol>
<li><p>首先记录一下 pro02-maven-web 工程的依赖结构。</p>
 <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro02-maven-web:war:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br><span class="line">[INFO] +- cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT:compile</span><br><span class="line">[INFO] |  \- org<span class="variable">.springframework</span>:spring-core:jar:<span class="number">4</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.RELEASE</span>:compile</span><br><span class="line">[INFO] |     \- commons-logging:commons-logging:jar:<span class="number">1</span><span class="variable">.1</span><span class="variable">.1</span>:compile</span><br><span class="line">[INFO] \- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO]    \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br></pre></td></tr></table></figure>

<p> 可以看到 pro02-maven-web -&gt; pro01-maven-java -&gt; spring-core -&gt; commons-logging 这样的多级依赖关系。如果想要在 pro02-maven-web 工程中配置对 commons-logging 依赖的排除，可以参考如下设置。</p>
</li>
<li><p>配置方式</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro01-maven-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用 exclusions 标签配置依赖的排除 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在 exclusion 标签中配置一个具体的排除 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 指定要排除的依赖的坐标（不需要写 version）--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>重新查看 pro02-maven-web 工程的依赖结构。可以发现 commons-logging 依赖已经被排除掉了。</p>
 <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[INFO] cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro02-maven-web:war:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT</span><br><span class="line">[INFO] +- javax<span class="variable">.servlet</span>:javax<span class="variable">.servlet</span>-api:jar:<span class="number">3</span><span class="variable">.1</span><span class="variable">.0</span>:provided</span><br><span class="line">[INFO] +- cn<span class="variable">.xsyu</span><span class="variable">.maven</span>:pro01-maven-java:jar:<span class="number">1</span><span class="variable">.0</span>-SNAPSHOT:compile</span><br><span class="line">[INFO] |  \- org<span class="variable">.springframework</span>:spring-core:jar:<span class="number">4</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.RELEASE</span>:compile</span><br><span class="line">[INFO] \- junit:junit:jar:<span class="number">4</span><span class="variable">.12</span>:test</span><br><span class="line">[INFO]    \- org<span class="variable">.hamcrest</span>:hamcrest-core:jar:<span class="number">1</span><span class="variable">.3</span>:test</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="第九节-实验九：继承"><a href="#第九节-实验九：继承" class="headerlink" title="第九节 实验九：继承"></a>第九节 实验九：继承</h2><h3 id="1、概念-1"><a href="#1、概念-1" class="headerlink" title="1、概念"></a>1、概念</h3><p>Maven 工程之间，A 工程继承 B 工程。</p>
<ul>
<li>  B 工程：父工程</li>
<li>  A 工程：子工程</li>
</ul>
<p><strong>本质上是 A 工程的 pom.xml 中的配置继承了 B 工程中 pom.xml 的配置。</strong></p>
<h3 id="2、作用"><a href="#2、作用" class="headerlink" title="2、作用"></a>2、作用</h3><p>在父工程中统一管理项目中的依赖信息，具体来说是管理依赖信息的版本。</p>
<p>它的背景是：</p>
<ul>
<li><p>  在大型软件项目开发时，往往会对项目按照模块进行拆分，每个团队负责不同的模块。</p>
</li>
<li><p>  也就是说，在一个 project 下面，会创建很多个 module。</p>
</li>
<li><p>  如果没有继承，每一个 module 就需要独立配置自己的依赖信息。也就是说，一个 project 下面会有很多套 pom。</p>
</li>
</ul>
<p>它背后的需求是：</p>
<ul>
<li>  如果每一个 module 都独自维护自己的依赖信息，那么不同 module 中对于同一依赖的版本选择很容易发生出入，不易统一管理。这在开发环境下并没有什么太大的问题，但是一旦项目需要打包上线，一个 project 的所有 module 使用了多套不同的 pom 依赖，这就要求线上服务器中必须同时具备所有 module 需要的依赖。</li>
<li>  比如，module01 中使用的是 <code>spring-core:jar:4.0.0.RELEASE</code> 依赖，而 module02 中使用的则是 <code>spring-core:jar:5.0.0.RELEASE</code> 依赖，那么这就要求线上服务器中同时存在这两个版本的 jar 包。这会严重占用线上服务器的内存空间。</li>
<li>  当然，这并不是最严重的。最严重的是多个版本的 jar 包之间很可能会出现依赖冲突，这将直接导致程序无法运行。所以进行依赖的统一管理是非常有必要的。</li>
<li>  使用同一个框架内的不同 jar 包，它们应该是同一个版本，所以整个项目中使用的框架版本需要统一。</li>
<li>  使用框架时所需要的 jar 包组合（或者说依赖信息组合）需要经过长期摸索和反复调试，最终确定一个可用的组合。这个耗费很大精力总结出来的方案不应该在新的项目中重新摸索。</li>
</ul>
<p>通过在父工程中为整个项目维护依赖信息的组合既保证了整个项目使用规范、准确的 jar 包；又能够将以往的经验沉淀下来，节约时间和精力。</p>
<h3 id="3、操作"><a href="#3、操作" class="headerlink" title="3、操作"></a>3、操作</h3><h4 id="（1）创建父工程"><a href="#（1）创建父工程" class="headerlink" title="（1）创建父工程"></a>（1）创建父工程</h4><p>创建的过程和前面创建 pro01-maven-java 一样。</p>
<p>工程名称：pro03-maven-parent</p>
<p>工程创建好之后，要修改它的打包方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro03-maven-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当前工程作为父工程，它要去管理子工程，所以打包方式必须是 pom --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只有打包方式为 pom 的 Maven 工程才能管理其它的 Maven 工程。<u>打包方式为 pom 的 Maven 工程中不写业务代码，它是专门管理其它 Maven 工程的工程。</u></p>
<h4 id="（2）创建模块工程"><a href="#（2）创建模块工程" class="headerlink" title="（2）创建模块工程"></a>（2）创建模块工程</h4><p>模块工程类似于 IDEA 中的 module，所以需要进入 pro03-maven-parent 工程的根目录，然后运行 <code>mvn archetype:generate</code> 来创建模块工程。</p>
<p>我们先创建三个模块工程，工程名分别为：</p>
<ul>
<li>  pro04-maven-module</li>
<li>  pro05-maven-module</li>
<li>  pro06-maven-module</li>
</ul>
<img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220409191815270.png" alt="image-20220409191815270" style="zoom:67%;">



<h4 id="（3）重新查看父工程的-pom-xml"><a href="#（3）重新查看父工程的-pom-xml" class="headerlink" title="（3）重新查看父工程的 pom.xml"></a>（3）重新查看父工程的 pom.xml</h4><p>下面的 modules 和 module 标签是聚合功能的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>pro04-maven-module<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>pro05-maven-module<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>pro06-maven-module<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（4）解读子工程的-pom-xml"><a href="#（4）解读子工程的-pom-xml" class="headerlink" title="（4）解读子工程的 pom.xml"></a>（4）解读子工程的 pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用parent标签指定当前工程的父工程 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xsyu.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro03-maven-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 子工程的坐标 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果子工程坐标中的 groupId 和 version 与父工程一致，那就可以省略 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;groupId&gt;cn.xsyu.maven&lt;/groupId&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro04-maven-module<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; --&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="（5）在父工程中配置依赖的统一管理"><a href="#（5）在父工程中配置依赖的统一管理" class="headerlink" title="（5）在父工程中配置依赖的统一管理"></a>（5）在父工程中配置依赖的统一管理</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用dependencyManagement标签配置对依赖的管理 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 被管理的依赖并没有真正被引入到工程 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="（6）子工程中引用那些被父工程管理的依赖"><a href="#（6）子工程中引用那些被父工程管理的依赖" class="headerlink" title="（6）子工程中引用那些被父工程管理的依赖"></a>（6）子工程中引用那些被父工程管理的依赖</h4><p>关键点：省略版本号</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 子工程引用父工程中的依赖信息时，可以把版本号去掉。	--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 把版本号去掉就表示子工程中这个依赖的版本由父工程决定。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 具体来说是由父工程的dependencyManagement来决定。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="7-在父工程中声明自定义属性"><a href="#7-在父工程中声明自定义属性" class="headerlink" title="(7)在父工程中声明自定义属性"></a>(7)在父工程中声明自定义属性</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过自定义属性，统一指定 Spring 的版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义标签，维护Spring的版本信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my.spring.version</span>&gt;</span>4.3.6.RELEASE<span class="tag">&lt;/<span class="name">my.spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在需要使用的地方使用 <code>$&#123;自定义属性名&#125;</code> 的形式来引用自定义的属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;my.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>真正实现“一处修改，处处生效！”</p>
<h3 id="4、实际意义"><a href="#4、实际意义" class="headerlink" title="4、实际意义"></a>4、实际意义</h3><p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220409193722168.png" alt="image-20220409193722168"></p>
<p>编写一套符合要求、开发各种功能都能正常工作的依赖并不容易。如果公司里已经有人总结了成熟的组合方案，那么再开发新项目时，如果不使用原有的积累，而是重新摸索，会浪费大量的时间。为了提高效率，我们可以使用 Maven 工程的继承机制，让成熟的依赖组合方案能够保留下来。</p>
<p>如上图所示，公司级的父工程中管理的就是成熟的依赖组合方案，各个新项目、子系统各取所需即可。</p>
<hr>
<h2 id="第十节-实验十：聚合"><a href="#第十节-实验十：聚合" class="headerlink" title="第十节 实验十：聚合"></a>第十节 实验十：聚合</h2><h3 id="1、聚合本身的含义"><a href="#1、聚合本身的含义" class="headerlink" title="1、聚合本身的含义"></a>1、聚合本身的含义</h3><p>部分组成整体。</p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/image-20220409211556788.png" alt="image-20220409211556788"></p>
<p>动画片《战神金刚》中的经典台词：“我来组成头部！我来组成手臂！”就是聚合关系最生动的体现。</p>
<h3 id="2、Maven中的聚合"><a href="#2、Maven中的聚合" class="headerlink" title="2、Maven中的聚合"></a>2、Maven中的聚合</h3><p>使用一个“总工程”将各个“模块工程”汇集起来，作为一个整体对应完整的项目。</p>
<ul>
<li>  project：整体</li>
<li>  module：部分</li>
</ul>
<blockquote>
<p>  概念对应的关系:</p>
<ul>
<li>从继承关系的角度来看：<ul>
<li>  父工程</li>
<li>  子工程</li>
</ul>
</li>
<li>从聚合关系的角度来看：<ul>
<li>  总工程</li>
<li>  模块工程</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="3、好处"><a href="#3、好处" class="headerlink" title="3、好处"></a>3、好处</h3><ul>
<li><p>一键执行 Maven 命令：很多构建命令都可以在“总工程”中一键执行。</p>
<p>  以 mvn install 命令为例：Maven 要求有父工程时先安装父工程；有依赖的工程时，先安装被依赖的工程。如果所有这些规则都由我们自己配置的话非常麻烦。但是工程聚合后，在总工程执行 mvn install 可以一键完成安装，而且会自动按照正确的顺序执行。</p>
</li>
<li><p>  配置聚合之后，各个模块工程会在总工程中展示一个列表，让项目中的各个模块一目了然。</p>
</li>
</ul>
<h3 id="4、聚合的配置"><a href="#4、聚合的配置" class="headerlink" title="4、聚合的配置"></a>4、聚合的配置</h3><p>在总工程中配置 modules 即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">module</span>&gt;</span>pro04-maven-module<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">module</span>&gt;</span>pro05-maven-module<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">module</span>&gt;</span>pro06-maven-module<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="5、循环依赖问题"><a href="#5、循环依赖问题" class="headerlink" title="5、循环依赖问题"></a>5、循环依赖问题</h3><p>如果 A 工程依赖 B 工程，B 工程依赖 C 工程，C 工程又反过来依赖 A 工程，那么在执行构建操作时会报如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] [ERROR] The projects in the reactor contain a cyclic reference:</span><br></pre></td></tr></table></figure>

<p>这个错误的含义是：循环引用。</p>
<hr>
<h1 id="第四章-使用Maven：IDEA环境"><a href="#第四章-使用Maven：IDEA环境" class="headerlink" title="第四章 使用Maven：IDEA环境"></a>第四章 使用Maven：IDEA环境</h1><hr>
<h1 id="第五章-其它核心概念"><a href="#第五章-其它核心概念" class="headerlink" title="第五章 其它核心概念"></a>第五章 其它核心概念</h1><h2 id="1、生命周期"><a href="#1、生命周期" class="headerlink" title="1、生命周期"></a>1、生命周期</h2><h2 id="2、插件和目标"><a href="#2、插件和目标" class="headerlink" title="2、插件和目标"></a>2、插件和目标</h2><h3 id="（1）插件"><a href="#（1）插件" class="headerlink" title="（1）插件"></a>（1）插件</h3><p>Maven 的核心程序仅仅负责宏观调度，不做具体工作。具体工作都是由 Maven 插件完成的。</p>
<p>例如，编译工作就是由 <code>maven-compiler-plugin-3.1.jar</code> 插件来执行的。</p>
<h3 id="（2）目标"><a href="#（2）目标" class="headerlink" title="（2）目标"></a>（2）目标</h3><p>一个插件可以有多个目标，而每个目标都和声明周期中的某一个环节对应。</p>
<p>Default 生命周期中有 compile 和 test-compile 两个和编译相关的环节，这两个环节对应 compile 和 test-compile 两个目标，而这两个目标都是由 <code>maven-compiler-plugin-3.1.jar</code> 插件来执行的。</p>
<h2 id="3、仓库"><a href="#3、仓库" class="headerlink" title="3、仓库"></a>3、仓库</h2><ul>
<li>  本地仓库：在当前电脑上，为电脑上所有 Maven 工程服务</li>
<li>远程仓库：需要联网<ul>
<li>  局域网：我们自己搭建的 Maven 私服，例如使用 Nexus 技术。</li>
<li>Internet<ul>
<li>  中央仓库</li>
<li>  镜像仓库：内容和中央仓库保持一致，但是能够分担中央仓库的负载，同时让用户能够就近访问提高下载速度，例如：Nexus aliyun</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>建议：不要中央仓库和阿里云镜像仓库混用，否则 jar 包来源不纯，可能会彼此冲突。</p>
<p>专门搜索 Maven 依赖信息的网站：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<hr>
<h1 id="第六章-单一架构案例"><a href="#第六章-单一架构案例" class="headerlink" title="第六章 单一架构案例"></a>第六章 单一架构案例</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%9B%AE%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%9B%AE%E5%BD%95/" class="post-title-link" itemprop="url">Maven学习-目录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-08 09:58:03 / Modified: 10:04:26" itemprop="dateCreated datePublished" datetime="2022-04-08T09:58:03+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>  <a href>Maven学习——第一阶段</a></li>
<li>  <a href>Maven学习——第二阶段</a></li>
<li>  <a href>Maven学习——第三阶段</a></li>
</ul>
<h2 id="Maven学习架构"><a href="#Maven学习架构" class="headerlink" title="Maven学习架构"></a>Maven学习架构</h2><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/624f977f7d9c080729aed7c8">图片地址</a></p>
<p><img src="/2022/04/08/Maven%E5%AD%A6%E4%B9%A0-%E7%9B%AE%E5%BD%95/Maven%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.png" alt="Maven体系架构"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/08/%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98%E6%8C%87%E5%8C%97-Part01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/08/%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98%E6%8C%87%E5%8C%97-Part01/" class="post-title-link" itemprop="url">项目安装部署实战指北-Part01</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-08 08:59:53 / Modified: 09:15:21" itemprop="dateCreated datePublished" datetime="2022-04-08T08:59:53+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" itemprop="url" rel="index"><span itemprop="name">安装部署</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Case1-MyBatis的mapper-xml放在src-main-java下打包时找不到？"><a href="#Case1-MyBatis的mapper-xml放在src-main-java下打包时找不到？" class="headerlink" title="Case1 | MyBatis的mapper.xml放在src/main/java下打包时找不到？"></a>Case1 | MyBatis的mapper.xml放在src/main/java下打包时找不到？</h1><blockquote>
<p>  问题描述：</p>
</blockquote>
<p>如下图所示，基于 maven+mybatis 搭建的一个项目。然后 mybatis 的 mapper 的 xml 放在了 src/main/java 的目录下的子目录，然后打包的时候，发现这些 xml 文件都不见了。</p>
<img src="/2022/04/08/%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98%E6%8C%87%E5%8C%97-Part01/image-20220408090702003.png" alt="image-20220408090702003" style="zoom: 67%;">

<p>这种情况是这样的，<strong>maven 打包的时候默认打包 src/main/java 下的 Class 文件，打包 src/main/resources 下的配置文件</strong>。</p>
<p>上面发现 xml 不见的契机其实是这样的：<strong>运行项目，报错，说 mapper.java 里头的方法 bind exception，这个错误就是 xml 不存在导致的</strong>。</p>
<blockquote>
<p>  解决方案一：</p>
</blockquote>
<p>如果现在就是上面的情况，那么怎么把 src/main/java 下的 xml 打包到 jar 包里头，怎么做呢。</p>
<p>这种情况是这样的，<strong>如下往pom文件的bulid节点里头增加如下子节点内容</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>  解决方案一引发的第二个问题：</p>
</blockquote>
<p>采用上述解决方案一处理后，再进行打包，发现确实可以把 xml 打包到 jar 包里头，但是又会遇到另一个问题，通过 jar 包运行项目时连启动都起不来。</p>
<p>以 springboot 项目为例子，控制台直接卡在如下位置几秒就自动退出了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::        (v2.0.1.RELEASE)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>  解决方案二：</p>
</blockquote>
<p>这种情况是这样的，<strong>检查jar包，会发现 mapper.xml 是进去的，但是原先的 src/main/resources 下面的配置文件全部都丢失了</strong>。</p>
<p>这种情况只要如下<strong>往 pom 文件的 bulid 节点里头的 resources 里头增加如下子节点内容即可，增加后如下</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>  总结：</p>
</blockquote>
<p><strong>maven 打包时，默认会把 src/main/resources 下面的配置文件打包进来，src/main/java 下的 java 文件编译打包进来。</strong></p>
<p><strong>一旦配置 pom 文件里头的 resources 节点，那么 maven 打包的时候自动打破默认的捞取配置文件的位置，只捞取我们配置的位置的配置文件。</strong></p>
<blockquote>
<p>  补充：resources 里头的 filtering 属性用法：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Filtering</span><br><span class="line">Filtering 是 maven 的 resource 插件 提供的功能，作用是用环境变量、pom文件里定义的属性和指定配置文件里的属性替换属性(*.properties)文件里的占位符($&#123;jdbc.url&#125;)，具体使用如下：</span><br><span class="line">在src/main/resources目录有个配置文件jdbc.properties，内容如下：</span><br><span class="line"></span><br><span class="line">jdbc.url=$&#123;pom.jdbc.url&#125;</span><br><span class="line">jdbc.username=$&#123;pom.jdbc.username&#125;</span><br><span class="line">jdbc.passworkd=$&#123;pom.jdbc.password&#125;</span><br><span class="line">配置 resource 插件，启用filtering功能并添加属性到pom:</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- 用pom里定义的属性做替换 --&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pom.jdbc.url</span>&gt;</span>jdbc:mysql://127.0.0.1:3306/dev<span class="tag">&lt;/<span class="name">pom.jdbc.url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pom.jdbc.username</span>&gt;</span>root<span class="tag">&lt;/<span class="name">pom.jdbc.username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pom.jdbc.password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">pom.jdbc.password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">        <span class="comment">&lt;!-- 可以把属性写到文件里,用属性文件里定义的属性做替换 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filter</span>&gt;</span>src/main/filters.properties<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line">编译包后target目录下的jdbc.properties:</span><br><span class="line"></span><br><span class="line">jdbc.url=jdbc:mysql://127.0.0.1:3306/dev</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.passworkd=123456</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/06/SQL%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/06/SQL%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" class="post-title-link" itemprop="url">SQL每日一题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-06 10:03:50" itemprop="dateCreated datePublished" datetime="2022-04-06T10:03:50+08:00">2022-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-06-06 11:45:18" itemprop="dateModified" datetime="2022-06-06T11:45:18+08:00">2022-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySql/" itemprop="url" rel="index"><span itemprop="name">MySql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="A001：交集类型查询"><a href="#A001：交集类型查询" class="headerlink" title="A001：交集类型查询"></a>A001：交集类型查询</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE A001</span><br><span class="line">(</span><br><span class="line">stuId INT,</span><br><span class="line">cId VARCHAR(10),</span><br><span class="line">grade INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO A001 VALUES</span><br><span class="line">(1, &#x27;001&#x27;, 67),</span><br><span class="line">(1, &#x27;002&#x27;, 89),</span><br><span class="line">(1, &#x27;003&#x27;, 94),</span><br><span class="line">(2, &#x27;001&#x27;, 95),</span><br><span class="line">(2, &#x27;002&#x27;, 88),</span><br><span class="line">(2, &#x27;004&#x27;, 78),</span><br><span class="line">(3, &#x27;001&#x27;, 94),</span><br><span class="line">(3, &#x27;002&#x27;, 77),</span><br><span class="line">(3, &#x27;003&#x27;, 90);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">查询出既学过‘001’课程，也学过‘003’号课程的学生ID</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">-- 错误写法</span><br><span class="line">SELECT stuId FROM A001</span><br><span class="line">WHERE cId=&#x27;001&#x27; AND cId=&#x27;003&#x27;;</span><br><span class="line">-- 错误原因：没有一条数据的 cId 既是‘001’又是‘003’</span><br><span class="line"></span><br><span class="line">-- 思路1：使用自连接选择符合条件的学生</span><br><span class="line">SELECT t1.stuId FROM</span><br><span class="line">(SELECT stuId FROM A001 WHERE cId=&#x27;001&#x27;) t1</span><br><span class="line">INNER JOIN </span><br><span class="line">(SELECT stuId FROM A001 WHERE cId=&#x27;003&#x27;) t2</span><br><span class="line">ON t1.stuId=t2.stuId;</span><br><span class="line"></span><br><span class="line">-- 思路2：使用交集取出同时满足条件的学生【备注：MySQL中不支持直接使用INTERSECT关键字进行交集运算】</span><br><span class="line">SELECT stuId FROM A001 WHERE cId=&#x27;001&#x27;</span><br><span class="line">INTERSECT</span><br><span class="line">SELECT stuId FROM A001 WHERE cId=&#x27;003&#x27;;</span><br><span class="line"></span><br><span class="line">-- 思路3：</span><br><span class="line">SELECT stuId FROM A001 </span><br><span class="line">WHERE cId IN(&#x27;001&#x27;, &#x27;003&#x27;)</span><br><span class="line">GROUP BY stuId</span><br><span class="line">HAVING COUNT(stuId)=2;</span><br><span class="line"></span><br><span class="line">-- 思路4（思路3的变式）</span><br><span class="line">SELECT stuId FROM</span><br><span class="line">(</span><br><span class="line">SELECT stuId FROM A001 WHERE cId=&#x27;001&#x27;</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT stuId FROM A001 WHERE cId=&#x27;003&#x27;</span><br><span class="line">) tmp</span><br><span class="line">GROUP BY stuId</span><br><span class="line">HAVING COUNT(stuId)=2;</span><br></pre></td></tr></table></figure>





<p><strong>题目：</strong></p>
<blockquote>
<p>  假设有一张表，有字段：ID(主键),A,B,C,D；如果字段A的值和字段B的值和上一条(或者某一条)记录都相同的话就算重复，就需要删除其中重复的记录，只保留一条不重复的记录，请问该如何写这条SQL语句 ？</p>
</blockquote>
<p><strong>考点：delete，max，min，in</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/01/Spring-Bean%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/01/Spring-Bean%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Spring-Bean基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-01 10:53:04" itemprop="dateCreated datePublished" datetime="2022-04-01T10:53:04+08:00">2022-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-03 10:31:24" itemprop="dateModified" datetime="2022-04-03T10:31:24+08:00">2022-04-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>  BeanDefinition 元信息</li>
</ul>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Class</td>
<td align="left">Bean 全限定类名。必须是具体类，不能用抽象类或接口</td>
</tr>
<tr>
<td align="left">Name</td>
<td align="left">Bean 的名称或者 ID</td>
</tr>
<tr>
<td align="left">Scope</td>
<td align="left">Bean 的作用域（如：singleton、prototype 等）</td>
</tr>
<tr>
<td align="left">Constructor arguments</td>
<td align="left">Bean 构造器参数（用于依赖注入）</td>
</tr>
<tr>
<td align="left">Properties</td>
<td align="left">Bean 属性设置（用于依赖注入）</td>
</tr>
<tr>
<td align="left">Autowiring mode</td>
<td align="left">Bean 自动绑定模式（如：通过名称 byName）</td>
</tr>
<tr>
<td align="left">Lazy initialization mode</td>
<td align="left">Bean 延迟初始化模式（延迟和非延迟）</td>
</tr>
<tr>
<td align="left">Initialization method</td>
<td align="left">Bean 初始化回调方法名称</td>
</tr>
<tr>
<td align="left">Destruction method</td>
<td align="left">Bean 销毁回调方法名称</td>
</tr>
</tbody></table>
<ul>
<li><p>BeanDefinition 构建</p>
<ul>
<li>  通过 BeanDefinitionBuilder</li>
<li>通过 AbstractBeanDefinition 以及派生类</li>
</ul>
</li>
</ul>
<p><img src="/2022/04/01/Spring-Bean%E5%9F%BA%E7%A1%80/image-20220401112054138.png" alt="image-20220401112054138"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/30/Spring-IoC%E5%AE%B9%E5%99%A8%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/30/Spring-IoC%E5%AE%B9%E5%99%A8%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">Spring-IoC容器概述</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-30 16:46:26" itemprop="dateCreated datePublished" datetime="2022-03-30T16:46:26+08:00">2022-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-01 10:53:36" itemprop="dateModified" datetime="2022-04-01T10:53:36+08:00">2022-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/IoC/" itemprop="url" rel="index"><span itemprop="name">IoC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h1><p>本篇文章的内容是关于 Spring IoC 的一个整体的概述，主要通过一些具体的例子来展示 Spring IoC 是怎样使用的。至于更底层、更详细的诸如源码分析等内容，之后将会在更加细微的章节展开说明。</p>
<p>那么本篇文章要将的大致内容如下，你可以先快速浏览一下：</p>
<blockquote>
<ol>
<li> Spring IoC 依赖查找</li>
<li> Spring IoC 依赖注入</li>
<li> Spring IoC 依赖来源</li>
<li> Spring IoC 配置元信息</li>
<li> Spring 应用上下文</li>
<li> 使用 Spring IoC 容器</li>
<li> Spring IoC 容器声明周期</li>
<li> 面试题精选</li>
</ol>
</blockquote>
<p>我们可以对上面罗列出来的这些内容先进行一下简单的分类。</p>
<p>首先，我们可以把 IoC 分为依赖、配置、和容器三部分。其中，依赖又可细分为 依赖查找、依赖注入、依赖来源、配置元信息管理 四部分。</p>
<p>其次，我们要学习 Spring 应用上下文是什么，Spring 容器是什么，以及具体使用时如何在这二者间进行取舍，到底谁才是真正的底层 IoC 容器，谁才是面向程序的 IoC 容器。</p>
<p>最后呢，我们会分析一下 Spring IoC 里面一些核心对象的基本的生命周期。为后续文章进行源码分析奠定一个基础。</p>
<h1 id="Spring-IoC-依赖查找"><a href="#Spring-IoC-依赖查找" class="headerlink" title="Spring IoC 依赖查找"></a>Spring IoC 依赖查找</h1><blockquote>
<p>  开篇词：依赖注入还不够吗？依赖查找的价值到底在哪儿？</p>
</blockquote>
<p>我们知道，Spring 中 IoC 的主要实现方式有两种：依赖注入和依赖查找。</p>
<p>其中，依赖查找的主要实现方式有以下这些：</p>
<ul>
<li>根据 Bean 名称查找<ul>
<li>  实时查找</li>
<li>  延迟查找</li>
</ul>
</li>
<li>根据 Bean 类型查找<ul>
<li>  单个 Bean 对象</li>
<li>  多个 Bean 对象（集合）</li>
</ul>
</li>
<li>  根据 <code>Bean名称+类型</code> 查找</li>
<li>根据 Java 注解查找<ul>
<li>  单个 Bean 对象</li>
<li>  多个 Bean 对象（集合）</li>
</ul>
</li>
</ul>
<p>我们可以试着猜想一下为什么要这样分类，熟悉 Spring 的小伙伴一定知道，在 Spring 上下文中，Bean 的名称是唯一的，这里的名称我们可以理解为 “id”，在下文中如无特别说明，一律可以将名称视为“id”。</p>
<p>显然，由于 Bean 的名称是唯一的，所以 “根据 Bean 名称” 和 “根据 Bean名称+类型” 进行依赖查找得到的一定是单个实例，那么就没有必要采用集合的实现方式。</p>
<p>同理可得，“根据 Bean 类型” 或者 “根据 Java 注解” 进行的依赖查找，在一个上下文中，一个 Bean 类型对应的实例可能有多个，一个 Java 注解也可以用在多个类上，所以这两种依赖查找的方式又可分为找到一个 Bean 和找到多个 Bean 两种。</p>
<p>接下来，我将对这些依赖查找的实现方式进行逐一展示。</p>
<h2 id="1、根据-Bean-名称查找"><a href="#1、根据-Bean-名称查找" class="headerlink" title="1、根据 Bean 名称查找"></a>1、根据 Bean 名称查找</h2><p>通过 Bean 的名称进行依赖查找在 Spring 中被称为一种“鉴定”。</p>
<p>虽然名称在一个上下文中必须是唯一的，但这时候又会涉及到另一个问题，那就是：一个 Spring 应用里只有一个上下文吗？答案是否定的！对于一个 Spring 应用中包含多个上下文的情况，我们暂不讨论。我们先来看一下单个上下文环境中，通过 Bean 名称查找的依赖查找方式。</p>
<p>首先，对于“根据名称查找”，我们有两种方式，一种方式叫实时查找————即马上查找，马上索得。另外一种方式是延迟查找。</p>
<p>如果你有一定的 Spring 基础，那么你一定知道在 Spring 里有一个“延迟加载的 Bean”，那和这个东西是不是一码事呢？答案是否定的。这里讲的延迟查找是通过另外一种途径方式去实现的。 </p>
<p>那么，接下来，我们就通过具体的代码演示，来看看这两种依赖查找的实现方式。</p>
<h3 id="1-1、实时查找"><a href="#1-1、实时查找" class="headerlink" title="1.1、实时查找"></a>1.1、实时查找</h3><p>在正式编写核心代码前，我们要先进行一些准备工作，这些工作包括：</p>
<ol>
<li><p>创建一个 Maven 工程，并引入相关的依赖。由于我们目前只想使用依赖查找相关的功能，所以只需引入 Spring IoC 的核心依赖 <code>spring-context</code> 即可。</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring IoC 核心依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>一般来讲，我们最常见的 IoC 容器的实现方式是通过加载 XML 文件，所以我们需要创建一个 XML 文件用于保存容器对象的元信息，并引入相关的约束（约束的格式可直接从 Spring 官网复制）。</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions go here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建一些实体类用于后续的测试。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 省略 getter/setter/toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>接下来，我们正式进入核心代码的编写。</p>
<ol>
<li><p> 首先创建一个类 DependencyLookupDemo 用于编写依赖查找相关的代码。</p>
</li>
<li><p>在 XML 文件中配置 User 对象的属性。</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;章鱼哥&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在 DependencyLookupDemo 中创建上下文，并加载指定配置文件。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyLookupDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 配置 XML 配置文件</span></span><br><span class="line">        <span class="comment">// 启动 Spring 应用上下文</span></span><br><span class="line">        <span class="type">BeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;META-INF/dependency-lookup-context.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// 实时查找</span></span><br><span class="line">        lookupInRealTime(beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>接下来就可以根据 XML 文件中配置的 user 的名称来查找它的实例对象了。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookupInRealTime</span><span class="params">(BeanFactory beanFactory)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) beanFactory.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;根据id查找 - 实时查找：&quot;</span> + user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">根据id查找 - 实时查找：User&#123;id=1, name=&#x27;章鱼哥&#x27;&#125;</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>我们来看一下上面这两行代码，你会发现 getBean() 方法返回的对象是一个 Object 类型，而不是 User 类型。</p>
<p>所以，很多早期的书中都会通过上面这种形式将 Object 强转为 User 类型。这是因为 Spring3 之前使用的是 JDK5，JDK5 是不支持泛型的，所以我们只能使用这种强制转型的方式。</p>
<h3 id="1-2、延迟查找"><a href="#1-2、延迟查找" class="headerlink" title="1.2、延迟查找"></a>1.2、延迟查找</h3><p>接下来我们继续来看“延迟查找”，同样在按名称查找的条件下，延迟查找会用到另外一个类————ObjectFactory。</p>
<p>提起 ObjectFactory，这就涉及到了另外一个常见的面试题：Spring 中，ObjectFactory、BeanFactory 和 FactoryBean 之间的区别和联系？当然这个问题不是今天的重点，我们暂且不谈，先回到本节内容。</p>
<p>ObjectFactory 是一个接口，从字面意思上理解，它是一个工厂类（接口）。从作用上来讲，ObjectFactory 接口中只有一个方法 getObject()，它的作用是“Return an instance of the object managed by this factory（返回一个工厂管理的对象实例。）”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ObjectFactory</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Return an instance (possibly shared or independent)</span></span><br><span class="line"><span class="comment">	 * of the object managed by this factory.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the resulting instance</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> BeansException in case of creation errors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不知道你有没有发现，这个接口中只是声明了返回一个对象实例，但压根没有说返回哪一个实例。也就是说这个接口其实啥也没说。</p>
<p>所以说，该接口的实现类重写该方法后，可以是“根据名称返回对象实例”，也可以是“根据类型返回对象实例”，这是不固定的，只要返回的是一个对象实例即可。</p>
<p>实际上，我们要讲的“延迟加载”就是通过实现 ObjectFactory 接口，重写 getObject() 方法实现“根据名称获取对象”的。</p>
<p>当然，这和我们传统的 CRUD 业务开发中使用的接口习惯有点不一样。我们在业务开发中，一般会在接口中的抽象方法上声明入参，但不声明业务逻辑。而我们可以看到 ObjectFactory 接口中的 getObject() 方法，它既没有声明入参，也没有声明业务逻辑。</p>
<p>实现“延迟加载”真正业务逻辑的类是 ObjectFactory 接口的一个实现类————ObjectFactoryCreatingFactoryBean。</p>
<p>我们可以看到，在该实现类中重写了 getObject() 方法，实现了“根据名称获取对象”的功能，但其实底层真正执行的还是 <code>beanFactory.getBean(this.targetBeanName)</code>，即通过 targetBeanName 属性来获得 bean。和上面的“根据 Bean 名称实时查找”没有什么两样，而 targetBeanName 我们也可以在 XML 中通过 ObjectFactoryCreatingFactoryBean 的属性配置。所以说“延迟查找”和“实时查找”相比，只是多了一个中间商（但它不赚差价）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectFactoryCreatingFactoryBean</span> <span class="keyword">extends</span> <span class="title class_">AbstractFactoryBean</span>&lt;ObjectFactory&lt;Object&gt;&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">private</span> String targetBeanName;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TargetBeanObjectFactory</span> <span class="keyword">implements</span> <span class="title class_">ObjectFactory</span>&lt;Object&gt;, Serializable &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> BeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> String targetBeanName;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">TargetBeanObjectFactory</span><span class="params">(BeanFactory beanFactory, String targetBeanName)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">			<span class="built_in">this</span>.targetBeanName = targetBeanName;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.beanFactory.getBean(<span class="built_in">this</span>.targetBeanName); <span class="comment">// 与我们通过自定义的 BeanFactory 获取对象没有两样</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们就通过代码来实现一下 ObjectFactory 的延迟加载。</p>
<ul>
<li>  首先，我们需要把 ObjectFactory 的实现类 ObjectFactoryCreatingFactoryBean 配置到XML文件中；</li>
<li>  其次，我们还要设置实现类的 targetBeanName 属性，让其与 user 关联（最终形成 <code>targetBeanName -&gt; user -&gt; ioc.overview.domain.User</code> 的三级关联关系，当然你可以略过中间的关联，只看头和尾即可）。</li>
<li>  这样，我们在代码中就可以直接使用 ObjectFactory 的 getObject() 方法获取对象了。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;章鱼哥&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;objectFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.ObjectFactoryCreatingFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookupInLazy</span><span class="params">(BeanFactory beanFactory)</span> &#123;</span><br><span class="line">    ObjectFactory&lt;User&gt; objectFactory = (ObjectFactory&lt;User&gt;) beanFactory.getBean(<span class="string">&quot;objectFactory&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> objectFactory.getObject();</span><br><span class="line">    System.out.println(<span class="string">&quot;根据id查找 - 延迟查找：&quot;</span> + user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">根据id查找 - 延迟查找：User&#123;id=1, name=&#x27;章鱼哥&#x27;&#125;</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其实，所谓的延迟加载并不神奇，就是多了一个中转站，让 objectFactory 去调用 beanFactory 来加载 bean，而不是直接使用 beanFactory 去加载 bean。</p>
<p>也就是说，当我得到 objectFactory 的时候，并不会马上初始化 “user” 这个 bean，只有在调用 objectFactory.getObject() 方法的时候，才会去调用 beanFactory 真正地加载 “user” 对应的 bean。</p>
<p>【TODO】老实说，目前我还并没有真正理解这个 ObjectFactory 的在实际应用中的意义在哪里，保持学习，继续研究。</p>
<h2 id="2、根据-Bean-类型查找"><a href="#2、根据-Bean-类型查找" class="headerlink" title="2、根据 Bean 类型查找"></a>2、根据 Bean 类型查找</h2><p>依赖查找的第二种类型就是通过 Bean 的类型来查找 Bean 对象，既然是根据类型查找，那我们理所应当地应该想到：可能只找到一个对象，也可能找到了多个对象。</p>
<p>对于只找到一个对象，我们直接用对象本身的类型来接收即可，但对于找到了多个对象，如果还采用这种方式的话，显然程序会出错。因为我们不能用单个对象的数据类型来保存多个对象。举个例子就是，如果容器中 User 类对应的实例只有一个，那么可以直接用 User user 这种方式来保存；但如果容器中 User 类对应的实例存在多个，那前面那种保存方式显然就不适合了。对于这种情况，Spring 提供了三种解决方案：</p>
<ul>
<li><p>  （1）我们可以通过集合类型，比如 <code>List&lt;User&gt; users</code> 这样的方式来接收。</p>
</li>
<li><p>  （2）我们还可以通过增加筛选条件，比如，在根据 Bean 类型查找的基础上，再进行一轮筛选，根据 Bean 名称继续筛选。这样，得到的实例就能保证一定只有一个，我们还可以按照 User user 的方式来接收。</p>
</li>
<li><p>（3）第三种就是，在 XML 中的 <code>&lt;bean&gt;</code> 标签中，设置属性 <code>primary=&quot;true&quot;</code>。比如，在 XML 配置了三个 User 类的实例，user1，user2，user3，我们可以选择其中一个（如 user2），为其加上 <code>primary=&quot;true&quot;</code> 这个属性，那么 Spring 在查找到容器中包含多个同样类型的 User 对象后，只会返回 user2 对象，</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;章鱼哥&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.User&quot;</span> <span class="attr">primary</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;痞老板&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;派大星&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>对于按照类型查找，我们可以通过 BeanFactory 中 getBean() 的重载方法来实现按类型查找实例。对于其中那些包含泛型的方法，它们都应该是从 Spring3.0 之后才开始投入使用的，因为 Spring3.0 支持 JDK5 版本，而 JDK5 开始才支持使用泛型。</p>
<img src="/2022/03/30/Spring-IoC%E5%AE%B9%E5%99%A8%E6%A6%82%E8%BF%B0/image-20220330201508443.png" alt="image-20220330201508443" style="zoom:67%;">





<h3 id="2-1、根据类型查找单个对象"><a href="#2-1、根据类型查找单个对象" class="headerlink" title="2.1、根据类型查找单个对象"></a>2.1、根据类型查找单个对象</h3><p>根据类型查找单个对象的使用方式非常简单，代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookupByType</span><span class="params">(BeanFactory beanFactory)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> beanFactory.getBean(User.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;根据类型查找 - 实时查找：&quot;</span> + user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">根据类型查找 - 实时查找：User&#123;id=1, name=&#x27;章鱼哥&#x27;&#125;</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure>

<p>但是根据类型查找有个缺点就是：上下文中某个类型的对象可能不只一个，如果使用按照类型查找，且使用的是按照类型查找单个对象的方法，就会导致程序无法识别而报错。具体的我们可以试一下。</p>
<ol>
<li><p>我们首先在 XML 文件中新配置一个对象 user2。</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;痞老板&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p> 然后重新调用 lookupByType 方法，就会出现如下报错信息：<code>No qualifying bean of type &#39;ioc.overview.domain.User&#39; available: expected single matching bean but found 2: user,user2</code></p>
</li>
</ol>
<p>也就是说，如果上下文中同一类型的对象有多个，就只能使用下面要讲的，根据类型查找多个对象的方法。或者通过 类型+名称 这样的双重筛选方式达到最终返回的结果只有一个的效果。</p>
<h3 id="2-2、根据类型查找多个对象"><a href="#2-2、根据类型查找多个对象" class="headerlink" title="2.2、根据类型查找多个对象"></a>2.2、根据类型查找多个对象</h3><p>使用“根据类型查找多个对象”时，首先需要将 beanFactory 转换为 ListableBeanFactory 类型，之后再使用 ListableBeanFactory 中的 getBeansOfType() 方法获取多个对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookupCollectionByType</span><span class="params">(BeanFactory beanFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> ListableBeanFactory)&#123;</span><br><span class="line">        <span class="type">ListableBeanFactory</span> <span class="variable">listableBeanFactory</span> <span class="operator">=</span> (ListableBeanFactory) beanFactory;</span><br><span class="line">        Map&lt;String, User&gt; users = listableBeanFactory.getBeansOfType(User.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;查到的所有的 User 集合对象：&quot;</span> + users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">查到的所有的 User 对象：&#123;user=User&#123;id=1, name=&#x27;章鱼哥&#x27;&#125;, user2=User&#123;id=2, name=&#x27;痞老板&#x27;&#125;&#125;</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure>

<p>我们可以看到，多个对象以双列集合的形式保存，key 即为 bean 的名称，value 是实例对象的内容。</p>
<h2 id="3、根据-Bean名称-类型-查找"><a href="#3、根据-Bean名称-类型-查找" class="headerlink" title="3、根据 Bean名称+类型 查找"></a>3、根据 Bean名称+类型 查找</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookupByTypeAndId</span><span class="params">(BeanFactory beanFactory)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> beanFactory.getBean(<span class="string">&quot;user2&quot;</span>, User.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;根据`类型+名称`查找 - 实时查找：&quot;</span> + user2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">根据`类型+名称`查找 - 实时查找：User&#123;id=2, name=&#x27;痞老板&#x27;&#125;</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure>





<h2 id="4、根据-Java-注解查找"><a href="#4、根据-Java-注解查找" class="headerlink" title="4、根据 Java 注解查找"></a>4、根据 Java 注解查找</h2><p>最后一种方式是“通过 Java 注解的方式来查找实例对象”，比如说，你的某些类上标了注解，这时候我们通过注解的方式来进行依赖查询，就可以将包含找到所有包含注解的实例对象。</p>
<p>当然，查找到的实例对象也分为单个和多个两种，单个直接用对象的类型接收，多个 Bean 用 <code>Collection&lt;T&gt;</code> 类型接收。</p>
<p>我们直接来看代码。</p>
<p>首先，我们新增一个 SpuerUser 类继承自 User 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Super</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperUser</span> <span class="keyword">extends</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">	<span class="comment">// 省略 getter/setter/toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本质上讲，User 和 SuperUser 都是用户，为了增加它们之间区分度，我们来编写一个 Annotation 注解对 SuperUser 进行声明。<code>@Super</code> 注解的内容如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span> <span class="comment">// 注解的标注范围</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="comment">// 运行时生效</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Super &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在 SuperUser 类上声明 <code>@Super</code> 注解。此时，代码中标准的 User 类没有注解，SuperUser 类含有一个  <code>@Super</code> 注解。</p>
<p>这时我们再在 XML 文件中添加一个 SuperUser 的 bean，并设置继承 user 的信息。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;superuser&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ioc.overview.domain.SuperUser&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;比奇堡&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在我们再执行以下代码，发现输出结果中只包含标有 <code>@Super</code> 注解的 Bean 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">lookupByAnnotationType</span><span class="params">(BeanFactory beanFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> ListableBeanFactory)&#123;</span><br><span class="line">        <span class="type">ListableBeanFactory</span> <span class="variable">listableBeanFactory</span> <span class="operator">=</span> (ListableBeanFactory) beanFactory;</span><br><span class="line">        Map&lt;String, Object&gt; users = listableBeanFactory.getBeansWithAnnotation(Super.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;查找标注 @Super 注解的所有 User 对象：&quot;</span> + users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">查找标注 @Super 注解的所有 User 对象：&#123;superuser=SuperUser&#123;address=&#x27;比奇堡&#x27;&#125; User&#123;id=1, name=&#x27;章鱼哥&#x27;&#125;&#125;</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure>











<hr>
<h1 id="Spring-IoC-依赖注入"><a href="#Spring-IoC-依赖注入" class="headerlink" title="Spring IoC 依赖注入"></a>Spring IoC 依赖注入</h1><h2 id="大纲-1"><a href="#大纲-1" class="headerlink" title="大纲"></a>大纲</h2><blockquote>
<ol>
<li> 根据 Bean 名称注入</li>
<li>根据 Bean 类型注入<ul>
<li>  2.1 单个 Bean 对象</li>
<li>  2.2 多个 Bean 对象（集合）</li>
</ul>
</li>
<li> 注入容器内建 Bean 对象</li>
<li> 注入非 Bean 对象</li>
<li>注入类型<ul>
<li>  5.1、实时注入</li>
<li>  5.2、延迟注入</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123; <span class="comment">// 加锁</span></span><br><span class="line">        <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">        prepareRefresh(); <span class="comment">// 启动前的准备工作</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory(); <span class="comment">// 得到 beanFactory 实例</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">            initMessageSource();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">            onRefresh();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">            registerListeners();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">            destroyBeans();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">            cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">            <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">            resetCommonCaches();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
