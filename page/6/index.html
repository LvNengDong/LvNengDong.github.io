<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">235</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">69</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/14/Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/14/Nginx/" class="post-title-link" itemprop="url">Nginx</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-14 20:20:46 / Modified: 22:22:34" itemprop="dateCreated datePublished" datetime="2022-01-14T20:20:46+08:00">2022-01-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>  正向代理：代理服务器用于代替客户机访问目标地址。例如：科学上网</li>
<li>  反向代理：代理服务器事先不知道哪些客户会来访问，但是知道所有服务器的地址。</li>
</ul>
<h1 id="Nginx-安装（Linux）"><a href="#Nginx-安装（Linux）" class="headerlink" title="Nginx 安装（Linux）"></a>Nginx 安装（Linux）</h1><h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><ol>
<li>  使用 <code>yum</code> 安装依赖包</li>
</ol>
<pre><code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install openssl openssl-devel pcre pcre-devel zlib zlib-devel gcc gcc-c++</span><br></pre></td></tr></table></figure>
</code></pre>
<ol start="2">
<li><p>下载 <code>Nginx</code> 到 <code>/opt/software</code> 目录中。如果已经有下载好的安装包, 此步骤可以省略</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/software » wget http://nginx.org/download/nginx-1.12.2.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p>解压 <code>Nginx</code> 的源码到 <code>/opt/module</code> 目录中</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.12.2.tar.gz -C /opt/module</span><br></pre></td></tr></table></figure></li>
<li><p>编译和安装</p>
<ul>
<li>  为了防止出现权限问题, 建议切换到 root 用户</li>
</ul>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入解压缩的目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt/module/nginx-1.12.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译&amp;安装</span></span><br><span class="line">./configure  --prefix=/usr/local/webserver/nginx</span><br><span class="line"> make &amp;&amp; make install</span><br><span class="line"> </span><br><span class="line"><span class="comment"># --prefix 后面跟的是Nginx的安装位置</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="启动-Nginx"><a href="#启动-Nginx" class="headerlink" title="启动 Nginx"></a>启动 Nginx</h2><ol>
<li><p>进入安装目录：</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 nginx]$ <span class="built_in">cd</span> /usr/local/webserver/nginx</span><br></pre></td></tr></table></figure></li>
<li><p>启动 nginx</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 nginx]$ sudo sbin/nginx</span><br></pre></td></tr></table></figure></li>
<li><p>关闭 nginx</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 nginx]$ sudo sbin/nginx -s stop</span><br></pre></td></tr></table></figure></li>
<li><p>重新加载配置文件</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 nginx]$ sudo sbin/nginx -s reload</span><br></pre></td></tr></table></figure></li>
<li><p>查看是否启动成功</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于 Nginx 不是使用 Java 实现的，所以无法使用 jps 命令查看状态，需要使用 ps 命令</span></span><br><span class="line">[lvnengdong@hadoop102 conf]$ ps -ef | grep nginx</span><br><span class="line">root     109415      1  0 20:54 ?        00:00:00 nginx: master process sbin/nginx</span><br><span class="line">nobody   109416 109415  0 20:54 ?        00:00:00 nginx: worker process</span><br><span class="line">lvnengd+ 110118 109287  0 21:17 pts/1    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure></li>
<li><p>通过网页访问: <a target="_blank" rel="noopener" href="http://hadoop102/">http://hadoop102</a></p>
<p> ​                                     <img src="/2022/01/14/Nginx/image-20220114212341344.png" alt="image-20220114212341344"></p>
</li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>Nginx 默认使用的是 80 端口，由于非 root 用户不能使用 1024 以内的端口，所以建议使用 root 用户启动 Nginx。</li>
</ul>
<hr>
<h2 id="Nginx-配置文件"><a href="#Nginx-配置文件" class="headerlink" title="Nginx 配置文件"></a>Nginx 配置文件</h2><p>配置文件路径：<code>/usr/local/webserver/nginx/conf/nginx.conf</code></p>
<p><strong>原始配置文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>修改后的配置文件</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attr">worker_processes</span>  <span class="string">1;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">events</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">worker_connections</span>  <span class="string">1024;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 当 Nginx 接收到了 http 请求时走该分支</span></span><br><span class="line"><span class="attr">http</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">	# 对 HTTP 请求的一些格式要求</span></span><br><span class="line">    <span class="attr">include</span>       <span class="string">mime.types;</span></span><br><span class="line">    <span class="attr">default_type</span>  <span class="string">application/octet-stream;</span></span><br><span class="line">    <span class="attr">sendfile</span>        <span class="string">on;</span></span><br><span class="line">    <span class="attr">keepalive_timeout</span>  <span class="string">65;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    # 手动配置服务（新增）</span></span><br><span class="line"><span class="comment">    # 配置上游服务集群: 其实就被代理的服务器，`upstream`是关键字，logserver是服务名称</span></span><br><span class="line">    <span class="attr">upstream</span> <span class="string">logserver&#123;</span></span><br><span class="line">        <span class="attr">server</span> <span class="string">hadoop102:8080 weight=1;</span></span><br><span class="line">        <span class="attr">server</span> <span class="string">hadoop103:8080 weight=1;</span></span><br><span class="line">        <span class="attr">server</span> <span class="string">hadoop104:8080 weight=1;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">    	# Nginx 监听的端口，默认监听80端口</span></span><br><span class="line">        <span class="attr">listen</span>       <span class="string">80;</span></span><br><span class="line"><span class="comment">        # Nginx 将请求转发到哪个地方（手动指定），logserver是服务名称（一般都是一个集群），需要在配置文件的上下文中配置</span></span><br><span class="line">        <span class="attr">server_name</span>  <span class="string">logserver;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		# 拦截器，拦截访问 Nginx 服务器上访问 80 端口的请求，`/` 表示拦截所有请求</span></span><br><span class="line">        <span class="attr">location</span> <span class="string">/ &#123;</span></span><br><span class="line">            <span class="attr">root</span>   <span class="string">html;</span></span><br><span class="line">            <span class="attr">index</span>  <span class="string">index.html index.htm;</span></span><br><span class="line"><span class="comment">            # 配置代理：将拦截到的请求转发到 http 标签下的 logserver 服务中</span></span><br><span class="line">            <span class="attr">proxy_pass</span> <span class="string">http://logserver;</span></span><br><span class="line"><span class="comment">            # 超时时间</span></span><br><span class="line">            <span class="attr">proxy_connect_timeout</span> <span class="string">10;</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">error_page</span>   <span class="string">500 502 503 504  /50x.html;</span></span><br><span class="line">        <span class="attr">location</span> = <span class="string">/50x.html &#123;</span></span><br><span class="line">            <span class="attr">root</span>   <span class="string">html;</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/14/%E5%B0%86jar%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0Linux%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/14/%E5%B0%86jar%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0Linux%E4%B8%8A/" class="post-title-link" itemprop="url">将jar包部署到Linux上</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-14 17:50:43" itemprop="dateCreated datePublished" datetime="2022-01-14T17:50:43+08:00">2022-01-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-16 10:06:58" itemprop="dateModified" datetime="2022-01-16T10:06:58+08:00">2022-01-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="将SpringBoot项目打成jar包部署到Linux上"><a href="#将SpringBoot项目打成jar包部署到Linux上" class="headerlink" title="将SpringBoot项目打成jar包部署到Linux上"></a>将SpringBoot项目打成jar包部署到Linux上</h1><h2 id="1、打包"><a href="#1、打包" class="headerlink" title="1、打包"></a>1、打包</h2><ul>
<li>  使用 <code>package</code> 命令打包 SpringBoot 项目</li>
<li>  使用对于不需要的目录（比如 <code>test</code> 目录）可以选择性的忽略。</li>
</ul>
<img src="/2022/01/14/%E5%B0%86jar%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0Linux%E4%B8%8A/image-20220114175348398.png" alt="image-20220114175348398" style="zoom:50%;">



<h3 id="查看打包之后的文件结构"><a href="#查看打包之后的文件结构" class="headerlink" title="查看打包之后的文件结构"></a>查看打包之后的文件结构</h3><ol>
<li> jar 包所在位置</li>
</ol>
<img src="/2022/01/14/%E5%B0%86jar%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0Linux%E4%B8%8A/image-20220114180356799.png" alt="image-20220114180356799" style="zoom:50%;">

<ol start="2">
<li><p>jar 的目录结构</p>
<p> <img src="/2022/01/14/%E5%B0%86jar%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0Linux%E4%B8%8A/image-20220114180636623.png" alt="image-20220114180636623"></p>
</li>
<li><p>在元数据目录 <code>META-INF</code> 下的文件 <code>MANIFEST.MF</code> 包含了元数据基本信息。其中的内容如下：</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Manifest-Version</span>: <span class="string">1.0</span></span><br><span class="line"><span class="attr">Implementation-Title</span>: <span class="string">gmall-logger</span></span><br><span class="line"><span class="attr">Implementation-Version</span>: <span class="string">0.0.1-SNAPSHOT</span></span><br><span class="line"><span class="attr">Start-Class</span>: <span class="string">com.example.gmalllogger.GmallLoggerApplication</span></span><br><span class="line"><span class="attr">Spring-Boot-Classes</span>: <span class="string">BOOT-INF/classes/</span></span><br><span class="line"><span class="attr">Spring-Boot-Lib</span>: <span class="string">BOOT-INF/lib/</span></span><br><span class="line"><span class="attr">Build-Jdk-Spec</span>: <span class="string">1.8</span></span><br><span class="line"><span class="attr">Spring-Boot-Version</span>: <span class="string">2.2.1.RELEASE</span></span><br><span class="line"><span class="attr">Created-By</span>: <span class="string">Maven Archiver 3.4.0</span></span><br><span class="line"><span class="comment"># jar 的主类名，在 Linux 中运行 jar 包时需要使用到该主类名</span></span><br><span class="line"><span class="attr">Main-Class</span>: <span class="string">org.springframework.boot.loader.JarLauncher</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>  SpringBoot 项目生成的 jar 包内嵌了 TomCat 服务器，所以在 Linux 系统上运行时无需额外安装 TomCat。</p>
</li>
<li><p> 将 jar 文件上传到 Linux 上。</p>
</li>
</ol>
<h2 id="2、在-Linux-上运行-jar"><a href="#2、在-Linux-上运行-jar" class="headerlink" title="2、在 Linux 上运行 jar"></a>2、在 Linux 上运行 jar</h2><p>在 Linux 上运行 jar 包有两种命令格式：</p>
<p><strong>Case1</strong></p>
<ul>
<li><p>  格式：<code>java -jar jar包名称</code></p>
</li>
<li><p>  场景：适用于已经指定了启动类名的jar 包。SpringBoot 项目打包后一般都会生成一个主类名。</p>
</li>
<li><p>实例：在 jar 包所在的目录下执行以下命令：</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 tmp]$ java -jar gmall-logger-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>  <img src="/2022/01/14/%E5%B0%86jar%E5%8C%85%E9%83%A8%E7%BD%B2%E5%88%B0Linux%E4%B8%8A/image-20220114181942630.png" alt="image-20220114181942630"></p>
</li>
</ul>
<p><strong>Case2</strong></p>
<ul>
<li><p>  语法：<code>java -cp jar包名 启动类名称</code></p>
</li>
<li><p>  场景：如果一个 jar 包在元数据信息中没有显式声明启动类的类名，则可以通过这种方式手动指定启动类类名</p>
</li>
<li><p>实例：</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 tmp]$ java -<span class="built_in">cp</span> gmall-logger-0.0.1-SNAPSHOT.jar org.springframework.boot.loader.JarLauncher </span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/11/%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0Part01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/11/%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0Part01/" class="post-title-link" itemprop="url">架构学习Part01</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-11 17:16:06" itemprop="dateCreated datePublished" datetime="2022-01-11T17:16:06+08:00">2022-01-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-13 11:04:23" itemprop="dateModified" datetime="2022-01-13T11:04:23+08:00">2022-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="43"><a href="#43" class="headerlink" title="43"></a>43</h2><p><strong>业务复杂度越来越高</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">互联网的业务干差万别，不同的业务分解下来有不同的系统，所以业务层没有办法提炼一些公共的系统或者组件。抛开业务上的差异，各个互联网业务发展最终面临的问题都是类似的：业务复杂度越来越高。也就是说，业务层面对的主要技术挑战是“复杂度”。</span><br><span class="line"></span><br><span class="line">复杂度越来越高的一个主要原因就是系统越来越庞大，业务越来越多。幸运的是，面对业务层的技术挑战，我们有一把“屠龙宝刀” ，不管什么业务难题，用上“屠龙宝刀”问题都能迎刃而解。这把“屠龙宝刀”就是＂拆＂ ，化整为零、分而治之，将整体复杂性分散到多个子业务或者子系统里面去。具体拆的方式你可以查看专栏前面可扩展架构模式部分的分层架构、微服务、微内核等。</span><br></pre></td></tr></table></figure>



<h2 id="44"><a href="#44" class="headerlink" title="44"></a>44</h2><p><strong>为什么要有“平台”？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当业务规模比较小、系统复杂度不高时，运维、测试、数据分析、管理等支撑功能主要由各系统或者团队独立完成。随着业务规模越来越大，系统复杂度越来越高，子系统数量越来越多，如果继续采取各自为政的方式来实现这些支撑功能，会发现重复工作非常多。因此我们自然而然就会想到将这些支撑功能做成平台，避免重复造轮子，减少不规范带来的沟通和协作成本。</span><br></pre></td></tr></table></figure>



<p><strong>数据平台</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数据平台的核心职责主要包括三部分：数据管理、数据分析和数据应用。每一部分又包含更多的细分领域，详细的数据平台架构如下图所示。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/11/%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0Part01/image-20220111174618538.png" alt="image-20220111174618538"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1. 数据管理：数据管理包含数据采集、数据存储、数据访问和数据安全四个核心职责，是数据平台的基础功能。</span><br><span class="line">	• 数据采集：从业务系统搜集各类数据。例如，日志、用户行为、业务数据等，将这些数据传送到数据平台。（Sqoop）</span><br><span class="line">	• 数据存储：将从业务系统采集的数据存储到数据平台，用千后续数据分析。（HDFS。Hive）</span><br><span class="line">	• 数据访问：负责对外提供各种协议用于读写数据。例如， SQL、Hive 、Key-Value 等读写协议。</span><br><span class="line">	• 数据安全：通常清况下数据平台都是多个业务共享的，部分业务敏感数据需要加以保护，防止被其他业务读取甚至修改，因此需要设计数据安全策略来保护数据。</span><br><span class="line"></span><br><span class="line">2. 数据分析：数据分析包括数据统计、数据挖掘、机器学习、深度学习等几个细分领域。</span><br><span class="line">	• 数据统计：根据原始数据统计出相关的总览数据。例如， PV、UV、交易额等。</span><br><span class="line">	• 数据挖掘：数据挖掘这个概念本身含义可以很广，为了与机器学习和深度学习区分开，这里的数据挖掘主要是指传统的数据挖掘方式。例如，有经验的数据分析人员基于数据仓库构建一系列规则来对数据进行分析从而发现一些隐含的规律、现象、问题等，经典的数据挖掘案例就是沃尔玛的啤酒与尿布的关联关系的发现。</span><br><span class="line">	• 机器学习、深度学习：机器学习和深度学习属千数据挖掘的一种具体实现方式，由千其实现方式与传统的数据挖掘方式差异较大，因此数据平台在实现机器学习和深度学习时，需要针对机器学习和深度学习独立进行设计。</span><br><span class="line"></span><br><span class="line">3. 数据应用：数据应用很广泛，既包括在线业务，也包括离线业务。例如，推荐、广告等属于在线应用，报表、欺诈检测、异常检测等属于离线应用。数据应用能够发挥价值的前提是需要有“大数据“ ，只有当数据的规模达到一定程度，基于数据的分析、挖掘才能发现有价值的规律、现象、间题等。如果数据没有达到一定规模，通常清况下做好数据统计就足够了，尤其是很多初创企业，无须一开始就参考BAT 来构建自己的数据平台。</span><br></pre></td></tr></table></figure>



<p><strong>管理平台</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">管理平台的核心职责就是权限管理，无论是业务系统（例如，淘宝网）、中间件系统（例如，消息队列Kafka) , 还是平台系统（例如，运维平台），都需要进行管理。如果每个系统都自己来实现权限管理，效率太低，重复工作很多，因此需要统一的管理平台来管理所有的系统的权限。权限管理主要分为两部分：身份认证、权限控制，其基本架构如下图所示。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/11/%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0Part01/image-20220111175333396.png" alt="image-20220111175333396"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 身份认证：</span><br><span class="line">	确定当前的操作人员身份，防止非法人员进入系统。例如，不允许匿名用户进入系统。为了避免每个系统都自己来管理用户，通常清况下都会使用企业账号来做统一认证和登录。</span><br><span class="line">	</span><br><span class="line">2. 权限控制：</span><br><span class="line">	根据操作人员的身份确定操作权限，防止未经授权的人员进行操作。例如，不允许研发人员进入财务系统查看别人的工资。</span><br></pre></td></tr></table></figure>







<h2 id="01-12"><a href="#01-12" class="headerlink" title="01/12"></a>01/12</h2><p><strong>架构不满足业务发展的情况，可以考虑加入到单体架构现存的缺陷中去</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通常情况下，当系统架构不满足业务的发展时，其表现形式是系统不断出现各种问题，轻微一点的如系统响应慢、数据错误、某些用户访问失败等，严重的可能是宕机、数据库瘫痪、数据丢失等，或者系统的开发效率很低。开始的时候，技术团队可能只针对具体的问题去解决，解决一个算一个，但如果持续时间较长，例如持续了半年甚至一年情况都不见好转，此时可能有人想到了系统的架构是否存在问题，讨论是否是因为架构原因导致了各种问题。一旦确定需要进行架构重构，就会由架构师牵头来进行架构重构的分析。</span><br><span class="line"></span><br><span class="line">来自：45</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" class="post-title-link" itemprop="url">数据仓库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-04 21:32:25" itemprop="dateCreated datePublished" datetime="2022-01-04T21:32:25+08:00">2022-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-05-27 19:54:33" itemprop="dateModified" datetime="2022-05-27T19:54:33+08:00">2022-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E4%BB%93/" itemprop="url" rel="index"><span itemprop="name">数仓</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、数据采集平台搭建</span><br><span class="line"></span><br><span class="line">2、实现业务数据仓库分层搭建</span><br><span class="line"></span><br><span class="line">3、针对数仓中的数据进行分析</span><br><span class="line">	留存：用户粘性</span><br><span class="line">	转换率：注册用户中有多少用户使用了业务</span><br><span class="line">	GMV：成交额</span><br><span class="line">	复购率：重新购买某件商品的概率</span><br><span class="line">	活跃：日活、月活、...</span><br><span class="line">4、机器学习应用</span><br></pre></td></tr></table></figure>

<p><strong>埋点</strong>：需要什么数据，就在应用程序对应的部位添加数据采集的模块。</p>
<h2 id="FastJson"><a href="#FastJson" class="headerlink" title="FastJson"></a>FastJson</h2><p>解析JSON的框架FastJson</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--阿里巴巴开源json解析框架--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.51<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="logback"><a href="#logback" class="headerlink" title="logback"></a>logback</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--日志生成框架--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>  日志记录框架：logback</p>
</li>
<li><p>  <code>log4j --&gt;&gt; log4j2 --&gt;&gt; logback</code></p>
</li>
<li><p>  <code>logback</code> 是 <code>log4j</code> 的升级版，速度更快，性能更高，测试更充分！logback 提供了对 SLF4J 的支持，可以从 log4j 无缝切换到logback</p>
</li>
<li><p>  <strong>区别：</strong>log4j使用的log4j.properties作为配置文件，logback使用logback.xml作为配置文件</p>
</li>
<li><p><strong>使用：</strong>在配置文件中，可以定义三种组件</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Logger:  日志的记录器，可以在Logger上定义日志的记录级别(INFO,WARN)</span><br><span class="line">Appender： 负责将输出的信息，追加到目的地(文件，控制台，网络端口，数据库)</span><br><span class="line">Layout:  输出的样式，每条信息都会格式化为指定的样式输出</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>  Logback 主要用于在磁盘和控制台打印日志。</li>
<li>Logback具体使用：<ol>
<li> 在 resources 文件夹下创建 logback.xml 文件。</li>
<li> 在 logback.xml 文件中填写如下配置</li>
</ol>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义日志文件的存储地址 勿在 LogBack 的配置中使用相对路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/tmp/logs/&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制台输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 按照每天生成日志文件。存储事件日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;File&gt;$&#123;LOG_HOME&#125;/app.log&lt;/File&gt;设置日志不超过$&#123;log.max.size&#125;时的保存路径，注意，如果是web项目会保存到Tomcat的bin目录 下 --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件输出的文件名 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/app-%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">triggeringPolicy</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">triggeringPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--异步打印日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span> =<span class="string">&quot;ASYNC_FILE&quot;</span> <span class="attr">class</span>= <span class="string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discardingThreshold</span> &gt;</span>0<span class="tag">&lt;/<span class="name">discardingThreshold</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 更改默认的队列的深度,该值会影响性能.默认值为256 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">queueSize</span>&gt;</span>512<span class="tag">&lt;/<span class="name">queueSize</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加附加的appender,最多只能添加一个 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span> = <span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志输出级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span>	</span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ASYNC_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;error&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>







<h2 id="打包框架"><a href="#打包框架" class="headerlink" title="打包框架"></a>打包框架</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--编译打包插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果已经在Maven的全局配置中，配置了JDK编译的界别，这个插件可以省略 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;2.3.2&lt;/version&gt;</span></span><br><span class="line"><span class="comment">            &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                &lt;source&gt;1.8&lt;/source&gt;</span></span><br><span class="line"><span class="comment">                &lt;target&gt;1.8&lt;/target&gt;</span></span><br><span class="line"><span class="comment">            &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">        &lt;/plugin&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		在mvn:package阶段使用 maven-assembly-plugin 可以将当前项目及其依赖中的Jar中的字节码全部打包！</span></span><br><span class="line"><span class="comment">		Maven项目默认提供的打包插件 maven-jar-plugin，只会将自己写的代码打包。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--当前jar包的主类的全限定类名--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.atguigu.appclient.AppMain<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>





<hr>
<h1 id="数仓分层"><a href="#数仓分层" class="headerlink" title="数仓分层"></a>数仓分层</h1><h2 id="如何分层？"><a href="#如何分层？" class="headerlink" title="如何分层？"></a>如何分层？</h2><p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220130155736785.png" alt="image-20220130155736785"></p>
<p><strong>ODS</strong></p>
<p>Operation Data Store 直译过来是“操作数据层”，那么何为“操作数据”呢？我们将业务系统中产生的数据称为操作数据，由于这一层存储的就是直接从业务系统中同步过来的数据，没有做任何处理，所以又称之为“原始数据层”。</p>
<ul>
<li>  职责：存放原始数据</li>
<li>  数据来源：业务系统，保存从业务系统同步过来的日志、及关系型数据库中的数据</li>
</ul>
<p><strong>DWD</strong></p>
<p>Data Warehouse Detail，数据明细层</p>
<ul>
<li>  职责：保存业务事实明细。每一个业务操作都叫做一个“业务事实”。[业务事实就是事实表中的数据，事实表中的数据需要维度表数据进行解释说明，因为在事实表中多数数据都以“码”存在]</li>
</ul>
<p><strong>DIM</strong></p>
<p>Dimension，维度层。保存维度数据，其实就是维度表中的数据。主要是对业务事实（也就是业务数据表中的数据）的描述信息。</p>
<p><strong>DWS</strong></p>
<p>Data Warehouse Summary，数据汇总层。</p>
<ul>
<li>  汇总数据来源：DWD层的业务事实数据</li>
</ul>
<p><strong>DWT</strong></p>
<p>Data Warehouse Topic，数据主题层</p>
<p><strong>DIM</strong></p>
<p>维度层</p>
<p><strong>ADS</strong></p>
<p>Application Data Store，数据应用层</p>
<p>为数仓后续的应用提供结果</p>
<ul>
<li>  ODS层：原始数据层，存放原始数据，数据保持原貌不做处理</li>
<li>  DWD层：结构和粒度与原始表保持一致，对 ODS 层数据进行ETL过滤（去除空值、脏数据和异常数据等）</li>
<li>  DWS层：以DWD层为基础，进行初步汇总。基于ADS层需要统计的主题，创建宽表</li>
<li>  ADS层：为各种统计报表直接提供数据。基于DWS层的宽表，计算出结果</li>
</ul>
<p>数仓分层并没有绝对的标准，可以根据业务情况适当增加或减少。</p>
<h2 id="为什么分层？"><a href="#为什么分层？" class="headerlink" title="为什么分层？"></a>为什么分层？</h2><ol>
<li><p>把复杂问题简单化</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">复杂需求拆解</span><br><span class="line"></span><br><span class="line">大SQL</span><br><span class="line">	1、编写复杂</span><br><span class="line">	2、出问题后排查复杂</span><br><span class="line">	3、降低开发复杂度</span><br><span class="line"></span><br><span class="line">每层只处理简单的任务，开发目标明确，开发方便</span><br><span class="line">遇到问题时方便定位</span><br></pre></td></tr></table></figure>

<p> 将一个复杂的任务分解成多个步骤来完成，每层只处理单一的步骤，比较简单，并且方便定位问题。</p>
</li>
<li><p>减少重复开发</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">所有业务都需要从ODS查询数据，</span><br><span class="line">	1、清洗操作逻辑相同，但需要重复开发</span><br><span class="line">	2、分层之后，统一清洗，把清洗结果放到DWD层，避免重复开发</span><br></pre></td></tr></table></figure>

<p> 规范数据分层，通过中间层数据，能够极大减少重复计算，增加单次计算结果的复用性</p>
</li>
<li><p>隔离原始数据（数据脱敏）</p>
<p> 使真实数据与统计数据解耦开，保证真实数据的安全性</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ODS可能存在一些用户的敏感数据，如手机号等</span><br><span class="line">敏感信息脱敏</span><br><span class="line">禁止从ODS层取数据，可以起到隔离原始数据，避免敏感数据泄露的风险</span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">宽表：为了防止大量的join操作，将很多表的数据放到一个宽表中</span><br><span class="line"></span><br><span class="line">DWS层存在大量宽表</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="数仓建模（重点）"><a href="#数仓建模（重点）" class="headerlink" title="数仓建模（重点）"></a>数仓建模（重点）</h2><p><strong>准则：</strong>在搭建数仓的每一层的时候，都需要解决如下两个问题：</p>
<ol>
<li> 确定需要创建哪些表</li>
<li>确定每张表的表结构<ul>
<li>  确定每行数据的含义</li>
<li>  确定表的字段</li>
<li>  确定表的分区规划</li>
</ul>
</li>
</ol>
<p><strong>ODS</strong></p>
<p>ODS的建表逻辑整体参照待同步表的业务逻辑</p>
<p>参照MySQL中同步的表建立ODS层的表</p>
<ul>
<li>  分区：按天分区，存储当天从关系型数据库同步过来的数据</li>
</ul>
<p><strong>DWD</strong>：业务事实 ==&gt; 维度模型中的事实表</p>
<p><strong>DIM</strong>：对业务事实的描述信息 ==&gt; 维度模型中的维度表</p>
<p>确定需要哪些事实表 ==&gt; 声明粒度 ==&gt; 确定维度</p>
<hr>
<h1 id="数仓理论"><a href="#数仓理论" class="headerlink" title="数仓理论"></a>数仓理论</h1><h2 id="1-1-表的分类"><a href="#1-1-表的分类" class="headerlink" title="1.1 表的分类"></a>1.1 表的分类</h2><h3 id="1-1-1-实体表"><a href="#1-1-1-实体表" class="headerlink" title="1.1.1 实体表"></a>1.1.1 实体表</h3><p><strong>实体表</strong>，一般是指一个现实存在的业务对象，比如用户，商品，商家，销售员等等。</p>
<p>用户表：</p>
<table>
<thead>
<tr>
<th>用户id</th>
<th>姓名</th>
<th>生日</th>
<th>性别</th>
<th>邮箱</th>
<th>用户等级</th>
<th>创建时间</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张三</td>
<td>2011-11-11</td>
<td>男</td>
<td><a href="mailto:&#122;&#115;&#x40;&#49;&#x36;&#51;&#46;&#99;&#x6f;&#109;">&#122;&#115;&#x40;&#49;&#x36;&#51;&#46;&#99;&#x6f;&#109;</a></td>
<td>2</td>
<td>2018-11-11</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>2011-11-11</td>
<td>女</td>
<td><a href="mailto:&#x6c;&#x73;&#64;&#x31;&#54;&#x33;&#x2e;&#99;&#x6f;&#x6d;">&#x6c;&#x73;&#64;&#x31;&#54;&#x33;&#x2e;&#99;&#x6f;&#x6d;</a></td>
<td>3</td>
<td>2018-11-11</td>
</tr>
<tr>
<td>3</td>
<td>王五</td>
<td>2011-11-11</td>
<td>中性</td>
<td><a href="mailto:&#119;&#x77;&#x40;&#49;&#54;&#x33;&#x2e;&#x63;&#111;&#x6d;">&#119;&#x77;&#x40;&#49;&#54;&#x33;&#x2e;&#x63;&#111;&#x6d;</a></td>
<td>1</td>
<td>2018-11-11</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<h3 id="1-1-2-维度表"><a href="#1-1-2-维度表" class="headerlink" title="1.1.2 维度表"></a>1.1.2 维度表</h3><p><strong>维度表</strong>，一般是指对应一些业务状态，编号的解释表。也可以称之为码表。</p>
<p>比如地区表，订单状态，支付方式，审批状态，商品分类等等。</p>
<p>订单状态表：</p>
<table>
<thead>
<tr>
<th>订单状态编号</th>
<th>订单状态名称</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>未支付</td>
</tr>
<tr>
<td>2</td>
<td>支付</td>
</tr>
<tr>
<td>3</td>
<td>发货中</td>
</tr>
<tr>
<td>4</td>
<td>已发货</td>
</tr>
<tr>
<td>5</td>
<td>已完成</td>
</tr>
</tbody></table>
<p>​    商品分类表：</p>
<table>
<thead>
<tr>
<th>商品分类编号</th>
<th>分类名称</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>服装</td>
</tr>
<tr>
<td>2</td>
<td>保健</td>
</tr>
<tr>
<td>3</td>
<td>电器</td>
</tr>
<tr>
<td>4</td>
<td>图书</td>
</tr>
</tbody></table>
<h3 id="1-1-3-事务型事实表"><a href="#1-1-3-事务型事实表" class="headerlink" title="1.1.3 事务型事实表"></a>1.1.3 事务型事实表</h3><p><strong>事务型事实表</strong>，一般指随着业务发生不断产生数据。特点是一旦发生不会再变化。</p>
<p>一般比如，交易流水，操作日志，出库入库记录等等。</p>
<p>交易流水表：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>对外业务编号</th>
<th>订单编号</th>
<th>用户编号</th>
<th>支付宝交易流水编号</th>
<th>支付金额</th>
<th>交易内容</th>
<th>支付类型</th>
<th>支付时间</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>7577697945</td>
<td>1</td>
<td>111</td>
<td>QEyF-63000323</td>
<td>223.00</td>
<td>海狗人参丸1</td>
<td>alipay</td>
<td>2019-02-10 00:50:02</td>
</tr>
<tr>
<td>2</td>
<td>0170099522</td>
<td>2</td>
<td>222</td>
<td>qdwV-25111279</td>
<td>589.00</td>
<td>海狗人参丸2</td>
<td>wechatpay</td>
<td>2019-02-10 00:50:02</td>
</tr>
<tr>
<td>3</td>
<td>1840931679</td>
<td>3</td>
<td>666</td>
<td>hSUS-65716585</td>
<td>485.00</td>
<td>海狗人参丸3</td>
<td>unionpay</td>
<td>2019-02-10 00:50:02</td>
</tr>
<tr>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
</tr>
</tbody></table>
<h3 id="1-1-4-周期型事实表"><a href="#1-1-4-周期型事实表" class="headerlink" title="1.1.4    周期型事实表"></a>1.1.4    周期型事实表</h3><p><strong>周期型事实表</strong>，一般指随着业务发生不断产生变化(更新, 新增)的数据。</p>
<p>与事务型不同的是，数据会随着业务周期性的推进而变化。</p>
<p> 比如订单，其中订单状态会周期性变化。再比如，请假、贷款申请，随着批复状态在周期性变化。</p>
<p>订单表：</p>
<table>
<thead>
<tr>
<th>订单编号</th>
<th>订单金额</th>
<th>订单状态</th>
<th>用户id</th>
<th>支付方式</th>
<th>支付流水号</th>
<th>创建时间</th>
<th>操作时间</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>223.00</td>
<td>2</td>
<td>111</td>
<td>alipay</td>
<td>QEyF-63000323</td>
<td>2019-02-10 00:01:29</td>
<td>2019-02-10 00:01:29</td>
</tr>
<tr>
<td>2</td>
<td>589.00</td>
<td>2</td>
<td>222</td>
<td>wechatpay</td>
<td>qdwV-25111279</td>
<td>2019-02-10 00:05:02</td>
<td>2019-02-10 00:05:02</td>
</tr>
<tr>
<td>3</td>
<td>485.00</td>
<td>1</td>
<td>666</td>
<td>unionpay</td>
<td>hSUS-65716585</td>
<td>2019-02-10 00:50:02</td>
<td>2019-02-10 00:50:02</td>
</tr>
<tr>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
</tr>
</tbody></table>
<h2 id="1-2-同步策略"><a href="#1-2-同步策略" class="headerlink" title="1.2 同步策略"></a>1.2 同步策略</h2><p>数据同步策略的类型包括：全量表、增量表、新增及变化表、拉链表</p>
<p>Ø 全量表：存储完整的数据。</p>
<p>Ø 增量表：存储新增加的数据。</p>
<p>Ø 新增及变化表：存储新增加的数据和变化的数据。</p>
<p>Ø 拉链表：对新增及变化表做定期合并。</p>
<h3 id="1-1-1-实体表同步策略"><a href="#1-1-1-实体表同步策略" class="headerlink" title="1.1.1 实体表同步策略"></a>1.1.1 实体表同步策略</h3><p>实体表：比如用户，商品，商家，销售员等</p>
<p>实体表数据量比较小：通常可以做每日全量，就是每天存一份完整数据。即每日全量。</p>
<h3 id="1-1-2-维度表同步策略"><a href="#1-1-2-维度表同步策略" class="headerlink" title="1.1.2 维度表同步策略"></a>1.1.2 维度表同步策略</h3><p>维度表：比如订单状态，审批状态，商品分类</p>
<p>维度表数据量比较小：通常可以做每日全量，就是每天存一份完整数据。即每日全量。</p>
<p>说明：</p>
<p>1）针对可能会有变化的状态数据可以存储每日全量。</p>
<p>2）没变化的客观世界的维度（比如性别，地区，民族，政治成分，鞋子尺码）可以只存一份固定值。</p>
<h3 id="1-1-3-事务型事实表同步策略"><a href="#1-1-3-事务型事实表同步策略" class="headerlink" title="1.1.3 事务型事实表同步策略"></a>1.1.3 事务型事实表同步策略</h3><p>事务型事实表：比如，交易流水，操作日志，出库入库记录等。</p>
<p>因为数据不会变化，而且数据量巨大，所以每天只同步新增数据即可，所以可以做成每日增量表，即每日创建一个分区存储。</p>
<h3 id="1-1-4-周期型事实表同步策略"><a href="#1-1-4-周期型事实表同步策略" class="headerlink" title="1.1.4 周期型事实表同步策略"></a>1.1.4 周期型事实表同步策略</h3><p>周期型事实表：比如，订单、请假、贷款申请等</p>
<p>这类表从数据量的角度，存每日全量的话，数据量太大，冗余也太大。如果用每日增量的话无法反应数据变化。</p>
<p> 每日新增及变化量，包括了当日的新增和修改。一般来说这个表，足够计算大部分当日数据的。但是这种依然无法解决能够得到某一个历史时间点（时间切片）的切片数据。 </p>
<p> 所以要用利用每日新增和变化表，制作一张拉链表，以方便的取到某个时间切片的快照数据。所以我们需要得到每日新增及变化量。</p>
<p>拉链表：</p>
<table>
<thead>
<tr>
<th>name姓名</th>
<th>start新名字创建时间</th>
<th>end名字更改时间</th>
</tr>
</thead>
<tbody><tr>
<td>张三</td>
<td>1990/1/1</td>
<td>2018/12/31</td>
</tr>
<tr>
<td>张小三</td>
<td>2019/1/1</td>
<td>2019/4/30</td>
</tr>
<tr>
<td>张大三</td>
<td>2019/5/1</td>
<td>9999-99-99</td>
</tr>
<tr>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
</tr>
</tbody></table>
<p>select * from user where start =&lt;’2019-1-2’ and end&gt;=’2019-1-2’</p>
<hr>
<h2 id="1-3-范式理论"><a href="#1-3-范式理论" class="headerlink" title="1.3 范式理论"></a>1.3 范式理论</h2><h3 id="1-3-1-范式概念"><a href="#1-3-1-范式概念" class="headerlink" title="1.3.1 范式概念"></a>1.3.1 范式概念</h3><p>关系型数据库设计时，遵照一定的规范要求，目的在于降低数据的冗余性，目前业界范式有：第一范式(1NF)、第二范式(2NF)、第三范式(3NF)、巴斯-科德范式(BCNF)、第四范式(4NF)、第五范式(5NF)。</p>
<p>范式可以理解为设计一张数据表的表结构，符合的标准级别。</p>
<p> 使用范式的根本目的是：</p>
<p> 1）减少数据冗余，尽量让每个数据只出现一次。</p>
<p> 2）保证数据一致性</p>
<p> 缺点是获取数据时，需要通过Join拼接出最后的数据。</p>
<h3 id="1-3-2-函数依赖"><a href="#1-3-2-函数依赖" class="headerlink" title="1.3.2 函数依赖"></a>1.3.2 函数依赖</h3><h3 id="1-3-3-三范式区分"><a href="#1-3-3-三范式区分" class="headerlink" title="1.3.3 三范式区分"></a>1.3.3 三范式区分</h3><h2 id="1-4-关系建模与维度建模"><a href="#1-4-关系建模与维度建模" class="headerlink" title="1.4 关系建模与维度建模"></a>1.4 关系建模与维度建模</h2><h3 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h3><p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220130163059487.png" alt="image-20220130163059487"></p>
<p>关系模型主要应用与OLTP系统中，为了保证数据的一致性以及避免冗余，所以大部分业务系统的表都是遵循第三范式的。</p>
<p>关系模型严格遵循第三范式（3NF），数据冗余程度低，数据的一致性容易得到保证。由于数据分布于众多的表中，查询会相对复杂，在大数据的场景下，查询效率相对较低。</p>
<p><strong>为什么关系模型在大数据中查询效率低？</strong></p>
<p>由于表的数量较多，查询可能用到 join 操作，每次 join 会涉及到 MR 的 Shuffle 操作，在 MR 中Shuffle 是一个比较耗时的操作，join多Shuffle就多，就会比较耗时。</p>
<h3 id="维度模型"><a href="#维度模型" class="headerlink" title="维度模型"></a>维度模型</h3><p>模型相对清晰、简洁。</p>
<p>维度模型以数据分析作为出发点，不遵循三范式，故数据存在一定的冗余。维度模型面向业务，将业务用事实表和维度表呈现出来。表结构简单，故查询简单，查询效率较高。</p>
<p>事实表和维度表是维度模型中的两类表。业务事实存储在事实表中。维度表中存储的是业务事实的描述信息。</p>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220130163024436.png" alt="image-20220130163024436"></p>
<p>维度模型主要应用于OLAP系统中，因为关系模型虽然冗余少，但是在大规模数据，跨表分析统计查询过程中，会造成多表关联，这会大大降低执行效率。</p>
<p>所以把相关各种表整理成两种：<strong>事实表和维度</strong>表两种。所有维度表围绕着事实表进行解释。</p>
<p>维度模型（以星型为例），表与表之间最多只做一次关联，join查询较少，shuffle较少，效率较高。</p>
<p>事实表存储的是业务事实信息</p>
<p>维度表存储的是对业务事实的描述信息</p>
<p>不管多么复杂的业务，都可以用事实表和维度表进行描述。</p>
<p>事实表中的字段分类：</p>
<ul>
<li>  各种维度表的外键，叫做<strong>维度外键</strong></li>
<li>  数字类型的字段，叫做<strong>度量值</strong></li>
</ul>
<h3 id="OLAP与OLTP对比"><a href="#OLAP与OLTP对比" class="headerlink" title="OLAP与OLTP对比"></a>OLAP与OLTP对比</h3><table>
<thead>
<tr>
<th><strong>对比属性</strong></th>
<th><strong>OLTP</strong></th>
<th><strong>OLAP</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>读特性</strong></td>
<td>每次查询只返回少量记录</td>
<td>对大量记录进行汇总</td>
</tr>
<tr>
<td><strong>写特性</strong></td>
<td>随机、低延时写入用户的输入</td>
<td>批量导入</td>
</tr>
<tr>
<td><strong>使用场景</strong></td>
<td>用户，Java EE项目</td>
<td>内部分析师，为决策提供支持</td>
</tr>
<tr>
<td><strong>数据表征</strong></td>
<td>最新数据状态</td>
<td>随时间变化的历史状态</td>
</tr>
<tr>
<td><strong>数据规模</strong></td>
<td>GB</td>
<td>TP到PB</td>
</tr>
</tbody></table>
<h2 id="维度表和事实表（重点）"><a href="#维度表和事实表（重点）" class="headerlink" title="维度表和事实表（重点）"></a>维度表和事实表（重点）</h2><h3 id="2-3-1-维度表"><a href="#2-3-1-维度表" class="headerlink" title="2.3.1 维度表"></a>2.3.1 维度表</h3><p><strong>维度表</strong>：一般是对事实的<strong>描述信息</strong>[维度表中的数据一般是对业务数据的描述信息]。每一张维表对应现实世界中的一个对象或者概念。例如：用户、商品、日期、地区等。</p>
<p><strong>维表的特征：</strong></p>
<ul>
<li>  维表的范围很宽（具有多个属性、列比较多）</li>
<li>  跟事实表相比，行数相对较小：通常&lt; 10万条</li>
<li>  内容相对固定：编码表</li>
</ul>
<p>时间维度表：</p>
<table>
<thead>
<tr>
<th>日期ID</th>
<th>day of week</th>
<th>day of year</th>
<th>季度</th>
<th>节假日</th>
</tr>
</thead>
<tbody><tr>
<td>2020-01-01</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>元旦</td>
</tr>
<tr>
<td>2020-01-02</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>无</td>
</tr>
<tr>
<td>2020-01-03</td>
<td>4</td>
<td>3</td>
<td>1</td>
<td>无</td>
</tr>
<tr>
<td>2020-01-04</td>
<td>5</td>
<td>4</td>
<td>1</td>
<td>无</td>
</tr>
<tr>
<td>2020-01-05</td>
<td>6</td>
<td>5</td>
<td>1</td>
<td>无</td>
</tr>
</tbody></table>
<h3 id="2-3-2-事实表"><a href="#2-3-2-事实表" class="headerlink" title="2.3.2 事实表"></a>2.3.2 事实表</h3><p><strong>事实表中的每行数据代表一个业务事件（下单、支付、退款、评价等）</strong>。“事实”这个术语表示的是业务事件的<strong>度量值（可统计次数、个数、金额等）</strong>，例如，2020年5月21日，宋宋老师在京东花了250块钱买了一瓶海狗人参丸。维度表：时间、用户、商品、商家。事实表：250块钱、一瓶</p>
<p>每一个事实表的行包括：具有可加性的数值型的度量值、与维表相连接的外键，通常具有两个和两个以上的外键。</p>
<p>事实表的特征：</p>
<p>Ø 非常的大（数据量比较大/行数比较多）</p>
<p>Ø 内容相对的窄：列数较少（主要是外键id和度量值）</p>
<p>Ø 经常发生变化，每天会新增加很多。</p>
<p><strong>1）事务型事实表</strong></p>
<p>以<strong>每个事务或事件为单位</strong>，例如一个销售订单记录，一笔支付记录等，作为事实表里的一行数据。一旦事务被提交，事实表数据被插入，数据就不再进行更改，其更新方式为增量更新。</p>
<p><strong>2****）周期型快照事实表</strong></p>
<p>周期型快照事实表中<strong>不会保留所有[业务操作]数据</strong>，<strong>只保留固定时间间隔的数据</strong>，例如每天或者每月的销售额，或每月的账户余额等。</p>
<p>例如购物车，有加减商品，随时都有可能变化，但是我们更关心每天结束时这里面有多少商品，方便我们后期统计分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">每日全量同步</span><br><span class="line"></span><br><span class="line">使用场景：不关心业务明细操作，只关心最终的操作结果</span><br><span class="line"></span><br><span class="line">同步策略：全量同步</span><br></pre></td></tr></table></figure>



<p><strong>3****）累积型快照事实表</strong></p>
<p><strong>累计快照事实表用于跟踪业务事实的变化。</strong>例如，数据仓库中可能需要累积或者存储订单从下订单开始，到订单商品被打包、运输、和签收的各个业务阶段的时间点数据来跟踪订单声明周期的进展情况。当这个业务过程进行时，事实表的记录也要不断更新。</p>
<table>
<thead>
<tr>
<th><strong>订单id</strong></th>
<th><strong>用户id</strong></th>
<th><strong>下单时间</strong></th>
<th><strong>打包时间</strong></th>
<th><strong>发货时间</strong></th>
<th><strong>签收时间</strong></th>
<th><strong>订单金额</strong></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td>3-8</td>
<td>3-8</td>
<td>3-9</td>
<td>3-10</td>
<td></td>
</tr>
</tbody></table>
<h2 id="1-5-雪花模型、星型模型和星座模型"><a href="#1-5-雪花模型、星型模型和星座模型" class="headerlink" title="1.5 雪花模型、星型模型和星座模型"></a>1.5 雪花模型、星型模型和星座模型</h2><p>在维度建模的基础上又分为三种模型：星型模型、雪花模型、星座模型。</p>
<p> <img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220104215355987.png" alt="image-20220104215355987"></p>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220104215433736.png" alt="image-20220104215433736"></p>
<p>雪花：对维度表进行规范化，消除数据的冗余。</p>
<hr>
<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p><strong>安装Sqoop</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">建议Sqoop和Hive安装在同一台机器上</span><br><span class="line"></span><br><span class="line">	import：MySQL ==&gt; HDFS ==&gt; Hive</span><br><span class="line">	export: ODS ==&gt; DWD ==&gt; DWS ==&gt; ADS ==&gt; MySql</span><br><span class="line">    	从导出的角度讲，Sqoop 需要和 Hive 安装在同一台机器上</span><br></pre></td></tr></table></figure>





<h1 id="离线数仓项目"><a href="#离线数仓项目" class="headerlink" title="离线数仓项目"></a>离线数仓项目</h1><p><strong>离线数仓项目Sqoop导入数据脚本</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">db_date=$2</span><br><span class="line">echo $db_date</span><br><span class="line">db_name=gmall</span><br><span class="line"></span><br><span class="line">import_data() &#123;</span><br><span class="line">/opt/module/sqoop/bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/$db_name \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--target-dir /origin_data/$db_name/db/$1/$db_date \</span><br><span class="line">--delete-target-dir \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--fields-terminated-by &quot;\t&quot; \</span><br><span class="line">--query &quot;$2&quot;&#x27; and $CONDITIONS;&#x27;</span><br><span class="line">--null-string &#x27;\\N&#x27; \</span><br><span class="line">--null-non-string &#x27;\\N&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_sku_info()&#123;</span><br><span class="line">  import_data &quot;sku_info&quot; &quot;select </span><br><span class="line">id, spu_id, price, sku_name, sku_desc, weight, tm_id,</span><br><span class="line">category3_id, create_time</span><br><span class="line">  from sku_info where 1=1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_user_info()&#123;</span><br><span class="line">  import_data &quot;user_info&quot; &quot;select </span><br><span class="line">id, name, birthday, gender, email, user_level, </span><br><span class="line">create_time </span><br><span class="line">from user_info where 1=1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_base_category1()&#123;</span><br><span class="line">  import_data &quot;base_category1&quot; &quot;select </span><br><span class="line">id, name from base_category1 where 1=1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_base_category2()&#123;</span><br><span class="line">  import_data &quot;base_category2&quot; &quot;select </span><br><span class="line">id, name, category1_id from base_category2 where 1=1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_base_category3()&#123;</span><br><span class="line">  import_data &quot;base_category3&quot; &quot;select id, name, category2_id from base_category3 where 1=1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_order_detail()&#123;</span><br><span class="line">  import_data   &quot;order_detail&quot;   &quot;select </span><br><span class="line">    od.id, </span><br><span class="line">    order_id, </span><br><span class="line">    user_id, </span><br><span class="line">    sku_id, </span><br><span class="line">    sku_name, </span><br><span class="line">    order_price, </span><br><span class="line">    sku_num, </span><br><span class="line">    o.create_time  </span><br><span class="line">  from order_info o, order_detail od</span><br><span class="line">  where o.id=od.order_id</span><br><span class="line">  and DATE_FORMAT(create_time,&#x27;%Y-%m-%d&#x27;)=&#x27;$db_date&#x27;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_payment_info()&#123;</span><br><span class="line">  import_data &quot;payment_info&quot;   &quot;select </span><br><span class="line">    id,  </span><br><span class="line">    out_trade_no, </span><br><span class="line">    order_id, </span><br><span class="line">    user_id, </span><br><span class="line">    alipay_trade_no, </span><br><span class="line">    total_amount,  </span><br><span class="line">    subject, </span><br><span class="line">    payment_type, </span><br><span class="line">    payment_time </span><br><span class="line">  from payment_info </span><br><span class="line">  where DATE_FORMAT(payment_time,&#x27;%Y-%m-%d&#x27;)=&#x27;$db_date&#x27;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import_order_info()&#123;</span><br><span class="line">  import_data   &quot;order_info&quot;   &quot;select </span><br><span class="line">    id, </span><br><span class="line">    total_amount, </span><br><span class="line">    order_status, </span><br><span class="line">    user_id, </span><br><span class="line">    payment_way, </span><br><span class="line">    out_trade_no, </span><br><span class="line">    create_time, </span><br><span class="line">    operate_time  </span><br><span class="line">  from order_info </span><br><span class="line">  where (DATE_FORMAT(create_time,&#x27;%Y-%m-%d&#x27;)=&#x27;$db_date&#x27; or DATE_FORMAT(operate_time,&#x27;%Y-%m-%d&#x27;)=&#x27;$db_date&#x27;)&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">  &quot;base_category1&quot;)</span><br><span class="line">     import_base_category1</span><br><span class="line">;;</span><br><span class="line">  &quot;base_category2&quot;)</span><br><span class="line">     import_base_category2</span><br><span class="line">;;</span><br><span class="line">  &quot;base_category3&quot;)</span><br><span class="line">     import_base_category3</span><br><span class="line">;;</span><br><span class="line">  &quot;order_info&quot;)</span><br><span class="line">     import_order_info</span><br><span class="line">;;</span><br><span class="line">  &quot;order_detail&quot;)</span><br><span class="line">     import_order_detail</span><br><span class="line">;;</span><br><span class="line">  &quot;sku_info&quot;)</span><br><span class="line">     import_sku_info</span><br><span class="line">;;</span><br><span class="line">  &quot;user_info&quot;)</span><br><span class="line">     import_user_info</span><br><span class="line">;;</span><br><span class="line">  &quot;payment_info&quot;)</span><br><span class="line">     import_payment_info</span><br><span class="line">;;</span><br><span class="line">   &quot;all&quot;)</span><br><span class="line">   import_base_category1</span><br><span class="line">   import_base_category2</span><br><span class="line">   import_base_category3</span><br><span class="line">   import_order_info</span><br><span class="line">   import_order_detail</span><br><span class="line">   import_sku_info</span><br><span class="line">   import_user_info</span><br><span class="line">   import_payment_info</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="Sqoop导入导出NULL存储一致性问题（在论文中体现）"><a href="#Sqoop导入导出NULL存储一致性问题（在论文中体现）" class="headerlink" title="Sqoop导入导出NULL存储一致性问题（在论文中体现）"></a>Sqoop导入导出NULL存储一致性问题（在论文中体现）</h2><p>Hive 中的 NULL 在底层是以 <code>\N</code> 来存储，而 MySQL 中的 Null 在底层就是 <code>Null</code>，为了保证数据两端的一致性。在导出数据时采用 <strong>–input-null-string</strong> 和 <strong>–input-null-non-string</strong> 两个参数。导入数据时采用 <strong>–null-string</strong> 和 <strong>–null-non-string</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、在 MySQL 中，NULL 值直接以 NULL 来存储</span><br><span class="line">2、在 Hive 中，NULL 的底层用 \N 来存储</span><br><span class="line"></span><br><span class="line">所以，MySQL 中的数据在导入到 Hive 之后，如果存在 NULL 值，在 Hive 中会被识别为 &#x27;NULL&#x27; 字符串。</span><br><span class="line">为了保证两端数据的一致性，在导入数据 MySQL--&gt;Hive 时采用 --null-string 和 --null-non-string。</span><br><span class="line"></span><br><span class="line">--null-string：当MySQL的字符串类型为null时，导入到Hive中时，使用某个值来代替。</span><br><span class="line">--null-string arg：如果MySQL中，当前列是字符串类型（char、varchar），假如该列值为NULL，导入到Hive中时，则使用 arg 来代替。</span><br><span class="line"></span><br><span class="line">--null-non-string arg：如果MySQL中，当前列是不是字符串类型，假如该列值为NULL，导入到Hive中时，则使用 arg 来代替。</span><br></pre></td></tr></table></figure>



<p><strong>老师讲的</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">三、在导入和导出数据时，如果源数据库有字段为NULL值，那么导入和导出后，如何也使用NULL</span><br><span class="line"></span><br><span class="line">目前：  mysql--operate_time--NULL  导入到  hdfs时， hdfs----operate_time----&#x27;null&#x27;</span><br><span class="line">希望：  mysql--operate_time--NULL  导入到  hdfs时， hdfs----operate_time----NULL</span><br><span class="line"></span><br><span class="line">需要在sqoop导入和导出的命令中添加额外的参数！</span><br><span class="line"></span><br><span class="line">①默认sqoop到import数据时，将Mysql的Null类型，转为&#x27;null&#x27;</span><br><span class="line">②hive中使用\N代表NULL类型</span><br><span class="line">③如果希望在import时，讲将Mysql的Null类型，转为自己期望的类型，</span><br><span class="line">需要使用--null-string and --null-non-string </span><br><span class="line">	--null-string：  当mysql的string类型列为null时，导入到hive时，使用什么来代替！</span><br><span class="line">		--null-string a:  如果mysql中，当前列是字符串类型(varchar,char)，假如这列值为NULL，</span><br><span class="line">							导入到hive时，使用a来代替！</span><br><span class="line">	--null-non-string： 当mysql的非string类型列为null时，导入到hive时，使用什么来代替！</span><br><span class="line">		--null-non-string b: 如果mysql中，当前列不是字符串类型(varchar,char)，假如这列值为NULL，</span><br><span class="line">							导入到hive时，使用b来代替！</span><br><span class="line">④如果到导出时，希望将指定的参数，导出为mysql的NULL类型，需要使用</span><br><span class="line">--input-null-string and --input-null-non-string </span><br><span class="line">	 --input-null-string a： 在hive导出到mysql时，如果hive中string类型的列的值为a,导出到mysql中，使用NULL代替！</span><br><span class="line">	--input-null-non-string b: 在hive导出到mysql时，如果hive中非string类型的列的值为b,导出到mysql中，使用NULL代替！</span><br></pre></td></tr></table></figure>



<h2 id="DWD层建表"><a href="#DWD层建表" class="headerlink" title="DWD层建表"></a>DWD层建表</h2><p>老师讲的支持 snappy，我没有做，因此建表语句将会发生一些变化</p>
<ul>
<li>  <strong>创建订单表</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists dwd_order_info;</span><br><span class="line">create external table dwd_order_info (</span><br><span class="line">    `id` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `total_amount` decimal(10,2) COMMENT &#x27;&#x27;,</span><br><span class="line">    `order_status` string COMMENT &#x27; 1 2 3 4 5&#x27;,</span><br><span class="line">    `user_id` string COMMENT &#x27;id&#x27;,</span><br><span class="line">    `payment_way` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `out_trade_no` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `create_time` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `operate_time` string COMMENT &#x27;&#x27;</span><br><span class="line">) </span><br><span class="line">PARTITIONED BY (`dt` string)</span><br><span class="line">location &#x27;/warehouse/gmall/dwd/dwd_order_info/&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>  创建订单详情表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists dwd_order_detail;</span><br><span class="line">create external table dwd_order_detail( </span><br><span class="line">    `id` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `order_id` decimal(10,2) COMMENT &#x27;&#x27;, </span><br><span class="line">    `user_id` string COMMENT &#x27;id&#x27;,</span><br><span class="line">    `sku_id` string COMMENT &#x27;id&#x27;,</span><br><span class="line">    `sku_name` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `order_price` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `sku_num` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `create_time` string COMMENT &#x27;&#x27;</span><br><span class="line">)</span><br><span class="line">PARTITIONED BY (`dt` string)</span><br><span class="line">location &#x27;/warehouse/gmall/dwd/dwd_order_detail/&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>  创建用户表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists dwd_user_info;</span><br><span class="line">create external table dwd_user_info( </span><br><span class="line">    `id` string COMMENT &#x27;id&#x27;,</span><br><span class="line">    `name` string COMMENT &#x27;&#x27;, </span><br><span class="line">    `birthday` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `gender` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `email` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `user_level` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `create_time` string COMMENT &#x27;&#x27;</span><br><span class="line">) </span><br><span class="line">PARTITIONED BY (`dt` string)</span><br><span class="line">location &#x27;/warehouse/gmall/dwd/dwd_user_info/&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>  创建支付流水表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists dwd_payment_info;</span><br><span class="line">create external table dwd_payment_info(</span><br><span class="line">    `id`   bigint COMMENT &#x27;&#x27;,</span><br><span class="line">    `out_trade_no`    string COMMENT &#x27;&#x27;,</span><br><span class="line">    `order_id`        string COMMENT &#x27;&#x27;,</span><br><span class="line">    `user_id`         string COMMENT &#x27;&#x27;,</span><br><span class="line">    `alipay_trade_no` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `total_amount`    decimal(16,2) COMMENT &#x27;&#x27;,</span><br><span class="line">    `subject`         string COMMENT &#x27;&#x27;,</span><br><span class="line">    `payment_tpe`    string COMMENT &#x27;&#x27;,</span><br><span class="line">    `payment_time`    string COMMENT &#x27;&#x27;</span><br><span class="line">   )  </span><br><span class="line">PARTITIONED BY (`dt` string)</span><br><span class="line">location &#x27;/warehouse/gmall/dwd/dwd_payment_info/&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>  创建商品表（增加分类）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists dwd_sku_info;</span><br><span class="line">create external table dwd_sku_info(</span><br><span class="line">    `id` string COMMENT &#x27;skuId&#x27;,</span><br><span class="line">    `spu_id` string COMMENT &#x27;spuid&#x27;,</span><br><span class="line">    `price` decimal(10,2) COMMENT &#x27;&#x27;,</span><br><span class="line">    `sku_name` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `sku_desc` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `weight` string COMMENT &#x27;&#x27;,</span><br><span class="line">    `tm_id` string COMMENT &#x27;id&#x27;,</span><br><span class="line">    `category3_id` string COMMENT &#x27;1id&#x27;,</span><br><span class="line">    `category2_id` string COMMENT &#x27;2id&#x27;,</span><br><span class="line">    `category1_id` string COMMENT &#x27;3id&#x27;,</span><br><span class="line">    `category3_name` string COMMENT &#x27;3&#x27;,</span><br><span class="line">    `category2_name` string COMMENT &#x27;2&#x27;,</span><br><span class="line">    `category1_name` string COMMENT &#x27;1&#x27;,</span><br><span class="line">    `create_time` string COMMENT &#x27;&#x27;</span><br><span class="line">) </span><br><span class="line">PARTITIONED BY (`dt` string)</span><br><span class="line">location &#x27;/warehouse/gmall/dwd/dwd_sku_info/&#x27;;</span><br></pre></td></tr></table></figure>





<h2 id="DWD层"><a href="#DWD层" class="headerlink" title="DWD层"></a>DWD层</h2><p>对ODS层数据进行轻度聚合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DWD层（8张表）--&gt;ODS层（5张表）</span><br><span class="line"></span><br><span class="line">商品表及其分类表 --&gt; 一张表</span><br><span class="line"></span><br><span class="line">原先：需要多次join</span><br><span class="line">数仓中：维度建模，将商品相关的一个实体表和三张维度表放入到一张宽表/降维表中。（这个操作叫做降维）</span><br></pre></td></tr></table></figure>





<p><strong>向DWD层导入降维后的数据（SQL）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 需求：DWD层降维后的商品表</span><br><span class="line"></span><br><span class="line"># 相关表（先从下面这四张表中取出数据）</span><br><span class="line">ods_base_category1</span><br><span class="line">ods_base_category2</span><br><span class="line">ods_base_category3</span><br><span class="line">ods_sku_info</span><br><span class="line"></span><br><span class="line"># 思路：通过四张表关联，将和商品相关的1、2、3级分类信息汇总，插入到降维后的商品表 dwd_sku_info 中</span><br><span class="line">insert overwrite table dwd_sku_info PARTITION(dt=&#x27;2020-02-11&#x27;)</span><br><span class="line">SELECT </span><br><span class="line">t1.id, t1.spu_id, t1.price,</span><br><span class="line">t1.sku_name, </span><br><span class="line">t1.sku_desc, </span><br><span class="line">t1.weight, </span><br><span class="line">t1.tm_id, </span><br><span class="line">t1.category3_id,</span><br><span class="line">t3.id category2_id, </span><br><span class="line">t4.id category1_id,</span><br><span class="line">t2.name category3_name,</span><br><span class="line">t3.name category2_name,</span><br><span class="line">t4.name category1_name,</span><br><span class="line">t1.create_time</span><br><span class="line">FROM </span><br><span class="line">(select * from ods_sku_info where dt=&#x27;2020-02-11&#x27;) t1 </span><br><span class="line">join </span><br><span class="line">(select * from ods_base_category3 where dt=&#x27;2020-02-11&#x27;) t2 </span><br><span class="line">on t1.category3_id=t2.id </span><br><span class="line">join </span><br><span class="line">(select * from ods_base_category2 where dt=&#x27;2020-02-11&#x27;) t3</span><br><span class="line">on t2.category2_id=t3.id</span><br><span class="line">join</span><br><span class="line">(select * from ods_base_category1 where dt=&#x27;2020-02-11&#x27; )t4</span><br><span class="line">on t3.category1_id=t4.id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>将导入数据的SQL生成脚本文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义变量方便修改</span></span><br><span class="line">APP=gmall</span><br><span class="line">hive=/opt/module/hive/bin/hive</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">	do_date=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	do_date=`<span class="built_in">date</span> -d <span class="string">&quot;-1 day&quot;</span> +%F`  </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">sql=<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set hive.exec.dynamic.partition.mode=nonstrict;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">insert overwrite table &quot;</span><span class="variable">$APP</span><span class="string">&quot;.dwd_order_info partition(dt)</span></span><br><span class="line"><span class="string">select * from &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_order_info </span></span><br><span class="line"><span class="string">where dt=&#x27;<span class="variable">$do_date</span>&#x27; and id is not null;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">insert overwrite table &quot;</span><span class="variable">$APP</span><span class="string">&quot;.dwd_order_detail partition(dt)</span></span><br><span class="line"><span class="string">select * from &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_order_detail </span></span><br><span class="line"><span class="string">where dt=&#x27;<span class="variable">$do_date</span>&#x27;   and id is not null;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">insert overwrite table &quot;</span><span class="variable">$APP</span><span class="string">&quot;.dwd_user_info partition(dt)</span></span><br><span class="line"><span class="string">select * from &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_user_info</span></span><br><span class="line"><span class="string">where dt=&#x27;<span class="variable">$do_date</span>&#x27; and id is not null;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">insert overwrite table &quot;</span><span class="variable">$APP</span><span class="string">&quot;.dwd_payment_info partition(dt)</span></span><br><span class="line"><span class="string">select * from &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_payment_info</span></span><br><span class="line"><span class="string">where dt=&#x27;<span class="variable">$do_date</span>&#x27; and id is not null;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">insert overwrite table &quot;</span><span class="variable">$APP</span><span class="string">&quot;.dwd_sku_info partition(dt)</span></span><br><span class="line"><span class="string">select  </span></span><br><span class="line"><span class="string">    sku.id,</span></span><br><span class="line"><span class="string">    sku.spu_id,</span></span><br><span class="line"><span class="string">    sku.price,</span></span><br><span class="line"><span class="string">    sku.sku_name,</span></span><br><span class="line"><span class="string">    sku.sku_desc,</span></span><br><span class="line"><span class="string">    sku.weight,</span></span><br><span class="line"><span class="string">    sku.tm_id,</span></span><br><span class="line"><span class="string">    sku.category3_id,</span></span><br><span class="line"><span class="string">    c2.id category2_id,</span></span><br><span class="line"><span class="string">    c1.id category1_id,</span></span><br><span class="line"><span class="string">    c3.name category3_name,</span></span><br><span class="line"><span class="string">    c2.name category2_name,</span></span><br><span class="line"><span class="string">    c1.name category1_name,</span></span><br><span class="line"><span class="string">    sku.create_time,</span></span><br><span class="line"><span class="string">    sku.dt</span></span><br><span class="line"><span class="string">from</span></span><br><span class="line"><span class="string">    &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_sku_info sku</span></span><br><span class="line"><span class="string">join &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_base_category3 c3 on sku.category3_id=c3.id </span></span><br><span class="line"><span class="string">    join &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_base_category2 c2 on c3.category2_id=c2.id </span></span><br><span class="line"><span class="string">    join &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ods_base_category1 c1 on c2.category1_id=c1.id </span></span><br><span class="line"><span class="string">where sku.dt=&#x27;<span class="variable">$do_date</span>&#x27;  and c2.dt=&#x27;<span class="variable">$do_date</span>&#x27;</span></span><br><span class="line"><span class="string">and c3.dt=&#x27;<span class="variable">$do_date</span>&#x27; and c1.dt=&#x27;<span class="variable">$do_date</span>&#x27;</span></span><br><span class="line"><span class="string">and sku.id is not null;</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$hive</span> -e <span class="string">&quot;<span class="variable">$sql</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="创建用户在电商业务中的行为宽表"><a href="#创建用户在电商业务中的行为宽表" class="headerlink" title="创建用户在电商业务中的行为宽表"></a>创建用户在电商业务中的行为宽表</h3><h4 id="创建用户行为宽表"><a href="#创建用户行为宽表" class="headerlink" title="创建用户行为宽表"></a>创建用户行为宽表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists dws_user_action;</span><br><span class="line">create external table dws_user_action </span><br><span class="line">(   </span><br><span class="line">    user_id          string      comment &#x27;用户 id&#x27;,</span><br><span class="line">    order_count     bigint      comment &#x27;下单次数 &#x27;,</span><br><span class="line">    order_amount    decimal(16,2)  comment &#x27;下单金额 &#x27;,</span><br><span class="line">    payment_count   bigint      comment &#x27;支付次数&#x27;,</span><br><span class="line">    payment_amount  decimal(16,2) comment &#x27;支付金额 &#x27;</span><br><span class="line">) COMMENT &#x27;每日用户行为宽表&#x27;</span><br><span class="line">PARTITIONED BY (`dt` string)</span><br><span class="line">location &#x27;/warehouse/gmall/dws/dws_user_action/&#x27;;</span><br></pre></td></tr></table></figure>



<p><strong>需求：dws_user_action</strong>：创建用户在电商业务中的行为宽表，统计每个用户每天的</p>
<ol>
<li> 下单总数</li>
<li> 下单总金额</li>
<li> 支付总数</li>
<li> 支付总金额</li>
<li> 和评论次数（不要了）</li>
</ol>
<p><strong>相关表：</strong></p>
<ul>
<li>  dwd_order_info： 取user_id(用户)，total_amount(当前订单金额)</li>
<li>  dwd_payment_info： 取user_id(用户)，total_amount(当前支付金额)</li>
<li>  dwd_comment_log： 取user_id(用户)，统计评论次数，<code>不要了</code></li>
</ul>
<p><strong>注意：</strong>最后拼接结果集时，不能使用 inner join!</p>
<ul>
<li>  因为三个结果集中，可能存在差异（只存在在t3，不在t2,t1中），需要使用full join!</li>
<li>  如果不使用 join，则需要使用 union all</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite TABLE dws_user_action PARTITION(dt=&#x27;2020-02-11&#x27;)</span><br><span class="line">select</span><br><span class="line">    user_id,</span><br><span class="line">    sum(order_count),</span><br><span class="line">    sum(order_amount),</span><br><span class="line">    sum(payment_count),</span><br><span class="line">    sum(payment_amount)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">    select </span><br><span class="line">    	user_id,</span><br><span class="line">    	count(*) order_count,</span><br><span class="line">    	sum(total_amount) order_amount,</span><br><span class="line">    	0 payment_count,</span><br><span class="line">    	0 payment_amount</span><br><span class="line">    from dwd_order_info</span><br><span class="line">    where dt=&#x27;2020-02-11&#x27;</span><br><span class="line">    GROUP by user_id</span><br><span class="line">    </span><br><span class="line">    union all</span><br><span class="line"></span><br><span class="line">    select </span><br><span class="line">    	user_id,</span><br><span class="line">    	0 order_count,</span><br><span class="line">    	0 order_amount,</span><br><span class="line">    	count(*) payment_count,</span><br><span class="line">    	sum(total_amount) payment_amount</span><br><span class="line">	from dwd_payment_info</span><br><span class="line">    where dt=&#x27;2020-02-11&#x27;</span><br><span class="line">    GROUP by user_id</span><br><span class="line">) tmp</span><br><span class="line">GROUP by user_id</span><br></pre></td></tr></table></figure>





<p><strong>转换生成脚本文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义变量方便修改</span></span><br><span class="line">APP=gmall</span><br><span class="line">hive=/opt/module/hive/bin/hive</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">	do_date=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	do_date=`<span class="built_in">date</span> -d <span class="string">&quot;-1 day&quot;</span> +%F`  </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">sql=<span class="string">&quot;</span></span><br><span class="line"><span class="string">insert overwrite TABLE dws_user_action PARTITION(dt=&#x27;<span class="variable">$do_date</span>&#x27;)</span></span><br><span class="line"><span class="string">select</span></span><br><span class="line"><span class="string">    user_id,</span></span><br><span class="line"><span class="string">    sum(order_count),</span></span><br><span class="line"><span class="string">    sum(order_amount),</span></span><br><span class="line"><span class="string">    sum(payment_count),</span></span><br><span class="line"><span class="string">    sum(payment_amount)</span></span><br><span class="line"><span class="string">from</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">    select </span></span><br><span class="line"><span class="string">    	user_id,</span></span><br><span class="line"><span class="string">    	count(*) order_count,</span></span><br><span class="line"><span class="string">    	sum(total_amount) order_amount,</span></span><br><span class="line"><span class="string">    	0 payment_count,</span></span><br><span class="line"><span class="string">    	0 payment_amount</span></span><br><span class="line"><span class="string">    from dwd_order_info</span></span><br><span class="line"><span class="string">    where dt=&#x27;<span class="variable">$do_date</span>&#x27;</span></span><br><span class="line"><span class="string">    GROUP by user_id</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    union all</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    select </span></span><br><span class="line"><span class="string">    	user_id,</span></span><br><span class="line"><span class="string">    	0 order_count,</span></span><br><span class="line"><span class="string">    	0 order_amount,</span></span><br><span class="line"><span class="string">    	count(*) payment_count,</span></span><br><span class="line"><span class="string">    	sum(total_amount) payment_amount</span></span><br><span class="line"><span class="string">	from dwd_payment_info</span></span><br><span class="line"><span class="string">    where dt=&#x27;<span class="variable">$do_date</span>&#x27;</span></span><br><span class="line"><span class="string">    GROUP by user_id</span></span><br><span class="line"><span class="string">) tmp</span></span><br><span class="line"><span class="string">GROUP by user_id</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$hive</span> -e <span class="string">&quot;<span class="variable">$sql</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="需求一：GMV成交总额"><a href="#需求一：GMV成交总额" class="headerlink" title="需求一：GMV成交总额"></a>需求一：GMV成交总额</h2><p>ADS层：面向业务的一层</p>
<p>流程：</p>
<ol>
<li> 建立 ADS 层的表</li>
<li> 将查询得到的数据写入到表中</li>
</ol>
<p><strong>建表</strong>：统计每天的 GMV 总额</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hive (gmall)&gt;</span><br><span class="line">drop table if exists ads_gmv_sum_day;</span><br><span class="line">create external table ads_gmv_sum_day(</span><br><span class="line">    `dt` string COMMENT &#x27;统计日期&#x27;,</span><br><span class="line">    `gmv_count`  bigint COMMENT &#x27;当日gmv订单个数&#x27;,</span><br><span class="line">    `gmv_amount`  decimal(16,2) COMMENT &#x27;当日gmv订单总金额&#x27;,</span><br><span class="line">    `gmv_payment`  decimal(16,2) COMMENT &#x27;当日支付金额&#x27;</span><br><span class="line">) COMMENT &#x27;GMV&#x27;</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;</span><br><span class="line">location &#x27;/warehouse/gmall/ads/ads_gmv_sum_day/&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>向新表中插入从宽表中得到的数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use gmall;</span><br><span class="line">INSERT INTO TABLE  ads_gmv_sum_day</span><br><span class="line">SELECT </span><br><span class="line">	&#x27;2020-02-11&#x27;,</span><br><span class="line">	SUM(order_count) AS gmv_count,</span><br><span class="line">	SUM(order_amount) AS gmv_amount,</span><br><span class="line">	SUM(payment_amount) AS gmv_payment</span><br><span class="line">FROM dws_user_action</span><br><span class="line">WHERE dt=&#x27;2020-02-11&#x27;</span><br><span class="line">group by dt;</span><br></pre></td></tr></table></figure>



<p><strong>制作成脚本</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义变量方便修改</span></span><br><span class="line">APP=gmall</span><br><span class="line">hive=/opt/module/hive/bin/hive</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">	do_date=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	do_date=`<span class="built_in">date</span> -d <span class="string">&quot;-1 day&quot;</span> +%F`</span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">sql=<span class="string">&quot;</span></span><br><span class="line"><span class="string">insert into table &quot;</span><span class="variable">$APP</span><span class="string">&quot;.ads_gmv_sum_day </span></span><br><span class="line"><span class="string">select </span></span><br><span class="line"><span class="string">    &#x27;<span class="variable">$do_date</span>&#x27; dt,</span></span><br><span class="line"><span class="string">    sum(order_count)  gmv_count,</span></span><br><span class="line"><span class="string">    sum(order_amount) gmv_amount,</span></span><br><span class="line"><span class="string">    sum(payment_amount) payment_amount </span></span><br><span class="line"><span class="string">from &quot;</span><span class="variable">$APP</span><span class="string">&quot;.dws_user_action </span></span><br><span class="line"><span class="string">where dt =&#x27;<span class="variable">$do_date</span>&#x27;</span></span><br><span class="line"><span class="string">group by dt;</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$hive</span> -e <span class="string">&quot;<span class="variable">$sql</span>&quot;</span></span><br></pre></td></tr></table></figure>





<h2 id="需求二：转化率之用户新鲜度及漏斗分析（不做）"><a href="#需求二：转化率之用户新鲜度及漏斗分析（不做）" class="headerlink" title="需求二：转化率之用户新鲜度及漏斗分析（不做）"></a>需求二：转化率之用户新鲜度及漏斗分析（不做）</h2><hr>
<h1 id="数据仓库分层"><a href="#数据仓库分层" class="headerlink" title="数据仓库分层"></a>数据仓库分层</h1><blockquote>
<ol>
<li>什么是数据分层？</li>
<li>数据分层的好处</li>
<li>一种通用的数据分层设计举例</li>
<li>各层会用到的计算引擎和存储系统</li>
<li>分层实现</li>
<li>数据分层的一些概念说明</li>
<li>大数据相关基础概念</li>
</ol>
</blockquote>
<h2 id="一、什么是数据分层？"><a href="#一、什么是数据分层？" class="headerlink" title="一、什么是数据分层？"></a>一、什么是数据分层？</h2><p>数据分层是一套行之有效的数据组织和管理方法，使得数据体系更有序。</p>
<h2 id="二、数据分层的好处"><a href="#二、数据分层的好处" class="headerlink" title="二、数据分层的好处"></a>二、数据分层的好处</h2><ol>
<li> 清晰数据结构：每一个数据分层都有它的作用域和职责，在使用表的时候能更方便的定位和理解。</li>
<li> 减少重复开发：规范数据分层，开发一些通用的中间层数据，能够减少极大的重复计算。</li>
<li> 统一数据口径：通过数据分层，提供统一的数据出口，统一对外输出的数据口径。</li>
<li> 复杂问题简单化：将一个复杂的任务分解成多个步骤完成，每一层解决特定的问题。</li>
</ol>
<h2 id="三、一种通用的数据分层设计"><a href="#三、一种通用的数据分层设计" class="headerlink" title="三、一种通用的数据分层设计"></a>三、一种通用的数据分层设计</h2><ul>
<li>  ODS：存放原始数据</li>
<li>  DW：存放数仓中间层数据</li>
<li>  APP：面向业务定制的应用数据</li>
</ul>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_1_20200103045352770" alt="大数据之数据仓库分层"></p>
<h2 id="三、举例"><a href="#三、举例" class="headerlink" title="三、举例"></a>三、举例</h2><p>以下是一个电商网站的数据体系设计，只关注用户访问日志这部分数据。</p>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_2_20200103045352832" alt="大数据之数据仓库分层"></p>
<h2 id="四、各层会用到的计算引擎和存储系统"><a href="#四、各层会用到的计算引擎和存储系统" class="headerlink" title="四、各层会用到的计算引擎和存储系统"></a>四、各层会用到的计算引擎和存储系统</h2><p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_3_202001030453534" alt="大数据之数据仓库分层"></p>
<h2 id="五、分层实现"><a href="#五、分层实现" class="headerlink" title="五、分层实现"></a>五、分层实现</h2><p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_4_2020010304535367" alt="大数据之数据仓库分层"></p>
<p>在确定建模思路和模型类型之后，下一步的工作是数据分层。数据分层可以使得数据构建体系更加清晰，便于数据使用者快速对数据进行定位；同时数据分层也可以简化数据加工处理流程，降低计算复杂度。</p>
<p>我们常用的数据仓库的数据分层通常分为集市层、中间层、基础数据层上下三层结构。由传统的多层结构减少到上下三层结构的目的是为了压缩整体数据处理流程的长度，同时扁平化的数据处理流程有助于数据质量控制和数据运维。</p>
<p>在上下三层的结构的右侧，我们增加了流式数据，将其添加成数据体系的一部分。这是因为当前的数据应用方向会越来越关注数据的时效性，越实时的数据价值度越高。</p>
<p>但是，由于流式数据集的采集、加工和管理的成本较高，一般都会按照需求驱动的方式建设；此外，考虑到成本因素，流式数据体系的结构更加扁平化，通常不会设计中间层。</p>
<p>下面来具体看下每一层的具体作用。</p>
<p><strong>数据基础层</strong></p>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_5_20200103045353113" alt="大数据之数据仓库分层"></p>
<p>数据基础层主要完成的工作包括以下几点：</p>
<ul>
<li>  数据采集：把不同数据源的数据统一采集到一个平台上；</li>
<li>  数据清洗，清洗不符合质量要求的数据，避免脏数据参与后续数据计算；</li>
<li>  数据归类，建立数据目录，在基础层一般按照来源系统和业务域进行分类；</li>
<li>  数据结构化，对于半结构化和非结构化的数据，进行结构化；</li>
<li>  数据规范化，包括规范维度标识、统一计量单位等规范化操作。</li>
</ul>
<p><strong>数据中间层</strong></p>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_6_20200103045353176" alt="大数据之数据仓库分层"></p>
<p>数据中间层最为重要的目标就是把同一实体不同来源的数据打通起来，这是因为当前业务形态下，同一实体的数据可能分散在不同的系统和来源，且这些数据对同一实体的标识符可能不同。此外，数据中间层还可以从行为中抽象关系。从行为中抽象出来的基础关系，会是未来上层应用一个很重要的数据依赖。例如抽象出的兴趣、偏好、习惯等关系数据是推荐、个性化的基础生产资料。</p>
<p>在中间层，为了保证主题的完整性或提高数据的易用性，经常会进行适当的数据冗余。比如某一实事数据和两个主题相关但自身又没有成为独立主题，则会放在两个主题库中；为了提高单数据表的复用性和减少计算关联，通常会在事实表中冗余部分维度信息。</p>
<p><strong>数据集市层</strong></p>
<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/179455377_7_20200103045353238" alt="大数据之数据仓库分层"></p>
<p>数据集市层是上下三层架构的最上层，通常是由需求场景驱动建设的，并且各集市间垂直构造。在数据集市层，我们可以深度挖掘数据价值。值得注意的是，数据集市层需要能够快速试错。</p>
<p><strong>数据架构</strong></p>
<p>数据架构包括数据整合、数据体系、数据服务三部分。其中，数据整合又可以分为结构化、半结构化、非结构化三类。</p>
<ul>
<li><strong>数据整合</strong><ul>
<li>  结构化数据采集又可细分为全量采集、增量采集、实时采集三类。三种采集方式的各自特点和适应场合如上图所示，其中全量采集的方式最为简单；实时采集的采集质量最难控制。</li>
<li>  在传统的架构中，日志的结构化处理是放在数仓体系之外的。在大数据平台仓库架构中，日志在采集到平台之前不做结构化处理；在大数据平台上按行符分割每条日志，整条日志存储在一个数据表字段；后续，通过UDF或MR计算框架实现日志结构化。</li>
<li>  在我们看来，日志结构越规范，解析成本越低。在日志结构化的过程中，并不一定需要完全平铺数据内容，只需结构化出重要常用字段；同时，为了保障扩展性，我们可以利用数据冗余保存原始符合字段（如useragent字段）。</li>
<li>  非结构化的数据需要结构化才能使用。非结构化数据特征提取包括语音转文本、图片识别、自然语言处理、图片达标、视频识别等方式。尽管目前数仓架构体系中并不包含非结构化数据特征提取操作，但在未来，这将成为可能。</li>
</ul>
</li>
<li><strong>数据服务化</strong>：数据服务化包括统计服务、分析服务和标签服务：<ul>
<li>  统计服务主要是偏传统的报表服务，利用大数据平台将数据加工后的结果放入关系型数据库中，供前端的报表系统或业务系统查询；</li>
<li>  分析服务用来提供明细的事实数据，利用大数据平台的实时计算能力，允许操作人员自主灵活的进行各种维度的交叉组合查询。分析服务的能力类似于传统cube提供的内容，但是在大数据平台下不需要预先建好cube，更灵活、更节省成本；</li>
<li>  标签服务，大数据的应用场景下，经常会对主体进行特征刻画，比如客户的消费能力、兴趣习惯、物理特征等等，这些数据通过打标签转换成KV的数据服务，用于前端应用查询。</li>
</ul>
</li>
</ul>
<h2 id="六、数据分层的一些概念说明"><a href="#六、数据分层的一些概念说明" class="headerlink" title="六、数据分层的一些概念说明"></a>六、数据分层的一些概念说明</h2><p>大数据数据仓库是基于HIVE构建的数据仓库，分布文件系统为HDFS，资源管理为Yarn，计算引擎主要包括MapReduce/Tez/Spark等，分层架构说明如下：</p>
<ol>
<li> 数据来源层：日志或者关系型数据库，并通过Flume、Sqoop、Kettle等etl工具导入到HDFS，并映射到HIVE的数据仓库表中。</li>
<li> 事实表是数据仓库结构中的中央表，它包含联系事实与维度表的数字度量值和键。事实数据表包含描述业务（例如产品销售）内特定事件的数据。</li>
<li> 维度表是维度属性的集合。是分析问题的一个窗口。是人们观察数据的特定角度，是考虑问题时的一类属性，属性的集合构成一个维。数据库结构中的星型结构，该结构在位于结构中心的单个事实数据表中维护数据，其它维度数据存储在维度表中。每个维度表与事实数据表直接相关，且通常通过一个键联接到事实数据表中。星型架构是数据仓库比较流向的一种架构。</li>
</ol>
<p>星型模式的基本思想就是保持立方体的多维功能，同时也增加了小规模数据存储的灵活性。</p>
<p><strong>说明：</strong></p>
<p>1)、事实表就是你要关注的内容；</p>
<p>2)、维度表就是你观察该事务的角度，是从哪个角度去观察这个内容的。</p>
<p>例如，某地区商品的销量，是从地区这个角度观察商品销量的。事实表就是销量表，维度表就是地区表</p>
<ol start="4">
<li><p>主题表：主题（Subject）是在较高层次上将企业信息系统中的数据进行综合、归类和分析利用的一个抽象概念，每一个主题基本对应一个宏观的分析领域。在逻辑意义上，它是对应企业中某一宏观分析领域所涉及的分析对象。例如“销售分析”就是一个分析领域，因此这个数据仓库应用的主题就是“销售分析”。</p>
<p> 面向主题的数据组织方式，就是在较高层次上对分析对象数据的一个完整并且一致的描述，能刻画各个分析对象所涉及的企业各项数据，以及数据之间的联系。所谓较高层次是相对面向应用的数据组织方式而言的，是指按照主题进行数据组织的方式具有更高的数据抽象级别。与传统数据库面向应用进行数据组织的特点相对应，数据仓库中的数据是面向主题进行组织的。例如，一个生产企业的数据仓库所组织的主题可能有产品订货分析和货物发运分析等。而按应用来组织则可能为财务子系统、销售子系统、供应子系统、人力资源子系统和生产调度子系统。</p>
</li>
<li><p> 汇总数据层：聚合原子粒度事实表及维度表，为满足固定分析需求，以提高查询性能为目的，形成的高粒度表，如周报、月报、季报、年报等。</p>
</li>
<li><p> 应用层：这层数据是完全为了满足具体的分析需求而构建的数据，也是星形结构的数据。应用层为前端应用的展现提现数据，可以为关系型数据库组成。</p>
</li>
<li><p>【补充】数据缓存层：</p>
<p> 用于存放接口方提供的原始数据的数据库层，此层的表结构与源数据保持基本一致，数据存放时间根据数据量大小和项目情况而定，如果数据量较大，可以只存近期数据，将历史数据进行备份。此层的目的在于数据的中转和备份。</p>
<p> 临时数据表层：</p>
<p> 存放临时测试数据表（Temp表），或者中间结果集的表。</p>
</li>
</ol>
<h2 id="七、大数据相关基础概念"><a href="#七、大数据相关基础概念" class="headerlink" title="七、大数据相关基础概念"></a>七、大数据相关基础概念</h2><blockquote>
<p>  数据源：业务系统、埋点、爬虫</p>
</blockquote>
<p>PG：PostgreSQL,一种关系型数据库</p>
<p>Sqoop：是一个在结构化数据(mysql/oracle)和Hadoop(Hive)之间进行批量数据迁移的工具</p>
<p>Flume：是一个分布式、可靠、高可用的海量日志采集、聚合和传输的系统。支持在日志系统中定制各类数据发送方，用于收集数据；提供对数据进行简单处理，并写到各种数据接受方（HDFS\Hbase）的能力。</p>
<p>Kafka：是一个分布式、支持分区的、多副本的，基于zookeeper协调的分布式消息系统。</p>
<p>Flink：一个流式的数据流执行引擎。针对数据流的分布式计算提供了数据分布、数据通信以及容错机制等功能。</p>
<p>Kylin：是一个开源的分布式分析引擎，提供Hadoop/Spark之上的SQL查询接口及多维分析（OLAP）能力一直吃超大规模数据。能在亚秒内查询巨大的Hive表。</p>
<p>ES：elasticsSearch,是一个高扩展、开源的全文检索和分析引擎，可准实时地快速存储、搜索、分析海量的数据。</p>
<p>Hadoop：是一个分布式系统基础架构，可使用户在不了解分布式底层细节的情况下开发分布式程序，充分利用集群的威力进行高速运算和存储。两大核心：HDFS\MapReduce</p>
<p>HDFS：是可扩展、容错、高性能的分布式文件系统，异步复制，一次写入多次读取，主要负责存储。</p>
<p>MapReduce：分布式计算框架。</p>
<p>Spark：是一个专为大规模数据处理而设计的快速通用的计算引擎。</p>
<hr>
<h1 id="数据仓库分层-1"><a href="#数据仓库分层-1" class="headerlink" title="数据仓库分层"></a>数据仓库分层</h1><p>数仓中的每一层都需要解决这样两个问题：</p>
<ol>
<li><p> 确定要创建哪些表</p>
</li>
<li><p>确定每张表的表结构</p>
<ul>
<li>  确定每行数据的含义</li>
<li>  确定表的字段</li>
<li>  确定表的分区规划</li>
</ul>
</li>
</ol>
<p>提高数据的复用性，避免重复计算</p>
<h1 id="毕设实战"><a href="#毕设实战" class="headerlink" title="毕设实战"></a>毕设实战</h1><h2 id="Sqoop导入数据"><a href="#Sqoop导入数据" class="headerlink" title="Sqoop导入数据"></a>Sqoop导入数据</h2><ol>
<li><p>ods_base_material</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_material \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_material</span><br></pre></td></tr></table></figure>

</li>
<li><p>ods_base_material_type</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_material_type \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_material_type</span><br></pre></td></tr></table></figure>

</li>
<li><p>ods_base_province</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_province \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_province</span><br></pre></td></tr></table></figure>

</li>
<li><p>ods_base_region</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_region \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_region</span><br></pre></td></tr></table></figure>

</li>
<li><p>ods_base_screw</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_screw \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_screw</span><br></pre></td></tr></table></figure>

</li>
<li><p>ods_base_spud_type</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_spud_type \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_spud_type</span><br></pre></td></tr></table></figure></li>
<li><p>ods_base_company</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table base_company \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_base_company</span><br></pre></td></tr></table></figure></li>
<li><p>ods_environment</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table environment \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_environment</span><br></pre></td></tr></table></figure></li>
<li><p>ods_final_product</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table final_product \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_final_product</span><br></pre></td></tr></table></figure></li>
<li><p>ods_geo_type</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table geo_type \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_geo_type</span><br></pre></td></tr></table></figure></li>
<li><p>ods_material_list</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table material_list \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_material_list</span><br></pre></td></tr></table></figure></li>
<li><p>ods_mud</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table mud \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_mud</span><br></pre></td></tr></table></figure></li>
<li><p>ods_rock_type</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table rock_type \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_rock_type</span><br></pre></td></tr></table></figure></li>
<li><p>ods_spud_num</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table spud_num \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_spud_num</span><br></pre></td></tr></table></figure></li>
<li><p>ods_store_record</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table store_record \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_store_record</span><br></pre></td></tr></table></figure></li>
<li><p>ods_warehouse</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table warehouse \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_warehouse</span><br></pre></td></tr></table></figure></li>
<li><p>ods_well</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table well \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_well</span><br></pre></td></tr></table></figure></li>
<li><p>ods_well_type</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table well_type \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table material.ods_well_type</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Sqoop导出数据"><a href="#Sqoop导出数据" class="headerlink" title="Sqoop导出数据"></a>Sqoop导出数据</h2><ol>
<li><p>app_company_use</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqoop <span class="built_in">export</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material_res \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table company_use \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--export-dir /warehouse/material/app/app_company_use \</span><br><span class="line">--input-fields-terminated-by <span class="string">&quot;\t&quot;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>app_warehouse_use</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqoop <span class="built_in">export</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material_res \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table warehouse_use \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--export-dir /warehouse/material/app/app_warehouse_use \</span><br><span class="line">--input-fields-terminated-by <span class="string">&quot;\t&quot;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>app_well_use</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqoop <span class="built_in">export</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/material_res \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table well_use \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--export-dir /warehouse/material/app/app_well_use \</span><br><span class="line">--input-fields-terminated-by <span class="string">&quot;\t&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS dwd_material_use;</span><br><span class="line">CREATE EXTERNAL TABLE dwd_material_use(</span><br><span class="line">    id INT COMMENT &#x27;编号&#x27;,</span><br><span class="line">    company_id INT COMMENT &#x27;公司id&#x27;,</span><br><span class="line">    warehouse_id INT COMMENT &#x27;仓库id&#x27;,</span><br><span class="line">    material_id INT COMMENT &#x27;物料id&#x27;,</span><br><span class="line">    operator_id INT COMMENT &#x27;操作者id&#x27;,</span><br><span class="line">    well_id INT COMMENT &#x27;井id&#x27;,</span><br><span class="line">    type INT COMMENT &#x27;出库为0，入库为1&#x27;,</span><br><span class="line">    num INT COMMENT &#x27;数量&#x27;,</span><br><span class="line">    operate_time STRING COMMENT &#x27;操作时间&#x27;</span><br><span class="line">) COMMENT &#x27;物料消耗事实表&#x27;</span><br><span class="line">LOCATION &#x27;/warehouse/material/dwd/dwd_material_use/&#x27;;</span><br></pre></td></tr></table></figure>







<hr>
<h2 id="数据挖掘原始数据"><a href="#数据挖掘原始数据" class="headerlink" title="数据挖掘原始数据"></a>数据挖掘原始数据</h2><p><strong>MySQL</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	spud_num.`env_id`,</span><br><span class="line">	base_material_type.`name`,</span><br><span class="line">	GROUP_CONCAT(base_material.material_name SEPARATOR &#x27;,&#x27;) AS material_name, </span><br><span class="line">	GROUP_CONCAT(material_list.num  SEPARATOR &#x27;,&#x27;) AS material_num</span><br><span class="line">FROM spud_num, environment, material_list, base_material, base_material_type</span><br><span class="line">WHERE spud_num.env_id = environment.id</span><br><span class="line">AND spud_num.`product_id` = material_list.`product_id`</span><br><span class="line">AND spud_num.`spud_type` = material_list.`spud_id`</span><br><span class="line">AND material_list.`material_id` = base_material.`id`</span><br><span class="line">AND base_material.`material_type` = base_material_type.`id`</span><br><span class="line">AND base_material_type.id = 1</span><br><span class="line">GROUP BY environment.id</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220223112144155.png" alt="image-20220223112144155"></p>
<p><strong>Hive</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">-- 钻头</span><br><span class="line">with</span><br><span class="line">mat_use as (</span><br><span class="line">    SELECT</span><br><span class="line">        dwd_material_list.env_id,</span><br><span class="line">        concat_ws(&#x27;,&#x27;, collect_set(dim_material_info.material_name)) AS material_name,</span><br><span class="line">        concat_ws(&#x27;,&#x27;, collect_set(cast(ods_material_list.num as STRING))) AS material_num</span><br><span class="line">    FROM dwd_material_list, dim_environment, ods_material_list, dim_material_info</span><br><span class="line">    WHERE dwd_material_list.env_id = dim_environment.environment_id</span><br><span class="line">    AND dwd_material_list.product_id = ods_material_list.product_id</span><br><span class="line">    AND dwd_material_list.spud_type = ods_material_list.spud_id</span><br><span class="line">    AND ods_material_list.`material_id` = dim_material_info.material_id</span><br><span class="line">    AND dim_material_info.material_type_id = 1</span><br><span class="line">    GROUP BY dwd_material_list.env_id</span><br><span class="line">),</span><br><span class="line">env as (</span><br><span class="line">    select</span><br><span class="line">        *</span><br><span class="line">    from dim_environment</span><br><span class="line">)</span><br><span class="line">select</span><br><span class="line">    material_name,</span><br><span class="line">    material_num,</span><br><span class="line">    well_type_name,</span><br><span class="line">    well_type_name,</span><br><span class="line">    geo_type_name,</span><br><span class="line">    mud_type_name,</span><br><span class="line">    rock_type_name,</span><br><span class="line">    spud_deep,</span><br><span class="line">    pressure,</span><br><span class="line">    temperature,</span><br><span class="line">    hardness,</span><br><span class="line">    plastic</span><br><span class="line">from mat_use</span><br><span class="line">left join env on mat_use.env_id = env.environment_id;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/04/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/image-20220223115252122.png" alt="image-20220223115252122"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/30/Sqoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/30/Sqoop/" class="post-title-link" itemprop="url">Sqoop</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-30 12:22:49" itemprop="dateCreated datePublished" datetime="2021-12-30T12:22:49+08:00">2021-12-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-05-22 10:34:19" itemprop="dateModified" datetime="2022-05-22T10:34:19+08:00">2022-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Sqoop/" itemprop="url" rel="index"><span itemprop="name">Sqoop</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第-1-章-Sqoop简介"><a href="#第-1-章-Sqoop简介" class="headerlink" title="第 1 章    Sqoop简介"></a>第 1 章    Sqoop简介</h1><p><code>Sqoop</code> 是一款开源的 ETL 工具，主要用于在 <code>Hadoop(Hive)</code> 与传统的数据库 <code>(mysql、oracle...)</code> 之间进行数据的传递，可以将一个关系型数据库（例如：<code>MySQL，Oracle，Postgres</code> 等）中的数据导进到 <code>Hadoop</code> 的 <code>HDFS</code> 中，也可以将 <code>HDFS</code> 的数据导进到关系型数据库中。</p>
<p><code>Sqoop</code> 项目开始于2009年，最早是作为 <code>Hadoop</code> 的一个第三方模块存在，后来为了让使用者能够快速部署，也为了让开发人员能够更快速的迭代开发，<code>Sqoop</code> 独立成为一个 <code>Apache</code> 项目。</p>
<p><code>Sqoop2</code> 的最新版本是 <code>1.99.7</code>。请注意，2 与 1 不兼容，且特征不完整，它并不打算用于生产部署。</p>
<hr>
<h1 id="第-2-章-Sqoop-原理"><a href="#第-2-章-Sqoop-原理" class="headerlink" title="第 2 章    Sqoop 原理"></a>第 2 章    Sqoop 原理</h1><p>将导入或导出命令翻译成 <code>mapreduce</code> 程序来实现。</p>
<p>在翻译出的 <code>mapreduce</code> 中主要是对 <code>inputformat</code> 和 <code>outputformat</code> 进行定制。</p>
<hr>
<h1 id="第-3-章-Sqoop安装"><a href="#第-3-章-Sqoop安装" class="headerlink" title="第 3 章    Sqoop安装"></a>第 3 章    Sqoop安装</h1><p>安装 <code>Sqoop</code> 的前提是已经具备 <code>Java</code> 和 <code>Hadoop</code> 的环境。</p>
<h2 id="3-1-下载并解压"><a href="#3-1-下载并解压" class="headerlink" title="3.1    下载并解压"></a>3.1    下载并解压</h2><ol>
<li><p> 下载地址：<a target="_blank" rel="noopener" href="http://mirrors.hust.edu.cn/apache/sqoop/1.4.6/">http://mirrors.hust.edu.cn/apache/sqoop/1.4.6/</a></p>
</li>
<li><p> 上传安装包 <code>sqoop-1.4.6.bin__hadoop-2.0.4-alpha.tar.gz</code> 到虚拟机中</p>
</li>
<li><p>解压 <code>sqoop</code> 安装包到指定目录</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 software]$ tar -zxf sqoop-1.4.6.bin__hadoop-2.0.4-alpha.tar.gz -C /opt/module/</span><br></pre></td></tr></table></figure></li>
<li><p>将 <code>sqoop-1.4.6.bin__hadoop-2.0.4-alpha</code> 重命名为 <code>sqoop</code></p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 module]$ <span class="built_in">mv</span> sqoop-1.4.6.bin__hadoop-2.0.4-alpha/ sqoop</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="3-2-修改配置文件"><a href="#3-2-修改配置文件" class="headerlink" title="3.2 修改配置文件"></a>3.2 修改配置文件</h2><p><code>Sqoop</code> 的配置文件与大多数大数据框架类似，在 <code>sqoop</code> 根目录下的 <code>conf</code> 目录中。</p>
<ol>
<li><p><strong>重命名配置文件</strong></p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 conf]$ <span class="built_in">mv</span> sqoop-env-template.sh sqoop-env.sh</span><br></pre></td></tr></table></figure></li>
<li><p><strong>修改配置文件</strong><code>sqoop-env.sh</code></p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_HOME=/opt/module/hadoop-2.7.2</span><br><span class="line"><span class="built_in">export</span> HADOOP_MAPRED_HOME=/opt/module/hadoop-2.7.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># HIVE_HOME</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/opt/module/hive</span><br><span class="line"></span><br><span class="line"><span class="comment"># ZOOKEEPER_HOME</span></span><br><span class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/opt/module/zookeeper-3.4.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># ZOOCFGDIR</span></span><br><span class="line"><span class="built_in">export</span> ZOOCFGDIR=/opt/module/zookeeper-3.4.10/conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># HBASE_HOME</span></span><br><span class="line"><span class="built_in">export</span> HBASE_HOME=/opt/module/hbase-1.3.1</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="3-3-拷贝-JDBC-驱动"><a href="#3-3-拷贝-JDBC-驱动" class="headerlink" title="3.3    拷贝 JDBC 驱动"></a>3.3    拷贝 JDBC 驱动</h2><ol>
<li><p>拷贝 <code>jdbc</code> 驱动到 <code>sqoop</code> 的 <code>lib</code> 目录下(<code>JDBC</code> 驱动在 <code>MySQL</code> 的安装目录下)</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 mysql-connector-java-5.1.27]$ <span class="built_in">cp</span> mysql-connector-java-5.1.27-bin.jar /opt/module/sqoop/lib/</span><br></pre></td></tr></table></figure></li>
</ol>
<p>因为要通过 Sqoop 将 MySQL 中的数据导入到 HDFS 中，所以 Sqoop 就相当于 MySQL 的一个客户端，自然就需要将 MySQL 的 JDBC 驱动导入到 Sqoop 的 <code>lib</code> 目录下了。</p>
<hr>
<h2 id="3-4-验证-Sqoop"><a href="#3-4-验证-Sqoop" class="headerlink" title="3.4    验证 Sqoop"></a>3.4    验证 Sqoop</h2><ol>
<li><p>我们可以通过某一个命令来验证 <code>sqoop</code> 配置是否正确：</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop <span class="built_in">help</span></span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 sqoop]$ bin/sqoop <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 出现一些Warning警告（警告信息已省略），并伴随着帮助命令的输出：</span></span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line">  codegen            Generate code to interact with database records</span><br><span class="line">  create-hive-table  Import a table definition into Hive</span><br><span class="line">  <span class="built_in">eval</span>               Evaluate a SQL statement and display the results</span><br><span class="line">  <span class="built_in">export</span>             Export an HDFS directory to a database table</span><br><span class="line">  <span class="built_in">help</span>               List available commands</span><br><span class="line">  import             Import a table from a database to HDFS</span><br><span class="line">  import-all-tables  Import tables from a database to HDFS</span><br><span class="line">  import-mainframe   Import datasets from a mainframe server to HDFS</span><br><span class="line">  job                Work with saved <span class="built_in">jobs</span></span><br><span class="line">  list-databases     List available databases on a server</span><br><span class="line">  list-tables        List available tables <span class="keyword">in</span> a database</span><br><span class="line">  merge              Merge results of incremental imports</span><br><span class="line">  metastore          Run a standalone Sqoop metastore</span><br><span class="line">  version            Display version information</span><br><span class="line"></span><br><span class="line">See <span class="string">&#x27;sqoop help COMMAND&#x27;</span> <span class="keyword">for</span> information on a specific <span class="built_in">command</span>.</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="3-5-测试-Sqoop-是否能够成功连接数据库"><a href="#3-5-测试-Sqoop-是否能够成功连接数据库" class="headerlink" title="3.5 测试 Sqoop 是否能够成功连接数据库"></a>3.5 测试 Sqoop 是否能够成功连接数据库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 展示当前连接管理的所有的数据库</span></span><br><span class="line">[lvnengdong@hadoop102 sqoop]$ bin/sqoop \</span><br><span class="line">list-databases \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/ \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 出现如下输出（数据库列表）：</span></span><br><span class="line">information_schema</span><br><span class="line">metastore</span><br><span class="line">mysql</span><br><span class="line">performance_schema</span><br><span class="line">rdd</span><br><span class="line">sys</span><br></pre></td></tr></table></figure>







<hr>
<h1 id="第4章-Sqoop-的简单使用案例"><a href="#第4章-Sqoop-的简单使用案例" class="headerlink" title="第4章 Sqoop 的简单使用案例"></a>第4章 Sqoop 的简单使用案例</h1><h2 id="4-1-导入数据"><a href="#4-1-导入数据" class="headerlink" title="4.1 导入数据"></a>4.1 导入数据</h2><p>在 Sqoop 中，<strong>导入</strong> 指的是：从非大数据集群(RDBMS)向大数据集群(HDFS，HIVE，HBASE)中传输数据。</p>
<p>导入使用 <code>import</code> 关键字。</p>
<h3 id="4-1-1-RDBMS-gt-HDFS"><a href="#4-1-1-RDBMS-gt-HDFS" class="headerlink" title="4.1.1 RDBMS =&gt; HDFS"></a>4.1.1 RDBMS =&gt; HDFS</h3><ol>
<li><p> 确定 MySQL 服务开启正常</p>
</li>
<li><p>在 MySQL 中新建一张表并插入一些数据</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 建库</span><br><span class="line">CREATE DATABASE `sqoop_test`;</span><br><span class="line"></span><br><span class="line"># 建表</span><br><span class="line">CREATE TABLE emp (</span><br><span class="line">  id INT (4) PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">  NAME VARCHAR (255),</span><br><span class="line">  sex VARCHAR (255)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"># 插入数据</span><br><span class="line">INSERT INTO emp(NAME, sex) VALUES(&#x27;Thomas&#x27;, &#x27;Male&#x27;);</span><br><span class="line">INSERT INTO emp(NAME, sex) VALUES(&#x27;Catalina&#x27;, &#x27;FeMale&#x27;);</span><br><span class="line">INSERT INTO emp(NAME, sex) VALUES(&#x27;zs&#x27;, &#x27;Male&#x27;);</span><br><span class="line">INSERT INTO emp(NAME, sex) VALUES(&#x27;ls&#x27;, &#x27;Male&#x27;);</span><br><span class="line">INSERT INTO emp(NAME, sex) VALUES(&#x27;ww&#x27;, &#x27;FeMale&#x27;);</span><br></pre></td></tr></table></figure></li>
<li><p>导入数据</p>
<ul>
<li>  全表导入：默认</li>
<li>  导入指定列 <code>--columns</code></li>
<li>  导入指定行 <code>--where</code></li>
<li>  查询导入</li>
</ul>
</li>
</ol>
<h4 id="1、全表导入"><a href="#1、全表导入" class="headerlink" title="1、全表导入"></a>1、全表导入</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># \ 代表在shell窗口中换行</span></span><br><span class="line">[lvnengdong@hadoop102 sqoop]$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp \</span><br><span class="line">--target-dir /sqoop_test \</span><br><span class="line">--delete-target-dir \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--num-mappers 2 \</span><br><span class="line">--split-by <span class="built_in">id</span></span><br></pre></td></tr></table></figure>



<p><strong>解析：</strong></p>
<ol>
<li><p>从哪儿来</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \	<span class="comment"># 数据库的URL </span></span><br><span class="line">--username root \	<span class="comment"># 账号</span></span><br><span class="line">--password 123456 \	<span class="comment"># 密码</span></span><br><span class="line">--table emp \	<span class="comment"># 源数据表名</span></span><br></pre></td></tr></table></figure></li>
<li><p>到哪儿去</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--target-dir /sqoop_test \	<span class="comment"># 目的路径（HDFS下的路径）</span></span><br><span class="line">--delete-target-dir \</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、这两行命令一般是成对出现的</span></span><br><span class="line"><span class="comment"># 2、Sqoop `导入/导出`的功能底层是通过 MapReduce 实现的，在 MapReduce 中，要求输出目录必须事先不存在，</span></span><br><span class="line"><span class="comment"># 如果事先存在，在程序执行时就会抛出异常。在 Sqoop 为了避免这个异常，可以通过设置 `--delete-target-dir`，</span></span><br><span class="line"><span class="comment"># 这条命令的作用是如果目标目录事先已经存在了，则删除掉它。</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>怎么去（规则）</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \	<span class="comment"># 导入到 HDFS 上时，MySQL 中的字段使用 `/t` 作为分隔符 </span></span><br><span class="line">--num-mappers 2 \	<span class="comment"># 设置几个 MapTask 来运行程序</span></span><br><span class="line">--split-by <span class="built_in">id</span>	<span class="comment"># 在上一行设置了2个MapTask，自然就需要将数据切分，该行的含义是：基于 id 列，将数据切分为2片，这个参数只有在 `--num-mappers` 参数大于1时才需要指定。如果数据不需要切分该参数是无意义的。	</span></span><br><span class="line"><span class="comment"># 选择的列最好不要有 null 值，否则 null 值所在的行记录是不会被导入的</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>在 HDFS 上查看导入结果：</strong></p>
<p><img src="/2021/12/30/Sqoop/image-20211230191616906.png" alt="image-20211230191616906"></p>
<h4 id="2、导入指定列-columns"><a href="#2、导入指定列-columns" class="headerlink" title="2、导入指定列 --columns"></a>2、导入指定列 <code>--columns</code></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 sqoop]$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp \</span><br><span class="line">--columns <span class="built_in">id</span>,name \		<span class="comment"># 导入指定列（只导入 id 和 name 列）</span></span><br><span class="line">--target-dir /sqoop_test \</span><br><span class="line">--delete-target-dir \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--num-mappers 2 \</span><br><span class="line">--split-by <span class="built_in">id</span></span><br></pre></td></tr></table></figure>





<h4 id="3、导入指定行-where"><a href="#3、导入指定行-where" class="headerlink" title="3、导入指定行 --where"></a>3、导入指定行 <code>--where</code></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 sqoop]$ bin/sqoop import \</span><br><span class="line">&gt; --connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">&gt; --username root \</span><br><span class="line">&gt; --password 123456 \</span><br><span class="line">&gt; --table emp \</span><br><span class="line">&gt; --<span class="built_in">where</span> <span class="string">&#x27;id &gt;= 1 and id &lt;= 3&#x27;</span> \	<span class="comment"># 导入指定行</span></span><br><span class="line">&gt; --target-dir /sqoop_test \</span><br><span class="line">&gt; --delete-target-dir \</span><br><span class="line">&gt; --fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">&gt; --num-mappers 2 \</span><br><span class="line">&gt; --split-by <span class="built_in">id</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="6、查询导入"><a href="#6、查询导入" class="headerlink" title="6、查询导入"></a>6、查询导入</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[lvnengdong@hadoop102 sqoop]$ bin/sqoop import \</span><br><span class="line">&gt; --connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">&gt; --username root \</span><br><span class="line">&gt; --password 123456 \</span><br><span class="line">&gt; --query <span class="string">&quot;select * from emp where \$CONDITIONS and id &lt;= 3&quot;</span> \	<span class="comment"># 查询导入</span></span><br><span class="line">&gt; --target-dir /sqoop_test \</span><br><span class="line">&gt; --delete-target-dir \</span><br><span class="line">&gt; --fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">&gt; --num-mappers 2 \</span><br><span class="line">&gt; --split-by <span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong></p>
<ul>
<li>  如果使用了 <code>--query</code>，就不能再使用 <code>--table、--where、--columns</code> 了</li>
<li>  只要使用 <code>--query</code>，就必须添加 <code>$CONDITIONS</code>。<code>(must contain &#39;$CONDITIONS&#39; in WHERE clause)</code></li>
<li>  如果 <code>--query </code>后使用的是双引号，则 <code>$CONDITIONS</code> 前必须加转义符，防止 <code>shell</code> 识别为自己的变量。</li>
</ul>
<hr>
<h3 id="4-1-2-RDBMS-gt-Hive"><a href="#4-1-2-RDBMS-gt-Hive" class="headerlink" title="4.1.2 RDBMS ==&gt; Hive"></a>4.1.2 <code>RDBMS ==&gt; Hive</code></h3><p>将 MySQL 中的数据导入的 Hive 的过程分为两步：</p>
<ul>
<li>  第一步将数据导入到 <code>HDFS</code>，默认的临时目录是 <code>/user/lvnengdong/表名</code></li>
<li>  第二步将导入到 <code>HDFS</code> 的数据迁移到 <code>Hive</code> 仓库。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-table emp_hive</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--hive-import \	<span class="comment"># 显式指定将MySQL中的数据导入到 Hive</span></span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--hive-overwrite \	<span class="comment"># 是否以 overwrite 的方式导入</span></span><br><span class="line">--hive-table emp_hive	<span class="comment"># 要导入的 Hive 表的名称，若表实现不存在会自动建表</span></span><br></pre></td></tr></table></figure>



<p>连接 Hive，查看数据是否上传成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from emp_hive;</span><br><span class="line">OK</span><br><span class="line">emp_hive.id	emp_hive.name	emp_hive.sex</span><br><span class="line">1	Thomas	Male</span><br><span class="line">2	Catalina	FeMale</span><br><span class="line">3	zs	Male</span><br><span class="line">4	ls	Male</span><br><span class="line">5	ww	FeMale</span><br><span class="line">Time taken: 1.032 seconds, Fetched: 5 row(s)</span><br></pre></td></tr></table></figure>









<hr>
<h3 id="4-1-3-RDBMS-gt-Hbase"><a href="#4-1-3-RDBMS-gt-Hbase" class="headerlink" title="4.1.3    RDBMS ==&gt; Hbase"></a>4.1.3    <code>RDBMS ==&gt; Hbase</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp \</span><br><span class="line">--<span class="built_in">where</span> <span class="string">&#x27;id &lt;= 5&#x27;</span> \</span><br><span class="line">--hbase-create-table \</span><br><span class="line">--hbase-table <span class="string">&quot;hive_hbase&quot;</span> \</span><br><span class="line">--hbase-row-key <span class="string">&quot;id&quot;</span> \</span><br><span class="line">--column-family <span class="string">&quot;info&quot;</span> \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--split-by <span class="built_in">id</span></span><br></pre></td></tr></table></figure>



<p><strong>提示：</strong><code>sqoop1.4.6</code> 只支持 <code>HBase1.0.1 </code>之前的版本的自动创建 <code>HBase</code> 表的功能</p>
<p><strong>解决方案：</strong>手动创建 <code>HBase</code> 表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase&gt; create &#x27;hive_hbase&#x27;,&#x27;info&#x27;</span><br></pre></td></tr></table></figure>

<p>在 <code>HBase</code> 中 <code>scan</code> 这张表得到如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase&gt; scan &#x27;hive_hbase&#x27;</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="4-2-导出数据"><a href="#4-2-导出数据" class="headerlink" title="4.2    导出数据"></a>4.2    导出数据</h2><p>在 <code>Sqoop</code> 中，<strong>导出</strong>指的是：从大数据集群<code>(HDFS，HIVE)</code>向非大数据集群<code>(RDBMS)</code>中传输数据。</p>
<p>导出使用 <code>export</code> 关键字。</p>
<h3 id="4-2-1-HIVE-HDFS-gt-RDBMS"><a href="#4-2-1-HIVE-HDFS-gt-RDBMS" class="headerlink" title="4.2.1    HIVE/HDFS ==&gt; RDBMS"></a>4.2.1    <code>HIVE/HDFS ==&gt; RDBMS</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bin/sqoop <span class="built_in">export</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp_new \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--export-dir /sqoop_test \</span><br><span class="line">--input-fields-terminated-by <span class="string">&quot;\t&quot;</span></span><br></pre></td></tr></table></figure>



<p><strong>解释</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bin/sqoop <span class="built_in">export</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/sqoop_test \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table emp_new \	<span class="comment"># 要导出到 MySQL 的哪张表中</span></span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--export-dir /sqoop_test \	<span class="comment"># HDFS上文件的源路径</span></span><br><span class="line">--input-fields-terminated-by <span class="string">&quot;\t&quot;</span>	<span class="comment"># 待导出数据的分隔符</span></span><br></pre></td></tr></table></figure>



<p><strong>提示：</strong><code>MySQL</code> 中如果表不存在，不会自动创建。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE emp_new LIKE emp;</span><br></pre></td></tr></table></figure>





<hr>
<h3 id="4-2-2-Sqoop-导出遇到重复主键"><a href="#4-2-2-Sqoop-导出遇到重复主键" class="headerlink" title="4.2.2    Sqoop 导出遇到重复主键"></a>4.2.2    Sqoop 导出遇到重复主键</h3><p>在 <code>MySQL</code> 中，主键是唯一的，如果在插入数据时发现主键重复，则会抛出异常。但是 <code>MySQL</code> 给我们提供了另外一种策略，就是当主键重复时，使用 <code>update</code> 操作来代替 <code>insert</code> 操作，这样即使主键重复也不会报错，而是使用新数据覆盖旧数据。该形式的写法为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 当主键重复时，使用新值覆盖旧值</span><br><span class="line">INSERT INTO emp_new </span><br><span class="line">VALUES (3, &quot;张三&quot;, &quot;男&quot;) </span><br><span class="line">ON DUPLICATE KEY UPDATE ;	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 当主键重复时，使用新值覆盖旧值，并且仅修改部分列的值</span><br><span class="line">INSERT INTO emp_new VALUES </span><br><span class="line">(3, &quot;张三&quot;, &quot;???&quot;) </span><br><span class="line">ON DUPLICATE KEY UPDATE </span><br><span class="line">sex=VALUES(sex)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<p>默认情况下，<code>Sqoop</code> 在导出数据到 <code>MySQL</code> 中时，会将每一条数据翻译成 MySQL 中的 <code>insert</code> 语句插入到 MySQL 数据库中。如果此时 MySQL 表结构中存在一些主键约束或唯一约束，并且表中已经有了一部分数据，那么新的数据在插入到 MySQL 表中时，就可能会触犯约束条件，导致插入失败。</p>
<p>默认情况下，<code>export</code> 适用于向一张空白表中导出数据的场景。每一条要导出的记录，都会转换为 MySQL 中的 <code>insert</code> 语句执行。</p>
<p>如果要导入的表中已经有数据了，此时可以指定 <code>--update-key</code> 参数，使用该参数后，将不再执行 <code>insert</code> 操作，而是只会执行 <code>update</code> 操作。但是这又会带来另一个问题，即此时只会更新重复的数据，不重复的数据是无法导入的。</p>
<p>如果希望遇到重复的数据就 <code>insert</code>，不重复的数据就 <code>update</code>，可以使用 <code>--update-key</code> 结合 <code>--update-mode=allowinsert </code> 使用。此时当主键不重复时执行 <code>insert</code> 操作，当发生主键重复时，会将<code>新增操作(insert)</code>转变为<code>更新操作(update)</code>执行；。</p>
<p> <code>--update-mode</code> 属性的默认值是 <code>updateonly</code>，即 <code>--update-mode=updateonly</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在导出时，基于哪一列来判断数据是否重复</span></span><br><span class="line">--update-key</span><br><span class="line"></span><br><span class="line"><span class="comment"># .eg</span></span><br><span class="line">--update-key <span class="built_in">id</span></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="4-3-脚本打包"><a href="#4-3-脚本打包" class="headerlink" title="4.3    脚本打包"></a>4.3    脚本打包</h2><p>使用 <code>opt</code> 格式的文件打包 <code>sqoop</code> 命令，然后执行</p>
<ol>
<li><p>创建一个 <code>.opt</code> 文件</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> opt</span><br><span class="line">$ <span class="built_in">touch</span> opt/job_mysql2hdfs.opt</span><br></pre></td></tr></table></figure>

</li>
<li><p>编写 <code>sqoop</code> 脚本</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ vim opt/job_mysql2hdfs.opt</span><br><span class="line"></span><br><span class="line">import</span><br><span class="line">--connect</span><br><span class="line">jdbc:mysql://hadoop102:3306/company</span><br><span class="line">--username</span><br><span class="line">root</span><br><span class="line">--password</span><br><span class="line">123456</span><br><span class="line">--table</span><br><span class="line">staff</span><br><span class="line">--target-dir</span><br><span class="line">/company3</span><br><span class="line">--delete-target-dir</span><br><span class="line">--num-mappers</span><br><span class="line">1</span><br><span class="line">--fields-terminated-by</span><br><span class="line"><span class="string">&quot;\t&quot;</span></span><br><span class="line">--split-by</span><br><span class="line"><span class="built_in">id</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>执行该脚本</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/sqoop --options-file opt/job_mysql2hdfs.opt</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h1 id="第5章-Sqoop-常用命令及参数"><a href="#第5章-Sqoop-常用命令及参数" class="headerlink" title="第5章 Sqoop 常用命令及参数"></a>第5章 Sqoop 常用命令及参数</h1><h2 id="5-1-常用命令"><a href="#5-1-常用命令" class="headerlink" title="5.1 常用命令"></a>5.1 常用命令</h2><p>这里给大家列出来了一部分 <code>Sqoop</code> 操作时的常用参数，以供参考，需要深入学习的可以参看对应类的源代码。</p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>命令</th>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>import</code></td>
<td><code>ImportTool</code></td>
<td>将数据导入到集群</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>export</code></td>
<td><code>ExportTool</code></td>
<td>将集群数据导出</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>codegen</code></td>
<td><code>CodeGenTool</code></td>
<td>获取数据库中某张表数据生成 Java 并打包 Jar</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>create-hive-table</code></td>
<td><code>CreateHiveTableTool</code></td>
<td>创建 Hive 表</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>eval</code></td>
<td><code>EvalSqlTool</code></td>
<td>查看 SQL 执行结果</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>import-all-tables</code></td>
<td><code>ImportAllTablesTool</code></td>
<td>导入某个数据库下所有表到 HDFS 中</td>
</tr>
<tr>
<td align="center">7</td>
<td><code>job</code></td>
<td><code>JobTool</code></td>
<td>用来生成一个 sqoop 的任务，生成后，该任务<br>并不执行，除非使用命令执行该任务。</td>
</tr>
<tr>
<td align="center">8</td>
<td><code>list-databases</code></td>
<td><code>ListDatabasesTool</code></td>
<td>列出所有数据库名</td>
</tr>
<tr>
<td align="center">9</td>
<td><code>list-tables</code></td>
<td><code>ListTablesTool</code></td>
<td>列出某个数据库下所有表</td>
</tr>
<tr>
<td align="center">10</td>
<td><code>merge</code></td>
<td><code>MergeTool</code></td>
<td>将 HDFS 中不同目录下面的数据合并在一起，并存放在指定的目录中</td>
</tr>
<tr>
<td align="center">11</td>
<td><code>metastore</code></td>
<td><code>MetastoreTool</code></td>
<td>记录 <code>sqoop job</code> 的元数据信息，如果不启动 <code>metastore</code> 实例，<br>则默认的元数据存储目录为 <code>~/.sqoop</code>，如果要更改存储目录，<br>可以在配置文件 <code>sqoop-site.xml</code> 中进行更改</td>
</tr>
<tr>
<td align="center">12</td>
<td><code>help</code></td>
<td><code>HelpTool</code></td>
<td>打印 sqoop 帮助信息</td>
</tr>
<tr>
<td align="center">13</td>
<td><code>version</code></td>
<td><code>VersionTool</code></td>
<td>打印 sqoop 版本信息</td>
</tr>
</tbody></table>
<h2 id="5-2-命令-amp-参数详解"><a href="#5-2-命令-amp-参数详解" class="headerlink" title="5.2    命令&amp;参数详解"></a>5.2    命令&amp;参数详解</h2><p>刚才列举了一些 <code>Sqoop</code> 的常用命令，对于不同的命令，有不同的参数，让我们来一一列举说明。</p>
<p>首先来我们来介绍一下公用的参数，所谓公用参数，就是大多数命令都支持的参数。</p>
<h3 id="5-2-1-公用参数：数据库连接"><a href="#5-2-1-公用参数：数据库连接" class="headerlink" title="5.2.1    公用参数：数据库连接"></a>5.2.1    公用参数：数据库连接</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="left"><code>--connect</code></td>
<td align="left">连接关系型数据库的URL</td>
</tr>
<tr>
<td align="center">2</td>
<td align="left"><code>--connection-manager</code></td>
<td align="left">指定要使用的连接管理类</td>
</tr>
<tr>
<td align="center">3</td>
<td align="left"><code>--driver</code></td>
<td align="left">Hadoop 根目录</td>
</tr>
<tr>
<td align="center">4</td>
<td align="left"><code>--help</code></td>
<td align="left">打印帮助信息</td>
</tr>
<tr>
<td align="center">5</td>
<td align="left"><code>--password</code></td>
<td align="left">连接数据库的密码</td>
</tr>
<tr>
<td align="center">6</td>
<td align="left"><code>--username</code></td>
<td align="left">连接数据库的用户名</td>
</tr>
<tr>
<td align="center">7</td>
<td align="left"><code>--verbose</code></td>
<td align="left">在控制台打印出详细信息</td>
</tr>
</tbody></table>
<h3 id="5-2-2-公用参数：import"><a href="#5-2-2-公用参数：import" class="headerlink" title="5.2.2    公用参数：import"></a>5.2.2    公用参数：import</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="left"><code>--enclosed-by &lt;char&gt;</code></td>
<td align="left">给字段值前加上指定的字符</td>
</tr>
<tr>
<td align="center">2</td>
<td align="left"><code>--escaped-by &lt;char&gt;</code></td>
<td align="left">对字段中的双引号加转义符</td>
</tr>
<tr>
<td align="center">3</td>
<td align="left"><code>--fields-terminated-by &lt;char&gt;</code></td>
<td align="left">设定每个字段是以什么符号作为结束，默认为逗号</td>
</tr>
<tr>
<td align="center">4</td>
<td align="left"><code>--lines-terminated-by  &lt;char&gt;</code></td>
<td align="left">设定每行记录之间的分隔符，默认是 <code>\n</code></td>
</tr>
<tr>
<td align="center">5</td>
<td align="left"><code>--mysql-delimiters</code></td>
<td align="left">MySQL 默认的分隔符设置，字段之间以逗号 <code>,</code> 分隔，<br>行之间以 <code>\n</code> 分隔，默认转义符是 <code>\</code>，字段值以单引号 <code>‘ ’</code>包裹</td>
</tr>
<tr>
<td align="center">6</td>
<td align="left"><code>--optionally-enclosed-by &lt;char&gt;</code></td>
<td align="left">给带有双引号或单引号的字段值前后加上指定字符。</td>
</tr>
</tbody></table>
<h3 id="5-2-3-公用参数：export"><a href="#5-2-3-公用参数：export" class="headerlink" title="5.2.3 公用参数：export"></a>5.2.3 公用参数：export</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--input-enclosed-by &lt;char&gt;</code></td>
<td>对字段值前后加上指定字符</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--input-escaped-by &lt;char&gt;</code></td>
<td>对含有转移符的字段做转义处理</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--input-fields-terminated-by &lt;char&gt;</code></td>
<td>字段之间的分隔符</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--input-lines-terminated-by &lt;char&gt;</code></td>
<td>行之间的分隔符</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--input-optionally-enclosed-by &lt;char&gt;</code></td>
<td>给带有双引号或单引号的字段前后加上指定字符</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--update-key &lt;col-name&gt;</code></td>
<td>更新时参考的列</td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--update-mode &lt;mode&gt;</code></td>
<td>更新模式，可选参数 <code>[updateonly, allowinsert]</code></td>
</tr>
</tbody></table>
<h3 id="5-2-4-公用参数：hive"><a href="#5-2-4-公用参数：hive" class="headerlink" title="5.2.4    公用参数：hive"></a>5.2.4    公用参数：hive</h3><table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--hive-delims-replacement &lt;arg&gt;</code></td>
<td>用自定义的字符串替换掉数据中的 <code>\r\n</code> 和 <code>\013 \010</code> 等字符</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--hive-drop-import-delims</code></td>
<td>在导入数据到 <code>Hive</code> 时，去掉数据中的 <code>\r\n\013\010</code> 这样的字符</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--map-column-hive  &lt;arg&gt;</code></td>
<td>生成 <code>Hive</code> 表时，可以更改生成字段的数据类型</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--hive-partition-key</code></td>
<td>创建分区，后面直接跟分区名，分区字段的默认类型为 <code>string</code></td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--hive-partition-value &lt;v&gt;</code></td>
<td>导入数据时，指定某个分区的值</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--hive-home &lt;dir&gt;</code></td>
<td><code>Hive</code> 的安装目录，可以通过该参数覆盖之前默认配置的目录</td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--hive-import</code></td>
<td>将数据从关系数据库中导入到 <code>Hive</code> 表中</td>
</tr>
<tr>
<td align="center">8</td>
<td><code>--hive-overwrite</code></td>
<td>覆盖掉在 <code>Hive</code> 表中已经存在的数据</td>
</tr>
<tr>
<td align="center">9</td>
<td><code>--create-hive-table</code></td>
<td>默认是 <code>false</code>，即如果目标表已经存在了，那么创建任务失败</td>
</tr>
<tr>
<td align="center">10</td>
<td><code>--hive-table</code></td>
<td>后面接要创建的 <code>hive</code> 表，默认使用 <code>MySQL</code> 的表名</td>
</tr>
<tr>
<td align="center">11</td>
<td><code>--table</code></td>
<td>指定关系数据库的表名</td>
</tr>
</tbody></table>
<hr>
<p>公用参数介绍完之后，我们来按照命令介绍命令对应的特有参数。</p>
<h3 id="5-2-5-命令-amp-参数：import"><a href="#5-2-5-命令-amp-参数：import" class="headerlink" title="5.2.5    命令&amp;参数：import"></a>5.2.5    命令&amp;参数：import</h3><p>将关系型数据库中的数据导入到 <code>HDFS(包括Hive，HBase)</code> 中，如果导入的是 <code>Hive</code>，那么当 <code>Hive</code> 中没有对应表时，则自动创建。</p>
<p><strong>一、命令：</strong></p>
<p>eg：导入数据到 <code>hive</code> 中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff \</span><br><span class="line">--hive-import</span><br></pre></td></tr></table></figure>



<p>eg：增量导入数据到 <code>hive</code> 中，<code>mode=append</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># append导入：</span></span><br><span class="line"></span><br><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--target-dir /user/hive/warehouse/staff_hive \</span><br><span class="line">--check-column <span class="built_in">id</span> \</span><br><span class="line">--incremental append \	<span class="comment"># 增量导入</span></span><br><span class="line">--last-value 3</span><br></pre></td></tr></table></figure>

<ul>
<li>  <strong>提示：</strong><code>append</code> 不能与 <code>--hive</code> 等参数同时使用</li>
<li>  Append mode for hive imports is not yet supported. Please remove the parameter –append-mode</li>
</ul>
<p>eg：增量导入数据到 <code>hdfs</code> 中，<code>mode=lastmodified</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先在 mysql 中建表并插入几条数据：</span></span><br><span class="line">mysql&gt; </span><br><span class="line">	create table company.staff_timestamp(</span><br><span class="line">		<span class="built_in">id</span> int(4), </span><br><span class="line">		name varchar(255), </span><br><span class="line">		sex varchar(255), </span><br><span class="line">		last_modified timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into company.staff_timestamp (<span class="built_in">id</span>, name, sex) values(1, <span class="string">&#x27;AAA&#x27;</span>, <span class="string">&#x27;female&#x27;</span>);</span><br><span class="line">mysql&gt; insert into company.staff_timestamp (<span class="built_in">id</span>, name, sex) values(2, <span class="string">&#x27;BBB&#x27;</span>, <span class="string">&#x27;female&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先导入一部分数据：</span></span><br><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff_timestamp \</span><br><span class="line">--delete-target-dir \</span><br><span class="line">--m 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再增量导入一部分数据：</span></span><br><span class="line">mysql&gt; insert into company.staff_timestamp (<span class="built_in">id</span>, name, sex) values(3, <span class="string">&#x27;CCC&#x27;</span>, <span class="string">&#x27;female&#x27;</span>);</span><br><span class="line">$ bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff_timestamp \</span><br><span class="line">--check-column last_modified \</span><br><span class="line">--incremental lastmodified \</span><br><span class="line">--last-value <span class="string">&quot;2017-09-28 22:20:38&quot;</span> \</span><br><span class="line">--m 1 \</span><br><span class="line">--append</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>提示：</strong><ol>
<li> 使用 <code>lastmodified</code> 方式导入数据要指定增量数据是要 <code>--append</code>（追加）还是要 <code>--merge-key</code>（合并）</li>
<li> <code>last-value</code> 指定的值是会包含于增量导入的数据中</li>
</ol>
</li>
</ul>
<p><strong>二、参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--append</code></td>
<td>将数据追加到 HDFS 中已经存在的 DataSet 中。如果使用该参数，<br>sqoop 会把数据先导入到临时文件目录，再合并</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--as-avrodatafile</code></td>
<td>将数据导入到一个 <code>Avro</code> 数据文件中</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--as-sequencefile</code></td>
<td>将数据导入到一个 <code>sequence</code> 文件中</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--as-textfile</code></td>
<td>将数据导入到一个普通文本文件中</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--boundary-query  &lt;statement&gt;</code></td>
<td>边界查询，导入的数据为该参数的值（一条sql语句）所执行的结果<br>区间内的数据</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--columns &lt;col1, col2,  col3&gt;</code></td>
<td>指定要导入的字段</td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--direct</code></td>
<td>直接导入模式，使用的是关系数据库自带的导入导出工具，以便加快<br>导入导出过程</td>
</tr>
<tr>
<td align="center">8</td>
<td><code>--direct-split-size</code></td>
<td>在使用上面 direct 直接导入的基础上，对导入的流按字节分块，即达<br>到该阈值就产生一个新的文件</td>
</tr>
<tr>
<td align="center">9</td>
<td><code>--inline-lob-limit</code></td>
<td>设定大对象数据类型的最大值</td>
</tr>
<tr>
<td align="center">10</td>
<td><code>--m</code> 或 <code>–num-mappers</code></td>
<td>启动 N 个 map 来并行导入数据，默认 4 个</td>
</tr>
<tr>
<td align="center">11</td>
<td><code>--query</code>或 <code>--e &lt;statement&gt;</code></td>
<td>将查询结果的数据导入，使用时必须伴随参 <code>--target-dir，--hive-table</code>，<br>如果查询中有 where 条件，则条件后必须加上 <code>$CONDITIONS</code> 关键字</td>
</tr>
<tr>
<td align="center">12</td>
<td><code>--split-by &lt;column-name&gt;</code></td>
<td>按照某一列来切分表的工作单元，不能与–autoreset-to-one-mapper连用<br>（请参考官方文档</td>
</tr>
<tr>
<td align="center">13</td>
<td><code>--table &lt;table-name&gt;</code></td>
<td>关系数据库的表名</td>
</tr>
<tr>
<td align="center">14</td>
<td><code>--target-dir &lt;dir&gt;</code></td>
<td>指定 HDFS 路径</td>
</tr>
<tr>
<td align="center">15</td>
<td><code>--warehouse-dir &lt;dir&gt;</code></td>
<td>与<code>14</code>参数不能同时使用，导入数据到 HDFS 时指定的目录</td>
</tr>
<tr>
<td align="center">16</td>
<td><code>--where</code></td>
<td>从关系数据库导入数据时的查询条件</td>
</tr>
<tr>
<td align="center">17</td>
<td><code>--z</code>或<code>--compress</code></td>
<td>允许压缩</td>
</tr>
<tr>
<td align="center">18</td>
<td><code>--compression-codec</code></td>
<td>指定 hadoop 压缩编码类，默认为<code>gzip(Use Hadoop codec  default gzip)</code></td>
</tr>
<tr>
<td align="center">19</td>
<td><code>--null-string  &lt;null-string&gt;</code></td>
<td><code>string</code> 类型的列如果 <code>null</code>，替换为指定字符串</td>
</tr>
<tr>
<td align="center">20</td>
<td><code>--null-non-string  &lt;null-string&gt;</code></td>
<td>非 <code>string</code> 类型的列如果 <code>null</code>，替换为指定字符串</td>
</tr>
<tr>
<td align="center">21</td>
<td><code>--check-column &lt;col&gt;</code></td>
<td>作为增量导入判断的列名</td>
</tr>
<tr>
<td align="center">22</td>
<td><code>--incremental &lt;mode&gt;</code></td>
<td><code>mode:append</code> 或 <code>lastmodified</code></td>
</tr>
<tr>
<td align="center">23</td>
<td><code>--last-value &lt;value&gt;</code></td>
<td>指定某一个值，用于标记增量导入的位置</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-2-6-命令-amp-参数：export"><a href="#5-2-6-命令-amp-参数：export" class="headerlink" title="5.2.6    命令&amp;参数：export"></a>5.2.6    命令&amp;参数：export</h3><p>从<code>HDFS（包括Hive和HBase）</code>中奖数据导出到关系型数据库中。</p>
<p><strong>命令：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop <span class="built_in">export</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff \</span><br><span class="line">--export-dir /user/company \</span><br><span class="line">--input-fields-terminated-by <span class="string">&quot;\t&quot;</span> \</span><br><span class="line">--num-mappers 1</span><br></pre></td></tr></table></figure>



<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--direct</code></td>
<td align="left">利用数据库自带的导入导出工具，以便于提高效率</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--export-dir  &lt;dir&gt;</code></td>
<td align="left">存放数据的 HDFS 的源目录</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>-m</code> 或 <code>--num-mappers &lt;n&gt;</code></td>
<td align="left">启动 N 个 map 来并行导入数据，默认4个</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--table &lt;table-name&gt;</code></td>
<td align="left">指定导出到哪个 <code>RDBMS</code> 中的表</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--update-key  &lt;col-name&gt;</code></td>
<td align="left">对某一列的字段进行更新操作</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--update-mode  &lt;mode&gt;</code></td>
<td align="left"><code>updateonly</code>(默认)  <code>allowinsert</code></td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--input-null-string  &lt;null-string&gt;</code></td>
<td align="left">请参考 import 该类似参数说明</td>
</tr>
<tr>
<td align="center">8</td>
<td><code>--input-null-non-string  &lt;null-string&gt;</code></td>
<td align="left">请参考 import 该类似参数说明</td>
</tr>
<tr>
<td align="center">9</td>
<td><code>--staging-table  &lt;staging-table-name&gt;</code></td>
<td align="left">创建一张临时表，用于存放所有事务的结果，然后<br>将所有事务结果一次性导入到目标表中，防止错误</td>
</tr>
<tr>
<td align="center">10</td>
<td><code>--clear-staging-table</code></td>
<td align="left">如果第 9 个参数非空，则可以在导出操作执行前，清空临时事务结果表</td>
</tr>
</tbody></table>
<h3 id="5-2-7-命令-amp-参数：codegen"><a href="#5-2-7-命令-amp-参数：codegen" class="headerlink" title="5.2.7    命令&amp;参数：codegen"></a>5.2.7    命令&amp;参数：codegen</h3><p>将关系型数据库中的表映射为一个 Java 类，在该类中有各列对应的各个字段。</p>
<p>eg：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop codegen \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff \</span><br><span class="line">--bindir /home/admin/Desktop/staff \</span><br><span class="line">--class-name Staff \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span></span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--bindir &lt;dir&gt;</code></td>
<td>指定生成的 Java 文件、编译成的 class 文件及将生成文件打包为<br> <code>jar</code> 的文件输出路径</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--class-name &lt;name&gt;</code></td>
<td>设定生成的 Java 文件指定的名称</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--outdir &lt;dir&gt;</code></td>
<td>生成 Java 文件存放的路径</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--package-name  &lt;name&gt;</code></td>
<td>包名，如 <code>com.z</code>，就会生成<code>com</code>和<code>z</code>两级目录</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--input-null-non-string &lt;null-str&gt;</code></td>
<td>在生成的 Java 文件中，可以将 <code>null</code> 字符串或者不存在的字符串<br>设置为想要设定的值（例如空字符串）</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--input-null-string  &lt;null-str&gt;</code></td>
<td>将 <code>null</code> 字符串替换成想要替换的值（一般与 5 同时使用）</td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--map-column-java &lt;arg&gt;</code></td>
<td>数据库字段在生成的 Java 文件中会映射成各种属性，且默认的数据<br>类型与数据库类型保持对应关系。该参数可以改变默认类型，例如：<br><code>--map-column-java  id=long, name=String</code></td>
</tr>
<tr>
<td align="center">8</td>
<td><code>--null-non-string  &lt;null-str&gt;</code></td>
<td>在生成 Java 文件时，可以将不存在或者 <code>null</code> 的字符串设置为其他值</td>
</tr>
<tr>
<td align="center">9</td>
<td><code>--null-string &lt;null-str&gt;</code></td>
<td>在生成 Java 文件时，将 <code>null</code> 字符串设置为其他值（一般与8同时使用）</td>
</tr>
<tr>
<td align="center">10</td>
<td><code>--table &lt;table-name&gt;</code></td>
<td>对应关系数据库中的表名，生成的 Java 文件中的各个属性与该表的各<br>个字段一一对应</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-2-8-命令-amp-参数：create-hive-table"><a href="#5-2-8-命令-amp-参数：create-hive-table" class="headerlink" title="5.2.8    命令&amp;参数：create-hive-table"></a>5.2.8    命令&amp;参数：create-hive-table</h3><p>生成与关系数据库表结构对应的 <code>Hive</code> 表结构。</p>
<p><strong>命令：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop create-hive-table \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff \</span><br><span class="line">--hive-table hive_staff</span><br></pre></td></tr></table></figure>



<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th>序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>--hive-home  &lt;dir&gt;</code></td>
<td><code>Hive</code> 的安装目录，可以通过该参数覆盖掉默认的 <code>Hive</code> 目录</td>
</tr>
<tr>
<td>2</td>
<td><code>--hive-overwrite</code></td>
<td>覆盖掉在 <code>Hive</code> 表中已经存在的数据</td>
</tr>
<tr>
<td>3</td>
<td><code>--create-hive-table</code></td>
<td>默认是 <code>false</code>，如果目标表已经存在了，那么创建任务会失败</td>
</tr>
<tr>
<td>4</td>
<td><code>--hive-table</code></td>
<td>后面接要创建的 <code>hive</code> 表</td>
</tr>
<tr>
<td>5</td>
<td><code>--table</code></td>
<td>指定关系数据库的表名</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-2-9-命令-amp-参数：eval"><a href="#5-2-9-命令-amp-参数：eval" class="headerlink" title="5.2.9    命令&amp;参数：eval"></a>5.2.9    命令&amp;参数：eval</h3><p>可以快速的使用 SQL 语句对关系型数据库进行操作，经常用于在 <code>import</code> 数据之前，了解一下 SQL 语句是否正确，数据是否正常，并可以将结果显示在控制台。</p>
<p><strong>命令：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop <span class="built_in">eval</span> \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--query <span class="string">&quot;SELECT * FROM staff&quot;</span></span><br></pre></td></tr></table></figure>



<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--query或--e</code></td>
<td>后跟查询的 SQL 语句</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-2-10-命令-amp-参数：import-all-tables"><a href="#5-2-10-命令-amp-参数：import-all-tables" class="headerlink" title="5.2.10    命令&amp;参数：import-all-tables"></a>5.2.10    命令&amp;参数：import-all-tables</h3><p>可以将 <code>RDBMS</code> 中的所有表导入到 <code>HDFS</code> 中，每一个表都对应一个 <code>HDFS</code> 目录</p>
<p><strong>命令：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop import-all-tables \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--warehouse-dir /all_tables</span><br></pre></td></tr></table></figure>





<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--as-avrodatafile</code></td>
<td>这些参数的含义均和 <code>import</code>对应的含义一致</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--as-sequencefile</code></td>
<td></td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--as-textfile</code></td>
<td></td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--direct</code></td>
<td></td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--direct-split-size  &lt;n&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--inline-lob-limit  &lt;n&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--m</code> 或 <code>—num-mappers  &lt;n&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">8</td>
<td><code>--warehouse-dir  &lt;dir&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">9</td>
<td><code>-z</code> 或 <code>--compress</code></td>
<td></td>
</tr>
<tr>
<td align="center">10</td>
<td><code>--compression-codec</code></td>
<td></td>
</tr>
</tbody></table>
<hr>
<h3 id="5-2-11-命令-amp-参数：job"><a href="#5-2-11-命令-amp-参数：job" class="headerlink" title="5.2.11    命令&amp;参数：job"></a>5.2.11    命令&amp;参数：job</h3><p>用来生成一个 <code>sqoop</code> 任务，生成后不会立即执行，需要手动执行。</p>
<p><strong>命令：</strong></p>
<p>eg：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop job \</span><br><span class="line"> --create myjob -- import-all-tables \</span><br><span class="line"> --connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line"> --username root \</span><br><span class="line"> --password 123456</span><br><span class="line">$ bin/sqoop job \</span><br><span class="line">--list</span><br><span class="line">$ bin/sqoop job \</span><br><span class="line">--<span class="built_in">exec</span> myjob</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>提示：<ol>
<li> 注意 <code>import-all-tables</code> 和它左边的 <code>--</code> 之间有一个空格</li>
<li> 如果需要连接 <code>metastore</code>，则 <code>--meta-connect jdbc:hsqldb:hsql://linux01:16000/sqoop</code></li>
</ol>
</li>
</ul>
<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--create  &lt;job-id&gt;</code></td>
<td>创建 <code>job</code> 参数</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--delete  &lt;job-id&gt;</code></td>
<td>删除一个 <code>job</code></td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--exec  &lt;job-id&gt;</code></td>
<td>执行一个 <code>job</code></td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--help</code></td>
<td>显示 <code>job</code> 帮助</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--list</code></td>
<td>显示 <code>job</code> 列表</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--meta-connect  &lt;jdbc-uri&gt;</code></td>
<td>用来连接 <code>metastore</code> 服务</td>
</tr>
<tr>
<td align="center">7</td>
<td><code>--show  &lt;job-id&gt;</code></td>
<td>显示一个 <code>job</code> 的信息</td>
</tr>
<tr>
<td align="center">8</td>
<td><code>--verbose</code></td>
<td>打印命令运行时的详细信息</td>
</tr>
</tbody></table>
<p><strong>提示：</strong>在执行一个 <code>job</code> 时，如果需要手动输入数据库密码，可以做如下优化</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>sqoop.metastore.client.record.password<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>If true, allow saved passwords in the metastore.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="5-2-12-命令-amp-参数：list-databases"><a href="#5-2-12-命令-amp-参数：list-databases" class="headerlink" title="5.2.12 命令&amp;参数：list-databases"></a>5.2.12 命令&amp;参数：list-databases</h3><p><strong>命令：</strong>  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  bin/sqoop list-databases \  --connect jdbc:mysql://hadoop102:3306/  \  --username root \  --password 123456</span><br></pre></td></tr></table></figure>



<p><strong>参数：</strong>与公用参数一样</p>
<hr>
<h3 id="5-2-13-命令-amp-参数：list-tables"><a href="#5-2-13-命令-amp-参数：list-tables" class="headerlink" title="5.2.13    命令&amp;参数：list-tables"></a>5.2.13    命令&amp;参数：list-tables</h3><p><strong>命令：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  bin/sqoop list-tables \  --connect jdbc:mysql://hadoop102:3306/company  \  --username root \  --password 123456</span><br></pre></td></tr></table></figure>



<p><strong>参数：</strong>与公用参数一样</p>
<hr>
<h3 id="5-2-14-命令-amp-参数：merge"><a href="#5-2-14-命令-amp-参数：merge" class="headerlink" title="5.2.14    命令&amp;参数：merge"></a>5.2.14    命令&amp;参数：merge</h3><p><strong>作用：</strong>将 <code>HDFS</code> 中不同目录下面的数据合并在一起并放入指定目录中。</p>
<p><strong>数据环境：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">new_staff</span><br><span class="line">1	AAA	male</span><br><span class="line">2	BBB	male</span><br><span class="line">3	CCC	male</span><br><span class="line">4	DDD	male</span><br><span class="line">old_staff</span><br><span class="line">1	AAA	female</span><br><span class="line">2	CCC	female</span><br><span class="line">3	BBB	female</span><br><span class="line">6	DDD	female</span><br></pre></td></tr></table></figure>

<ul>
<li>  <strong>提示：</strong>上述数据的列之间的分隔符应该为 <code>\t</code>，行与行之间的分割符为 <code>\n</code>，如果直接复制，请检查。</li>
</ul>
<p><strong>命令：</strong></p>
<p>eg：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建JavaBean：</span></span><br><span class="line">$ bin/sqoop codegen \</span><br><span class="line">--connect jdbc:mysql://hadoop102:3306/company \</span><br><span class="line">--username root \</span><br><span class="line">--password 123456 \</span><br><span class="line">--table staff \</span><br><span class="line">--bindir /home/admin/Desktop/staff \</span><br><span class="line">--class-name Staff \</span><br><span class="line">--fields-terminated-by <span class="string">&quot;\t&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始合并：</span></span><br><span class="line">$ bin/sqoop merge \</span><br><span class="line">--new-data /test/new/ \</span><br><span class="line">--onto /test/old/ \</span><br><span class="line">--target-dir /test/merged \</span><br><span class="line">--jar-file /home/admin/Desktop/staff/Staff.jar \</span><br><span class="line">--class-name Staff \</span><br><span class="line">--merge-key <span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line">1	AAA	MALE</span><br><span class="line">2	BBB	MALE</span><br><span class="line">3	CCC	MALE</span><br><span class="line">4	DDD	MALE</span><br><span class="line">6	DDD	FEMALE</span><br></pre></td></tr></table></figure>

<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td><code>--new-data &lt;path&gt;</code></td>
<td>HDFS  中待合并数据的目录，合并后在新的数据集中保留</td>
</tr>
<tr>
<td align="center">2</td>
<td><code>--onto &lt;path&gt;</code></td>
<td>HDFS 合并后，重复的部分在新的数据集中被覆盖</td>
</tr>
<tr>
<td align="center">3</td>
<td><code>--merge-key  &lt;col&gt;</code></td>
<td>合并键，一般是主键ID</td>
</tr>
<tr>
<td align="center">4</td>
<td><code>--jar-file  &lt;file&gt;</code></td>
<td>合并时引入的 <code>jar</code> 包，该 <code>jar</code> 包是通过 <code>Codegen</code> 工具生成的 <code>jar</code> 包</td>
</tr>
<tr>
<td align="center">5</td>
<td><code>--class-name  &lt;class&gt;</code></td>
<td>对应的表名或对象名，该 <code>class</code> 类是包含在 <code>jar</code> 包中的</td>
</tr>
<tr>
<td align="center">6</td>
<td><code>--target-dir  &lt;path&gt;</code></td>
<td>合并后的数据在 HDFS 里存放的目录</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-2-15-命令-amp-参数：metastore"><a href="#5-2-15-命令-amp-参数：metastore" class="headerlink" title="5.2.15    命令&amp;参数：metastore"></a>5.2.15    命令&amp;参数：metastore</h3><p>记录了 <code>Sqoop job</code> 的元数据信息，如果不启动该服务，那么默认 <code>job</code> 元数据的存储目录为 <code>~/.sqoop</code>，可在 <code>sqoop-site.xml</code> 中修改。</p>
<p><strong>命令：</strong></p>
<p>eg：启动 <code>sqoop</code> 的 <code>metastore</code> 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqoop metastore</span><br></pre></td></tr></table></figure>



<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center"><code>--shutdown</code></td>
<td>关闭 <code>metastore</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/26/Spark-MLlib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/26/Spark-MLlib/" class="post-title-link" itemprop="url">Spark_MLlib</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-26 11:10:05" itemprop="dateCreated datePublished" datetime="2021-12-26T11:10:05+08:00">2021-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-12-28 14:34:40" itemprop="dateModified" datetime="2021-12-28T14:34:40+08:00">2021-12-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spark/" itemprop="url" rel="index"><span itemprop="name">Spark</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="机器学习开发流程"><a href="#机器学习开发流程" class="headerlink" title="机器学习开发流程"></a>机器学习开发流程</h1><ol>
<li> 获取数据</li>
<li> 数据处理</li>
<li> 特征工程</li>
<li> 机器学习算法进行训练 ==&gt; 模型</li>
<li> 模型评估</li>
<li> 应用</li>
</ol>
<h1 id="常见数据集地址"><a href="#常见数据集地址" class="headerlink" title="常见数据集地址"></a>常见数据集地址</h1><p>Kaggle：<a target="_blank" rel="noopener" href="https://www.kaggle.com/datasets">https://www.kaggle.com/datasets</a></p>
<p>UCI：<a target="_blank" rel="noopener" href="https://archive.ics.uci.edu/ml/index.php">https://archive.ics.uci.edu/ml/index.php</a></p>
<p>scikit-learn：<a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/">https://scikit-learn.org/stable/</a></p>
<h2 id="鸢尾花数据集"><a href="#鸢尾花数据集" class="headerlink" title="鸢尾花数据集"></a>鸢尾花数据集</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">5.1,3.5,1.4,0.2,Iris-setosa</span><br><span class="line">4.9,3.0,1.4,0.2,Iris-setosa</span><br><span class="line">4.7,3.2,1.3,0.2,Iris-setosa</span><br><span class="line">4.6,3.1,1.5,0.2,Iris-setosa</span><br><span class="line">5.0,3.6,1.4,0.2,Iris-setosa</span><br><span class="line">5.4,3.9,1.7,0.4,Iris-setosa</span><br><span class="line">4.6,3.4,1.4,0.3,Iris-setosa</span><br><span class="line">5.0,3.4,1.5,0.2,Iris-setosa</span><br><span class="line">4.4,2.9,1.4,0.2,Iris-setosa</span><br><span class="line">4.9,3.1,1.5,0.1,Iris-setosa</span><br><span class="line">5.4,3.7,1.5,0.2,Iris-setosa</span><br><span class="line">4.8,3.4,1.6,0.2,Iris-setosa</span><br><span class="line">4.8,3.0,1.4,0.1,Iris-setosa</span><br><span class="line">4.3,3.0,1.1,0.1,Iris-setosa</span><br><span class="line">5.8,4.0,1.2,0.2,Iris-setosa</span><br></pre></td></tr></table></figure>

<ul>
<li>  data：特征值数组</li>
<li>  target：目标值数组</li>
<li>  feature_name：特征值名字</li>
<li>  target_name：目标值名字</li>
</ul>
<p>钻头整体一类：分为多个类别</p>
<p>钻杆整体一类</p>
<p>钻井液整体一类</p>
<h1 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h1><h2 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">文本类型 ==&gt; 数值</span><br><span class="line"></span><br><span class="line">类别 ==&gt; 数值</span><br><span class="line"></span><br><span class="line">vector	向量	一维数组</span><br><span class="line">matrix	矩阵	二维数组</span><br><span class="line"></span><br><span class="line">父类：转换器类	==&gt; 用转换器类将文本转换成数值</span><br><span class="line"></span><br><span class="line">将类别转换成特征 ==&gt; 一个类别，扩充成多个特征（one-hot编码）</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="字典特征抽取"><a href="#字典特征抽取" class="headerlink" title="字典特征抽取"></a>字典特征抽取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、实例化一个转换器类</span><br><span class="line">2、调用对象中的方法</span><br></pre></td></tr></table></figure>

<ul>
<li>  稀疏矩阵（P8）</li>
</ul>
<p>为了类别公平，转换成 one-hot 编码</p>
<p>应用场景：数据集当中，类别特征比较多的时候</p>
<ol>
<li> <code>将数据集特征 --&gt; 字典类型</code></li>
</ol>
<p>如果将清单上所有的物料都划分到一个类别中的，那么排列组合后得到的所有情况太多了，不太好处理。</p>
<h3 id="文本特征抽取"><a href="#文本特征抽取" class="headerlink" title="文本特征抽取"></a>文本特征抽取</h3><ul>
<li>  <code>TF-IDF</code>：文本特征抽取。用于提取文本文档中的关键词。在 Spark 中同样有（与毕设无关）。</li>
</ul>
<hr>
<h2 id="特征预处理"><a href="#特征预处理" class="headerlink" title="特征预处理"></a>特征预处理</h2><p>无量纲化：使不同规格的数据转化到同一规格</p>
<ul>
<li>  归一化：使用放缩器</li>
<li>  标准化：</li>
</ul>
<h3 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h3><p>通过对原始数据进行变换把数据映射到（默认为[0,1]）之间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、获取数据</span><br><span class="line">2、实例化一个转换器类</span><br><span class="line">3、调用转换方法</span><br><span class="line"></span><br><span class="line">// 进行特征工程时，可以选择要对哪些数据（哪几行哪几列）进行处理</span><br></pre></td></tr></table></figure>





<h3 id="标准化"><a href="#标准化" class="headerlink" title="标准化"></a>标准化</h3><p>归一化的缺点：由于归一化的计算公式是根据最大值和最小值计算出来的，所以在进行归一化的时候，如果有异常值（过大或过小值），则会影响最终的归一化结果。</p>
<p>鲁棒性：健壮性</p>
<p>标准化：对原始数据进行变化，把数据变换到均值为 0，标准差为 1 的范围内</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="特征降维"><a href="#特征降维" class="headerlink" title="特征降维"></a>特征降维</h2><p>二维数组</p>
<ul>
<li>  几行就代表有几个样本</li>
<li>  几列就代表有几个特征</li>
</ul>
<p>降维就是降低列数（特征的个数）</p>
<p>希望得到结果：特征与特征之间不相关。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">比如：降雨量与湿度就是一对相关的变量</span><br></pre></td></tr></table></figure>



<h3 id="特征选择"><a href="#特征选择" class="headerlink" title="特征选择"></a>特征选择</h3><ol>
<li> 删除冗余特征：所有样本都具有的特征就叫做冗余特征</li>
<li></li>
</ol>
<p>特征之间相关性很高的时候，①可以选取其中一个即可。②可以将多个特征按一定的权重组合起来。③主成分分析</p>
<h3 id="主成分分析"><a href="#主成分分析" class="headerlink" title="主成分分析"></a>主成分分析</h3><ul>
<li>  定义：<strong>高维数据转化为低维数据的过程</strong>，在此过程中<strong>可能会舍弃原有数据、创造新的变量</strong></li>
<li>  作用：<strong>是数据维数压缩，尽可能降低原数据的维数（复杂度），损失少量信息。</strong></li>
<li>  应用：回归分析或者聚类分析当中</li>
</ul>
<hr>
<h1 id="特征工程-1"><a href="#特征工程-1" class="headerlink" title="特征工程"></a>特征工程</h1><p><img src="/2021/12/26/Spark-MLlib/fb2e1de527829c503514731396edb68a.jpg" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1、预处理：</span><br><span class="line">	字符型特征值 ==&gt; 数值型特征值</span><br><span class="line">	StringIndexer</span><br><span class="line">	</span><br><span class="line">2、特征选择：降维</span><br><span class="line">	2.1	人工选择</span><br><span class="line">	2.2 统计学方法：Pearson系数、卡方分布</span><br><span class="line">	</span><br><span class="line">3、归一化</span><br><span class="line">	消除特异值误差</span><br><span class="line">4、离散化</span><br><span class="line">	???</span><br><span class="line">5、Embedding</span><br><span class="line">	多用于分类，常见的是 one-hot 编码</span><br><span class="line">6、向量计算</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7、离散化</span><br><span class="line">	降低原始数据的多样性</span><br><span class="line">	场景	适用于 温度、湿度  等等连续数据</span><br><span class="line">	目的	提升特征数据的区分度与内聚性 </span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">|-- Id: string (nullable = true)</span><br><span class="line">|-- LotFrontage: string (nullable = true)</span><br><span class="line">|-- LotArea: string (nullable = true)</span><br><span class="line">|-- MasVnrArea: string (nullable = true)</span><br><span class="line">|-- BsmtFinSF1: string (nullable = true)</span><br><span class="line">|-- BsmtFinSF2: string (nullable = true)</span><br><span class="line">|-- BsmtUnfSF: string (nullable = true)</span><br><span class="line">|-- TotalBsmtSF: string (nullable = true)</span><br><span class="line">|-- 1stFlrSF: string (nullable = true)</span><br><span class="line">|-- 2ndFlrSF: string (nullable = true)</span><br><span class="line">|-- LowQualFinSF: string (nullable = true)</span><br><span class="line">|-- GrLivArea: string (nullable = true)</span><br><span class="line">|-- BsmtFullBath: string (nullable = true)</span><br><span class="line">|-- BsmtHalfBath: string (nullable = true)</span><br><span class="line">|-- FullBath: string (nullable = true)</span><br><span class="line">|-- HalfBath: string (nullable = true)</span><br><span class="line">|-- BedroomAbvGr: string (nullable = true)</span><br><span class="line">|-- KitchenAbvGr: string (nullable = true)</span><br><span class="line">|-- TotRmsAbvGrd: string (nullable = true)</span><br><span class="line">|-- Fireplaces: string (nullable = true)</span><br><span class="line">|-- GarageCars: string (nullable = true)</span><br><span class="line">|-- GarageArea: string (nullable = true)</span><br><span class="line">|-- WoodDeckSF: string (nullable = true)</span><br><span class="line">|-- OpenPorchSF: string (nullable = true)</span><br><span class="line">|-- EnclosedPorch: string (nullable = true)</span><br><span class="line">|-- 3SsnPorch: string (nullable = true)</span><br><span class="line">|-- ScreenPorch: string (nullable = true)</span><br><span class="line">|-- PoolArea: string (nullable = true)</span><br><span class="line">|-- SalePrice: string (nullable = true)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">|-- MSSubClassIndex: double (nullable = true)</span><br><span class="line">|-- MSZoningIndex: double (nullable = true)</span><br><span class="line">|-- StreetIndex: double (nullable = true)</span><br><span class="line">|-- AlleyIndex: double (nullable = true)</span><br><span class="line">|-- LotShapeIndex: double (nullable = true)</span><br><span class="line">|-- LandContourIndex: double (nullable = true)</span><br><span class="line">|-- UtilitiesIndex: double (nullable = true)</span><br><span class="line">|-- LotConfigIndex: double (nullable = true)</span><br><span class="line">|-- LandSlopeIndex: double (nullable = true)</span><br><span class="line">|-- NeighborhoodIndex: double (nullable = true)</span><br><span class="line">|-- Condition1Index: double (nullable = true)</span><br><span class="line">|-- Condition2Index: double (nullable = true)</span><br><span class="line">|-- BldgTypeIndex: double (nullable = true)</span><br><span class="line">|-- HouseStyleIndex: double (nullable = true)</span><br><span class="line">|-- OverallQualIndex: double (nullable = true)</span><br><span class="line">|-- OverallCondIndex: double (nullable = true)</span><br><span class="line">|-- YearBuiltIndex: double (nullable = true)</span><br><span class="line">|-- YearRemodAddIndex: double (nullable = true)</span><br><span class="line">|-- RoofStyleIndex: double (nullable = true)</span><br><span class="line">|-- RoofMatlIndex: double (nullable = true)</span><br><span class="line">|-- Exterior1stIndex: double (nullable = true)</span><br><span class="line">|-- Exterior2ndIndex: double (nullable = true)</span><br><span class="line">|-- MasVnrTypeIndex: double (nullable = true)</span><br><span class="line">|-- ExterQualIndex: double (nullable = true)</span><br><span class="line">|-- ExterCondIndex: double (nullable = true)</span><br><span class="line">|-- FoundationIndex: double (nullable = true)</span><br><span class="line">|-- BsmtQualIndex: double (nullable = true)</span><br><span class="line">|-- BsmtCondIndex: double (nullable = true)</span><br><span class="line">|-- BsmtExposureIndex: double (nullable = true)</span><br><span class="line">|-- BsmtFinType1Index: double (nullable = true)</span><br><span class="line">|-- BsmtFinType2Index: double (nullable = true)</span><br><span class="line">|-- HeatingIndex: double (nullable = true)</span><br><span class="line">|-- HeatingQCIndex: double (nullable = true)</span><br><span class="line">|-- CentralAirIndex: double (nullable = true)</span><br><span class="line">|-- ElectricalIndex: double (nullable = true)</span><br><span class="line">|-- KitchenQualIndex: double (nullable = true)</span><br><span class="line">|-- FunctionalIndex: double (nullable = true)</span><br><span class="line">|-- FireplaceQuIndex: double (nullable = true)</span><br><span class="line">|-- GarageTypeIndex: double (nullable = true)</span><br><span class="line">|-- GarageYrBltIndex: double (nullable = true)</span><br><span class="line">|-- GarageFinishIndex: double (nullable = true)</span><br><span class="line">|-- GarageQualIndex: double (nullable = true)</span><br><span class="line">|-- GarageCondIndex: double (nullable = true)</span><br><span class="line">|-- PavedDriveIndex: double (nullable = true)</span><br><span class="line">|-- PoolQCIndex: double (nullable = true)</span><br><span class="line">|-- FenceIndex: double (nullable = true)</span><br><span class="line">|-- MiscFeatureIndex: double (nullable = true)</span><br><span class="line">|-- MiscValIndex: double (nullable = true)</span><br><span class="line">|-- MoSoldIndex: double (nullable = true)</span><br><span class="line">|-- YrSoldIndex: double (nullable = true)</span><br><span class="line">|-- SaleTypeIndex: double (nullable = true)</span><br><span class="line">|-- SaleConditionIndex: double (nullable = true)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- Id: string (nullable = true)</span><br><span class="line"> |-- LotFrontage: string (nullable = true)</span><br><span class="line"> |-- MSSubClassIndex: double (nullable = true)</span><br><span class="line"> |-- MSZoningIndex: double (nullable = true)</span><br><span class="line"> |-- StreetIndex: double (nullable = true)</span><br><span class="line"> |-- AlleyIndex: double (nullable = true)</span><br><span class="line"> |-- LotShapeIndex: double (nullable = true)</span><br><span class="line"> |-- LandContourIndex: double (nullable = true)</span><br><span class="line"> |-- UtilitiesIndex: double (nullable = true)</span><br><span class="line"> |-- LotConfigIndex: double (nullable = true)</span><br><span class="line"> |-- LandSlopeIndex: double (nullable = true)</span><br><span class="line"> |-- NeighborhoodIndex: double (nullable = true)</span><br><span class="line"> |-- Condition1Index: double (nullable = true)</span><br><span class="line"> |-- Condition2Index: double (nullable = true)</span><br><span class="line"> |-- BldgTypeIndex: double (nullable = true)</span><br><span class="line"> |-- HouseStyleIndex: double (nullable = true)</span><br><span class="line"> |-- OverallQualIndex: double (nullable = true)</span><br><span class="line"> |-- OverallCondIndex: double (nullable = true)</span><br><span class="line"> |-- YearBuiltIndex: double (nullable = true)</span><br><span class="line"> |-- YearRemodAddIndex: double (nullable = true)</span><br><span class="line"> |-- RoofStyleIndex: double (nullable = true)</span><br><span class="line"> |-- RoofMatlIndex: double (nullable = true)</span><br><span class="line"> |-- Exterior1stIndex: double (nullable = true)</span><br><span class="line"> |-- Exterior2ndIndex: double (nullable = true)</span><br><span class="line"> |-- MasVnrTypeIndex: double (nullable = true)</span><br><span class="line"> |-- ExterQualIndex: double (nullable = true)</span><br><span class="line"> |-- ExterCondIndex: double (nullable = true)</span><br><span class="line"> |-- FoundationIndex: double (nullable = true)</span><br><span class="line"> |-- BsmtQualIndex: double (nullable = true)</span><br><span class="line"> |-- BsmtCondIndex: double (nullable = true)</span><br><span class="line"> |-- BsmtExposureIndex: double (nullable = true)</span><br><span class="line"> |-- BsmtFinType1Index: double (nullable = true)</span><br><span class="line"> |-- BsmtFinType2Index: double (nullable = true)</span><br><span class="line"> |-- HeatingIndex: double (nullable = true)</span><br><span class="line"> |-- HeatingQCIndex: double (nullable = true)</span><br><span class="line"> |-- CentralAirIndex: double (nullable = true)</span><br><span class="line"> |-- ElectricalIndex: double (nullable = true)</span><br><span class="line"> |-- KitchenQualIndex: double (nullable = true)</span><br><span class="line"> |-- FunctionalIndex: double (nullable = true)</span><br><span class="line"> |-- FireplaceQuIndex: double (nullable = true)</span><br><span class="line"> |-- GarageTypeIndex: double (nullable = true)</span><br><span class="line"> |-- GarageYrBltIndex: double (nullable = true)</span><br><span class="line"> |-- GarageFinishIndex: double (nullable = true)</span><br><span class="line"> |-- GarageQualIndex: double (nullable = true)</span><br><span class="line"> |-- GarageCondIndex: double (nullable = true)</span><br><span class="line"> |-- PavedDriveIndex: double (nullable = true)</span><br><span class="line"> |-- PoolQCIndex: double (nullable = true)</span><br><span class="line"> |-- FenceIndex: double (nullable = true)</span><br><span class="line"> |-- MiscFeatureIndex: double (nullable = true)</span><br><span class="line"> |-- MiscValIndex: double (nullable = true)</span><br><span class="line"> |-- MoSoldIndex: double (nullable = true)</span><br><span class="line"> |-- YrSoldIndex: double (nullable = true)</span><br><span class="line"> |-- SaleTypeIndex: double (nullable = true)</span><br><span class="line"> |-- SaleConditionIndex: double (nullable = true)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> |-- LotAreaInt: double (nullable = true)</span><br><span class="line"> |-- MasVnrAreaInt: double (nullable = true)</span><br><span class="line"> |-- BsmtFinSF1Int: double (nullable = true)</span><br><span class="line"> |-- BsmtFinSF2Int: double (nullable = true)</span><br><span class="line"> |-- BsmtUnfSFInt: double (nullable = true)</span><br><span class="line"> |-- TotalBsmtSFInt: double (nullable = true)</span><br><span class="line"> |-- 1stFlrSFInt: double (nullable = true)</span><br><span class="line"> |-- 2ndFlrSFInt: double (nullable = true)</span><br><span class="line"> |-- LowQualFinSFInt: double (nullable = true)</span><br><span class="line"> |-- GrLivAreaInt: double (nullable = true)</span><br><span class="line"> |-- BsmtFullBathInt: double (nullable = true)</span><br><span class="line"> |-- BsmtHalfBathInt: double (nullable = true)</span><br><span class="line"> |-- FullBathInt: double (nullable = true)</span><br><span class="line"> |-- HalfBathInt: double (nullable = true)</span><br><span class="line"> |-- BedroomAbvGrInt: double (nullable = true)</span><br><span class="line"> |-- KitchenAbvGrInt: double (nullable = true)</span><br><span class="line"> |-- TotRmsAbvGrdInt: double (nullable = true)</span><br><span class="line"> |-- FireplacesInt: double (nullable = true)</span><br><span class="line"> |-- GarageCarsInt: double (nullable = true)</span><br><span class="line"> |-- GarageAreaInt: double (nullable = true)</span><br><span class="line"> |-- WoodDeckSFInt: double (nullable = true)</span><br><span class="line"> |-- OpenPorchSFInt: double (nullable = true)</span><br><span class="line"> |-- EnclosedPorchInt: double (nullable = true)</span><br><span class="line"> |-- 3SsnPorchInt: double (nullable = true)</span><br><span class="line"> |-- ScreenPorchInt: double (nullable = true)</span><br><span class="line"> |-- PoolAreaInt: double (nullable = true)</span><br><span class="line"> |-- SalePriceInt: double (nullable = true)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> |-- features: vector (nullable = true)</span><br><span class="line"> </span><br><span class="line"> |-- LotAreaIntVector: vector (nullable = true)</span><br><span class="line"> |-- GrLivAreaIntVector: vector (nullable = true)</span><br><span class="line"> |-- TotalBsmtSFIntVector: vector (nullable = true)</span><br><span class="line"> |-- GarageAreaIntVector: vector (nullable = true)</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_28844767/article/details/94465688">https://blog.csdn.net/qq_28844767/article/details/94465688</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/23/Scala%E5%AE%B9%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/23/Scala%E5%AE%B9%E5%99%A8/" class="post-title-link" itemprop="url">Scala容器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-23 14:33:48 / Modified: 15:14:41" itemprop="dateCreated datePublished" datetime="2021-12-23T14:33:48+08:00">2021-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Scala/" itemprop="url" rel="index"><span itemprop="name">Scala</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Scala-数组"><a href="#Scala-数组" class="headerlink" title="Scala 数组"></a>Scala 数组</h1><p>数组是用来存储<strong>定长</strong>的<strong>同类型元素</strong>的容器。</p>
<p>以下是 Scala 数组声明的语法格式：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> z:<span class="type">Array</span>[<span class="type">String</span>] = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">String</span>](<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> z = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">String</span>](<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>以上语法中，<code>z</code> 声明一个字符串类型的数组，数组长度为 3 ，可存储 3 个元素。我们可以为每个元素设置值，并通过索引来访问每个元素，如下所示：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z(<span class="number">0</span>) = <span class="string">&quot;Runoob&quot;</span>; z(<span class="number">1</span>) = <span class="string">&quot;Baidu&quot;</span>; z(<span class="number">2</span>) = <span class="string">&quot;Google&quot;</span></span><br></pre></td></tr></table></figure>



<p>我们也可以使用以下方式来定义一个数组：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> z = <span class="type">Array</span>(<span class="string">&quot;Runoob&quot;</span>, <span class="string">&quot;Baidu&quot;</span>, <span class="string">&quot;Google&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="不可变数组"><a href="#不可变数组" class="headerlink" title="不可变数组"></a>不可变数组</h2><ol>
<li><p>第一种方式定义数组(定长数组)</p>
 <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr1 = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Int</span>](<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）<span class="keyword">new</span>是关键字</span><br><span class="line">（<span class="number">2</span>）[<span class="type">Int</span>]是泛型，如果希望存放任意数据类型，则指定<span class="type">Any</span></span><br><span class="line">（<span class="number">3</span>）(<span class="number">10</span>)，表示数组的大小，确定后就不可以变化</span><br></pre></td></tr></table></figure></li>
<li><p>案例实操</p>
 <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ArrayBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestArray</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）数组定义</span></span><br><span class="line">        <span class="keyword">val</span> arr01 = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Int</span>](<span class="number">4</span>)</span><br><span class="line">        println(arr01.length) <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）数组赋值</span></span><br><span class="line">        <span class="comment">//（2.1）修改某个元素的值</span></span><br><span class="line">        arr01(<span class="number">3</span>) = <span class="number">10</span></span><br><span class="line">        <span class="comment">//（2.2）采用方法的形式给数组赋值</span></span><br><span class="line">        arr01.update(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）遍历数组</span></span><br><span class="line">        <span class="comment">//（3.1）查看数组</span></span><br><span class="line">        println(arr01.mkString(<span class="string">&quot;,&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3.2）普通遍历</span></span><br><span class="line">        <span class="keyword">for</span> (i &lt;- arr01) &#123;</span><br><span class="line">            println(i)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3.3）简化遍历</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">printx</span></span>(elem:<span class="type">Int</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">            println(elem)</span><br><span class="line">        &#125;</span><br><span class="line">        arr01.foreach(printx)</span><br><span class="line">        <span class="comment">// arr01.foreach((x)=&gt;&#123;println(x)&#125;)</span></span><br><span class="line">        <span class="comment">// arr01.foreach(println(_))</span></span><br><span class="line">        arr01.foreach(println)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）增加元素（由于创建的是不可变数组，增加元素，其实是产生新的数组）</span></span><br><span class="line">        println(arr01)</span><br><span class="line">        <span class="keyword">val</span> ints: <span class="type">Array</span>[<span class="type">Int</span>] = arr01 :+ <span class="number">5</span></span><br><span class="line">        println(ints)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>第二种方式定义数组</p>
 <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr1 = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">（<span class="number">1</span>）在定义数组时，直接赋值</span><br><span class="line">（<span class="number">2</span>）底层使用apply方法创建数组对象</span><br></pre></td></tr></table></figure>

</li>
<li><p>案例实操</p>
 <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestArray</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">var</span> arr02 = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;bobo&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (i &lt;- arr02) &#123;</span><br><span class="line">            println(i)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="可变数组"><a href="#可变数组" class="headerlink" title="可变数组"></a>可变数组</h2><p>定义变长数组</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr01 = <span class="type">ArrayBuffer</span>[<span class="type">Any</span>](<span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）[<span class="type">Any</span>]存放任意数据类型</span><br><span class="line">（<span class="number">2</span>）(<span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>)初始化好的三个元素</span><br><span class="line">（<span class="number">3</span>）<span class="type">ArrayBuffer</span>需要引入scala.collection.mutable.<span class="type">ArrayBuffer</span></span><br></pre></td></tr></table></figure>





<p><strong>Demo</strong></p>
<ol>
<li> <code>ArrayBuffer</code> 是有序的集合</li>
<li> 增加元素使用的是 <code>append()</code> 方法，支持可变参数</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ArrayBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestArrayBuffer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）创建并赋值可变数组</span></span><br><span class="line">        <span class="keyword">val</span> arr01 = <span class="type">ArrayBuffer</span>[<span class="type">Any</span>](<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）遍历数组</span></span><br><span class="line">        <span class="keyword">for</span> (i &lt;- arr01) &#123;</span><br><span class="line">            println(i)</span><br><span class="line">        &#125;</span><br><span class="line">        println(arr01.length) <span class="comment">// 3</span></span><br><span class="line">        println(<span class="string">&quot;arr01.hash=&quot;</span> + arr01.hashCode())</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）增加元素</span></span><br><span class="line">        <span class="comment">//（3.1）追加数据</span></span><br><span class="line">        arr01.+=(<span class="number">4</span>)</span><br><span class="line">        <span class="comment">//（3.2）向数组最后追加数据</span></span><br><span class="line">        arr01.append(<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">        <span class="comment">//（3.3）向指定的位置插入数据</span></span><br><span class="line">        arr01.insert(<span class="number">0</span>,<span class="number">7</span>,<span class="number">8</span>)</span><br><span class="line">        println(<span class="string">&quot;arr01.hash=&quot;</span> + arr01.hashCode())</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）修改元素</span></span><br><span class="line">        arr01(<span class="number">1</span>) = <span class="number">9</span> <span class="comment">//修改第2个元素的值</span></span><br><span class="line">        println(<span class="string">&quot;--------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i &lt;- arr01) &#123;</span><br><span class="line">            println(i)</span><br><span class="line">        &#125;</span><br><span class="line">        println(arr01.length) <span class="comment">// 5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="不可变数组与可变数组的转换"><a href="#不可变数组与可变数组的转换" class="headerlink" title="不可变数组与可变数组的转换"></a>不可变数组与可变数组的转换</h2><p><strong>说明</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr1.toBuffer <span class="comment">//不可长数组转可变数组</span></span><br><span class="line"></span><br><span class="line">arr2.toArray <span class="comment">//可变数组转不可变数组</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>arr2.toArray</code> 返回结果才是一个不可变数组，arr2 本身没有变化</li>
<li>  <code>arr1.toBuffer</code> 返回结果才是一个可变数组，arr1 本身没有变化</li>
</ul>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestArrayBuffer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）创建一个空的可变数组</span></span><br><span class="line">        <span class="keyword">val</span> arr2 = <span class="type">ArrayBuffer</span>[<span class="type">Int</span>]()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）追加值</span></span><br><span class="line">        arr2.append(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        println(arr2) <span class="comment">// 1,2,3</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）ArrayBuffer ==&gt; Array</span></span><br><span class="line">        <span class="comment">//（3.1）arr2.toArray 返回的结果是一个新的定长数组集合</span></span><br><span class="line">        <span class="comment">//（3.2）arr2它没有变化</span></span><br><span class="line">        <span class="keyword">val</span> newArr = arr2.toArray</span><br><span class="line">        println(newArr)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）Array ===&gt; ArrayBuffer</span></span><br><span class="line">        <span class="comment">//（4.1）newArr.toBuffer 返回一个变长数组 newArr2</span></span><br><span class="line">        <span class="comment">//（4.2）newArr 没有任何变化，依然是定长数组</span></span><br><span class="line">        <span class="keyword">val</span> newArr2 = newArr.toBuffer</span><br><span class="line">        newArr2.append(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">        println(newArr2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h2><p>多维数组定义</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr = <span class="type">Array</span>.ofDim[<span class="type">Double</span>](<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>说明：二维数组中有三个一维数组，每个一维数组中有四个元素</p>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">DimArray</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）创建了一个二维数组, 有三个元素，每个元素是，含有4个元素一维数组()</span></span><br><span class="line">        <span class="keyword">val</span> arr = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">        arr(<span class="number">1</span>)(<span class="number">2</span>) = <span class="number">88</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）遍历二维数组</span></span><br><span class="line">        <span class="keyword">for</span> (i &lt;- arr) &#123; <span class="comment">//i 就是一维数组</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (j &lt;- i) &#123;</span><br><span class="line">                print(j + <span class="string">&quot; &quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            println()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h1 id="Scala-集合-Collection"><a href="#Scala-集合-Collection" class="headerlink" title="Scala 集合(Collection)"></a>Scala 集合(Collection)</h1><h2 id="集合分类一"><a href="#集合分类一" class="headerlink" title="集合分类一"></a>集合分类一</h2><p>Scala 集合分为<strong>可变集合</strong>和<strong>不可变集合</strong>。</p>
<p>可变集合可以被更新或扩展。这意味着你可以修改，添加，移除一个集合的元素。</p>
<p>而不可变集合永远不会改变。不过，你仍然可以模拟添加，移除或更新操作。但是这些操作将在每一种情况下都返回一个新的集合，而不是改变原来的集合。</p>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="left">集合及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/scala/scala-lists.html">Scala List(列表)</a><br>List 的特征是其元素以线性方式存储，集合中可以存放重复对象。<br>参考 <a target="_blank" rel="noopener" href="http://www.scala-lang.org/api/current/scala/collection/immutable/List.html">API文档</a></td>
</tr>
<tr>
<td align="center">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/scala/scala-sets.html">Scala Set(集合)</a><br>Set是最简单的一种集合。集合中的对象不按特定的方式排序，并且没有重复对象。<br>参考 <a target="_blank" rel="noopener" href="http://www.scala-lang.org/api/current/scala/collection/immutable/Set.html">API文档</a></td>
</tr>
<tr>
<td align="center">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/scala/scala-maps.html">Scala Map(映射)</a><br>Map 是一种把键对象和值对象映射的集合，它的每一个元素都包含一对键对象和值对象。<br>参考 <a target="_blank" rel="noopener" href="http://www.scala-lang.org/api/current/scala/collection/immutable/Map.html">API文档</a></td>
</tr>
<tr>
<td align="center">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/scala/scala-tuples.html">Scala 元组</a><br>元组是不同类型的值的集合</td>
</tr>
<tr>
<td align="center">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/scala/scala-options.html">Scala Option</a><br>Option[T] 表示有可能包含值的容器，也可能不包含值。</td>
</tr>
<tr>
<td align="center">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/scala/scala-iterators.html">Scala Iterator（迭代器）</a><br>迭代器不是一个容器，更确切的说是逐一访问容器内元素的方法。</td>
</tr>
</tbody></table>
<h2 id="集合简介"><a href="#集合简介" class="headerlink" title="集合简介"></a>集合简介</h2><p><strong>说明</strong></p>
<ol>
<li><p> Scala 的集合有三大类：序列 Seq、集 Set、映射 Map，所有的集合都扩展自 Iterable 特质。</p>
</li>
<li><p>对于几乎所有的集合类，Scala 都同时提供了<strong>可变</strong>和<strong>不可变</strong>的版本，分别位于以下两个包</p>
<ul>
<li>  不可变集合：<code>scala.collection.immutable</code></li>
<li>可变集合：<code>scala.collection.mutable</code></li>
</ul>
</li>
</ol>
<p>2）案例实操</p>
<p>​    （1）Scala不可变集合，就是指该集合对象不可修改，每次修改就会返回一个新对象，而不会对原对象进行修改。</p>
<p>（2）可变集合，就是这个集合可以直接对原对象进行修改，而不会返回新的对象。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//不可变List</span></span><br><span class="line">        <span class="keyword">val</span> immutableList: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对不可变List进行修改，在头部添加一个元素0</span></span><br><span class="line">        <span class="keyword">val</span> newImmutableList: <span class="type">List</span>[<span class="type">Int</span>] = <span class="number">0</span> +: immutableList</span><br><span class="line"></span><br><span class="line">        println(immutableList)</span><br><span class="line"></span><br><span class="line">        println(newImmutableList)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//可变List</span></span><br><span class="line">        <span class="keyword">val</span> mutableList: <span class="type">ListBuffer</span>[<span class="type">Int</span>] = <span class="type">ListBuffer</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对可变List进行修改，在头部添加一个元素0</span></span><br><span class="line">        <span class="keyword">val</span> newMutableList: <span class="type">ListBuffer</span>[<span class="type">Int</span>] = <span class="number">0</span> +=: mutableList</span><br><span class="line"></span><br><span class="line">        println(mutableList)</span><br><span class="line">        println(newMutableList)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// += 可以理解为类似原地修改</span></span><br><span class="line"><span class="comment">// + 可以理解为新增，但不是在原地修改</span></span><br></pre></td></tr></table></figure>







<hr>
<h2 id="Seq集合（List）"><a href="#Seq集合（List）" class="headerlink" title="Seq集合（List）"></a>Seq集合（List）</h2><h3 id="不可变-List"><a href="#不可变-List" class="headerlink" title="不可变 List"></a>不可变 List</h3><p><strong>说明</strong></p>
<ul>
<li>  <code>List</code> 默认为不可变集合</li>
<li>  创建一个 <code>List</code>（数据有顺序，可重复）</li>
<li>  遍历 <code>List</code></li>
<li>  <code>List</code> 增加数据</li>
<li>  集合间合并：将一个整体拆成一个一个的个体，称为<strong>扁平化</strong></li>
<li>  取指定数据</li>
<li>  空集合 <code>Nil</code></li>
</ul>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）List默认为不可变集合</span></span><br><span class="line">        <span class="comment">//（2）创建一个List（数据有顺序，可重复）</span></span><br><span class="line">        <span class="keyword">val</span> list: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（7）空集合Nil</span></span><br><span class="line">        <span class="keyword">val</span> list5 = <span class="number">1</span>::<span class="number">2</span>::<span class="number">3</span>::<span class="number">4</span>::<span class="type">Nil</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）List增加数据</span></span><br><span class="line">        <span class="comment">//（4.1）::的运算规则从右向左</span></span><br><span class="line">        <span class="comment">//val list1 = 5::list</span></span><br><span class="line">        <span class="keyword">val</span> list1 = <span class="number">7</span>::<span class="number">6</span>::<span class="number">5</span>::list</span><br><span class="line">        <span class="comment">//（4.2）添加到第一个元素位置</span></span><br><span class="line">        <span class="keyword">val</span> list2 = list.+:(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）集合间合并：将一个整体拆成一个一个的个体，称为扁平化</span></span><br><span class="line">        <span class="keyword">val</span> list3 = <span class="type">List</span>(<span class="number">8</span>,<span class="number">9</span>)</span><br><span class="line">        <span class="comment">//val list4 = list3::list1</span></span><br><span class="line">        <span class="keyword">val</span> list4 = list3:::list1</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（6）取指定数据</span></span><br><span class="line">        println(list(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）遍历List</span></span><br><span class="line">        <span class="comment">//list.foreach(println)</span></span><br><span class="line">        <span class="comment">//list1.foreach(println)</span></span><br><span class="line">        <span class="comment">//list3.foreach(println)</span></span><br><span class="line">        <span class="comment">//list4.foreach(println)</span></span><br><span class="line">        list5.foreach(println)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="可变-ListBuffer"><a href="#可变-ListBuffer" class="headerlink" title="可变 ListBuffer"></a>可变 ListBuffer</h3><p><strong>说明</strong></p>
<ol>
<li> 创建一个可变集合 <code>ListBuffer</code></li>
<li> 向集合中添加数据</li>
<li> 打印集合数据</li>
</ol>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ListBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）创建一个可变集合</span></span><br><span class="line">        <span class="keyword">val</span> buffer = <span class="type">ListBuffer</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）向集合中添加数据</span></span><br><span class="line">        buffer.+=(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）打印集合数据</span></span><br><span class="line">        buffer.foreach(println)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="Map-集合"><a href="#Map-集合" class="headerlink" title="Map 集合"></a>Map 集合</h2><p><strong>Scala 中不可变的 Map 是有序的，可变的 Map 是无序的</strong>。</p>
<h3 id="不可变-Map"><a href="#不可变-Map" class="headerlink" title="不可变 Map"></a>不可变 Map</h3><p><strong>说明</strong></p>
<ol>
<li> 创建不可变集合 <code>Map</code></li>
<li> 循环打印</li>
<li> 访问数据</li>
<li> 如果key不存在，返回0</li>
</ol>
<p><strong>二、案例实操</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="comment">// Map</span></span><br><span class="line">        <span class="comment">//（1）创建不可变集合Map</span></span><br><span class="line">        <span class="keyword">val</span> map = <span class="type">Map</span>( <span class="string">&quot;a&quot;</span>-&gt;<span class="number">1</span>, <span class="string">&quot;b&quot;</span>-&gt;<span class="number">2</span>, <span class="string">&quot;c&quot;</span>-&gt;<span class="number">3</span> )</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）访问数据</span></span><br><span class="line">        <span class="keyword">for</span> (key &lt;- map.keys) &#123;</span><br><span class="line">            <span class="comment">// 使用get访问map集合的数据，会返回特殊类型Option(选项):有值（Some），无值(None)</span></span><br><span class="line">            <span class="keyword">val</span> option: <span class="type">Option</span>[<span class="type">Int</span>] = map.get(key)</span><br><span class="line">            <span class="keyword">val</span> value: <span class="type">Int</span> = option.get</span><br><span class="line">            println(elem + <span class="string">&quot;=&quot;</span> + value)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）如果key不存在，返回0</span></span><br><span class="line">        println(map.get(<span class="string">&quot;d&quot;</span>).getOrElse(<span class="number">0</span>))</span><br><span class="line">        println(map.getOrElse(<span class="string">&quot;d&quot;</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）循环打印</span></span><br><span class="line">        map.foreach((entry)=&gt;&#123;println(entry)&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="可变Map"><a href="#可变Map" class="headerlink" title="可变Map"></a>可变Map</h3><p><strong>说明</strong></p>
<ol>
<li> 创建可变集合</li>
<li> 打印集合</li>
<li> 向集合增加数据</li>
<li> 删除数据</li>
<li> 修改数据</li>
</ol>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMap2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）创建可变集合</span></span><br><span class="line">        <span class="keyword">val</span> map = mutable.<span class="type">Map</span>( <span class="string">&quot;a&quot;</span>-&gt;<span class="number">1</span>, <span class="string">&quot;b&quot;</span>-&gt;<span class="number">2</span>, <span class="string">&quot;c&quot;</span>-&gt;<span class="number">3</span> )</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）向集合增加数据</span></span><br><span class="line">        map.+=(<span class="string">&quot;d&quot;</span>-&gt;<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将数值4添加到集合，并把集合中原值1返回</span></span><br><span class="line">        <span class="keyword">val</span> maybeInt: <span class="type">Option</span>[<span class="type">Int</span>] = map.put(<span class="string">&quot;a&quot;</span>, <span class="number">4</span>)</span><br><span class="line">        println(maybeInt.getOrElse(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）删除数据</span></span><br><span class="line">        map.-=(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）修改数据</span></span><br><span class="line">        map.update(<span class="string">&quot;d&quot;</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）打印集合</span></span><br><span class="line">        map.foreach((kv)=&gt;&#123;println(kv)&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><p><strong>说明</strong></p>
<p>元组也是可以理解为一个容器，可以存放各种相同或不同类型的数据。说的简单点，就是将多个无关的数据封装为一个整体，称为元组。</p>
<p><strong>注意：</strong>元组中最大只能有22个元素。</p>
<p><strong>Demo：</strong></p>
<ol>
<li> 声明元组的方式：<code>(元素1，元素2，元素3)</code></li>
<li> 访问元组</li>
<li> <code>Map</code> 中的键值对其实就是元组，只不过元组的元素个数为 2，称之为对偶</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestTuple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）声明元组的方式：(元素1，元素2，元素3)</span></span><br><span class="line">        <span class="keyword">val</span> tuple: (<span class="type">Int</span>, <span class="type">String</span>, <span class="type">Boolean</span>) = (<span class="number">40</span>, <span class="string">&quot;bobo&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）访问元组</span></span><br><span class="line">        <span class="comment">//（2.1）通过元素的顺序进行访问，调用方式：顺序号</span></span><br><span class="line">        println(tuple<span class="number">.1</span>)</span><br><span class="line">        println(tuple<span class="number">.2</span>)</span><br><span class="line">        println(tuple<span class="number">.3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2.2）通过索引访问数据</span></span><br><span class="line">        println(tuple.productElement(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2.3）通过迭代器访问数据</span></span><br><span class="line">        <span class="keyword">for</span> (elem &lt;- tuple.productIterator) &#123;</span><br><span class="line">            println(elem)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）Map中的键值对其实就是元组,只不过元组的元素个数为2，称之为对偶</span></span><br><span class="line">        <span class="keyword">val</span> map = <span class="type">Map</span>(<span class="string">&quot;a&quot;</span>-&gt;<span class="number">1</span>, <span class="string">&quot;b&quot;</span>-&gt;<span class="number">2</span>, <span class="string">&quot;c&quot;</span>-&gt;<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        map.foreach(tuple=&gt;&#123;println(tuple<span class="number">.1</span> + <span class="string">&quot;=&quot;</span> + tuple<span class="number">.2</span>)&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="集合常用函数"><a href="#集合常用函数" class="headerlink" title="集合常用函数"></a>集合常用函数</h1><h2 id="基本属性和常用操作"><a href="#基本属性和常用操作" class="headerlink" title="基本属性和常用操作"></a>基本属性和常用操作</h2><p><strong>说明</strong></p>
<ol>
<li> 获取集合长度</li>
<li> 获取集合大小</li>
<li> 循环遍历</li>
<li> 迭代器</li>
<li> 生成字符串</li>
<li> 是否包含</li>
</ol>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> list: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）获取集合长度</span></span><br><span class="line">        println(list.length)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）获取集合大小</span></span><br><span class="line">        println(list.size)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）循环遍历</span></span><br><span class="line">        list.foreach(println)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）迭代器</span></span><br><span class="line">        <span class="keyword">for</span> (elem &lt;- list.iterator) &#123;</span><br><span class="line">            println(elem)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）生成字符串</span></span><br><span class="line">        println(list.mkString(<span class="string">&quot;,&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（6）是否包含</span></span><br><span class="line">        println(list.contains(<span class="number">3</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="衍生集合"><a href="#衍生集合" class="headerlink" title="衍生集合"></a>衍生集合</h2><p><strong>说明</strong></p>
<ol>
<li> 获取集合的头部元素 <code>head</code> </li>
<li> 获取去掉首部元素后的子集合</li>
<li> 集合最后一个数据 <code>last</code></li>
<li> 获取去掉尾部元素后的子集合</li>
<li> 反转</li>
<li> 取前（后）n 个元素 <code>take</code></li>
<li> 去掉前（后）n 个元素 <code>drop</code></li>
<li> 并集</li>
<li> 交集</li>
<li> 差集</li>
<li> <strong>拉链</strong></li>
<li> <strong>滑窗</strong></li>
</ol>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> list1: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line">        <span class="keyword">val</span> list2: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）获取集合的头部元素</span></span><br><span class="line">        println(list1.head)</span><br><span class="line">        <span class="comment">//（3）集合的尾部元素</span></span><br><span class="line">        println(list1.last)</span><br><span class="line">        <span class="comment">//（2）获取去掉首部元素后的子集合</span></span><br><span class="line">        println(list1.tail)</span><br><span class="line">        <span class="comment">//（4）获取去掉尾部元素后的子集合</span></span><br><span class="line">        println(list1.init)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）反转</span></span><br><span class="line">        println(list1.reverse)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（6）取前（后）n个元素</span></span><br><span class="line">        println(list1.take(<span class="number">3</span>))</span><br><span class="line">        println(list1.takeRight(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（7）去掉前（后）n个元素</span></span><br><span class="line">        println(list1.drop(<span class="number">3</span>))</span><br><span class="line">        println(list1.dropRight(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（8）并集</span></span><br><span class="line">        println(list1.union(list2))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（9）交集</span></span><br><span class="line">        println(list1.intersect(list2))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（10）差集</span></span><br><span class="line">        println(list1.diff(list2))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（11）拉链 注:如果两个集合的元素个数不相等，那么会将同等数量的数据进行拉链，多余的数据省略不用</span></span><br><span class="line">        println(list1.zip(list2))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（12）滑窗</span></span><br><span class="line">        list1.sliding(<span class="number">2</span>, <span class="number">5</span>).foreach(println)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="集合计算初级函数"><a href="#集合计算初级函数" class="headerlink" title="集合计算初级函数"></a>集合计算初级函数</h2><p><strong>说明</strong></p>
<ol>
<li> 求和</li>
<li> 求乘积</li>
<li> 最大值</li>
<li> 最小值</li>
<li> 排序</li>
</ol>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> list: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">5</span>, <span class="number">-3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">-7</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）求和</span></span><br><span class="line">        println(list.sum)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）求乘积</span></span><br><span class="line">        println(list.product)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）最大值</span></span><br><span class="line">        println(list.max)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）最小值</span></span><br><span class="line">        println(list.min)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）排序</span></span><br><span class="line">        <span class="comment">// （5.1）按照元素大小排序</span></span><br><span class="line">        println(list.sortBy(x =&gt; x))  <span class="comment">// 正序</span></span><br><span class="line">        println(list.sortBy(x =&gt; -x)) <span class="comment">// 倒序</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// （5.2）按照元素的绝对值大小排序</span></span><br><span class="line">        println(list.sortBy(x =&gt; x.abs))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// （5.3）按元素大小升序排序</span></span><br><span class="line">        println(list.sortWith((x, y) =&gt; x &lt; y))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// （5.4）按元素大小降序排序</span></span><br><span class="line">        println(list.sortWith((x, y) =&gt; x &gt; y))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="集合计算高级函数"><a href="#集合计算高级函数" class="headerlink" title="集合计算高级函数"></a>集合计算高级函数</h2><p><img src="/2021/12/23/Scala%E5%AE%B9%E5%99%A8/image-20211210144455768.png" alt="image-20211210144455768"></p>
<p><strong>说明</strong></p>
<ol>
<li> 过滤：<code>filter</code></li>
<li> 映射：<code>map</code></li>
<li> 扁平化：<code>flatten</code></li>
<li> 扁平化+映射：<code>flatMap</code> 【注：<code>flatMap</code> 相当于先进行 <code>map</code> 操作，再进行 <code>flatten</code> 操作】   </li>
<li>简化（规约）：<code>reduce</code><ul>
<li>  <code>reduceLeft</code>：等价于 <code>reduce</code>，表示从左向右进行聚合</li>
<li>  <code>reduceRight</code>：从右向左进行聚合</li>
</ul>
</li>
<li> 分组：<code>groupBy</code></li>
<li> 折叠：<code>Fold</code></li>
</ol>
<blockquote>
<p>  map 和 foreach 的区别</p>
</blockquote>
<p><code>map</code> 拥有返回值，而 <code>foreach</code> 没有返回值</p>
<p>实操</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> list: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line">        <span class="keyword">val</span> nestedList: <span class="type">List</span>[<span class="type">List</span>[<span class="type">Int</span>]] = <span class="type">List</span>(<span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), <span class="type">List</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>), <span class="type">List</span>(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>))</span><br><span class="line">        <span class="keyword">val</span> wordList: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;hello atguigu&quot;</span>, <span class="string">&quot;hello scala&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）过滤</span></span><br><span class="line">        println(list.filter(x =&gt; x % <span class="number">2</span> == <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）转化/映射</span></span><br><span class="line">        println(list.map(x =&gt; x + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）扁平化</span></span><br><span class="line">        println(nestedList.flatten)	<span class="comment">// 输出结果为：List(1, 2, 3, 4, 5, 6, 7, 8, 9)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）扁平化+映射 注：flatMap相当于先进行map操作，在进行flatten操作</span></span><br><span class="line">        println(wordList.flatMap(x =&gt; x.split(<span class="string">&quot; &quot;</span>)))</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">			&quot;hello world&quot;, &quot;hello atguigu&quot;, &quot;hello scala&quot;</span></span><br><span class="line"><span class="comment">			==&gt; map</span></span><br><span class="line"><span class="comment">            [</span></span><br><span class="line"><span class="comment">            	[hello, world], </span></span><br><span class="line"><span class="comment">            	[hello, atguigu], </span></span><br><span class="line"><span class="comment">            	[hello, scala]</span></span><br><span class="line"><span class="comment">            ]</span></span><br><span class="line"><span class="comment">            ==&gt; flatten</span></span><br><span class="line"><span class="comment">            [hello, world, hello, atguigu, hello, scala]</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">        <span class="comment">//（5）分组</span></span><br><span class="line">        println(list.groupBy(x =&gt; x % <span class="number">2</span>))	<span class="comment">// 输出结果为：Map(false -&gt; List(1, 3, 5, 7, 9), true -&gt; List(2, 4, 6, 8))</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h3><p><code>Reduce</code> 简化（规约）：通过指定的逻辑将集合中的数据进行聚合，从而减少数据，最终获取结果。</p>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestReduce</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将数据两两结合，实现运算规则</span></span><br><span class="line">        <span class="keyword">val</span> i: <span class="type">Int</span> = list.reduce( (x,y) =&gt; x-y )</span><br><span class="line">        println(<span class="string">&quot;i = &quot;</span> + i)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从源码的角度，reduce底层调用的其实就是reduceLeft</span></span><br><span class="line">        <span class="comment">//val i1 = list.reduceLeft((x,y) =&gt; x-y)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ((4-3)-2-1) = -2</span></span><br><span class="line">        <span class="keyword">val</span> i2 = list.reduceRight((x,y) =&gt; x-y)</span><br><span class="line">        println(i2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="Fold"><a href="#Fold" class="headerlink" title="Fold"></a>Fold</h3><p><code>Fold</code> 折叠：化简的一种特殊情况。</p>
<p><strong>Demo01</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestFold</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// fold方法使用了函数柯里化，存在两个参数列表</span></span><br><span class="line">        <span class="comment">// 第一个参数列表为 ： 零值（初始值）</span></span><br><span class="line">        <span class="comment">// 第二个参数列表为：</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// fold 底层其实为 foldLeft</span></span><br><span class="line">        <span class="keyword">val</span> i = list.foldLeft(<span class="number">1</span>)((x,y)=&gt;x-y)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> i1 = list.foldRight(<span class="number">10</span>)((x,y)=&gt;x-y)</span><br><span class="line"></span><br><span class="line">        println(i)</span><br><span class="line">        println(i1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Demo02</strong>：两个集合合并</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestFold</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 两个Map的数据合并</span></span><br><span class="line">        <span class="keyword">val</span> map1 = mutable.<span class="type">Map</span>(<span class="string">&quot;a&quot;</span>-&gt;<span class="number">1</span>, <span class="string">&quot;b&quot;</span>-&gt;<span class="number">2</span>, <span class="string">&quot;c&quot;</span>-&gt;<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">val</span> map2 = mutable.<span class="type">Map</span>(<span class="string">&quot;a&quot;</span>-&gt;<span class="number">4</span>, <span class="string">&quot;b&quot;</span>-&gt;<span class="number">5</span>, <span class="string">&quot;d&quot;</span>-&gt;<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> map3: mutable.<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = map2.foldLeft(map1) &#123;</span><br><span class="line">            (map, kv) =&gt; &#123;</span><br><span class="line">                <span class="keyword">val</span> k = kv._1</span><br><span class="line">                <span class="keyword">val</span> v = kv._2</span><br><span class="line"></span><br><span class="line">                map(k) = map.getOrElse(k, <span class="number">0</span>) + v</span><br><span class="line"></span><br><span class="line">                map</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        println(map3)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p>在 scala 中，不管是可变集合还是不可变集合，都是返回一个新的排好序的集合。原集合不会发生变化。默认升序</p>
<hr>
<p><strong>不可变</strong></p>
<p><code>:+</code>：一般用于给不可变的集合追加元素（尾插）</p>
<p><code>:+</code>：一般用于给不可变的集合开头插入元素（头插）</p>
<p><strong>可变</strong></p>
<p><code>+=</code>：一般用于可变集合，表示尾插</p>
<p><code>:+=</code>：一般用于可变集合，表示头插</p>
<p><code>++=</code>：把等号后面的元素合并到前面的集合中</p>
<p><code>冒号挨着的对象就是方法的调用主体。</code></p>
<p><code>-=</code>：删除满足条件的第一个元素</p>
<p><code>--=</code>：移出两个结合中的交集元素，（只移出一次）</p>
<p><strong>通用</strong></p>
<p><code>++</code>：合并两个集合 </p>
<p><strong>链表:List</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span></span><br><span class="line"></span><br><span class="line">空链表：</span><br><span class="line">	<span class="type">Nil</span></span><br><span class="line">	<span class="type">List</span>[<span class="type">Int</span>]()</span><br><span class="line"></span><br><span class="line">添加元素（专用）</span><br><span class="line">	:: 	添加元素</span><br><span class="line">	::: 合并两个<span class="type">List</span></span><br></pre></td></tr></table></figure>





<p><strong>Set</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">并集：</span><br><span class="line">	set1 ++ set2</span><br><span class="line">	set1 | set2</span><br><span class="line">	set1 union set2</span><br><span class="line"></span><br><span class="line">交集</span><br><span class="line">	set1 &amp; set2</span><br><span class="line">	set1 intersect set2</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">差集</span><br><span class="line">	set1 &amp;~ set2</span><br><span class="line">	set1 -- set2</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="Java-和-Scala-容器的互相转换"><a href="#Java-和-Scala-容器的互相转换" class="headerlink" title="Java 和 Scala 容器的互相转换"></a>Java 和 Scala 容器的互相转换</h2><p>我们知道在 Scala 中可以引入 Java 的 API，但是如果引入 Java 的 API，那么部分的 Scala 特性就不能正常使用了。比如我们创建一个 Java 的 ArrayList ，那么就不能使用 <code>+=</code> 或者 <code>ints.foreach(println)</code> 等来处理这个集合。为了解决这种问题，我们可以通过引入 <code>scala.collection.JavaConversions._</code> 来实现 Java 和 Scala 中对应 API 的自动互相转换，这样就可以无缝使用两种语言的语法了。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">J2s</span></span>&#123;</span><br><span class="line">  <span class="keyword">import</span> scala.collection.<span class="type">JavaConversions</span>._		<span class="comment">// 引入J2S转换包，这个包中包含了许多隐式转换，可以完成Java集合和Scala集合的互转</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> ints = <span class="keyword">new</span> util.<span class="type">ArrayList</span>[<span class="type">Int</span>]()</span><br><span class="line"></span><br><span class="line">    ints.add(<span class="number">1</span>) <span class="comment">// Java语法</span></span><br><span class="line">    ints.add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    ints += <span class="number">3</span> <span class="comment">// scala 语法</span></span><br><span class="line">    ints.foreach(println)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/22/Scala%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/Scala%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="post-title-link" itemprop="url">Scala模式匹配</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-22 16:52:28" itemprop="dateCreated datePublished" datetime="2021-12-22T16:52:28+08:00">2021-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-12-23 11:13:47" itemprop="dateModified" datetime="2021-12-23T11:13:47+08:00">2021-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Scala/" itemprop="url" rel="index"><span itemprop="name">Scala</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h1><p>Scala 中的模式匹配<code>(match)</code> 类似于 Java 中的 <code>switch</code> 语法，但是功能更为强大。</p>
<p>所谓的模式匹配，就是一个定义好规则的黑盒，这个黑盒中保存了非常多种 <code>case</code>。对于使用它的用户来讲，只需要传入一个值，就会执行与该值成功匹配的 <code>case</code>。</p>
<p>一个模式匹配包含了一系列备选项，每个都开始于关键字 <code>case</code>。每个备选项都包含了一个模式及一到多个表达式。箭头符号 <code>=&gt;</code> 隔开了模式和表达式。</p>
<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">? <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> one =&gt; ???</span><br><span class="line">    <span class="keyword">case</span> two =&gt; ???</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; ???</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模式匹配语法中，采用 <code>match</code> 关键字声明进入模式匹配，每个分支采用 <code>case</code> 关键字进行声明，当需要匹配时，会从第一个 <code>case</code> 分支开始，如果匹配成功，那么执行对应的逻辑代码，如果匹配不成功，继续执行下一个分支进行判断。如果所有 <code>case</code> 都不匹配，那么会执行 <code>case _</code> 分支，类似于 Java 中 <code>default</code> 语句。</p>
<p><strong>注意：</strong><code>case _</code>分支必须放在最后，因为 <code>case _</code> 可以匹配所有情况，将会导致 <code>case _</code> 之后的所有 <code>case</code> 都失效。同理，在模式匹配中一定要注意 <code>case</code> 的顺序，如果进入了排在前面的 <code>case</code>，那么排在后面的 <code>case</code> 就一定不会被执行，所以一定要把范围小的条件放在前面，范围大的条件放在后面。</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 17:01</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> a:<span class="type">Int</span> = <span class="number">10</span></span><br><span class="line">    <span class="keyword">val</span> b:<span class="type">Int</span> = <span class="number">20</span></span><br><span class="line">    <span class="keyword">val</span> operator:<span class="type">Char</span> = &#x27;x&#x27;	</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> res = operator <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &#x27;+&#x27; =&gt; a + b</span><br><span class="line">      <span class="keyword">case</span> &#x27;-&#x27; =&gt; a - b</span><br><span class="line">      <span class="keyword">case</span> &#x27;*&#x27; =&gt; a * b</span><br><span class="line">      <span class="keyword">case</span> &#x27;/&#x27; =&gt; a / b</span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;您的输入不合法，请重新输入&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">输出结果为：</span><br><span class="line">您的输入不合法，请重新输入</span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<ol>
<li> 如果所有 <code>case</code> 都不匹配，那么会执行 <code>case _</code> 分支，类似于 Java 中的 <code>default</code> 语句，若没有 <code>case _</code> 分支，则会抛出 <code>MatchError</code>。</li>
<li> <code>match</code> 表达式通过以代码编写的先后次序尝试每个模式来完成计算，只要发现有一个匹配的 <code>case</code>，剩下的 <code>case</code>不会继续匹配。即在每个 <code>case</code> 中，不用 <code>break</code> 语句，自动中断 <code>case</code>。</li>
<li> <code>match...case...</code> 语句可以匹配任何类型，而不只是字面量。</li>
<li> <code>=&gt;</code> 后面的代码块，<strong>作为一个整体执行</strong>，可以使用 <code>&#123;&#125;</code> 括起来，也可以不括。</li>
</ol>
<hr>
<h1 id="模式守卫"><a href="#模式守卫" class="headerlink" title="模式守卫"></a>模式守卫</h1><p>就是在模式匹配中加守卫。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 17:26</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchGuard</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个函数，函数内部使用了模式匹配。返回匹配的结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">abs</span></span>(num: <span class="type">Int</span>) = &#123;</span><br><span class="line">      num <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> x: <span class="type">Int</span> <span class="keyword">if</span> x &gt;= <span class="number">0</span> =&gt; x</span><br><span class="line">        <span class="keyword">case</span> x: <span class="type">Int</span> <span class="keyword">if</span> x &lt; <span class="number">0</span> =&gt; -x</span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="string">&quot;非法参数&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 【x : Int if x &gt;= 0】整体作为一个判断条件，既有参数类型匹配，也有参数范围匹配</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(abs(<span class="number">-5</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>



<hr>
<h1 id="模式匹配类型"><a href="#模式匹配类型" class="headerlink" title="模式匹配类型"></a>模式匹配类型</h1><h2 id="匹配常量"><a href="#匹配常量" class="headerlink" title="匹配常量"></a>匹配常量</h2><p><strong>说明</strong>：<code>scala</code> 中，模式匹配可以匹配所有的字面量，包括<strong>字符串，字符，数字，布尔值</strong>等等。</p>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 17:40</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchVal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(describe(<span class="number">6</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(args1 : <span class="type">Any</span>): <span class="type">String</span> = &#123;</span><br><span class="line">    args1 <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span> =&gt; <span class="string">&quot;Int five&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;hello&quot;</span> =&gt; <span class="string">&quot;Int five&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="literal">true</span> =&gt; <span class="string">&quot;Boolean true&quot;</span></span><br><span class="line">      <span class="keyword">case</span> &#x27;+&#x27; =&gt; <span class="string">&quot;Char +&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Other&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="匹配类型"><a href="#匹配类型" class="headerlink" title="匹配类型"></a>匹配类型</h2><p><strong>说明：</strong>在某些需要进行类型判断场景中，可以使用 Scala 内置的 <code>isInstanceOf[T]</code> 和 <code>asInstanceOf[T]</code> 方法，也可使用模式匹配实现同样的功能</p>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 17:49</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 数组例外，可以保留泛型</span></span><br><span class="line">    println(describe(<span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>))) <span class="comment">// 输出结果为：Other</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其它类型（如List），将会执行泛型擦除</span></span><br><span class="line">    println(describe(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>))) <span class="comment">// 输出结果为：List[String]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(args1 : <span class="type">Any</span>): <span class="type">String</span> = &#123;</span><br><span class="line">    args1 <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> x : <span class="type">Int</span> =&gt; <span class="string">&quot;Int&quot;</span></span><br><span class="line">      <span class="keyword">case</span> y : <span class="type">String</span> =&gt; <span class="string">&quot;String&quot;</span></span><br><span class="line">      <span class="keyword">case</span> z : <span class="type">Array</span>[<span class="type">String</span>] =&gt; <span class="string">&quot;Array[Int]&quot;</span></span><br><span class="line">      <span class="keyword">case</span> w : <span class="type">List</span>[<span class="type">String</span>] =&gt; <span class="string">&quot;List[String]&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Other&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  分析：在上面的代码中，我们使用 <code>List[Int]</code> 类型的集合，却与 <code>List[String]</code> 类型的 case 匹配成功了，这是因为发生了泛型擦除。</li>
</ul>
<h3 id="泛型擦除"><a href="#泛型擦除" class="headerlink" title="泛型擦除"></a>泛型擦除</h3><p><strong>是什么？</strong></p>
<p>所谓泛型擦除，是指 <code>.scala</code> 源代码文件编译成 <code>.class</code> 字节码文件后，会擦除源代码中的泛型类型。也就是说在 <code>.class</code> 字节码文件中是没有泛型的。</p>
<p>在 Scala 中，除了数组，其它所有都是真正使用了泛型。虽然数组看起来也像是使用了泛型，但是实际上并没有使用到泛型。因为数组在编译后的类型就是 <code>new int[]</code>，<code>new String[]</code> 等等这些。</p>
<p><strong>Scala 的模式匹配是无法匹配对象的泛型的。</strong></p>
<p><strong>Demo</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 数组例外，可以保留泛型</span></span><br><span class="line">    println(describe(<span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>))) <span class="comment">// 输出结果为：Other</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其它类型（如List），将会执行泛型擦除</span></span><br><span class="line">    println(describe(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>))) <span class="comment">// 输出结果为：List[String]</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(args1 : <span class="type">Any</span>): <span class="type">String</span> = &#123;</span><br><span class="line">    args1 <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> x : <span class="type">Int</span> =&gt; <span class="string">&quot;Int&quot;</span></span><br><span class="line">      <span class="keyword">case</span> y : <span class="type">String</span> =&gt; <span class="string">&quot;String&quot;</span></span><br><span class="line">      <span class="keyword">case</span> z : <span class="type">Array</span>[<span class="type">String</span>] =&gt; <span class="string">&quot;Array[Int]&quot;</span></span><br><span class="line">      <span class="keyword">case</span> w : <span class="type">List</span>[<span class="type">String</span>] =&gt; <span class="string">&quot;List[String]&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Other&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li> 可以看到，我们使用了 <code>List[Int]</code> 类型的集合去匹配 <code>List[Double]</code> 类型，并且匹配成功了。这就是因为发生了 <strong>泛型擦除</strong>，即在源代码在编译后，只保留了 <code>List</code> 类型，而把泛型全部擦除了。所以真正执行的类型匹配是 <code>List &lt;==&gt; List</code>，所以匹配成功了。</li>
<li> 在 Scala 中的数组看起来像是使用了泛型，诸如 <code>Array[Int]</code> 之类，但是实际上在编译后它的底层实现是 <code>new Int[]</code>，也就是说真正执行的类型匹配是 <code>Int[] &lt;==&gt; String[]</code>，所以匹配失败了。</li>
</ol>
<hr>
<h2 id="匹配数组"><a href="#匹配数组" class="headerlink" title="匹配数组"></a>匹配数组</h2><p><strong>说明</strong>：Scala 的模式匹配可以对集合及集合中的元素进行精确的匹配。</p>
<p><strong>Demo01</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数组匹配</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matchTest08</span></span>() = &#123;</span><br><span class="line">  <span class="keyword">val</span> array = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">  array <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="comment">// 要求：①长度为4 ②前两个元素是1和2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, _, _) =&gt; println(<span class="string">&quot;(1,2,_,_)&quot;</span>)</span><br><span class="line">    <span class="comment">// 要求：①长度为4  ②前两个元素是1和2  ③后两个元素用变量a和b接收</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, a, b) =&gt; println(<span class="string">s&quot;(1, 2, <span class="subst">$a</span>, <span class="subst">$b</span>)&quot;</span>) <span class="comment">// 变量可以接收任意类型的值</span></span><br><span class="line">    <span class="comment">// 要求：①长度任意  ②前两个元素是2和2</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">2</span>, <span class="number">2</span>, _*) =&gt; println(<span class="string">&quot;前两个元素是2，2的任意长度集合&quot;</span>)</span><br><span class="line">    <span class="comment">// 要求：①长度任意  ②前两个元素是2和2  ③用变量x接收通配符_*匹配的集合</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">2</span>, <span class="number">2</span>, x@_*) =&gt; println(x) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p><strong>Demo02</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 19:43</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchArray</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> array: <span class="type">Array</span>[<span class="type">Array</span>[_ &gt;: <span class="type">Int</span>]] = <span class="type">Array</span>(<span class="type">Array</span>(<span class="number">0</span>), <span class="type">Array</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="type">Array</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), <span class="type">Array</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>), <span class="type">Array</span>(<span class="string">&quot;hello&quot;</span>, <span class="number">90</span>))</span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- array) &#123;</span><br><span class="line">      <span class="keyword">val</span> res: <span class="type">String</span> = elem <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="comment">// 匹配与 Array(0) 相同的数组</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">0</span>) =&gt; <span class="string">&quot;0&quot;</span></span><br><span class="line">        <span class="comment">// 匹配有两个元素的数组</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">Array</span>(x, y) =&gt; x + <span class="string">&quot;,&quot;</span> + y</span><br><span class="line">        <span class="comment">// 匹配以 0 开头的数组</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">0</span>, _*) =&gt; <span class="string">&quot;以0开头的数组&quot;</span></span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Others&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      println(<span class="string">&quot;res = &quot;</span> + res)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="集合的模式匹配"><a href="#集合的模式匹配" class="headerlink" title="集合的模式匹配"></a>集合的模式匹配</h2><p>模式匹配还可以根据集合内部的元素进行匹配，但是要求集合必须是有序集合。也就是 HashSet、HashMap 等不能使用模式匹配。</p>
<h2 id="匹配-List"><a href="#匹配-List" class="headerlink" title="匹配 List"></a>匹配 List</h2><ol>
<li> <code>Array</code> 中的模式匹配规则在 <code>List</code> 中同样适用</li>
<li> 并且 <code>List</code> 还对这些匹配规则定义了自己独有的简化语法</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 20:00</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchList</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> myList: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通用API</span></span><br><span class="line">    myList <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      * 1、要求 List 中有四个元素</span></span><br><span class="line"><span class="comment">      * 2、要求 List 中第三个元素为 30</span></span><br><span class="line"><span class="comment">      * 3、用 a 接收 List 中第一个元素，b 接收第二个元素，*/</span></span><br><span class="line">      <span class="keyword">case</span> <span class="type">List</span>(a, b, <span class="number">30</span>, _) =&gt; println(<span class="string">s&quot;<span class="subst">$a</span>, <span class="subst">$b</span>, 30, _&quot;</span>) <span class="comment">// 10, 20, 30, _</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 1、不限制 List 中元素的个数</span></span><br><span class="line"><span class="comment">        * 2、用 a 接收 List 中第一个元素</span></span><br><span class="line"><span class="comment">        * 3、用 `other@_*` 接收 List 中的其它元素，并封装到一个新的 List 中</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">      <span class="keyword">case</span> <span class="type">List</span>(a, other@_*) =&gt; println(<span class="string">s&quot;<span class="subst">$a</span>, <span class="subst">$other</span>&quot;</span>) <span class="comment">// 10, List(20, 30, 40)</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;分隔符=================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 专用API</span></span><br><span class="line">    myList <span class="keyword">match</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 1、要求 List 中有四个元素，Nil 是结束条件</span></span><br><span class="line"><span class="comment">        * 2、用 a 接收 List 中第一个元素</span></span><br><span class="line"><span class="comment">        * 3、用 `other` 接收 List 中的其它元素，并封装到一个新的 List 中。</span></span><br><span class="line"><span class="comment">        * other 不是固定的写法，可以用任意的其它字符串代替，如果没有 Nil 作为结束条件，</span></span><br><span class="line"><span class="comment">        * 默认可以匹配任意多个参数的 List */</span></span><br><span class="line">      <span class="keyword">case</span> (a :: other) =&gt; println(<span class="string">s&quot;<span class="subst">$a</span>, <span class="subst">$other</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> (a :: b :: c :: d :: <span class="type">Nil</span>) =&gt; println(<span class="string">s&quot;<span class="subst">$a</span>, <span class="subst">$b</span>, <span class="subst">$c</span>, <span class="subst">$d</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">输出结果为：</span><br><span class="line"></span><br><span class="line"><span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, _</span><br><span class="line">分隔符=================</span><br><span class="line"><span class="number">10</span>, <span class="type">List</span>(<span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br></pre></td></tr></table></figure>





<h2 id="匹配元组"><a href="#匹配元组" class="headerlink" title="匹配元组"></a>匹配元组</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 20:23</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 匹配元组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchTuple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> tuple: (<span class="type">String</span>, <span class="type">Int</span>) = (<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 元组的输出的缺点：无法做到见名知意</span></span><br><span class="line">    println(tuple._1 + <span class="string">&quot;：&quot;</span> + tuple._2)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模式匹配下输出元组中的元素</span></span><br><span class="line">    tuple <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="comment">// 匹配到一个元组元素，用 name 接收 tuple._1，用 age 接收 tuple._2</span></span><br><span class="line">      <span class="keyword">case</span> (name, age) =&gt; println(name + <span class="string">&quot;：&quot;</span> + age)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">输出结果为：</span><br><span class="line"></span><br><span class="line">张三：<span class="number">20</span></span><br><span class="line">张三：<span class="number">20</span></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="匹配对象"><a href="#匹配对象" class="headerlink" title="匹配对象"></a>匹配对象</h2><ul>
<li>  当 <code>case</code> 匹配的条件是一个对象时（以 <code>class User</code> 为例），必须创建 <code>User</code> 类的伴生对象并重写对象中的 <code>unapply()</code> 方法。</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 20:26</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 匹配对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchObject</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 创建一个 User 实例</span></span><br><span class="line">    <span class="keyword">val</span> user: <span class="type">User</span> = <span class="keyword">new</span> <span class="type">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line">    user <span class="keyword">match</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 当将 User(&quot;张三&quot;, 23) 写在 case 后面时，会默认调用 User 伴生对象中的 unapply() 方法（对象提取器），</span></span><br><span class="line"><span class="comment">        * 所以 User 类必须实现伴生对象并重写 unapply() 方法。该方法接收一个 user 实例作为参数，并且会将 User </span></span><br><span class="line"><span class="comment">        * 对象的 name 和 age 属性提取出来，与 new User(&quot;张三&quot;, 23) 对象中的属性值进行匹配。*/</span></span><br><span class="line">      <span class="keyword">case</span> <span class="type">User</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">23</span>) =&gt; println(<span class="string">&quot;Yes&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Other&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// User 类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">val name: <span class="type">String</span>, val age : <span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 User 的伴生对象，并重写 unapply 方法</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">User</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">unapply</span></span>(user: <span class="type">User</span>): <span class="type">Option</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = &#123;</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) <span class="keyword">return</span> <span class="type">None</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="type">Some</span>(user.name, user.age)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/22/Scala%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/image-20211222203728840.png" alt="image-20211222203728840"></p>
<ul>
<li>  当将 <code>User(&quot;张三&quot;, 23)</code> 写在 <code>case</code> 后面时，会默认调用 <code>User</code> 伴生对象中的 <strong>unapply()</strong> 方法来解析这个对象，所以 <code>User</code> 类必须实现伴生对象并重写 <code>unapply()</code> 方法，该方法接收一个 <code>user</code> 实例作为参数，并且会将 <code>User</code> 对象的 <code>name</code> 和 <code>age</code> 属性提取出来，与 <code>new User(&quot;张三&quot;, 23)</code> 对象中的属性值进行匹配。</li>
<li>  <code>unapply()</code> 方法的返回值类型是 <strong>Option</strong>，<code>Option</code> 有两种子类型。只有当返回值类型为 <code>Some</code> 且所有属性均一致时才算匹配成功，当返回 <code>None</code> 或者返回 <code>Some</code> 但是属性不一致时都表示匹配失败。</li>
</ul>
<h3 id="unapply-方法"><a href="#unapply-方法" class="headerlink" title="unapply 方法"></a>unapply 方法</h3><p><code>unapply</code> 方法又被称为对象提取器</p>
<ol>
<li> 若只提取对象的一个属性，则提取器为 <code>unapply(obj : Obj) : Option[T]</code></li>
<li> 若提取对象的多个属性，则提取器为 <code>unapply(obj : Obj) : Option[ (T1,T2,T3…) ]</code></li>
<li> 若提取对象的可变个属性，则提取器为 <code>unapplySeq(obj: Obj) : Option[ Seq[T] ]</code></li>
</ol>
<hr>
<h3 id="样例类"><a href="#样例类" class="headerlink" title="样例类"></a>样例类</h3><p><strong>创建一个样例类：</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> (<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br></pre></td></tr></table></figure>



<p><strong>说明：</strong></p>
<ol>
<li> 样例类仍然是类，只是和普通类相比，其自动生成了伴生对象，并且已经在伴生对象中实现了一些常用的方法，如 <code>apply、unapply、toString、equals、hashCode</code> 和 <code>copy</code> 等。</li>
<li> <strong>样例类是为了适应模式匹配而优化的类</strong>，因为其默认提供了 <code>unapply</code> 方法，所以样例类可以直接使用模式匹配，而无需再去实现一遍 <code>unapply</code> 方法。</li>
<li> 在样例类中，构造器中的每一个参数都设置为 <code>val</code>，除非它被显式地声明为 <code>var</code>（不建议这样做）</li>
</ol>
<p><strong>Demo</strong></p>
<p>上一节中匹配对象的案例使用样例类的话会节省大量代码</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 21:09</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchCaseClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> emp: <span class="type">Emp</span> = <span class="keyword">new</span> <span class="type">Emp</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line">    emp <span class="keyword">match</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 样例类的模式匹配</span></span><br><span class="line">      <span class="keyword">case</span> <span class="type">Emp</span>(<span class="string">&quot;张三&quot;</span>, x) =&gt; println(<span class="string">&quot;张三Yes&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Emp</span>(<span class="string">&quot;李四&quot;</span>, y) =&gt; println(<span class="string">&quot;李四Yes&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个样例类</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span>(<span class="params">name: <span class="type">String</span>, age:<span class="type">Int</span></span>)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h1 id="隐式模式匹配-implicit"><a href="#隐式模式匹配-implicit" class="headerlink" title="隐式模式匹配(implicit)"></a>隐式模式匹配(implicit)</h1><p>隐式模式匹配就是看起来没使用模式匹配，也就是没使用 <code>match...case..</code> 语法，但其实在底层实现用用到了模式匹配的代码。</p>
<h2 id="变量声明中的模式匹配"><a href="#变量声明中的模式匹配" class="headerlink" title="变量声明中的模式匹配"></a>变量声明中的模式匹配</h2><p><strong>是什么？</strong></p>
<p>在声明变量时把等号右边的对象中的属性或方法赋值给等号左边的变量中，类似于 Vue 中的<strong>解构表达式</strong>，</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 21:53</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchImplicit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在创建变量 (x, y) 时把元组 (1, 2) 中对应位置上的值分别赋值给变量 x 和 y</span></span><br><span class="line">    <span class="keyword">val</span> (x, y) = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    println(<span class="string">s&quot;x=<span class="subst">$x</span>, y=<span class="subst">$y</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在创建变量 Array(first, second, _*) 时把数组 Array(1, 2, 3, 4) </span></span><br><span class="line">    <span class="comment">// 中前两个元素的值分别赋值给变量 first 和 second</span></span><br><span class="line">    <span class="keyword">val</span> <span class="type">Array</span>(first, second, _*) = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">    println(<span class="string">s&quot;first=<span class="subst">$first</span>, second=<span class="subst">$second</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在创建变量 Person(name, age) 时把 Person(&quot;zz&quot;, 13) 实例</span></span><br><span class="line">    <span class="comment">// 中的 `zz` 和 `13` 分别赋值给变量中的 name 和 age</span></span><br><span class="line">    <span class="keyword">val</span> <span class="type">Person</span>(name, age) = <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">&quot;zz&quot;</span>, <span class="number">13</span>)</span><br><span class="line">    println(<span class="string">s&quot;name=<span class="subst">$name</span>, age=<span class="subst">$age</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为底层使用到了模式匹配，所以还必须创建伴生对象并实现 unapply 方法</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="comment">x=1, y=2</span></span><br><span class="line"><span class="comment">first=1, second=2</span></span><br><span class="line"><span class="comment">name=zz, age=13</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="for-表达式中的模式匹配"><a href="#for-表达式中的模式匹配" class="headerlink" title="for 表达式中的模式匹配"></a>for 表达式中的模式匹配</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Author lnd</span></span><br><span class="line"><span class="comment"> * @Date 2021/12/22 22:18</span></span><br><span class="line"><span class="comment"> * @Version 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestMatchFor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> map = <span class="type">Map</span>(<span class="string">&quot;A&quot;</span> -&gt; <span class="number">1</span>, <span class="string">&quot;B&quot;</span> -&gt; <span class="number">0</span>, <span class="string">&quot;C&quot;</span> -&gt; <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> ((k, v) &lt;- map) &#123; <span class="comment">// 直接将 map 中的 k-v 遍历出来</span></span><br><span class="line">      println(k + <span class="string">&quot; -&gt; &quot;</span> + v) <span class="comment">// 3个</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;************************&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历 value = 0 的 k-v , 如果 v 不是 0 , 过滤</span></span><br><span class="line">    <span class="keyword">for</span> ((k, <span class="number">0</span>) &lt;- map) &#123;</span><br><span class="line">      println(k + <span class="string">&quot; --&gt; &quot;</span> + <span class="number">0</span>) </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;************************&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if v == 0 是一个过滤的条件</span></span><br><span class="line">    <span class="keyword">for</span> ((k, v) &lt;- map <span class="keyword">if</span> v &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      println(k + <span class="string">&quot; ---&gt; &quot;</span> + v)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 执行以上代码，输出结果为：</span></span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line"><span class="comment">A -&gt; 1</span></span><br><span class="line"><span class="comment">B -&gt; 0</span></span><br><span class="line"><span class="comment">C -&gt; 3</span></span><br><span class="line"><span class="comment">************************</span></span><br><span class="line"><span class="comment">B --&gt; 0</span></span><br><span class="line"><span class="comment">************************</span></span><br><span class="line"><span class="comment">A ---&gt; 1</span></span><br><span class="line"><span class="comment">C ---&gt; 3</span></span><br><span class="line"><span class="comment">----------------------------------- */</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="偏函数中的模式匹配"><a href="#偏函数中的模式匹配" class="headerlink" title="偏函数中的模式匹配"></a>偏函数中的模式匹配</h2><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2021/12/22/Scala%E5%87%BD%E6%95%B0">偏函数</a></p>
</blockquote>
<p><strong>偏函数的本质就是定义一个新的函数，对原始函数的功能进行增强。</strong></p>
<p>偏函数也是函数的一种，通过偏函数我们可以方便的对输入参数做更精确的检查。例如该偏函数的输入类型为 <code>List[Int]</code>，而我们需要的是第一个元素是 0 的集合，这就是通过模式匹配实现的。</p>
<p><strong>偏函数定义</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建了一个偏函数叫做 second，该偏函数的功能是返回输入 List 集合的第二个元素</span></span><br><span class="line"><span class="keyword">val</span> second: <span class="type">PartialFunction</span>[<span class="type">List</span>[<span class="type">Int</span>], <span class="type">Option</span>[<span class="type">Int</span>]] = &#123;</span><br><span class="line">    <span class="keyword">case</span> x :: y :: _ =&gt; <span class="type">Some</span>(y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/22/Scala%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/image-20211222223132241.png" alt="image-20211222223132241"></p>
<p><strong>偏函数原理</strong></p>
<p>上述代码会被 scala 编译器翻译成以下代码，与普通函数相比，只是多了一个用于参数检查的函数 <code>isDefinedAt</code>，其返回值类型为 <code>Boolean</code>。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">val</span> second = <span class="keyword">new</span> <span class="type">PartialFunction</span>[<span class="type">List</span>[<span class="type">Int</span>], <span class="type">Option</span>[<span class="type">Int</span>]] &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查输入参数是否合格</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(list: <span class="type">List</span>[<span class="type">Int</span>]): <span class="type">Boolean</span> = list <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> x :: y :: _ =&gt; <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行函数逻辑</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(list: <span class="type">List</span>[<span class="type">Int</span>]): <span class="type">Option</span>[<span class="type">Int</span>] = list <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> x :: y :: _ =&gt; <span class="type">Some</span>(y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>偏函数使用</strong></p>
<p>偏函数不能像 <code>second(List(1,2,3))</code> 这样直接使用，因为这样会直接调用 <code>apply</code> 方法，而应该调用 <code>applyOrElse</code> 方法，如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">second.applyOrElse(  <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),  (_: <span class="type">List</span>[<span class="type">Int</span>]) =&gt; <span class="type">None</span>	 )</span><br></pre></td></tr></table></figure>

<p><code>applyOrElse</code> 方法的逻辑为：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( ifDefinedAt(list) )</span><br><span class="line">	apply(list) </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="keyword">default</span></span><br></pre></td></tr></table></figure>

<p>如果输入参数满足条件，即 <code>isDefinedAt</code> 返回 <code>true</code>，则执行 <code>apply</code> 方法，否则执行 <code>defalut</code> 方法，<code>default</code> 方法为参数不满足要求的处理逻辑。</p>
<p><strong>案例实操</strong></p>
<ol>
<li><p> 需求：将 <code>List(1,2,3,4,5,6,&quot;test&quot;)</code> 中 <code>Int</code> 类型的元素加一，并去掉字符串。</p>
</li>
<li><p>实操</p>
 <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法一：</span></span><br><span class="line"><span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="string">&quot;test&quot;</span>).filter(_.isInstanceOf[<span class="type">Int</span>]).map(_.asInstanceOf[<span class="type">Int</span>] + <span class="number">1</span>).foreach(println)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二：</span></span><br><span class="line"><span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="string">&quot;test&quot;</span>).collect &#123; <span class="keyword">case</span> x: <span class="type">Int</span> =&gt; x + <span class="number">1</span> &#125;.foreach(println)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>说实话，偏函数有点子懵</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/22/Scala%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/Scala%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">Scala函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-22 11:15:55" itemprop="dateCreated datePublished" datetime="2021-12-22T11:15:55+08:00">2021-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-12-23 15:23:35" itemprop="dateModified" datetime="2021-12-23T15:23:35+08:00">2021-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Scala/" itemprop="url" rel="index"><span itemprop="name">Scala</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Scala-方法与函数"><a href="#Scala-方法与函数" class="headerlink" title="Scala 方法与函数"></a>Scala 方法与函数</h1><h2 id="方法和函数的区别"><a href="#方法和函数的区别" class="headerlink" title="方法和函数的区别"></a>方法和函数的区别</h2><p>Scala 有方法与函数，二者在语义上的区别很小。Scala 方法是类的一部分，而<strong>函数是一个对象</strong>可以赋值给一个变量。换句话来说在类中定义的函数即是方法。</p>
<p>Scala 中的方法跟 Java 的类似，方法是组成类的一部分。</p>
<p>Scala 中的函数则是一个完整的对象，Scala 中的函数其实就是继承了 Trait 的类的对象。</p>
<p>Scala 中使用 <strong>val</strong> 语句可以定义函数，<strong>def</strong> 语句定义方法。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m</span></span>(x: <span class="type">Int</span>) = x + <span class="number">3</span>	<span class="comment">// 方法</span></span><br><span class="line">    <span class="keyword">val</span> f = (x: <span class="type">Int</span>) =&gt; x + <span class="number">3</span>	<span class="comment">// 函数，将函数对象赋值给常量f</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数可作为一个参数传入到方法中，而方法不行。</p>
<p>在 Scala 中无法直接操作方法，如果要操作方法，必须先将其转换成函数。在方法名称 m 后面紧跟一个空格和下划线告诉编译器将方法m转换成函数，而不是要调用这个方法。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f1 = m _</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="方法声明"><a href="#方法声明" class="headerlink" title="方法声明"></a>方法声明</h2><p>Scala 方法声明格式如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">functionName</span> </span>([参数列表]) : [<span class="keyword">return</span> <span class="class"><span class="keyword">type</span>]</span></span><br></pre></td></tr></table></figure>

<p>如果你不写等于号和方法主体，那么方法会被隐式声明为<strong>抽象(abstract)方法</strong>，包含它的类型于是也应该是一个抽象类。</p>
<hr>
<h2 id="方法定义"><a href="#方法定义" class="headerlink" title="方法定义"></a>方法定义</h2><p>方法定义由一个 <strong>def</strong> 关键字开始，紧接着是可选的参数列表，一个冒号 <strong>:</strong> 和方法的返回类型，一个等于号 <strong>=</strong> ，最后是方法的主体。</p>
<p>Scala 方法定义格式如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">functionName</span> </span>([参数列表]) : [<span class="keyword">return</span> <span class="class"><span class="keyword">type</span>] </span>= &#123;</span><br><span class="line">    function body</span><br><span class="line">    <span class="keyword">return</span> [expr]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码中 <strong>return type</strong> 可以是任意合法的 Scala 数据类型。参数列表中的参数可以使用逗号分隔。</p>
<p>如果方法没有返回值，可以返回为 <strong>Unit</strong>，这个类似于 Java 的 <strong>void</strong>, 实例如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printMe</span></span>( ) : <span class="type">Unit</span> = &#123;</span><br><span class="line">        println(<span class="string">&quot;Hello, Scala!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h2><p>Scala 提供了多种不同的方法调用方式：</p>
<p>以下是调用方法的标准格式：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">functionName( 参数列表 )</span><br></pre></td></tr></table></figure>

<p>如果方法使用了实例的对象来调用，我们可以使用类似java的格式 (使用 <strong>.</strong> 号)：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[instance.]functionName( 参数列表 )</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="函数至简原则"><a href="#函数至简原则" class="headerlink" title="函数至简原则"></a>函数至简原则</h2><p>函数至简原则：能省则省</p>
<ol>
<li> <code>return</code> 关键字可以省略，Scala 会使用函数体的最后一行代码作为返回值</li>
<li> 返回值类型如果能够推断出来，那么可以省略</li>
<li> 如果函数体只有一行代码，可以省略花括号</li>
<li> 如果函数无参，则可以省略小括号。若定义函数时省略小括号，则调用该函数时，也需省略小括号；若定时函数时未省略，则调用时，可省可不省。</li>
<li> 如果函数显式声明返回值为 <code>Unit</code>，那么即使在函数体中使用 <code>return</code> 关键字也不会起作用</li>
<li> Scala 如果想要自动推断无返回值，可以省略等号</li>
<li> 如果不关心名称，只关系逻辑处理，那么函数名（def）可以省略</li>
<li> 如果函数明确使用return关键字，那么函数返回就不能使用自行推断了，需要声明返回值类型</li>
</ol>
<hr>
<h1 id="函数传名调用-call-by-name"><a href="#函数传名调用-call-by-name" class="headerlink" title="函数传名调用(call-by-name)"></a>函数传名调用(call-by-name)</h1><p>Scala 的解释器在解析函数参数<code>(function arguments)</code>时有两种方式：</p>
<ul>
<li>  <strong>传值调用（call-by-value）</strong>：先计算参数表达式的值，再应用到函数内部；</li>
<li>  <strong>传名调用（call-by-name）</strong>：将未计算的参数表达式直接应用到函数内部</li>
</ul>
<p>在进入函数内部前，传值调用方式就已经将参数表达式的值计算完毕，而传名调用是在函数内部进行参数表达式的值计算的。</p>
<p>这就造成了一种现象，每次使用传名调用时，解释器都会计算一次表达式的值。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        delayed(time());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">time</span></span>() = &#123;</span><br><span class="line">        println(<span class="string">&quot;获取时间，单位为纳秒&quot;</span>)</span><br><span class="line">        <span class="type">System</span>.nanoTime</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delayed</span></span>( t: =&gt; <span class="type">Long</span> ) = &#123;</span><br><span class="line">        println(<span class="string">&quot;在 delayed 方法内&quot;</span>)</span><br><span class="line">        println(<span class="string">&quot;参数： &quot;</span> + t)</span><br><span class="line">        t</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上实例中我们声明了 <code>delayed</code> 方法， 该方法在参数列表中使用 <code>变量名和变量类型使用 =&gt; 符号</code> 来设置传名调用。执行以上代码，输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在 delayed 方法内</span><br><span class="line">获取时间，单位为纳秒</span><br><span class="line">参数： 1283416055823200</span><br><span class="line">获取时间，单位为纳秒</span><br></pre></td></tr></table></figure>

<p>实例中 <code>delay</code> 方法打印了一条信息表示进入了该方法，接着 <code>delay</code> 方法打印接收到的值，最后再返回 <code>t</code>。</p>
<hr>
<h1 id="指定函数参数名"><a href="#指定函数参数名" class="headerlink" title="指定函数参数名"></a>指定函数参数名</h1><p>一般情况下函数调用参数，就按照函数定义时的参数顺序一个个传递。但是我们也可以通过指定函数参数名，并且不需要按照顺序向函数传递参数，实例如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        printInt(b=<span class="number">5</span>, a=<span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printInt</span></span>( a:<span class="type">Int</span>, b:<span class="type">Int</span> ) = &#123;</span><br><span class="line">        println(<span class="string">&quot;Value of a : &quot;</span> + a );</span><br><span class="line">        println(<span class="string">&quot;Value of b : &quot;</span> + b );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Value</span> of a :  <span class="number">7</span></span><br><span class="line"><span class="type">Value</span> of b :  <span class="number">5</span></span><br></pre></td></tr></table></figure>





<h1 id="函数-可变参数"><a href="#函数-可变参数" class="headerlink" title="函数 - 可变参数"></a>函数 - 可变参数</h1><p>Scala 允许你指明函数的最后一个参数可以是重复的，即我们不需要指定函数参数的个数，可以向函数传入可变长度参数列表。</p>
<p>Scala 通过在参数的类型之后放一个星号来设置可变参数(可重复的参数)。例如：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        printStrings(<span class="string">&quot;Runoob&quot;</span>, <span class="string">&quot;Scala&quot;</span>, <span class="string">&quot;Python&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">printStrings</span></span>( args:<span class="type">String</span>* ) = &#123;</span><br><span class="line">      <span class="keyword">var</span> i : <span class="type">Int</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( arg &lt;- args )&#123;</span><br><span class="line">         println(<span class="string">&quot;Arg value[&quot;</span> + i + <span class="string">&quot;] = &quot;</span> + arg );</span><br><span class="line">         i = i + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Arg value[0] = Runoob</span><br><span class="line">Arg value[1] = Scala</span><br><span class="line">Arg value[2] = Python</span><br></pre></td></tr></table></figure>





<h1 id="函数-默认参数值"><a href="#函数-默认参数值" class="headerlink" title="函数 - 默认参数值"></a>函数 - 默认参数值</h1><p>Scala 可以为函数参数指定默认参数值，使用了默认参数，你在调用函数的过程中可以不需要传递参数，这时函数就会调用它的默认参数值，如果传递了参数，则传递值会取代默认值。实例如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        println( <span class="string">&quot;返回值 : &quot;</span> + addInt() );</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">addInt</span></span>( a:<span class="type">Int</span>=<span class="number">5</span>, b:<span class="type">Int</span>=<span class="number">7</span> ) : <span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="keyword">var</span> sum:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">      sum = a + b</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> sum</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ scalac Test.scala</span><br><span class="line">$ scala Test</span><br><span class="line">返回值 : 12</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h1><p>Scala 中定义匿名函数的语法很简单，箭头左边是参数列表，右边是函数体。</p>
<p>使用匿名函数后，我们的代码变得更简洁了。</p>
<p>下面的表达式就定义了一个接受一个 Int 类型输入参数的匿名函数:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inc = (x:<span class="type">Int</span>) =&gt; x+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>上述定义的匿名函数，其实是下面这种写法的简写：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2</span> </span>= <span class="keyword">new</span> <span class="type">Function1</span>[<span class="type">Int</span>,<span class="type">Int</span>]&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x:<span class="type">Int</span>):<span class="type">Int</span> = x+<span class="number">1</span>;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>以上实例的 inc 现在可作为一个函数，使用方式如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = inc(<span class="number">7</span>)<span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>同样我们可以在匿名函数中定义多个参数：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mul = (x: <span class="type">Int</span>, y: <span class="type">Int</span>) =&gt; x*y</span><br></pre></td></tr></table></figure>

<p>mul 现在可作为一个函数，使用方式如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(mul(<span class="number">3</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>我们也可以不给匿名函数设置参数，如下所示：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userDir = () =&gt; &#123; <span class="type">System</span>.getProperty(<span class="string">&quot;user.dir&quot;</span>) &#125;</span><br></pre></td></tr></table></figure>

<p>userDir 现在可作为一个函数，使用方式如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println( userDir() )</span><br></pre></td></tr></table></figure>



<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        println( <span class="string">&quot;multiplier(1) value = &quot;</span> +  multiplier(<span class="number">1</span>) )</span><br><span class="line">        println( <span class="string">&quot;multiplier(2) value = &quot;</span> +  multiplier(<span class="number">2</span>) )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> factor = <span class="number">3</span></span><br><span class="line">    <span class="keyword">val</span> multiplier = (i:<span class="type">Int</span>) =&gt; i * factor</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">multiplier(1) value = 3</span><br><span class="line">multiplier(2) value = 6</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="函数柯里化-Currying"><a href="#函数柯里化-Currying" class="headerlink" title="函数柯里化(Currying)"></a>函数柯里化(Currying)</h1><p>柯里化<code>(Currying)</code>指的是将原来接受两个参数的函数变成新的接受一个参数的函数的过程。新的函数返回一个以原有第二个参数为参数的函数。</p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p>首先我们定义一个函数:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x:<span class="type">Int</span>,y:<span class="type">Int</span>)=x+y</span><br></pre></td></tr></table></figure>

<p>那么我们应用的时候，应该是这样用：add(1,2)</p>
<p>现在我们把这个函数变一下形：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x:<span class="type">Int</span>)(y:<span class="type">Int</span>) = x + y</span><br></pre></td></tr></table></figure>

<p>那么我们应用的时候，应该是这样用：add(1)(2),最后结果都一样是3，这种方式（过程）就叫柯里化。</p>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><p>add(1)(2) 实际上是依次调用两个普通函数（非柯里化函数），第一次调用使用一个参数 x，返回一个函数类型的值，第二次使用参数y调用这个函数类型的值。</p>
<p>实质上最先演变成这样一个方法：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x:<span class="type">Int</span>)=(y:<span class="type">Int</span>)=&gt;x+y</span><br></pre></td></tr></table></figure>

<p>那么这个函数是什么意思呢？ 接收一个x为参数，返回一个匿名函数，该匿名函数的定义是：接收一个Int型参数y，函数体为x+y。现在我们来对这个方法进行调用。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = add(<span class="number">1</span>) </span><br></pre></td></tr></table></figure>

<p>返回一个result，那result的值应该是一个匿名函数：(y:Int)=&gt;1+y</p>
<p>所以为了得到结果，我们继续调用result。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> sum = result(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>最后打印出来的结果就是3。</p>
<h3 id="完整实例"><a href="#完整实例" class="headerlink" title="完整实例"></a>完整实例</h3><p>下面是一个完整实例：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">      <span class="keyword">val</span> str1:<span class="type">String</span> = <span class="string">&quot;Hello, &quot;</span></span><br><span class="line">      <span class="keyword">val</span> str2:<span class="type">String</span> = <span class="string">&quot;Scala!&quot;</span></span><br><span class="line">      println( <span class="string">&quot;str1 + str2 = &quot;</span> +  strcat(str1)(str2) )</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">strcat</span></span>(s1: <span class="type">String</span>)(s2: <span class="type">String</span>) = &#123;</span><br><span class="line">      s1 + s2</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str1 + str2 = <span class="type">Hello</span>, <span class="type">Scala</span>!</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h1><p>高阶函数（Higher-Order Function）就是操作其他函数的函数。</p>
<p>Scala 中允许使用高阶函数，<strong>高阶函数可以使用其他函数作为参数，或者使用函数作为输出结果</strong>。</p>
<p>以下实例中，apply() 函数使用了另外一个函数 f 和 值 v 作为参数，而函数 f 又调用了参数 v：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line"></span><br><span class="line">        println( apply( layout, <span class="number">10</span>) )</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 函数 f 和 值 v 作为参数，而函数 f 又调用了参数 v</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(f: <span class="type">Int</span> =&gt; <span class="type">String</span>, v: <span class="type">Int</span>) = f(v)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">layout</span></span>[<span class="type">A</span>](x: <span class="type">A</span>) = <span class="string">&quot;[&quot;</span> + x.toString() + <span class="string">&quot;]&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[10]</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="偏应用函数（偏函数）"><a href="#偏应用函数（偏函数）" class="headerlink" title="偏应用函数（偏函数）"></a>偏应用函数（偏函数）</h1><p><strong>偏函数的本质就是定义一个新的函数，对原始函数的功能进行增强。</strong></p>
<p>偏函数是一种表达式，你不需要提供函数需要的所有参数，只需要提供部分，或不提供所需参数。</p>
<p>如下实例，我们打印日志信息：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Date</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        <span class="keyword">val</span> date = <span class="keyword">new</span> <span class="type">Date</span></span><br><span class="line">        log(date, <span class="string">&quot;message1&quot;</span> )</span><br><span class="line">        <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">        log(date, <span class="string">&quot;message2&quot;</span> )</span><br><span class="line">        <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">        log(date, <span class="string">&quot;message3&quot;</span> )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log</span></span>(date: <span class="type">Date</span>, message: <span class="type">String</span>)  = &#123;</span><br><span class="line">        println(date + <span class="string">&quot;----&quot;</span> + message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mon Dec 02 12:52:41 CST 2018----message1</span><br><span class="line">Mon Dec 02 12:52:41 CST 2018----message2</span><br><span class="line">Mon Dec 02 12:52:41 CST 2018----message3</span><br></pre></td></tr></table></figure>

<p>实例中，<code>log()</code> 方法接收两个参数：<code>date</code> 和 <code>message</code>。我们在程序执行时调用了三次，参数 <code>date</code> 值都相同，<code>message</code> 不同。</p>
<p>我们可以使用偏应用函数优化以上方法，绑定第一个 <code>date</code> 参数，第二个参数使用下划线 <code>_</code> 替换缺失的参数列表，并把这个新的函数值的索引的赋给变量。以上实例修改如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Date</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">      <span class="keyword">val</span> date = <span class="keyword">new</span> <span class="type">Date</span></span><br><span class="line">      <span class="keyword">val</span> logWithDateBound = log(date, _ : <span class="type">String</span>)</span><br><span class="line"></span><br><span class="line">      logWithDateBound(<span class="string">&quot;message1&quot;</span> )</span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">      logWithDateBound(<span class="string">&quot;message2&quot;</span> )</span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">      logWithDateBound(<span class="string">&quot;message3&quot;</span> )</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">log</span></span>(date: <span class="type">Date</span>, message: <span class="type">String</span>)  = &#123;</span><br><span class="line">     println(date + <span class="string">&quot;----&quot;</span> + message)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行以上代码，输出结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Tue Dec 18 11:25:54 CST 2018----message1</span><br><span class="line">Tue Dec 18 11:25:54 CST 2018----message2</span><br><span class="line">Tue Dec 18 11:25:54 CST 2018----message3</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/21/SparkSQL%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/SparkSQL%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">SparkSQL实战</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-21 14:49:45" itemprop="dateCreated datePublished" datetime="2021-12-21T14:49:45+08:00">2021-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-12-25 17:11:25" itemprop="dateModified" datetime="2021-12-25T17:11:25+08:00">2021-12-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spark/" itemprop="url" rel="index"><span itemprop="name">Spark</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="第-1-章-准备数据"><a href="#第-1-章-准备数据" class="headerlink" title="第 1 章    准备数据"></a>第 1 章    准备数据</h1><ul>
<li>  我们这次 <code>SparkSQL</code> 操作中所有的数据均来自 <code>Hive</code>。</li>
<li>  首先在 <code>Hive</code> 中创建表，并导入数据。</li>
<li>  一共有 3 张表：1 张用户行为表，1 张城市表，1 张产品表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 用户行为表</span><br><span class="line">CREATE TABLE `user_visit_action`(</span><br><span class="line">  `date` string,</span><br><span class="line">  `user_id` bigint,</span><br><span class="line">  `session_id` string,</span><br><span class="line">  `page_id` bigint,</span><br><span class="line">  `action_time` string,</span><br><span class="line">  `search_keyword` string,</span><br><span class="line">  `click_category_id` bigint,</span><br><span class="line">  `click_product_id` bigint,</span><br><span class="line">  `order_category_ids` string,</span><br><span class="line">  `order_product_ids` string,</span><br><span class="line">  `pay_category_ids` string,</span><br><span class="line">  `pay_product_ids` string,</span><br><span class="line">  `city_id` bigint)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br><span class="line">load data local inpath &#x27;/opt/module/datas/user_visit_action.txt&#x27; into table sparkpractice.user_visit_action;</span><br><span class="line"></span><br><span class="line"># 产品表</span><br><span class="line">CREATE TABLE `product_info`(</span><br><span class="line">  `product_id` bigint,</span><br><span class="line">  `product_name` string,</span><br><span class="line">  `extend_info` string)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br><span class="line">load data local inpath &#x27;/opt/module/datas/product_info.txt&#x27; into table sparkpractice.product_info;</span><br><span class="line"></span><br><span class="line"># 城市表</span><br><span class="line">CREATE TABLE `city_info`(</span><br><span class="line">  `city_id` bigint,</span><br><span class="line">  `city_name` string,</span><br><span class="line">  `area` string)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br><span class="line">load data local inpath &#x27;/opt/module/datas/city_info.txt&#x27; into table sparkpractice.city_info;</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="第-2-章-需求"><a href="#第-2-章-需求" class="headerlink" title="第 2 章    需求"></a>第 2 章    需求</h1><h2 id="2-1-需求简介"><a href="#2-1-需求简介" class="headerlink" title="2.1    需求简介"></a>2.1    需求简介</h2><p>各区域热门商品 Top3</p>
<p>这里的热门商品是从点击量的维度来看的</p>
<p>计算各个区域前三大热门商品，并备注上每个商品在主要城市中的分布比例，超过两个城市用其它显示。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">地区	商品名称		点击次数	城市备注</span><br><span class="line">华北	商品A		100000	北京21.2%，天津13.2%，其它65.6%</span><br><span class="line">华北	商品P		80200	北京63.0%，太原10%，其它27.0%</span><br><span class="line">华北	商品M		40000	北京63.0%，太原10%，其它27.0%</span><br><span class="line">东北	商品J		92000	大连28%，辽宁17.0%，其它 55.0%</span><br></pre></td></tr></table></figure>

<h2 id="2-2-思路分析"><a href="#2-2-思路分析" class="headerlink" title="2.2    思路分析"></a>2.2    思路分析</h2><p>使用 <code>SQL</code> 来完成。碰到复杂的需求，可以使用 <code>UDF</code> 或 <code>UDAF</code>。</p>
<ol>
<li>   查询出来所有的点击记录，并与 <code>city_info</code> 表连接，得到每个城市所在的地区，与 <code>Product_info</code> 表连接得到产品名称。</li>
<li>   按照地区和商品 <code>id</code> 分组，统计出每个商品在每个地区的总点击次数</li>
<li>   每个地区内按照点击次数降序排列</li>
<li>   只取前三名，并把结果保存在数据库中</li>
<li>   城市备注需要自定义 <code>UDAF</code> 函数</li>
</ol>
<hr>
<h1 id="第-3-章-具体业务实现"><a href="#第-3-章-具体业务实现" class="headerlink" title="第 3 章    具体业务实现"></a>第 3 章    具体业务实现</h1><h2 id="3-1-UDAF-函数定义"><a href="#3-1-UDAF-函数定义" class="headerlink" title="3.1    UDAF 函数定义"></a>3.1    <code>UDAF</code> 函数定义</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.sparkoffline.udf</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.<span class="type">DecimalFormat</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.expressions.&#123;<span class="type">MutableAggregationBuffer</span>, <span class="type">UserDefinedAggregateFunction</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AreaClickUDAF</span> <span class="keyword">extends</span> <span class="title">UserDefinedAggregateFunction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 输入数据的类型:  北京  String</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">inputSchema</span></span>: <span class="type">StructType</span> = &#123;</span><br><span class="line">        <span class="type">StructType</span>(<span class="type">StructField</span>(<span class="string">&quot;city_name&quot;</span>, <span class="type">StringType</span>) :: <span class="type">Nil</span>)</span><br><span class="line">        <span class="comment">//        StructType(Array(StructField(&quot;city_name&quot;, StringType)))</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 缓存的数据的类型: 北京-&gt;1000, 天津-&gt;5000  Map,  总的点击量  1000/?</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">bufferSchema</span></span>: <span class="type">StructType</span> = &#123;</span><br><span class="line">        <span class="comment">// MapType(StringType, LongType) 还需要标注 map的key的类型和value的类型</span></span><br><span class="line">        <span class="type">StructType</span>(<span class="type">StructField</span>(<span class="string">&quot;city_count&quot;</span>, <span class="type">MapType</span>(<span class="type">StringType</span>, <span class="type">LongType</span>)) :: <span class="type">StructField</span>(<span class="string">&quot;total_count&quot;</span>, <span class="type">LongType</span>) :: <span class="type">Nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出的数据类型  &quot;北京21.2%，天津13.2%，其它65.6%&quot;  String</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">dataType</span></span>: <span class="type">DataType</span> = <span class="type">StringType</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 相同的输入是否应用有相同的输出.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">deterministic</span></span>: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 给存储数据初始化</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="comment">//初始化map缓存</span></span><br><span class="line">        buffer(<span class="number">0</span>) = <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Long</span>]()</span><br><span class="line">        <span class="comment">// 初始化总的点击量</span></span><br><span class="line">        buffer(<span class="number">1</span>) = <span class="number">0</span>L</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分区内合并 Map[城市名, 点击量]</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>, input: <span class="type">Row</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="comment">// 首先拿到城市名, 然后把成名作为key去查看map中是否存在, 如果存在就把对应的值 +1, 如果不存在, 则直径0+1</span></span><br><span class="line">        <span class="keyword">val</span> cityName = input.getString(<span class="number">0</span>)</span><br><span class="line">        <span class="comment">//        val map: collection.Map[String, Long] = buffer.getMap[String, Long](0)</span></span><br><span class="line">        <span class="keyword">val</span> map: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Long</span>] = buffer.getAs[<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Long</span>]](<span class="number">0</span>)</span><br><span class="line">        buffer(<span class="number">0</span>) = map + (cityName -&gt; (map.getOrElse(cityName, <span class="number">0</span>L) + <span class="number">1</span>L))</span><br><span class="line">        <span class="comment">// 碰到一个城市, 则总的点击量要+1</span></span><br><span class="line">        buffer(<span class="number">1</span>) = buffer.getLong(<span class="number">1</span>) + <span class="number">1</span>L</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分区间的合并</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">merge</span></span>(buffer1: <span class="type">MutableAggregationBuffer</span>, buffer2: <span class="type">Row</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">val</span> map1 = buffer1.getAs[<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Long</span>]](<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">val</span> map2 = buffer2.getAs[<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Long</span>]](<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 把map1的键值对与map2中的累积, 最后赋值给buffer1</span></span><br><span class="line">        buffer1(<span class="number">0</span>) = map1.foldLeft(map2) &#123;</span><br><span class="line">            <span class="keyword">case</span> (map, (k, v)) =&gt;</span><br><span class="line">                map + (k -&gt; (map.getOrElse(k, <span class="number">0</span>L) + v))</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        buffer1(<span class="number">1</span>) = buffer1.getLong(<span class="number">1</span>) + buffer2.getLong(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 最终的输出. &quot;北京21.2%，天津13.2%，其它65.6%&quot;</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">evaluate</span></span>(buffer: <span class="type">Row</span>): <span class="type">Any</span> = &#123;</span><br><span class="line">        <span class="keyword">val</span> cityCountMap = buffer.getAs[<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Long</span>]](<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">val</span> totalCount = buffer.getLong(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> citysRatio: <span class="type">List</span>[<span class="type">CityRemark</span>] = cityCountMap.toList.sortBy(-_._2).take(<span class="number">2</span>).map &#123;</span><br><span class="line">            <span class="keyword">case</span> (cityName, count) =&gt; &#123;</span><br><span class="line">                <span class="type">CityRemark</span>(cityName, count.toDouble / totalCount)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果城市的个数超过2才显示其它</span></span><br><span class="line">        <span class="keyword">if</span> (cityCountMap.size &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            citysRatio = citysRatio :+ <span class="type">CityRemark</span>(<span class="string">&quot;其它&quot;</span>, citysRatio.foldLeft(<span class="number">1</span>D)(_ - _.cityRatio))</span><br><span class="line">        &#125;</span><br><span class="line">        citysRatio.mkString(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">CityRemark</span>(<span class="params">cityName: <span class="type">String</span>, cityRatio: <span class="type">Double</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> formatter = <span class="keyword">new</span> <span class="type">DecimalFormat</span>(<span class="string">&quot;0.00%&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span></span>: <span class="type">String</span> = <span class="string">s&quot;<span class="subst">$cityName</span>:<span class="subst">$&#123;formatter.format(cityRatio)&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="3-2-具体实现"><a href="#3-2-具体实现" class="headerlink" title="3.2    具体实现"></a>3.2    具体实现</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.atguigu.practice.app.udf.<span class="type">AreaClickUDAF</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">SparkSession</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Author lzc</span></span><br><span class="line"><span class="comment">  * Date 2019/8/9 4:47 PM</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">AreaClickApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">val</span> spark: <span class="type">SparkSession</span> = <span class="type">SparkSession</span></span><br><span class="line">            .builder()</span><br><span class="line">            .master(<span class="string">&quot;local[2]&quot;</span>)</span><br><span class="line">            .appName(<span class="string">&quot;AreaClickApp&quot;</span>)</span><br><span class="line">            .enableHiveSupport()</span><br><span class="line">            .getOrCreate()</span><br><span class="line">        spark.sql(<span class="string">&quot;use sparkpractice&quot;</span>)</span><br><span class="line">        <span class="comment">// 0 注册自定义聚合函数</span></span><br><span class="line">        spark.udf.register(<span class="string">&quot;city_remark&quot;</span>, <span class="keyword">new</span> <span class="type">AreaClickUDAF</span>)</span><br><span class="line">        <span class="comment">// 1. 查询出所有的点击记录,并和城市表产品表做内连接</span></span><br><span class="line">        spark.sql(</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              |select</span></span><br><span class="line"><span class="string">              |    c.*,</span></span><br><span class="line"><span class="string">              |    v.click_product_id,</span></span><br><span class="line"><span class="string">              |    p.product_name</span></span><br><span class="line"><span class="string">              |from user_visit_action v join city_info c join product_info p on v.city_id=c.city_id and v.click_product_id=p.product_id</span></span><br><span class="line"><span class="string">              |where click_product_id&gt;-1</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.stripMargin).createOrReplaceTempView(<span class="string">&quot;t1&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 计算每个区域, 每个产品的点击量</span></span><br><span class="line">        spark.sql(</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              |select</span></span><br><span class="line"><span class="string">              |    t1.area,</span></span><br><span class="line"><span class="string">              |    t1.product_name,</span></span><br><span class="line"><span class="string">              |    count(*) click_count,</span></span><br><span class="line"><span class="string">              |    city_remark(t1.city_name)</span></span><br><span class="line"><span class="string">              |from t1</span></span><br><span class="line"><span class="string">              |group by t1.area, t1.product_name</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.stripMargin).createOrReplaceTempView(<span class="string">&quot;t2&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 对每个区域内产品的点击量进行倒序排列</span></span><br><span class="line">        spark.sql(</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              |select</span></span><br><span class="line"><span class="string">              |    *,</span></span><br><span class="line"><span class="string">              |    rank() over(partition by t2.area order by t2.click_count desc) rank</span></span><br><span class="line"><span class="string">              |from t2</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.stripMargin).createOrReplaceTempView(<span class="string">&quot;t3&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 每个区域取top3</span></span><br><span class="line">        </span><br><span class="line">        spark.sql(</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              |select</span></span><br><span class="line"><span class="string">              |    *</span></span><br><span class="line"><span class="string">              |from t3</span></span><br><span class="line"><span class="string">              |where rank&lt;=3</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.stripMargin).show</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
