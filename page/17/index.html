<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/17/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/17/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/17/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">232</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/14/Node%E5%92%8CNPM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/14/Node%E5%92%8CNPM/" class="post-title-link" itemprop="url">Node和NPM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-14 17:04:34" itemprop="dateCreated datePublished" datetime="2021-03-14T17:04:34+08:00">2021-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-03-15 23:53:34" itemprop="dateModified" datetime="2021-03-15T23:53:34+08:00">2021-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前端开发模式发展"><a href="#前端开发模式发展" class="headerlink" title="前端开发模式发展"></a>前端开发模式发展</h1><p>前端开发模式的发展：</p>
<blockquote>
<ol>
<li>静态页面</li>
</ol>
</blockquote>
<p>最初的网页以HTML为主，是纯静态的网页。网页是只读的，<strong>数据只能从服务端到客户端单向流通</strong>。前端开发人员只关心数据和页面的展示样式即可。</p>
<blockquote>
<ol start="2">
<li>动态页面</li>
</ol>
</blockquote>
<p>随着 JavaScript 的诞生，前端开发人员可以操作页面的 DOM 元素及样式，页面有了一些动态的效果，但仍以静态为主。</p>
<blockquote>
<ol start="3">
<li>异步请求：Ajax</li>
</ol>
</blockquote>
<ul>
<li>2005年开始，Ajax 逐渐被前端开发人员所重视，因为不用刷新页面就可以更新页面的数据和渲染效果。</li>
<li>此时的<strong>开发人员不仅仅要编写HTML样式，还要懂ajax与后端交互，然后通过JS操作Dom元素来实现页面动态效果</strong>。</li>
<li>比较流行的框架如Jquery就是典型代表。</li>
</ul>
<blockquote>
<ol start="4">
<li>MVVM：关注模型和视图</li>
</ol>
</blockquote>
<ul>
<li><p>2008年，Google 的 Chrome 发布，随后就以极快的速度占领市场，超过 IE 成为浏览器市场的主导者。</p>
</li>
<li><p>2009年，Ryan Dahl 在谷歌的 Chrome V8 引擎基础上，打造了基于事件循环的异步IO框架：<code>Node.js</code></p>
<ul>
<li>基于事件循环的异步IO</li>
<li>单线程运行，避免多线程的变量同步问题</li>
<li>Js 可以编写后台代码，前后台统一编程语言</li>
</ul>
<p>node.js的伟大之处不在于让 Js 迈向了后端开发，而是构建了一个庞大的生态系统。</p>
</li>
<li><p>2010年，NPM 作为 node.js 的包管理系统首次发布，开发人员可以遵循 Common.js 规范来编写 Node.js 模块，然后发布到NPM上供其他开发人员使用。目前已经是世界最大的包模块管理系统。</p>
</li>
</ul>
<p>随后，在node的基础上，涌现出了一大批的前端框架：</p>
<p> <img src="/2021/03/14/Node%E5%92%8CNPM/1525825983230.png" alt="1525825983230"></p>
<blockquote>
<ol start="5">
<li>MVVM模式</li>
</ol>
</blockquote>
<ul>
<li>M：即Model，模型，包括数据和一些基本操作</li>
<li>V：即View，视图，页面渲染结果</li>
<li>VM：即View-Model，模型与视图间的双向操作（无需开发人员干涉）</li>
</ul>
<p>在 MVVM 之前，前端开发人员从后端获取需要的数据模型，然后要通过 DOM 操作 Model 渲染到 View 中。而后当用户操作视图，我们还需要通过 DOM 获取 View 中的数据，然后同步到 Model 中。</p>
<p>而 MVVM 中的 VM 要做的事情就是把 DOM 操作完全封装起来，开发人员不用再关心 Model 和 View 之间是如何互相影响的：</p>
<ul>
<li>只要我们Model发生了改变，View上自然就会表现出来。</li>
<li>当用户修改了View，Model中的数据也会跟着改变。</li>
</ul>
<p>把开发人员从繁琐的DOM操作中解放出来，把关注点放在如何操作Model上。</p>
<p> <img src="/2021/03/14/Node%E5%92%8CNPM/1525828854056.png" alt="1525828854056"></p>
<h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><h2 id="Node-js-的概念"><a href="#Node-js-的概念" class="headerlink" title="Node.js 的概念"></a>Node.js 的概念</h2><h3 id="JavaScript-引擎"><a href="#JavaScript-引擎" class="headerlink" title="JavaScript 引擎"></a>JavaScript 引擎</h3><p>浏览器的内核包括两部分核心：</p>
<ul>
<li>DOM 渲染引擎</li>
<li>JavaScript 解析引擎</li>
</ul>
<p>Chrome 浏览器内置 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。</p>
<h3 id="什么是Node-js"><a href="#什么是Node-js" class="headerlink" title="什么是Node.js"></a>什么是Node.js</h3><ul>
<li>脱离浏览器环境也可以运行JavaScript，只要有JavaScript 引擎就可以。</li>
<li>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境！即 Node.js 内置了 Chrome 的 V8 引擎，可以在 Node.js 环境中直接运行JavaScript 程序。</li>
<li>在 Node.js 中写 JavaScript 和在 Chrome 浏览器中写  JavaScript 基本没有什么不一样。</li>
<li>具体有以下几点不同：<ol>
<li>Node.js 中没有浏览器API，即document，window等。</li>
<li>Node.js 中增加了许多 Node.js 的专属 API，例如文件系统，进程，http功能。</li>
</ol>
</li>
</ul>
<h3 id="Node-js有什么用"><a href="#Node-js有什么用" class="headerlink" title="Node.js有什么用"></a>Node.js有什么用</h3><p>如果你想开发类似JavaWeb的简单的后端程序，那么学习Node.js是一个非常好的选择。</p>
<p>如果你想部署一些高性能的服务，那么学习Node.js也是一个非常好的选择。</p>
<p>通常他会被用来作一个BFF层，即 Backend For Frontend（服务于前端的后端），通俗的说是一个专门用于为前端业务提供数据的后端程序</p>
<blockquote>
<p>NPM 是 Node 提供的模块管理工具，可以非常方便的下载安装很多前端框架，包括Jquery、AngularJS、VueJs 等等。</p>
</blockquote>
<h2 id="Node-js-的下载与安装"><a href="#Node-js-的下载与安装" class="headerlink" title="Node.js 的下载与安装"></a>Node.js 的下载与安装</h2><blockquote>
<ol>
<li>下载地址：</li>
</ol>
</blockquote>
<ul>
<li>官网：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></li>
<li>中文网：<a target="_blank" rel="noopener" href="http://nodejs.cn/">http://nodejs.cn/</a></li>
</ul>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529594451775.png" alt="1529594451775"></p>
<blockquote>
<ol start="2">
<li>推荐下载LTS版本。</li>
</ol>
</blockquote>
<ul>
<li>LTS：长期支持版本</li>
<li>Current：最新版</li>
</ul>
<blockquote>
<ol start="3">
<li>下载完成后直接下一步安装即可！</li>
</ol>
</blockquote>
<blockquote>
<ol start="4">
<li>完成以后，在控制台输入<code>node -v</code>就能看到版本信息：</li>
</ol>
</blockquote>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529595770482.png" alt="1529595770482"></p>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><blockquote>
<p>使用 VsCode 开发工具</p>
</blockquote>
<ol>
<li><p>创建<code>node/demo01.js</code>文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello Node.js&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>打开命令行终端，进入到程序所在的目录，输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node demo01.js</span><br></pre></td></tr></table></figure></li>
<li><p>直接在控制台上打印结果：Hello Node.js</p>
</li>
</ol>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/image-20210315233449126.png" alt="image-20210315233449126"></p>
<hr>
<h1 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p>什么是 NPM ？</p>
</blockquote>
<ul>
<li>NPM（Node Package Manager）：是 Node.js 的包管理工具，是全球最大的模块生态系统，里面所有的模块都是开源免费的；</li>
<li>相当于后端的 Maven 。不同的是后端的 Maven 引入的是 jar 包依赖；而前端的 NPM 导入的是 Js 文件依赖！</li>
</ul>
<h2 id="安装-NPM"><a href="#安装-NPM" class="headerlink" title="安装 NPM"></a>安装 NPM</h2><ul>
<li>Node.js 自带了 NPM 了，在命令提示符输入<code>npm -v</code>可查看当前 NPM 版本：</li>
</ul>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529595810923.png" alt="1529595810923"></p>
<h3 id="安装-NRM"><a href="#安装-NRM" class="headerlink" title="安装 NRM"></a>安装 NRM</h3><p>npm 默认的仓库地址是在国外网站，速度较慢，所以我们需要设置到淘宝镜像。</p>
<p>但是切换镜像是比较麻烦的，我在这里使用一款切换镜像的工具：nrm</p>
<ol>
<li>首先安装nrm。[<code>-g</code>代表全局安装]</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nrm -g</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529596099952.png" alt="1529596099952"></p>
<ol start="2">
<li>然后通过<code>nrm ls</code>命令查看 npm 的仓库列表，带 <code>*</code> 的就是当前选中的镜像仓库：</li>
</ol>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529596219439.png" alt="1529596219439"></p>
<ol start="3">
<li>通过 <code>nrm use taobao</code> 来指定要使用的镜像源：</li>
</ol>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529596312671.png" alt="1529596312671"></p>
<ol start="4">
<li>最后通过<code>nrm test npm </code>来测试速度：</li>
</ol>
<p><img src="/2021/03/14/Node%E5%92%8CNPM/1529596566134.png" alt="1529596566134"></p>
<blockquote>
<p>Tip：</p>
</blockquote>
<ul>
<li>使用 cnpm 有时会有bug，不推荐使用 cnpm 命令！</li>
<li>安装完成请一定要重启下电脑！！！</li>
</ul>
<hr>
<h2 id="使用-NPM-管理项目"><a href="#使用-NPM-管理项目" class="headerlink" title="使用 NPM 管理项目"></a>使用 NPM 管理项目</h2><blockquote>
<p>创建<code>npm_demo</code>文件夹用于测试</p>
</blockquote>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><ol>
<li><p>在<code>npm_demo</code> 文件夹下 cmd 窗口，输入<code>npm init</code> 命令执行初始化。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>

<p>接下来按照提示输入相关信息，如果使用默认值则直接回车即可。</p>
<p><strong>最后会生成 package.json 文件，这个是包的配置文件，相当于 maven 的 pom.xml，而具体的 Js 依赖可以通过<code>npm install</code> 命令进行下载！</strong></p>
</li>
<li><p>如果想直接生成 package.json 文件，那么可以使用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y		# 对所有询问默认执行yes</span><br></pre></td></tr></table></figure></li>
<li><p><code>package.json</code> 文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>	</span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm_demo&quot;</span><span class="punctuation">,</span>		<span class="comment">// name: 项目名称</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span>		<span class="comment">// version: 项目版本号</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span>		<span class="comment">// 项目的入口Js文件，相当于Java中的main函数！</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span>			<span class="comment">// description: 项目描述</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="npm-install-命令的使用"><a href="#npm-install-命令的使用" class="headerlink" title="npm install 命令的使用"></a>npm install 命令的使用</h3><blockquote>
<p>基本命令</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、安装依赖包的最新版</span><br><span class="line">npm install 依赖包名字		</span><br><span class="line"></span><br><span class="line">2、依赖包安装到的位置：</span><br><span class="line">项目目录\node_modules</span><br><span class="line"></span><br><span class="line">3、同时在 package.json 文件中，依赖包会被添加到 dependencies 节点下，类似 maven 中的 &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">4、默认参数：--save 简写为 -s ，作用是将当前依赖保存在 dependencies 节点下 ！</span><br><span class="line"></span><br><span class="line">5、示例：安装JQuery的js依赖</span><br><span class="line">npm install jquery --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下载特定版本的依赖</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery@2.1.x</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下载开发依赖</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载 devDependencies节点中的依赖，即开发时使用的依赖包，项目打包到生产环境的时候使用的是dependencies节点中的依赖</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">示例：使用 -D参数将依赖添加到devDependencies节点中：</span></span><br><span class="line">npm install --save-dev jquery</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或简写</span></span><br><span class="line">npm i -D jquery</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下载全局依赖</p>
</blockquote>
<ul>
<li>Node.js 全局安装的 npm 包和工具的位置：<code>用户目录\AppData\Roaming\npm\node_modules</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全局安装命令</span></span><br><span class="line">npm install --global webpack</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或简写</span></span><br><span class="line">npm install -g webpack</span><br></pre></td></tr></table></figure>

<blockquote>
<p>根据依赖下载安装包</p>
</blockquote>
<ul>
<li>NPM 管理的项目在备份和传输的时候一般不携带 <code>node_modules</code> 文件夹</li>
<li>使用 NPM 安装 Js 依赖时会自动在项目目录下添加 <code>package-lock.json</code> 文件，这个文件帮助锁定安装包的版本</li>
<li>我们可以使用<code>npm install</code>命令来根据<code>package.json</code>中的配置下载依赖，初始化项目</li>
</ul>
<h3 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a>其它命令</h3><blockquote>
<p>更新包（更新到最新版本）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update 包名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>全局更新</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update -g 包名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>卸载包</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall 包名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>全局卸载</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall -g 包名</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/13/Vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/13/Vue/" class="post-title-link" itemprop="url">Vue</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-13 11:01:13" itemprop="dateCreated datePublished" datetime="2021-03-13T11:01:13+08:00">2021-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-03-24 20:50:36" itemprop="dateModified" datetime="2022-03-24T20:50:36+08:00">2022-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Vue-概述"><a href="#Vue-概述" class="headerlink" title="Vue 概述"></a>Vue 概述</h1><p>前端框架三巨头是 Vue.js、React.js、AngularJS。</p>
<p>Vue 是一套用于构建用户界面的<strong>渐进式框架</strong>。与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与现代化的工具链以及各种支持类库结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p>
<ul>
<li>官网：<a target="_blank" rel="noopener" href="https://cn.vuejs.org/">https://cn.vuejs.org/</a></li>
<li>官方文档：<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/">https://cn.vuejs.org/v2/guide/</a></li>
<li>Git地址：<a target="_blank" rel="noopener" href="https://github.com/vuejs">https://github.com/vuejs</a></li>
</ul>
<hr>
<h1 id="运行环境安装"><a href="#运行环境安装" class="headerlink" title="运行环境安装"></a>运行环境安装</h1><h3>
    1、创建工程
</h3>

<p>创建 vueDemo 工程保存接下来要编写的Vue文件，实际上就是一个文件夹。</p>
<h3>
    2、引入 Vue 依赖
</h3>

<p>我们使用的 JQuery、React、包括 Vue 都是 JavaScript 框架，底层其实都是 js 代码。要使用这些框架，首先要引入框架的 js 文件。关于如何引入这些 js 文件，我们既可以手动将 Vue 的依赖的 js 文件（<code>vue.js 或 vue.min.js</code>）先下载到本地，然后从本地引入，也可以使用 NPM 包管理工具一键安装 Vue 框架所需的依赖。</p>
<h4>
    2.1、下载到本地安装
</h4>   

<ul>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue">https://github.com/vuejs/vue</a></p>
</li>
<li><p>下载后解压，得到<code>vue.js</code>文件，将其放在项目文件的根目录下</p>
</li>
<li><p>在项目中引入依赖（<code>vue.js</code>文件）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./vue.js&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4>
    2.2、npm安装
</h4>

<p>使用 NPM 安装 Vue（这里采用了局部安装）</p>
<ol>
<li><p>在 <code>vueDemo</code> 文件夹下进入 cmd 命令行窗口</p>
</li>
<li><p>输入 <code>npm init -y</code>  初始化文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure></li>
<li><p>安装 Vue 所需的依赖，输入命令：<code>npm install vue --save</code>    【-g是全局安装， -save 是本文件夹内安装】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue --save</span><br></pre></td></tr></table></figure></li>
<li><p>安装完毕后，会发现在当前目录下多出一个<code>node_modules</code>目录，并且在 <code>node_modules/vue/dist/vue.js</code> 目录下有一个<code>vue.js</code>文件，这就是使用 Vue 框架所需的 Js 依赖文件</p>
</li>
</ol>
<p>node_modules 是通过 npm 安装的所有依赖默认的保存位置。</p>
<hr>
<h1 id="Vue入门案例"><a href="#Vue入门案例" class="headerlink" title="Vue入门案例"></a>Vue入门案例</h1><h3>
    1、新建一个 HTML 模板
</h3>

<p>在 vueDemo 目录下新建一个<code>demo.html</code>文件，并在文件中编写一段简单的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>XXX 的闪电五连鞭<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>		<span class="comment">&lt;!-- XXX 就是待渲染的数据。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3>
    2、使用 vue 渲染
</h3>

<ol>
<li>在项目中引入 Vue 运行所需的 Js 依赖；</li>
<li>创建Vue实例。Vue 实例的构造函数中需要传入一个对象，这个对象中需要声明一些属性。<ul>
<li><code>el</code>：el 即 element，限定 vue 实例的作用范围</li>
<li><code>data</code>：vue 对象中的数据，里面有很多属性。一般用于取出来渲染页面。</li>
</ul>
</li>
<li>在 HTML 模板中，通过插值表达式<code>&#123;&#123;name&#125;&#125;</code>来渲染 name 属性。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;name&#125;&#125;的闪电五连鞭<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1、引入 Vue 框架需要的 Js 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2、创建Vue实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,	<span class="comment">// 绑定 Vue 作用的范围</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;	<span class="comment">// vue对象中的数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&quot;马保国&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125; </span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li> 打开页面查看效果：</li>
</ol>
<p><img src="/2021/03/13/Vue/image-20201124181657607.png" alt="image-20201124181657607"></p>
<hr>
<h3>
    3、双向绑定
</h3>

<p>双向绑定就是不仅 Vue 中属性的变换会提现在 HTML 页面上，HTML 静态页面中属性的变化也会影响到 Vue 中对应的属性。</p>
<p>我们通过对刚才的案例进行进行几处修改来看一下效果。</p>
<ol>
<li> 在 Vue 实例的 data 中添加新的属性 <code>num</code>；</li>
<li> 在 HTML 页面中添加一个 <code>&lt;input&gt;</code> 元素，通过 <code>v-model</code> 属性与 <code>num</code> 进行绑定；</li>
<li> 在 HTML 页面中输出 <code>&#123;&#123;num&#125;&#125;</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;num&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;name&#125;&#125; 非常帅,</span><br><span class="line">        有&#123;&#123;num&#125;&#125;位女神为他着迷。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 创建一个 Vue 对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>, </span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123; </span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>:<span class="string">&quot;虎哥&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>:<span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li> 效果：</li>
</ol>
<p> <img src="/2021/03/13/Vue/2.gif"></p>
<p>我们可以观察到，输入框的变化引起了data中的num的变化，同时页面输出也跟着变化。我们可以想到，输入框的变化表示静态 HTML 页面属性的变化，而此时 HTML 中的静态属性通过 <code>v-model</code> 与 Vue 实例的 num 属性进行了绑定，所以输入框值的变换会引起 Vue 实例中 num 的变换。而 num 的变化又会提现在 HTML 页面上，最终引起了页面效果变化。</p>
<p>而这其中没有任何dom操作，这就是双向绑定的魅力。</p>
<h3>
    4、事件处理
</h3>



<p>我们在继续给上面的页面添加一个按钮：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;num++&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里用 <code>v-on</code> 指令绑定点击事件，然后直接操作 num。注意这不是普通的单击事件 <code>onclick</code>，通click是无法直接操作num的。</p>
<p>效果：</p>
<p> <img src="/2021/03/13/Vue/3.gif"></p>
<hr>
<h1 id="Vue-实例"><a href="#Vue-实例" class="headerlink" title="Vue 实例"></a>Vue 实例</h1><h3>
    1.创建Vue实例
</h3>

<p>每个 Vue 应用都是从创建一个 <strong>Vue 实例</strong>开始的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="comment">// 选项</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在构造函数中传入一个对象，并且在对象中声明各种Vue需要的数据和方法，包括：</p>
<ul>
<li>el</li>
<li>data</li>
<li>methods</li>
</ul>
<p>等等。</p>
<h3>
    2.模板或元素
</h3>

<p>每个 Vue 实例都需要关联一段 HTML 模板，表示该实例对象作用的范围，实例对象会在模板范围内进行视图渲染。我们可以通过el属性绑定模板名称。</p>
<ol>
<li> 创建一个 HTML 模板：</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 然后创建Vue实例，关联这个div</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">	<span class="attr">el</span>:<span class="string">&quot;#app&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样，Vue就可以基于id为<code>app</code>的div元素作为模板进行渲染了。在这个div范围以外的部分是无法使用这个vue对象中的属性。</p>
<h3>
    3.数据
</h3>

<p>当 Vue 实例被创建时，它会尝试获取 data 中定义的所有属性，用于视图的渲染，并且监视data中的属性变化，当data发生改变，所有相关的视图都将重新渲染，这就是“响应式“系统。</p>
<ul>
<li>  html：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  vue:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;刘德华&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>name的变化会影响到<code>input</code>的值</li>
<li>input中输入的值，也会导致vm中的name发生改变</li>
</ul>
<h3>
    4.方法
</h3>

<p>Vue 实例中除了可以定义 data 属性，也可以定义方法，并且在 Vue 实例的作用范围内使用。</p>
<ul>
<li>  html:</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;num&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  vue:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">num</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>:&#123;</span><br><span class="line">        <span class="attr">add</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">// this代表的当前vue实例</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3>5.Vue对象的生命周期

<h4>5.1.生命周期

<p>每个 Vue 实例创建时都要经过一系列的初始化过程：创建实例，装载模板，渲染模板等等。Vue为实例对象生命周期中的每个状态都设置了钩子函数（监听函数）。每当Vue实例进入生命中不同的阶段时，对应的钩子函数就会被触发。</p>
<p><strong>Vue实例的生命周期：</strong></p>
<img src="https://cn.vuejs.org/images/lifecycle.png" alt="img" style="zoom:67%;">



<h4>5.2.钩子函数

<p>钩子函数就是在 Vue 实例的生命的不同阶段会自动调用的一些函数。Vue的钩子函数包含以下几个： </p>
<ul>
<li>  <strong>beforeCreate()</strong></li>
</ul>
<p>我们在用 Vue 时都要先进行实例化，该函数就是在 Vue 实例化时调用的，也可以将他理解为初始化函数比较方便一点，在 Vue1.0 时，这个函数的名字就是 <code>init()</code>。 </p>
<ul>
<li>  <strong>created()</strong></li>
</ul>
<p>在创建实例之后进行调用。</p>
<ul>
<li>  <strong>beforeMount()</strong></li>
</ul>
<p>静态页面加载完毕，但还没有渲染动态值时调用。如：此时页面中某个元素还是 <code>&#123;&#123;name&#125;&#125;</code></p>
<ul>
<li>  <strong>mounted()</strong></li>
</ul>
<p>我们可以将他理解为原生js中的 <code>window.onload=function(&#123;.,.&#125;)</code>,它的功能就是：在 dom 文档渲染完毕之后将要执行的函数，该函数在 Vue1.0 版本中名字为 compiled。此时页面中的  已被渲染成峰哥。</p>
<ul>
<li><p>  **beforeDestroy()**：该函数将在销毁实例前进行调用。</p>
</li>
<li><p>  **destroyed()**：该函数将在销毁实例时进行调用。</p>
</li>
<li><p>  **beforeUpdate()**：组件更新之前。</p>
</li>
<li><p>  **updated()**：组件更新之后。</p>
</li>
</ul>
<p>例如：created 代表在 vue 实例创建后，我们可以在 Vue 实例中定义一个 created 函数，代表这个时期的钩子函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建vue实例</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>, <span class="comment">// el即element，该vue实例要渲染的页面元素</span></span><br><span class="line">    <span class="attr">data</span>: &#123; <span class="comment">// 渲染页面需要的数据</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;峰哥&quot;</span>,</span><br><span class="line">        <span class="attr">num</span>: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span>--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">num</span> = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/2021/03/13/Vue/1529835200236.png" alt="1529835200236"></p>
<h4> 5.3.this

<p>我们可以看下在 vue 内部的 this 变量是谁，我们在 created 的时候，打印 this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">num</span>--;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p> 控制台的输出：</p>
<p><img src="/2021/03/13/Vue/1529835379275.png" alt="1529835379275"></p>
<hr>
<h1 id="Vue-指令"><a href="#Vue-指令" class="headerlink" title="Vue 指令"></a>Vue 指令</h1><p>Vue 中的指令 (Directives) 是带有 <code>v-</code> 前缀的特殊特性。指令特性的预期值是：<strong>单个 JavaScript 表达式</strong>。指令的职责是，当表达式的值改变时，将其产生的连带影响，响应式地作用于 DOM。 例如我们在入门案例中的v-on，代表绑定事件。</p>
<h2 id="1-单向绑定：插值表达式、v-model和v-html"><a href="#1-单向绑定：插值表达式、v-model和v-html" class="headerlink" title="1.单向绑定：插值表达式、v-model和v-html"></a>1.单向绑定：插值表达式、v-model和v-html</h2><p>单向绑定即通过指令获取 Vue 实例的 data 中定义的变量值，并且限定数据只能由 <code>Vue-&gt;HTML</code>，不能反过来从 <code>HTML-&gt;Vue</code>。</p>
<p>在 Vue 中可以实现单向绑定的表达式有三种，分别是插值表达式、<code>v-model</code> 和 <code>v-html</code>。</p>
<h3>1.1.插值表达式

<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;插值表达式&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>该表达式支持JS语法，可以调用js内置函数（必须有返回值）</li>
<li>表达式必须有返回结果。例如 1 + 1，没有结果的表达式不允许使用，如：var a = 1 + 1;</li>
<li>可以直接获取Vue实例中定义的变量或函数</li>
</ul>
<p>示例：</p>
<p>HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JS:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;Jack&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4> 1.1.1.插值闪烁

<p>使用插值表达式<code>&#123;&#123;&#125;&#125;`方式在网速较慢时会出现问题。在数据未加载完成时，页面会显示出原始的`&#123;&#123;&#125;&#125;</code>，加载完毕后才显示正确数据，我们称为插值闪烁。</p>
<p>我们可以将网速调慢一些，然后试试看刚才的案例：</p>
<p><img src="/2021/03/13/Vue/1529836021593.png" alt="1529836021593"></p>
<p>刷新页面：</p>
<p><img src="/2021/03/13/Vue/54.gif"></p>
<h3>1.2.v-text 和 v-html

<p>既然插值表达式存在插值闪烁现象，为了解决这个问题，Vue 提供了 <code>v-text</code> 和 <code>v-html</code> 指令来替代插值表达式 <code>&#123;&#123;&#125;&#125;</code>。</p>
<ul>
<li><strong>v-text</strong>：将数据输出到元素内部，如果输出的数据有HTML代码，会作为普通文本输出</li>
<li><strong>v-html</strong>：将数据输出到元素内部，如果输出的数据有HTML代码，会被渲染</li>
</ul>
<p>示例：</p>
<p>HTML:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    v-text:<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">&quot;hello&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    v-html:<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;hello&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JS:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">hello</span>: <span class="string">&quot;&lt;h1&gt;大家好，我是峰哥&lt;/h1&gt;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/1529836688083.png" alt="1529836688083"></p>
<h2 id="2-双向绑定：v-model"><a href="#2-双向绑定：v-model" class="headerlink" title="2.双向绑定：v-model"></a>2.双向绑定：v-model</h2><p>刚才的 <code>v-text</code> 和 <code>v-html</code> 可以看做是单向绑定，数据影响了视图渲染，但是反过来就不行。接下来学习的 <code>v-model</code> 是双向绑定，视图（View）和模型（Model）之间会互相影响。</p>
<p>用户在 View 层修改数据会直接影响到 Model 中数据的值。</p>
<p>既然是双向绑定，一定是在视图（HTML页面）中可以修改数据，这样就限定了视图的元素类型。目前 v-model 可使用的元素有：</p>
<blockquote>
<ul>
<li>input</li>
<li>select</li>
<li>textarea</li>
<li>checkbox</li>
<li>radio</li>
<li>components（Vue中的自定义组件）</li>
</ul>
</blockquote>
<p>基本上除了最后一项，其它都是表单的输入项。</p>
<p>举例：</p>
<p>html：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;language&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Java&quot;</span> /&gt;</span>Java<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;language&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PHP&quot;</span> /&gt;</span>PHP<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;language&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Swift&quot;</span> /&gt;</span>Swift<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        你选择了：&#123;&#123;language.join(&#x27;,&#x27;)&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">language</span>: []</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>多个<code>CheckBox</code>对应一个变量时，变量的类型是一个数组，单个checkbox值默认是boolean类型</li>
<li>radio对应的值是input的value值</li>
<li><code>input</code> 和<code>textarea</code> 默认对应的变量是字符串</li>
<li><code>select</code>单选对应字符串，多选对应也是数组</li>
</ul>
<p>效果：</p>
<p><img src="/2021/03/13/Vue/1529837541201.png" alt="1529837541201"></p>
<h2 id="3-绑定事件：v-on"><a href="#3-绑定事件：v-on" class="headerlink" title="3.绑定事件：v-on"></a>3.绑定事件：v-on</h2><h3 id="5-3-1-基本用法"><a href="#5-3-1-基本用法" class="headerlink" title="5.3.1.基本用法"></a>5.3.1.基本用法</h3><p><code>v-on</code> 用于给页面元素绑定事件。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v-on:事件名=&quot;js片段或函数名&quot;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事件中直接写js片段--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;num++&quot;</span>&gt;</span>增加一个<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事件指定一个回调函数，必须是Vue实例中定义的函数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;decrement&quot;</span>&gt;</span>减少一个<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>有&#123;&#123;num&#125;&#125;个女神迷恋峰哥<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>:<span class="number">100</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">decrement</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">num</span>--;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/55.gif"></p>
<p>另外，事件绑定可以简写，例如<code>v-on:click=&#39;add&#39;</code>可以简写为<code>@click=&#39;add&#39;</code></p>
<hr>
<h3 id="5-3-2-事件修饰符"><a href="#5-3-2-事件修饰符" class="headerlink" title="5.3.2.事件修饰符"></a>5.3.2.事件修饰符</h3><p>在事件处理程序中调用 <code>event.preventDefault()</code> 或 <code>event.stopPropagation()</code> 是非常常见的需求。尽管我们可以在方法中轻松实现这点，但更好的方式是：方法只有纯粹的数据逻辑，而不是去处理 DOM 事件细节。</p>
<p>为了解决这个问题，Vue.js 为 <code>v-on</code> 提供了<strong>事件修饰符</strong>。修饰符是由点开头的指令后缀来表示的。</p>
<ul>
<li><code>.stop</code> ：阻止事件冒泡到父元素</li>
<li><code>.prevent</code>：阻止默认事件发生</li>
<li><code>.capture</code>：使用事件捕获模式</li>
<li><code>.self</code>：只有元素自身触发事件才执行。（冒泡或捕获的都不执行）</li>
<li><code>.once</code>：只执行一次</li>
</ul>
<p>阻止默认事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--右击事件，并阻止默认事件发生--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:contextmenu.prevent</span>=<span class="string">&quot;num++&quot;</span>&gt;</span>增加一个<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--右击事件，不阻止默认事件发生--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:contextmenu</span>=<span class="string">&quot;decrement($event)&quot;</span>&gt;</span>减少一个<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>有&#123;&#123;num&#125;&#125;个女神迷恋峰哥<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>: <span class="number">100</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">decrement</span>(<span class="params">ev</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// ev.preventDefault();</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">num</span>--;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：（右键“增加一个”，不会触发默认的浏览器右击事件；右键“减少一个”，会触发默认的浏览器右击事件）</p>
<p><img src="/2021/03/13/Vue/56.gif"></p>
<h3 id="5-3-3-按键修饰符"><a href="#5-3-3-按键修饰符" class="headerlink" title="5.3.3.按键修饰符"></a>5.3.3.按键修饰符</h3><p>在监听键盘事件时，我们经常需要检查常见的键值。Vue 允许为 <code>v-on</code> 在监听键盘事件时添加按键修饰符： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 只有在 `keyCode` 是 13 时调用 `vm.submit()` --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-on:keyup.13</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>记住所有的 <code>keyCode</code> 比较困难，所以 Vue 为最常用的按键提供了别名：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 同上 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-on:keyup.enter</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>全部的按键别名：</p>
<ul>
<li><code>.enter</code></li>
<li><code>.tab</code></li>
<li><code>.delete</code> (捕获“删除”和“退格”键)</li>
<li><code>.esc</code></li>
<li><code>.space</code></li>
<li><code>.up</code></li>
<li><code>.down</code></li>
<li><code>.left</code></li>
<li><code>.right</code></li>
</ul>
<h3 id="5-3-4-组合按钮"><a href="#5-3-4-组合按钮" class="headerlink" title="5.3.4.组合按钮"></a>5.3.4.组合按钮</h3><p>可以用如下修饰符来实现仅在按下相应按键时才触发鼠标或键盘事件的监听器。</p>
<ul>
<li><code>.ctrl</code></li>
<li><code>.alt</code></li>
<li><code>.shift</code></li>
</ul>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Alt + C --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup.alt.67</span>=<span class="string">&quot;clear&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Ctrl + Click --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.ctrl</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>Do something<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="4-列表渲染（循环指令）：v-for"><a href="#4-列表渲染（循环指令）：v-for" class="headerlink" title="4 列表渲染（循环指令）：v-for"></a>4 列表渲染（循环指令）：v-for</h2><p>遍历数据渲染页面是非常常用的需求，Vue中通过 <code>v-for</code> 指令来实现。</p>
<h3 id="5-4-1-遍历数组"><a href="#5-4-1-遍历数组" class="headerlink" title="5.4.1.遍历数组"></a>5.4.1.遍历数组</h3><blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v-<span class="keyword">for</span>=<span class="string">&quot;item in items&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>items：待遍历的数组。</li>
<li>item：遍历得到的数组中的单个元素。</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;user in users&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;user.name&#125;&#125; - &#123;&#123;user.gender&#125;&#125; - &#123;&#123;user.age&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">users</span>:[</span></span><br><span class="line"><span class="language-javascript">                &#123;<span class="attr">name</span>:<span class="string">&#x27;柳岩&#x27;</span>, <span class="attr">gender</span>:<span class="string">&#x27;女&#x27;</span>, <span class="attr">age</span>: <span class="number">21</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;<span class="attr">name</span>:<span class="string">&#x27;峰哥&#x27;</span>, <span class="attr">gender</span>:<span class="string">&#x27;男&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;<span class="attr">name</span>:<span class="string">&#x27;范冰冰&#x27;</span>, <span class="attr">gender</span>:<span class="string">&#x27;女&#x27;</span>, <span class="attr">age</span>: <span class="number">24</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;<span class="attr">name</span>:<span class="string">&#x27;刘亦菲&#x27;</span>, <span class="attr">gender</span>:<span class="string">&#x27;女&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;<span class="attr">name</span>:<span class="string">&#x27;古力娜扎&#x27;</span>, <span class="attr">gender</span>:<span class="string">&#x27;女&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span>&#125;</span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/1530006198953.png" alt="1530006198953"></p>
<h3 id="5-4-2-数组角标"><a href="#5-4-2-数组角标" class="headerlink" title="5.4.2 数组角标"></a>5.4.2 数组角标</h3><p>在遍历的过程中，如果我们需要知道数组角标，可以指定第二个参数：</p>
<blockquote>
<p>语法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v-for=&quot;(item,index) in items&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>items：待遍历的数组。</li>
<li>item：遍历得到的数组中的单个元素。</li>
<li>index：当前遍历到的元素的索引，从0开始。</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(user, index) in users&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;index + 1&#125;&#125;. &#123;&#123;user.name&#125;&#125; - &#123;&#123;user.gender&#125;&#125; - &#123;&#123;user.age&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>效果：</p>
</blockquote>
<p><img src="/2021/03/13/Vue/1530006094601.png" alt="1530006094601"></p>
<h3 id="5-4-3-遍历对象"><a href="#5-4-3-遍历对象" class="headerlink" title="5.4.3 遍历对象"></a>5.4.3 遍历对象</h3><p>v-for除了可以迭代数组，也可以迭代对象。语法基本类似</p>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v-<span class="keyword">for</span>=<span class="string">&quot;value in object&quot;</span></span><br><span class="line">v-<span class="keyword">for</span>=<span class="string">&quot;(value,key) in object&quot;</span></span><br><span class="line">v-<span class="keyword">for</span>=<span class="string">&quot;(value,key,index) in object&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>1个参数时，得到的是对象的属性</li>
<li>2个参数时，第一个是属性，第二个是键</li>
<li>3个参数时，第三个是索引，从0开始</li>
</ul>
<blockquote>
<p>示例：</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value, key, index) in user&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;index + 1&#125;&#125;. &#123;&#123;key&#125;&#125; - &#123;&#123;value&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">user</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>:<span class="string">&#x27;峰哥&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                <span class="attr">gender</span>:<span class="string">&#x27;男&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="number">18</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>效果：</p>
</blockquote>
<p><img src="/2021/03/13/Vue/1530006251975.png" alt="1530006251975"></p>
<hr>
<h3 id="5-4-4-key"><a href="#5-4-4-key" class="headerlink" title="5.4.4 key"></a>5.4.4 key</h3><p>当 Vue.js 用 <code>v-for</code> 正在更新已渲染过的元素列表时，它默认用“就地复用”策略。如果数据项的顺序被改变，Vue 将不会移动 DOM 元素来匹配数据项的顺序， 而是简单复用此处每个元素，并且确保它在特定索引下显示已被渲染过的每个元素。 </p>
<p>这个功能可以有效的提高渲染的效率。</p>
<p>但是要实现这个功能，你需要给Vue一些提示，以便它能跟踪每个节点的身份，从而重用和重新排序现有元素，你需要为每项提供一个唯一 <code>key</code> 属性。理想的 <code>key</code> 值是每项都有的且唯一的 id。 </p>
<p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in items&quot;</span> <span class="attr">:key</span>=<span class="string">index</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里使用了一个特殊语法：<code>:key=&quot;&quot;</code> 我们后面会讲到，它可以让你读取vue中的属性，并赋值给key属性</li>
<li>这里我们绑定的key是数组的索引，应该是唯一的</li>
</ul>
<h2 id="5-条件渲染（条件指令）：v-if-和-v-show"><a href="#5-条件渲染（条件指令）：v-if-和-v-show" class="headerlink" title="5 条件渲染（条件指令）：v-if 和 v-show"></a>5 条件渲染（条件指令）：v-if 和 v-show</h2><h3 id="5-5-1-基本使用"><a href="#5-5-1-基本使用" class="headerlink" title="5.5.1.基本使用"></a>5.5.1.基本使用</h3><p><code>v-if</code>，顾名思义，条件判断。当得到结果为 true 时，所在的元素才会被渲染。</p>
<blockquote>
<p>语法：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v-if=&quot;布尔表达式&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;show = !show&quot;</span>&gt;</span>点我呀<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><br><span class="line">        看到我啦？！</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-show</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><br><span class="line">        看到我啦？！show</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">show</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>效果：</p>
</blockquote>
<p><img src="/2021/03/13/Vue/57.gif"></p>
<h3 id="5-5-2-与v-for结合"><a href="#5-5-2-与v-for结合" class="headerlink" title="5.5.2 与v-for结合"></a>5.5.2 与v-for结合</h3><p>当 <code>v-if</code> 和 <code>v-for</code> 出现在一起时，<code>v-for</code> 优先级更高。也就是说，会先遍历，再判断条件。</p>
<p>修改 <code>v-for</code> 中的案例，添加 <code>v-if</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(user, index) in users&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;user.gender == &#x27;女&#x27;&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;index + 1&#125;&#125;. &#123;&#123;user.name&#125;&#125; - &#123;&#123;user.gender&#125;&#125; - &#123;&#123;user.age&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/1530013415911.png" alt="1530013415911"></p>
<p>只显示女性用户信息</p>
<h3 id="5-5-3-v-else"><a href="#5-5-3-v-else" class="headerlink" title="5.5.3.v-else"></a>5.5.3.v-else</h3><p>你可以使用 <code>v-else</code> 指令来表示 <code>v-if</code> 的“else 块”：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;Math.random() &gt; 0.5&quot;</span>&gt;</span></span><br><span class="line">        看到我啦？！if</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">        看到我啦？！else</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>v-else</code> 元素必须紧跟在带 <code>v-if</code> 或者 <code>v-else-if</code> 的元素的后面，否则它将不会被识别。</p>
<p><code>v-else-if</code>，顾名思义，充当 <code>v-if</code> 的“else-if 块”，可以连续使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;random=Math.random()&quot;</span>&gt;</span>点我呀<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;random&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;random &gt;= 0.75&quot;</span>&gt;</span></span><br><span class="line">        看到我啦？！if</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else-if</span>=<span class="string">&quot;random &gt; 0.5&quot;</span>&gt;</span></span><br><span class="line">        看到我啦？！if 0.5</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else-if</span>=<span class="string">&quot;random &gt; 0.25&quot;</span>&gt;</span></span><br><span class="line">        看到我啦？！if 0.25</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">        看到我啦？！else</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">random</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>类似于 <code>v-else</code>，<code>v-else-if</code> 也必须紧跟在带 <code>v-if</code> 或者 <code>v-else-if</code> 的元素之后。</p>
<p>演示：</p>
<p><img src="/2021/03/13/Vue/58.gif" alt="1530013415911"></p>
<h3 id="5-5-4-v-show"><a href="#5-5-4-v-show" class="headerlink" title="5.5.4 v-show"></a>5.5.4 v-show</h3><p>另一个用于根据条件展示元素的选项是 <code>v-show</code> 指令。用法大致一样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 v-show=&quot;ok&quot;&gt;Hello!&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>不同的是带有 <code>v-show</code> 的元素始终会被渲染并保留在 DOM 中。<code>v-show</code> 只是简单地切换元素的 CSS 属性 <code>display</code>。</p>
<p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事件中直接写js片段--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;show = !show&quot;</span>&gt;</span>点击切换<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><br><span class="line">        你好</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">show</span>:<span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>代码：</p>
<p><img src="/2021/03/13/Vue/59.gif"></p>
<h2 id="6-v-bind"><a href="#6-v-bind" class="headerlink" title="6 v-bind"></a>6 v-bind</h2><p>html 标签中的属性不能使用插值表达式的形式绑定，只能使用v-bind指令。</p>
<p>在将 <code>v-bind</code> 用于 <code>class</code> 和 <code>style</code> 时，Vue.js 做了专门的增强。表达式结果的类型除了字符串之外，还可以是对象或数组。 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--可以是数据模型，可以是具有返回值的js代码块或者函数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;title&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid red; width: 50px; height: 50px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&quot;title&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/1530025378843.png" alt="1530025378843"></p>
<p>在将 <code>v-bind</code> 用于 <code>class</code> 和 <code>style</code> 时，Vue.js 做了专门的增强。表达式结果的类型除了字符串之外，还可以是对象或数组。 </p>
<h3 id="5-6-1-绑定class样式"><a href="#5-6-1-绑定class样式" class="headerlink" title="5.6.1.绑定class样式"></a>5.6.1.绑定class样式</h3><blockquote>
<p>数组语法</p>
</blockquote>
<p>我们可以借助于<code>v-bind</code>指令来实现：</p>
<p>HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;activeClass&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;errorClass&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;[activeClass, errorClass]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">activeClass</span>: <span class="string">&#x27;active&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">errorClass</span>: [<span class="string">&#x27;text-danger&#x27;</span>, <span class="string">&#x27;text-error&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>渲染后的效果：（具有active和hasError的样式）</p>
<p><img src="/2021/03/13/Vue/1530026818515.png" alt="1530026818515"></p>
<blockquote>
<p>对象语法</p>
</blockquote>
<p>我们可以传给 <code>v-bind:class</code> 一个对象，以动态地切换 class：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;&#123; active: isActive &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的语法表示 <code>active</code> 这个 <strong>class 存在与否将取决于数据属性 <code>isActive</code></strong> 的值（除了false,0,“”,null,undefined和NaN，其它值都表示 true）。</p>
<p>你可以在对象中传入更多属性来动态切换多个 class。此外，<code>v-bind:class</code> 指令也可以与普通的 class 属性共存。如下模板:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">v-bind:class</span>=<span class="string">&quot;&#123; active: isActive, &#x27;text-danger&#x27;: hasError &#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和如下 data：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">isActive</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">hasError</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果渲染为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;static active&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>active</code> 和 <code>text-danger</code> 样式的存在与否，取决于 isActive 和 hasError 的值。本例中 <code>isActive=true</code>，<code>hasError=false</code>，所以 active 样式存在，text-danger 不存在。</p>
<p><strong>通常情况下，绑定的数据对象不必内联定义在模板里</strong>： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;classObject&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">classObject</span>: &#123;</span><br><span class="line">    <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;text-danger&#x27;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果和之前一样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;static active&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="5-6-2-绑定style样式"><a href="#5-6-2-绑定style样式" class="headerlink" title="5.6.2.绑定style样式"></a>5.6.2.绑定style样式</h3><blockquote>
<p>数组语法</p>
</blockquote>
<p>数组语法可以将多个样式对象应用到同一个元素上： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;[baseStyles, overridingStyles]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">baseStyles</span>: &#123;<span class="string">&#x27;background-color&#x27;</span>: <span class="string">&#x27;red&#x27;</span>&#125;,</span><br><span class="line">    <span class="attr">overridingStyles</span>: &#123;<span class="attr">border</span>: <span class="string">&#x27;1px solid black&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>渲染后的结果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: red; border: 1px solid black;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对象语法</p>
</blockquote>
<p><code>v-bind:style</code> 的对象语法十分直观——看着非常像 CSS，但其实是一个 JavaScript 对象。CSS 属性名可以用驼峰式 (camelCase) 或短横线分隔 (kebab-case，记得用单引号括起来) 来命名： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;&#123; color: activeColor, fontSize: fontSize + &#x27;px&#x27; &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">activeColor</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">  <span class="attr">fontSize</span>: <span class="number">30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color: red; font-size: 30px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>直接绑定到一个样式对象通常更好，这会让模板更清晰</strong>： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;styleObject&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">styleObject</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="string">&#x27;13px&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果同上。</p>
<h3 id="5-6-3-简写"><a href="#5-6-3-简写" class="headerlink" title="5.6.3.简写"></a>5.6.3.简写</h3><p><code>v-bind:class</code>可以简写为<code>:class</code></p>
<hr>
<h2 id="7-计算属性"><a href="#7-计算属性" class="headerlink" title="7 计算属性"></a>7 计算属性</h2><p>在插值表达式中使用JS表达式是非常方便的，而且也经常被用到。但是如果表达式的内容很长，就会显得不够优雅，而且后期维护起来也不方便。例如下面的场景，我们有一个毫秒值显示的日期数据，并希望在页面上以 yyyy-MM-dd 的样式渲染。</p>
<p><strong>不使用计算属性：</strong></p>
<ol>
<li><p>Vue实例内容</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">birthday</span>:<span class="number">1529032123201</span> <span class="comment">// 毫秒值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在页面中渲染。</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>现在的北京时间是：</span><br><span class="line">    &#123;&#123;</span><br><span class="line">    	new Date(birthday).getFullYear() + &#x27;-&#x27; + new Date(birthday).getMonth()+ &#x27;-&#x27; + new Date(birthday).getDay()</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p> 虽然能得到结果，但是非常麻烦。</p>
</li>
</ol>
<p><strong>使用计算属性：</strong></p>
<ol>
<li><p>Vue实例内容</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">birthday</span>:<span class="number">1429032123201</span> <span class="comment">// 毫秒值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>:&#123;</span><br><span class="line">        <span class="title function_">birth</span>(<span class="params"></span>)&#123;<span class="comment">// 计算属性本质是一个方法，但是必须返回结果</span></span><br><span class="line">            <span class="keyword">const</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="variable language_">this</span>.<span class="property">birthday</span>);</span><br><span class="line">            <span class="keyword">return</span> d.<span class="title function_">getFullYear</span>() + <span class="string">&quot;-&quot;</span> + d.<span class="title function_">getMonth</span>() + <span class="string">&quot;-&quot;</span> + d.<span class="title function_">getDay</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  计算属性本质就是方法，但是一定要返回数据。然后页面渲染时，可以把这个方法当成一个变量来使用。</p>
</blockquote>
</li>
<li><p>页面使用：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h1</span>&gt;</span>现在的北京时间是：&#123;&#123;birth&#125;&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>效果：</p>
<p><img src="/2021/03/13/Vue/1530029950644.png" alt="1530029950644"></p>
<p>我们可以将同一函数定义为一个方法而不是一个计算属性。两种方式的最终结果确实是完全相同的。然而，不同的是<strong>计算属性是基于它们的依赖进行缓存的</strong>。计算属性只有在它的相关依赖发生改变时才会重新求值。这就意味着只要<code>birthday</code>还没有发生改变，多次访问 <code>birthday</code> 计算属性会立即返回之前的计算结果，而不必再次执行函数。 </p>
<hr>
<h2 id="8-watch"><a href="#8-watch" class="headerlink" title="8 watch"></a>8 watch</h2><p><strong>watch</strong> 是一个监听器。可用于监听某个变量，当变量发生变化时做出相应的处理。</p>
<p><strong>Demo：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>:<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">watch</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">message</span>(<span class="params">newVal, oldVal</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal, oldVal);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/1530030506879.png" alt="1530030506879"></p>
<hr>
<h1 id="Vue-组件化"><a href="#Vue-组件化" class="headerlink" title="Vue 组件化"></a>Vue 组件化</h1><p>超链接：</p>
<hr>
<h1 id="路由vue-router"><a href="#路由vue-router" class="headerlink" title="路由vue-router"></a>路由vue-router</h1><h2 id="场景模拟"><a href="#场景模拟" class="headerlink" title="场景模拟"></a>场景模拟</h2><p>现在我们来实现这样一个功能：</p>
<p>一个页面，包含登录和注册，点击不同按钮，实现登录和注册页切换</p>
<h3 id="7-1-1-编写父组件"><a href="#7-1-1-编写父组件" class="headerlink" title="7.1.1.编写父组件"></a>7.1.1.编写父组件</h3><p>为了让接下来的功能比较清晰，我们先新建一个文件夹：src</p>
<p>然后新建一个HTML文件，作为入口：index.html</p>
<p> <img src="/2021/03/13/Vue/1530148321175.png" alt="1530148321175"></p>
<p>然后编写页面的基本结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        登录页/注册页</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>样式：</p>
<p><img src="/2021/03/13/Vue/1530149363817.png" alt="1530149363817"></p>
<h3 id="7-1-2-编写登录及注册组件"><a href="#7-1-2-编写登录及注册组件" class="headerlink" title="7.1.2.编写登录及注册组件"></a>7.1.2.编写登录及注册组件</h3><p>接下来我们来实现登录组件，以前我们都是写在一个文件中，但是为了复用性，开发中都会把组件放入独立的JS文件中，我们新建一个user目录以及login.js及register.js：</p>
<p> <img src="/2021/03/13/Vue/1530156389366.png" alt="1530156389366"></p>
<p>编写组件，这里我们只写模板，不写功能。</p>
<p>login.js内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loginForm = &#123;</span><br><span class="line">    <span class="attr">template</span>:<span class="string">&#x27;\</span></span><br><span class="line"><span class="string">    &lt;div&gt;\</span></span><br><span class="line"><span class="string">    &lt;h2&gt;登录页&lt;/h2&gt; \</span></span><br><span class="line"><span class="string">    用户名：&lt;input type=&quot;text&quot;&gt;&lt;br/&gt;\</span></span><br><span class="line"><span class="string">    密码：&lt;input type=&quot;password&quot;&gt;&lt;br/&gt;\</span></span><br><span class="line"><span class="string">    &lt;/div&gt;\</span></span><br><span class="line"><span class="string">    &#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>register.js内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> registerForm = &#123;</span><br><span class="line">    <span class="attr">template</span>:<span class="string">&#x27;\</span></span><br><span class="line"><span class="string">    &lt;div&gt;\</span></span><br><span class="line"><span class="string">    &lt;h2&gt;注册页&lt;/h2&gt; \</span></span><br><span class="line"><span class="string">    用&amp;ensp;户&amp;ensp;名：&lt;input type=&quot;text&quot;&gt;&lt;br/&gt;\</span></span><br><span class="line"><span class="string">    密&amp;emsp;&amp;emsp;码：&lt;input type=&quot;password&quot;&gt;&lt;br/&gt;\</span></span><br><span class="line"><span class="string">    确认密码：&lt;input type=&quot;password&quot;&gt;&lt;br/&gt;\</span></span><br><span class="line"><span class="string">    &lt;/div&gt;\</span></span><br><span class="line"><span class="string">    &#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-1-3-在父组件中引用"><a href="#7-1-3-在父组件中引用" class="headerlink" title="7.1.3.在父组件中引用"></a>7.1.3.在父组件中引用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;loginForm&gt;&lt;/loginForm&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            疑问：为什么不采用上面的写法？</span></span><br><span class="line"><span class="comment">            由于html是大小写不敏感的，如果采用上面的写法，则被认为是&lt;loginform&gt;&lt;/loginform&gt;</span></span><br><span class="line"><span class="comment">            所以，如果是驼峰形式的组件，需要把驼峰转化为“-”的形式</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">login-form</span>&gt;</span><span class="tag">&lt;/<span class="name">login-form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">register-form</span>&gt;</span><span class="tag">&lt;/<span class="name">register-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;user/login.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;user/register.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            loginForm,</span></span><br><span class="line"><span class="language-javascript">            registerForm</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/2021/03/13/Vue/1530157389501.png" alt="1530157389501"></p>
<h3 id="7-1-5-问题"><a href="#7-1-5-问题" class="headerlink" title="7.1.5.问题"></a>7.1.5.问题</h3><p>我们期待的是，当点击登录或注册按钮，分别显示登录页或注册页，而不是一起显示。</p>
<p>但是，如何才能动态加载组件，实现组件切换呢？</p>
<p>虽然使用原生的Html5和JS也能实现，但是官方推荐我们使用vue-router模块。</p>
<h2 id="7-2-vue-router简介和安装"><a href="#7-2-vue-router简介和安装" class="headerlink" title="7.2.vue-router简介和安装"></a>7.2.vue-router简介和安装</h2><p>使用vue-router和vue可以非常方便的实现 复杂单页应用的动态路由功能。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh-cn/">https://router.vuejs.org/zh-cn/</a></p>
<p>使用npm安装：<code>npm install vue-router --save</code> </p>
<p>在index.html中引入依赖：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../node_modules/vue-router/dist/vue-router.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="7-3-快速入门"><a href="#7-3-快速入门" class="headerlink" title="7.3.快速入门"></a>7.3.快速入门</h2><p>新建vue-router对象，并且指定路由规则：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建VueRouter对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>:[ <span class="comment">// 编写路由规则</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>:<span class="string">&quot;/login&quot;</span>, <span class="comment">// 请求路径</span></span><br><span class="line">            <span class="attr">component</span>:loginForm <span class="comment">// 组件名称</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>:<span class="string">&quot;/register&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>:registerForm</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>创建VueRouter对象，并指定路由参数</li>
<li>routes：路由规则的数组，可以指定多个对象，每个对象是一条路由规则，包含以下属性：<ul>
<li>path：路由的路径</li>
<li>component：组件名称</li>
</ul>
</li>
</ul>
<p>在父组件中引入router对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">components</span>:&#123;<span class="comment">// 引用登录和注册组件</span></span><br><span class="line">        loginForm,</span><br><span class="line">        registerForm</span><br><span class="line">    &#125;,</span><br><span class="line">    router <span class="comment">// 引用上面定义的router对象</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>页面跳转控制：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--router-link来指定跳转的路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/register&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--vue-router的锚点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过<code>&lt;router-view&gt;</code>来指定一个锚点，当路由的路径匹配时，vue-router会自动把对应组件放到锚点位置进行渲染</li>
<li>通过<code>&lt;router-link&gt;</code>指定一个跳转链接，当点击时，会触发vue-router的路由功能，路径中的hash值会随之改变</li>
</ul>
<p>效果：</p>
<p><img src="/2021/03/13/Vue/62.gif"></p>
<p><strong>注意</strong>：单页应用中，页面的切换并不是页面的跳转。仅仅是地址最后的hash值变化。</p>
<p>事实上，我们总共就一个HTML：index.html</p>
<h1 id="WebPack"><a href="#WebPack" class="headerlink" title="WebPack"></a>WebPack</h1><blockquote>
<p>超链接：<a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2021/04/03/WebPack/">https://lvnengdong.github.io/2021/04/03/WebPack/</a></p>
</blockquote>
<h1 id="Vue-cli"><a href="#Vue-cli" class="headerlink" title="Vue-cli"></a>Vue-cli</h1><blockquote>
<p>超链接：</p>
</blockquote>
<h1 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h1><blockquote>
<p>Axios 是一个基于 promise 的 HTTP 库，<strong>可以用在浏览器和 node.js 中</strong>！</p>
</blockquote>
<h2 id="引入-axios"><a href="#引入-axios" class="headerlink" title="引入 axios"></a>引入 axios</h2><ol>
<li><p>导入 Axios 依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure></li>
<li><p>导入模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>或者直接使用 script 标签引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="axios-发送请求"><a href="#axios-发送请求" class="headerlink" title="axios 发送请求"></a>axios 发送请求</h2><h3 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过给定的ID来发送请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/user?ID=12345&#x27;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//以上请求也可以通过这种方式来发送</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>,&#123;</span><br><span class="line"><span class="attr">params</span>:&#123;</span><br><span class="line"><span class="attr">ID</span>:<span class="number">12345</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="POST-请求"><a href="#POST-请求" class="headerlink" title="POST 请求"></a>POST 请求</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>,&#123;</span><br><span class="line"><span class="attr">firstName</span>:<span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line"><span class="attr">lastName</span>:<span class="string">&#x27;Flintstone&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>









<h2 id="Vue-组件"><a href="#Vue-组件" class="headerlink" title="Vue 组件"></a>Vue 组件</h2><h3 id="全局组件-amp-局部组件"><a href="#全局组件-amp-局部组件" class="headerlink" title="全局组件  &amp; 局部组件"></a>全局组件  &amp; 局部组件</h3><h4 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h4><ul>
<li>全局组件是通过 Vue 的静态方法定义的，定义完成后就相当于在 Vue 的构造器中新增了一个组件。这时我们再创建任何一个 Vue 实例时其内部都有这个组件，也就是说只要创建了 Vue 实例并通过 el 绑定了该 Vue 实例的作用范围后，就可以在此范围内使用我们提前定义好的全局组件。</li>
</ul>
<h4 id="组件中的data为什么要定义成方法？"><a href="#组件中的data为什么要定义成方法？" class="headerlink" title="组件中的data为什么要定义成方法？"></a>组件中的data为什么要定义成方法？</h4><ul>
<li>组件其实就是一个 Vue 对象。</li>
<li>我们可以看到，在一个普通的 Vue 对象（即该 Vue 实例不是组件）中，所有的变量/常量都会被我们放到 <code>data[]</code>中。如：</li>
<li>但是在组件中，我们会用 <code>data()</code> 方法来代替 <code>data[]</code> 数组，其原因就是：</li>
</ul>
<p>组件诞生的原因就是为了复用，因为组件可能在多个地方被使用，如果用 data 保存数据的话，一个地方更改了组件中<code>data[]</code>的值，其它地方<code>data[]</code>的值也会跟着发生变化。而定义成方法的返回值有个好处就是每个方法都维护一个唯一的返回值。某个组件中的data发生变化只会影响自己，不会影响全局。</p>
<p>因为：函数内部的变量是局部变量，每次调用方法得到都是一个初始值。</p>
<h4 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h4><p>局部组件就是一个普通的 JS对象，如果不在 Vue 中使用的话，它仅仅是一个 JS对象，和 Vue 是没有任何关系的。</p>
<p>只有当我们在 Vue 实例内部通过 components 字段关联了这个对象后，这个对象才成为了一个局部组件。</p>
<p>局部组件和全局组件的内容部分没有任何差别，不同的是全局组件是通过Vue的静态方法创建的，创建后在Vue实例的作用范围内可以直接使用，</p>
<p>而局部组件则会将内容部分赋值给一个普通的JS对象，我们在使用时，首先要在页面中引入这个 JS对象，并且在 Vue 对象中通过 components 字段引入这个局部组件，然后才能在 Vue 实例的 el 作用范围内使用。</p>
<h4 id="ES6-语法"><a href="#ES6-语法" class="headerlink" title="ES6 语法"></a>ES6 语法</h4><p>在ES6的语法中，如果一个对象的key和value完全相同，可以简写为只有key</p>
</h3></h4></h3></h4></h4></h4></h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">ES6语法指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-13 11:00:58" itemprop="dateCreated datePublished" datetime="2021-03-13T11:00:58+08:00">2021-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-03-03 22:21:39" itemprop="dateModified" datetime="2022-03-03T22:21:39+08:00">2022-03-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ES6-概述"><a href="#ES6-概述" class="headerlink" title="ES6 概述"></a>ES6 概述</h1><p><strong>是什么？</strong></p>
<ul>
<li>  就是 ECMA Script 第6版标准。</li>
</ul>
<p><strong>什么是 ECMA Script？</strong></p>
<ul>
<li>ECMA Script 就是浏览器脚本语言的规范。</li>
<li>为了统一各种不同的 Script 脚本语言，ECMA（欧洲计算机制造商协会）以 JavaScript 为基础，制定了<code>ECMAscript</code>标准规范</li>
<li>如主流的 JavaScript、JScript、ActionScript 等都是<code>ECMAScript</code>标准的实现者。</li>
</ul>
<p><strong>参考教程：</strong></p>
<ul>
<li>  <a target="_blank" rel="noopener" href="http://es6.ruanyifeng.com/?search=reduce&x=0&y=0#README">阮一峰的ES6教程</a></li>
</ul>
<hr>
<h1 id="ES6-新语法"><a href="#ES6-新语法" class="headerlink" title="ES6 新语法"></a>ES6 新语法</h1><h2 id="let：声明变量"><a href="#let：声明变量" class="headerlink" title="let：声明变量"></a>let：声明变量</h2><p>​    在 ES6 出现之前，在 JS 中想要声明变量只能使用 <strong>var</strong> 关键字，但是 <code>var</code> 存在一个致命的缺陷，就是定义的变量有时会自动提升为全局变量，所以在 ES6 中新增了 <strong>let</strong> 关键字专门用于声明<strong>局部变量</strong>，而 <code>var</code> 关键字可以专注于声明全局变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var 用于声明全局变量；let 用于声明局部变量</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)  <span class="comment">//b is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var 在作用范围内可以声明多次，默认后面覆盖前面</span></span><br><span class="line"><span class="comment">// let 在作用范围内只能声明一次</span></span><br><span class="line"><span class="keyword">var</span> m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> m = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> n = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> n = <span class="number">20</span>;  <span class="comment">//&#x27;n&#x27; has already been declared</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n)</span><br></pre></td></tr></table></figure>





<h2 id="const：声明常量-只读变量"><a href="#const：声明常量-只读变量" class="headerlink" title="const：声明常量(只读变量)"></a>const：声明常量(只读变量)</h2><p><strong>const</strong> 关键字声明的变量是一个常量，在创建时就必须确定最终值，之后不能被修改。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、声明之后不允许改变</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="string">&quot;3.1415926&quot;</span></span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">3</span>     <span class="comment">// TypeError: Assignment to constant variable.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、一但声明必须初始化，否则会报错</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MY_AGE</span>  <span class="comment">// Missing initializer in const declaration</span></span><br></pre></td></tr></table></figure>





<hr>
<h2 id="字符串扩展"><a href="#字符串扩展" class="headerlink" title="字符串扩展"></a>字符串扩展</h2><h3 id="字符串的新方法"><a href="#字符串的新方法" class="headerlink" title="字符串的新方法"></a>字符串的新方法</h3><p>ES6为<strong>字符串</strong>对象新增了几个API：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>返回值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>includes()</code></td>
<td>boolean</td>
<td>是否包含参数字符串</td>
</tr>
<tr>
<td><code>startsWith()</code></td>
<td>boolean</td>
<td>参数字符串是否在原字符串头部</td>
</tr>
<tr>
<td><code>endsWith()</code></td>
<td>boolean</td>
<td>参数字符串是否在原字符串尾部</td>
</tr>
</tbody></table>
<blockquote>
<p>  参数字符串：即方法参数中的字符串</p>
</blockquote>
<p><strong>Demo</strong></p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526107640349.png" alt="1526107640349"></p>
<h3 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h3><p>ES6中新增了<strong>模板字符串</strong>。模板字符串相当于加强版的字符串，用反引号 ` 标记，两个反引号之间的部分都会被作为字符串的值。</p>
<p>除了定义普通字符串，还可以用来定义<strong>多行字符串</strong>，甚至在字符串中加入<strong>变量</strong>、<strong>表达式</strong>、<strong>Js 脚本</strong>等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串插入变量和表达式。变量名写在 $&#123;&#125; 中，$&#123;&#125; 中可以放入 JavaScript 表达式。</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;lucy&quot;</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> info = <span class="string">`My </span></span><br><span class="line"><span class="string">		   name is </span></span><br><span class="line"><span class="string">		   <span class="subst">$&#123;name&#125;</span> ,I am <span class="subst">$&#123;age+<span class="number">1</span>&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info)</span><br></pre></td></tr></table></figure>



<h2 id="声明对象简写"><a href="#声明对象简写" class="headerlink" title="声明对象简写"></a>声明对象简写</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统方式定义对象</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;lucy&quot;</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">20</span></span><br><span class="line"><span class="keyword">const</span> user1 = &#123;<span class="attr">name</span>:name,<span class="attr">age</span>:age&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="keyword">const</span> user2 = &#123;name,age&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user2)</span><br></pre></td></tr></table></figure>





<h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><p>解构赋值是对赋值运算符的扩展。它是一种针对<strong>数组或者对象</strong>进行<code>模式匹配</code>，然后对其中的变量进行赋值。在代码书写上简洁且易读，语义更加清晰明了；也方便了复杂对象中数据字段获取。</p>
<h3 id="数组解构"><a href="#数组解构" class="headerlink" title="数组解构"></a>数组解构</h3><p>定义一个数组：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>ES6 之前想要获取其中的值，只能通过角标。而在 ES6 可以通过结构赋值来实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [x,y,z] = arr;	<span class="comment">// 将arr中的每个位置的值赋给x，y，z</span></span><br><span class="line"><span class="comment">// 然后打印</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x,y,z);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526109778368.png" alt="1526109778368"></p>
<h3 id="对象解构"><a href="#对象解构" class="headerlink" title="对象解构"></a>对象解构</h3><p>定义 person 对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;jack&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">21</span>,</span><br><span class="line">    <span class="attr">language</span>: [<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;js&#x27;</span>,<span class="string">&#x27;css&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传统方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 key 获取 value</span></span><br><span class="line"><span class="keyword">let</span> name1 = person.<span class="property">name</span></span><br><span class="line"><span class="keyword">let</span> age1 = person.<span class="property">age</span></span><br><span class="line"><span class="keyword">let</span> language1 = person.<span class="property">language</span></span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name1, age1, language1)</span><br></pre></td></tr></table></figure>

<p>ES6</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解构表达式获取值</span></span><br><span class="line"><span class="keyword">const</span> &#123;name,age,language&#125; = person;		<span class="comment">//Tip：解构赋值的变量必须是person中存在的属性</span></span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name, age, language)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526109984544.png" alt="1526109984544"></p>
<p>如过想要用其它变量接收对象中的属性，需要额外指定别名：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526110159450.png" alt="1526110159450"></p>
<ul>
<li><code>&#123;name:n&#125;</code>：<code>name</code> 是 person 中的属性名，冒号后面的 <code>n</code> 是解构后要赋值给的变量。</li>
</ul>
<hr>
<h2 id="函数优化"><a href="#函数优化" class="headerlink" title="函数优化"></a>函数优化</h2><h3 id="函数参数默认值"><a href="#函数参数默认值" class="headerlink" title="函数参数默认值"></a>函数参数默认值</h3><p>在 ES6 之前，我们无法直接给函数的参数设置默认值，只能采用变通写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a , b</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断b是否为空，为空就给默认值1</span></span><br><span class="line">    b = b || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传一个参数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<p>现在可以直接给函数的参数设置默认值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a , b = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传一个参数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<h3 id="不定参数函数"><a href="#不定参数函数" class="headerlink" title="不定参数函数"></a>不定参数函数</h3><ul>
<li>  函数可以接收随机多个参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">...values</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(values.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>(<span class="number">1</span>,<span class="number">2</span>)	<span class="comment">// 2</span></span><br><span class="line"><span class="title function_">f</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)	<span class="comment">// 4</span></span><br></pre></td></tr></table></figure>





<h3 id="箭头函数（类似于-Java-中的-Lambda-表达式）"><a href="#箭头函数（类似于-Java-中的-Lambda-表达式）" class="headerlink" title="箭头函数（类似于 Java 中的 Lambda 表达式）"></a>箭头函数（类似于 Java 中的 Lambda 表达式）</h3><ul>
<li>箭头函数提供了一种更加简洁的函数书写方式。</li>
<li>基本语法是：<code>参数 =&gt; 函数体</code></li>
<li>箭头函数多用于匿名函数的定义</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统方式定义函数</span></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6 使用箭头函数定义：参数 =&gt; 函数体</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f2</span> = a =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<ul>
<li>当箭头函数没有参数或者有多个参数，要用 () 括起来。有且仅有一个参数可以<strong>省略括号</strong></li>
<li> 当箭头函数函数体有多行语句，用 {} 包裹起来，表示代码块，</li>
<li>当有且仅有一行语句，并且需要返回结果时，可以<strong>省略 {} 和 return关键字</strong> , 结果会自动返回。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个参数的情况：</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="keyword">function</span> (<span class="params">a , b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 简写为：</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">sum2</span> = (<span class="params">a,b</span>) =&gt; a+b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码不止一行，可以用 &#123;&#125; 括起来</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">sum3</span> = (<span class="params">a,b</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是多余的&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="对象的函数属性简写"><a href="#对象的函数属性简写" class="headerlink" title="对象的函数属性简写"></a>对象的函数属性简写</h3><p>比如一个 Person 对象，里面有 eat() 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jack&quot;</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 以前：</span></span><br><span class="line">    <span class="attr">eat</span>: <span class="keyword">function</span> (<span class="params">food</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 箭头函数版：</span></span><br><span class="line">    <span class="attr">eat2</span>: <span class="function"><span class="params">food</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food),	<span class="comment">// 这里拿不到this</span></span><br><span class="line">    <span class="comment">// 简写版：</span></span><br><span class="line">    <span class="title function_">eat3</span>(<span class="params">food</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="箭头函数结合解构表达式"><a href="#箭头函数结合解构表达式" class="headerlink" title="箭头函数结合解构表达式"></a>箭头函数结合解构表达式</h3><p>比如有一个函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;jack&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">21</span>,</span><br><span class="line">    <span class="attr">language</span>: [<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;js&#x27;</span>,<span class="string">&#x27;css&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params">person</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello,&quot;</span> + person.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果用箭头函数和解构表达式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">hi</span> = (<span class="params">&#123;name&#125;</span>) =&gt;  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello,&quot;</span> + name);</span><br><span class="line"><span class="title function_">hi</span>(person)</span><br></pre></td></tr></table></figure>



<h2 id="数组中的-map-和-reduce-方法"><a href="#数组中的-map-和-reduce-方法" class="headerlink" title="数组中的 map 和 reduce 方法"></a>数组中的 map 和 reduce 方法</h2><p><strong>数组</strong>中新增了<code>map</code>和<code>reduce</code>方法。</p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p><code>map()</code>：参数中接收一个函数，将原数组中的每个元素用这个函数处理后放入新数组返回。</p>
<p>举例：有一个字符串数组，我们希望转为int数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;20&#x27;</span>,<span class="string">&#x27;-5&#x27;</span>,<span class="string">&#x27;3&#x27;</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr)</span><br><span class="line"></span><br><span class="line">arr = arr.<span class="title function_">map</span>(<span class="function"><span class="params">s</span> =&gt;</span> <span class="built_in">parseInt</span>(s));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr)</span><br></pre></td></tr></table></figure>

<p>  <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526110796839.png" alt="1526110796839"></p>
<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p><code>reduce()</code>：参数中接收一个函数（必须）和一个初始值（可选），该函数接收两个参数：</p>
<ul>
<li>第一个参数是上一次 reduce 处理的结果</li>
<li>第二个参数是数组中要处理的下一个元素</li>
</ul>
<p><code>reduce()</code>会从左到右依次把数组中的元素用 reduce 参数中的函数处理，并把处理的结果作为下次函数中的第一个参数。如果是第一次，会把前两个元素作为计算参数，或者把用户指定的初始值作为起始参数</p>
<p>举例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">20</span>,-<span class="number">5</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>没有初始值：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526111537204.png" alt="1526111537204"></p>
<p>指定初始值：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526111580742.png" alt="1526111580742"></p>
<h2 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h2><p>Promise 简单来说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。</p>
<p>我们可以通过 Promise 的构造函数来创建 Promise 对象，并在内部封装一个异步执行的结果。</p>
<p>语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="comment">// ... 执行异步操作</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* 异步操作成功 */</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>(value);<span class="comment">// 调用resolve，代表Promise将返回成功的结果</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(error);<span class="comment">// 调用reject，代表Promise会返回失败结果</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样，在promise中就封装了一段异步执行的结果。</p>
<p>如果我们想要等待异步执行完成，做一些事情，我们可以通过promise的then方法来实现,语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">value</span>)&#123;</span><br><span class="line">    <span class="comment">// 异步执行成功后的回调</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果想要处理promise异步执行失败的事件，还可以跟上catch：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">value</span>)&#123;</span><br><span class="line">    <span class="comment">// 异步执行成功后的回调</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>)&#123;</span><br><span class="line">    <span class="comment">// 异步执行失败后的回调</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="comment">// 这里我们用定时任务模拟异步</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> num = <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">        <span class="comment">// 随机返回成功或失败</span></span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&quot;成功！num:&quot;</span> + num)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&quot;出错了！num:&quot;</span> + num)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用promise</span></span><br><span class="line">p.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(msg);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(msg);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526113115887.png" alt="1526113115887"></p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526113140074.png" alt="1526113140074"></p>
<h2 id="set-amp-map"><a href="#set-amp-map" class="headerlink" title="set &amp; map"></a>set &amp; map</h2><p>ES6 提供了Set 和 Map 的数据结构。</p>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>构造函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set构造函数可以接收一个数组或空</span></span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">1</span>);<span class="comment">// [1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收数组</span></span><br><span class="line"><span class="keyword">let</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>]);<span class="comment">// 得到[2,3,4,5]</span></span><br></pre></td></tr></table></figure>

<p>普通方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set.<span class="title function_">add</span>(<span class="number">1</span>);<span class="comment">// （按下标）添加</span></span><br><span class="line">set.<span class="title function_">clear</span>();<span class="comment">// 清空</span></span><br><span class="line">set.<span class="title function_">delete</span>(<span class="number">2</span>);<span class="comment">// 删除指定元素</span></span><br><span class="line">set.<span class="title function_">has</span>(<span class="number">2</span>); <span class="comment">// 判断是否存在</span></span><br><span class="line">set.<span class="title function_">keys</span>();<span class="comment">// 返回所有key</span></span><br><span class="line">set.<span class="title function_">values</span>();<span class="comment">// 返回所有值</span></span><br><span class="line">set.<span class="title function_">entries</span>();<span class="comment">// 返回键值对集合</span></span><br><span class="line"><span class="comment">// 因为set没有键值对，所以其keys、values、entries方法返回值一样的。</span></span><br><span class="line">set.<span class="property">size</span>; <span class="comment">// 返回元素个数。[是属性，不是方法！]</span></span><br></pre></td></tr></table></figure>



<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>Map，本质是与 Object 类似的结构。不同在于，Object 强制规定 key 只能是字符串。而 Map 结构的 key 可以是任意对象。即：</p>
<ul>
<li>Object 是 <code>&lt;string,object&gt;</code> 集合</li>
<li>Map是 <code>&lt;object,object&gt;</code> 集合</li>
</ul>
<p>构造函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map接收一个数组，数组中的元素是键值对对象</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">&#x27;key1&#x27;</span>,<span class="string">&#x27;value1&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;key2&#x27;</span>,<span class="string">&#x27;value2&#x27;</span>],</span><br><span class="line">])</span><br><span class="line"><span class="comment">// 或者接收一个set</span></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([</span><br><span class="line">    [<span class="string">&#x27;key1&#x27;</span>,<span class="string">&#x27;value1&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;key2&#x27;</span>,<span class="string">&#x27;value2&#x27;</span>],</span><br><span class="line">])</span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>(set)</span><br><span class="line"><span class="comment">// 或者其它map</span></span><br><span class="line"><span class="keyword">const</span> map3 = <span class="keyword">new</span> <span class="title class_">Map</span>(map);</span><br></pre></td></tr></table></figure>

<p>方法：</p>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1526114799767.png" alt="1526114799767"></p>
<hr>
<h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><h3 id="什么是模块化"><a href="#什么是模块化" class="headerlink" title="什么是模块化"></a>什么是模块化</h3><p>模块化就是在开发时遵循单一功能原则进行开发，在需要使用的地方直接导入模块即可使用。类比到Java中就是将Java程序打成一个 jar 包，在使用时只要导入对应的包就可以使用该包中的方法。而 JS 中没有包的概念，取而代之的是<strong>模块</strong>。模块主要有两个功能：<strong>导出（export）</strong>和<strong>导入（import）</strong>。</p>
<ul>
<li><code>export</code>：将开发好的模块导出为全局模块。</li>
<li><code>import</code>：引入项目中其它可使用的模块。</li>
</ul>
<h3 id="export"><a href="#export" class="headerlink" title="export"></a>export</h3><p>Demo：</p>
<ol>
<li> 定义一个js文件：<code>hello.js</code>，里面有一个对象：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = &#123;</span><br><span class="line">    <span class="title function_">sum</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 使用 export 将这个模块导出：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = &#123;</span><br><span class="line">    <span class="title function_">sum</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> util;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 当然，也可以简写为：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> util = &#123;</span><br><span class="line">    <span class="title function_">sum</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>export</code>不仅可以导出对象，一切 JS 变量都可以导出。比如：基本类型变量、函数、数组、对象。</p>
<p>当要导出多个值时，还可以写在一起。比如我有一个文件：<code>user.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;name,age&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>省略名称</p>
</blockquote>
<p>上面的导出代码中，都显式指定了导出模块的名称，这样其它人在导入使用时就必须准确写出这一名称，否则就会出错。</p>
<p>因此 JS 提供了<code>default</code>关键字，可以对导出的变量名进行省略</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无需声明导出模块的名字</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	<span class="title function_">sum</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，当使用者导入时，可以自定义名字</p>
<hr>
<h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><blockquote>
<p><strong>使用<code>export</code>命令定义了模块的对外接口以后，其他 JS 文件才可以通过<code>import</code>命令加载这个模块。</strong></p>
</blockquote>
<p>例如我要使用上面导出的 util 模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入util</span></span><br><span class="line"><span class="keyword">import</span> util <span class="keyword">from</span> <span class="string">&#x27;hello.js&#x27;</span></span><br><span class="line"><span class="comment">// 调用util中的属性</span></span><br><span class="line">util.<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>



<p>要批量导入前面导出的name和age： </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;name, age&#125; <span class="keyword">from</span> <span class="string">&#x27;user.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name + <span class="string">&quot; , 今年&quot;</span>+ age +<span class="string">&quot;岁了&quot;</span>)</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="对象扩展"><a href="#对象扩展" class="headerlink" title="对象扩展"></a>对象扩展</h2><p>ES6 给 Object 拓展了许多新的方法，如：</p>
<ul>
<li><code>keys(obj)</code>：获取对象的所有key形成的数组</li>
<li><code>values(obj)</code>：获取对象的所有value形成的数组</li>
<li><code>entries(obj)</code>：获取对象的所有key和value形成的二维数组。格式：<code>[[k1,v1],[k2,v2],...]</code></li>
<li><code>assian(dest, ...src) </code>：将多个src对象的值 拷贝到 dest中（浅拷贝）。</li>
</ul>
<p> <img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/1527210872966.png" alt="1527210872966"></p>
<h3 id="对象拓展运算符"><a href="#对象拓展运算符" class="headerlink" title="对象拓展运算符"></a>对象拓展运算符</h3><p>拓展运算符 <code>...</code> ：用于取出参数对象中所有可遍历属性然后拷贝到当前对象。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 对象复制：将 person1 对象中的数据迭代的拷贝到 person2 对象中</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> person1 = &#123;<span class="attr">name</span>:<span class="string">&quot;Amy&quot;</span>, <span class="attr">age</span>:<span class="number">18</span>&#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> person2 = &#123;...person1&#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(person2);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 对象合并：将 age 对象复制到 person3 对象的第1个位置上；将 name 对象复制到 person3 对象的第2个位置上。</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> age = &#123;<span class="attr">age</span>: <span class="number">15</span>&#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> name = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>&#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> person3 = &#123;...age, ...name&#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(person3)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="数组扩展"><a href="#数组扩展" class="headerlink" title="数组扩展"></a>数组扩展</h2><p>ES6给数组新增了许多方法：</p>
<ul>
<li><code>find(callback)</code>：把数组中的元素逐个传递给<strong>callback函数</strong>执行，如果返回true，则返回该元素</li>
<li><code>findIndex(callback)</code>：与find类似，不过返回的是元素的索引</li>
<li><code>includes(callback)</code>：与find类似，如果匹配到元素，则返回true，代表找到了。</li>
</ul>
<hr>
<h1 id="ES6-模块化规范"><a href="#ES6-模块化规范" class="headerlink" title="ES6 模块化规范"></a>ES6 模块化规范</h1><h2 id="模块简介"><a href="#模块简介" class="headerlink" title="模块简介"></a>模块简介</h2><p>随着嵌入网页的 Javascript 代码越来越庞大，越来越复杂，Javascript 模块化编程，已经成为一个迫切的需求。理想情况下，开发者只需要实现核心的业务逻辑，其他都可以加载别人已经写好的模块。</p>
<h2 id="模块化规范"><a href="#模块化规范" class="headerlink" title="模块化规范"></a>模块化规范</h2><ol>
<li> CommonJS 模块化规范（基于ES6语法之前）</li>
<li>ES6 模块化规范（使用ES6语法）<ul>
<li>  <strong>ES6 使用 export 和 import 来导出、导入模块。</strong></li>
<li>  <strong>模块必须先导出才能导入，如果没有导出的模块就不能进行导入！</strong></li>
</ul>
</li>
</ol>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote>
<p>创建<code>module_demo</code> 文件夹用于模块化的测试</p>
</blockquote>
<h3 id="导出模块"><a href="#导出模块" class="headerlink" title="导出模块"></a>导出模块</h3><p>创建<code>src/01.js</code>文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在一个 Js 文件中定义两个方法，将这个文件作为一个模块导出，这样其它文件就可以引入该模块并调用其中的方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello 模块化&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">save</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;这是一个保存操作&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a>导入模块</h3><p>创建<code>src/02.js</code>文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx <span class="keyword">from</span> <span class="string">&#x27;./01.js&#x27;</span>   </span><br><span class="line"><span class="comment">// 使用一个自定义的名字导入 01.js 模块，然后在当前模块中就可以通过这个自定义名称去调用 01.js 模块中的方法</span></span><br><span class="line">xxx.<span class="title function_">get</span>();</span><br><span class="line">xxx.<span class="title function_">save</span>();</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node <span class="number">02</span>.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/13/ES6%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97/image-20210315234636294.png" alt="image-20210315234636294"></p>
<blockquote>
<p>  错误原因：此时程序是无法运行的，因为ES6的模块化语法无法在 Node.js 中执行，需要用 Babel 编辑成 ES5 后再执行。</p>
</blockquote>
<h1 id="使用-Babel-转码"><a href="#使用-Babel-转码" class="headerlink" title="使用 Babel 转码"></a>使用 Babel 转码</h1><p>​    ES6 支持的某些高级语法在浏览器环境甚至是 Node.js 环境中是无法执行的，这就意味着我们必须将ES6标准的代码转换为 ES5 甚至更低级别的版本才能在 Node 环境下正常运行。而 Babel 就是这样一个广泛使用的转码器，可以将 ES6 代码转为 ES5 代码，这意味着，你可以使用 ES6 编写程序，而不用担心程序的运行环境是否支持 ES6 语法标准，因为最终运行的代码都会被转换为 ES5 标准。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Babel 提供了一个 <code>babel-cli</code> 工具，用于通过命令行转码。它的安装命令如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装命令（cli = client，表示客户端的意思）</span></span><br><span class="line">npm install -g babel-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否安装成功</span></span><br><span class="line">babel --version</span><br></pre></td></tr></table></figure>

<h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>在 modularization 目录下初始化项目</p>
<p>  1  <code>npm init -y</code></p>
<h3 id="配置-babelrc"><a href="#配置-babelrc" class="headerlink" title="配置 .babelrc"></a>配置 .babelrc</h3><p>Babel的配置文件是.babelrc，存放在项目的根目录下，该文件用来设置转码规则和插件，presets字段设定转码规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;``&quot;presets&quot;: [&quot;es2015&quot;],``&quot;plugins&quot;: []``&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安装转码器"><a href="#安装转码器" class="headerlink" title="安装转码器"></a>安装转码器</h3><p>在modularization目录中安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D babel-preset-es2015`` </span><br></pre></td></tr></table></figure>

<h3 id="转码"><a href="#转码" class="headerlink" title="转码"></a>转码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 整个目录转码``# --out-dir 或 -d 参数指定输出目录``babel src -d dist</span><br></pre></td></tr></table></figure>

<h3 id="运行程序-1"><a href="#运行程序-1" class="headerlink" title="运行程序"></a>运行程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``node dist/teacherComponent.js`` </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/12/MyBatisPlus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/12/MyBatisPlus/" class="post-title-link" itemprop="url">MyBatisPlus</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-12 21:42:16" itemprop="dateCreated datePublished" datetime="2021-03-12T21:42:16+08:00">2021-03-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-11-15 10:43:19" itemprop="dateModified" datetime="2021-11-15T10:43:19+08:00">2021-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1    简介"></a>1    简介</h1><p>MyBatis-Plus（简称 MP）是一个 MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生！</p>
<h1 id="2-MP-入门"><a href="#2-MP-入门" class="headerlink" title="2    MP 入门"></a>2    MP 入门</h1><h2 id="2-1-准备数据库"><a href="#2-1-准备数据库" class="headerlink" title="2.1    准备数据库"></a>2.1    准备数据库</h2><ol>
<li>创建数据库</li>
</ol>
<blockquote>
<p>mybatis_plus</p>
</blockquote>
<ol start="2">
<li>创建 users 表</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users</span><br><span class="line">(</span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>)<span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    NAME <span class="type">VARCHAR</span>(<span class="number">30</span>)<span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span>(<span class="number">11</span>)<span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">50</span>)<span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>插入示例数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (id, name, age, email) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="2-2-准备-SpringBoot-项目"><a href="#2-2-准备-SpringBoot-项目" class="headerlink" title="2.2    准备 SpringBoot 项目"></a>2.2    准备 SpringBoot 项目</h2><ol>
<li><p>初始化 SpringBoot 项目并引入 Maven 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyBatisPlus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- MySQL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tip：引入 MyBatis-Plus 之后请不要再次引入 MyBatis，以避免因版本差异导致的问题。</strong></p>
</blockquote>
</li>
</ol>
<h2 id="2-3-编写代码"><a href="#2-3-编写代码" class="headerlink" title="2.3    编写代码"></a>2.3    编写代码</h2><h3 id="2-3-1-配置"><a href="#2-3-1-配置" class="headerlink" title="2.3.1    配置"></a>2.3.1    配置</h3><p>在 <code>application.properties</code> 配置文件中添加 MySQL 数据库的相关配置！</p>
<blockquote>
<p>spring boot 2.0（内置 jdbc5 驱动）</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>spring boot 2.1及以上（内置 jdbc8 驱动）</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意 driver 和 url 的变化</strong><ol>
<li>在 JDBC8 中的 url 需要添加 <code>?serverTimezone=GMT%2B8</code> 这个后缀，否则运行时会报错。</li>
<li>在 JDBC8 中 <code>driver-class-name</code> 建议使用 <code>com.mysql.cj.jdbc.Driver</code> 这个驱动，否则运行测试用例的时候会有 WARN 信息。</li>
</ol>
</li>
</ul>
<h3 id="2-3-2-启动类"><a href="#2-3-2-启动类" class="headerlink" title="2.3.2    启动类"></a>2.3.2    启动类</h3><p>在 SpringBoot 的启动类（或自定义的配置类）中添加 <strong>@MapperScan</strong> 注解，扫描 Mapper 文件夹！</p>
<p>我这里将 @MapperScan 注解放在了自定义的配置类中！！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.mp.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.xsyu.mp.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 乐观锁插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-3-3-添加实体"><a href="#2-3-3-添加实体" class="headerlink" title="2.3.3    添加实体"></a>2.3.3    添加实体</h3><blockquote>
<p>创建包 domain 编写实体类 User.java（此处使用了 Lombok 简化代码）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.mp.domain;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.*;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Version</span>    <span class="comment">// 开启 乐观锁 验证</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span>     <span class="comment">// 指定新创建一个元数据时的初始版本号，此后每次跟新版本号会自动 +1</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-添加mapper"><a href="#2-3-4-添加mapper" class="headerlink" title="2.3.4    添加mapper"></a>2.3.4    添加mapper</h3><blockquote>
<p>创建包 mapper 编写 Mapper 接口： UserMapper.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.mp.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.xsyu.mp.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// BaseMapper 是 MyBatisPlus 中的API ，其中指定的泛型即为我们要操作的数据库表对应的实体类！</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-5-测试"><a href="#2-3-5-测试" class="headerlink" title="2.3.5    测试"></a>2.3.5    测试</h3><blockquote>
<p>添加测试类，进行功能测试</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xsyu.mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.xsyu.mp.domain.User;</span><br><span class="line"><span class="keyword">import</span> cn.xsyu.mp.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MpApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找所有：select *  from users</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入操作：</span></span><br><span class="line"><span class="comment">     *  1、如果不指定 id 的话， MP 会生成随机ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;王奔&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新操作：先查询，再更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1370224030363250690L</span>);</span><br><span class="line">        <span class="comment">// 更新</span></span><br><span class="line">        user.setName(<span class="string">&quot;将军&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过多个 id 批量查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectBatchIds(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 简单的条件查询，通过 map 封装查询条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jone&quot;</span>);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectByMap(map);     <span class="comment">// 在源码中，已经指定了该方法接收的参数的泛型为 Map&lt;String, Object&gt;</span></span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span>&#123;</span><br><span class="line">        Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        Page&lt;User&gt; userPage = userMapper.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 返回结果分析</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">pages</span> <span class="operator">=</span> userPage.getPages();   <span class="comment">// 总页数</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> userPage.getCurrent();   <span class="comment">// 当前页（没有第0页）</span></span><br><span class="line">        List&lt;User&gt; records = userPage.getRecords(); <span class="comment">// 查询数据集合</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> userPage.getTotal();   <span class="comment">// 总记录数</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasNext</span> <span class="operator">=</span> userPage.hasNext();     <span class="comment">// 下一页</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasPrevious</span> <span class="operator">=</span> userPage.hasPrevious();   <span class="comment">// 上一页</span></span><br><span class="line">        System.out.println(pages);</span><br><span class="line">        System.out.println(current);</span><br><span class="line">        System.out.println(total);</span><br><span class="line">        System.out.println(hasNext);</span><br><span class="line">        System.out.println(hasPrevious);</span><br><span class="line">        System.out.println(records);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 删除记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.deleteById(<span class="number">1370268550282985474L</span>);</span><br><span class="line">        System.out.println(rows);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">results</span> <span class="operator">=</span> userMapper.deleteBatchIds(Arrays.asList(<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">        System.out.println(results);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 简单条件删除</span></span><br><span class="line"><span class="comment">     *  在条件查询的 Map 集合中，多个条件之间的关系用 AND 连接 ！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteByMap(map);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        QueryWrapper&lt;User&gt; query = wrapper</span><br><span class="line">            .isNotNull(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">            .ge(<span class="string">&quot;age&quot;</span>, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="3-MyBatisPlus-常见问题"><a href="#3-MyBatisPlus-常见问题" class="headerlink" title="3    MyBatisPlus 常见问题"></a>3    MyBatisPlus 常见问题</h1><h2 id="3-1-MyBatis没有读取到-XxxMapper-xml-文件"><a href="#3-1-MyBatis没有读取到-XxxMapper-xml-文件" class="headerlink" title="3.1    MyBatis没有读取到 XxxMapper.xml 文件"></a>3.1    MyBatis没有读取到 XxxMapper.xml 文件</h2><p>MyBatisPlus 的设计目的是在兼容 MyBatis 的基础上对其进行增强，在我们的项目中，有些复杂的 SQL 语句通过 MP 内置的方法并不能够实现目标，所以这时我们还是需要将 SQL 语句写在 <code>XxxMapper.xml</code> 中来实现复杂的 SQL 查询。而我们常见的 <code>XxxMapper.xml</code> 文件的存储路径主要有两种方式，</p>
<ul>
<li>  一种是把 <code>XxxMapper.xml</code> 文件放在 <code>src/main/java</code> 包下；</li>
<li>  另一种是把 <code>XxxMapper.xml</code> 文件放在 <code>src/main/resource</code> 文件夹下。</li>
</ul>
<img src="/2021/03/12/MyBatisPlus/image-20211115101724481.png" alt="image-20211115101724481" style="zoom: 67%;">





<p>针对这两种不同的存放方式，需要设置的配置信息是不一样的。如果 <code>XxxMapper.xml</code> 文件是在 <strong>java</strong> 文件夹下，需要在 <code>pom.xml</code> 配置文件中增加如下配置，否则可能会抛出 <strong>org.apache.ibatis.binding.BindingException</strong> 异常。</p>
<blockquote>
<p>  <strong>配置信息</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MAVEN项目部署时无法将mapper.xml文件部署，需要通过以下配置解决 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--资源往往不是代码，无需编译，而是一些properties或XML配置文件，构建过程中会往往会将资源文件从源路径复制到指定的目标路径。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--directory，资源文件的路径，默认位于$&#123;basedir&#125;/src/main/resources/目录下--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--includes，一组文件名的匹配模式，被匹配的资源文件将被构建过程处理--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--excludes：指定哪些文件被忽略，如果一个文件同时符合includes和excludes，则excludes生效；--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--filtering，构建过程中是否对资源进行过滤，默认false--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>





<blockquote>
<p>  <strong>异常类型</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.binding.BindingException: Invalid bound <span class="title function_">statement</span> <span class="params">(not found)</span>: com.husy.mapper.SystemUserMapper.findUserByName</span><br><span class="line"></span><br><span class="line">    at com.baomidou.mybatisplus.core.override.MybatisMapperMethod$SqlCommand.&lt;init&gt;(MybatisMapperMethod.java:<span class="number">242</span>)</span><br><span class="line">    at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.&lt;init&gt;(MybatisMapperMethod.java:<span class="number">54</span>)</span><br><span class="line">    at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.lambda$cachedMapperMethod$<span class="number">0</span>(MybatisMapperProxy.java:<span class="number">65</span>)</span><br><span class="line">    at java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:<span class="number">1660</span>)</span><br><span class="line">    at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.cachedMapperMethod(MybatisMapperProxy.java:<span class="number">65</span>)</span><br><span class="line">    at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:<span class="number">60</span>)</span><br><span class="line">    at com.sun.proxy.$Proxy72.findUserByName(Unknown Source)</span><br><span class="line">    at com.husy.service.impl.SystemUserServiceImpl.findUserByName(SystemUserServiceImpl.java:<span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="SpringBoot-中的-classpath-路径到底指哪里？"><a href="#SpringBoot-中的-classpath-路径到底指哪里？" class="headerlink" title="SpringBoot 中的 classpath 路径到底指哪里？"></a>SpringBoot 中的 classpath 路径到底指哪里？</h2><p><strong>一般springboot项目里classpath目录指的是resources文件夹</strong>，引用classpath路径下的文件，只需在文件名前加classpath。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/09/%E6%97%A5%E6%9C%9F%E5%B7%A5%E5%85%B7%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/09/%E6%97%A5%E6%9C%9F%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="post-title-link" itemprop="url">日期工具类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-09 23:53:06" itemprop="dateCreated datePublished" datetime="2021-03-09T23:53:06+08:00">2021-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-04-11 23:26:57" itemprop="dateModified" datetime="2021-04-11T23:26:57+08:00">2021-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E6%97%A5%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">开发日记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.BooleanUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.ZonedDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 时间工具</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> DSL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/12   </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">pastDate</span> <span class="operator">=</span> addDateDay(<span class="keyword">new</span> <span class="title class_">Date</span>(), -<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;打印&quot;</span>+pastDate);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> DateUtil.getBeforeCompare(DateUtil.addDateDay(DateUtil.strToDateYMDHMS(<span class="string">&quot;2020-06-01 11:11:08&quot;</span>),<span class="number">60</span>));</span><br><span class="line">        System.out.println(flag);</span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">aa</span> <span class="operator">=</span> DateUtil.addDateDay(DateUtil.strToDateYMDHMS(<span class="string">&quot;2020-06-12 19:19:01&quot;</span>), <span class="number">60</span>).getTime() &lt; System.currentTimeMillis();</span><br><span class="line">        System.out.println(aa);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 将时间戳转换为时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">stampToDate</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="comment">// 10位的秒级别的时间戳</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time1</span> <span class="operator">=</span> Long.valueOf(s);</span><br><span class="line">        <span class="type">String</span> <span class="variable">result1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>(time1 * <span class="number">1000</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;10位数的时间戳（秒）---&gt;Date:&quot;</span> + result1);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(time1*<span class="number">1000</span>);   <span class="comment">//对应的就是时间戳对应的Date</span></span><br><span class="line">        <span class="keyword">return</span>  date1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取精确到秒的时间戳</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getSecondTimestamp</span><span class="params">(Date date)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == date) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">timestamp</span> <span class="operator">=</span> String.valueOf(date.getTime());</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> timestamp.length();</span><br><span class="line">        <span class="keyword">if</span> (length &gt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(timestamp.substring(<span class="number">0</span>,length-<span class="number">3</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> year 1明年 -1去年</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Title</span>: getDefineYearDate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 根据参数年, 获取当前时间过去未来时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getDefineYearDate</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        c.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        c.add(Calendar.YEAR, year);</span><br><span class="line">        c.add(Calendar.MONTH, month);</span><br><span class="line">        c.add(Calendar.DATE, day);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">y</span> <span class="operator">=</span> c.getTime();</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据当前时间获取多少秒后的时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateSecond</span><span class="params">(<span class="type">int</span> second)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        c.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        c.add(Calendar.SECOND, second);<span class="comment">//把日期往后增加SECOND 秒.整数往后推,负数往前移动</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> c.getTime(); <span class="comment">//这个时间就是日期往后推一天的结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> format.format(date);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据当前时间获取多少分钟后的时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateMinute</span><span class="params">(<span class="type">int</span> minute)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        c.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        c.add(Calendar.MINUTE, minute);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> c.getTime(); <span class="comment">//这个时间就是日期往后推一天的结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> format.format(date);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据某个时间时间获取小时分钟后的时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateHour</span><span class="params">(Date dateSome,<span class="type">int</span> hour)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        c.setTime(dateSome);</span><br><span class="line">        c.add(Calendar.HOUR,hour);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> c.getTime(); <span class="comment">//这个时间就是日期往后推一天的结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> format.format(date);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据某个时间时间获取一小时后时间段</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateHourOut</span><span class="params">(Date dateSome,<span class="type">int</span> hour)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strOpen</span> <span class="operator">=</span> format.format(dateSome);</span><br><span class="line"></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        c.setTime(dateSome);</span><br><span class="line">        c.add(Calendar.HOUR,hour);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> c.getTime(); <span class="comment">//这个时间就是日期往后推一天的结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">strEnd</span> <span class="operator">=</span> format.format(date);</span><br><span class="line">        <span class="keyword">return</span> strOpen+<span class="string">&quot;-&quot;</span>+strEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Title</span>: getDate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前时间毫秒</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Title</span>: getDate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateMillisecond</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMddHHmmssSSSS&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前时间yyyy-MM-dd</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> YDL   2018-08-30</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Title</span>: getDateYMD</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateYMD</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateYMDstart</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd 00:00:00&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateYMDend</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd 23:59:59&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getOtherDateYMDstart</span><span class="params">(Date  otherDate)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd 00:00:00&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(otherDate);</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getOtherDateYMDend</span><span class="params">(Date  otherDate)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd 23:59:59&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(otherDate);</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得当天零时零分零秒</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@auth</span> hank</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当天零时零分零秒的Date</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getToDayInitial</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//带着时区(默认时区,本地日期)</span></span><br><span class="line">        <span class="type">ZonedDateTime</span> <span class="variable">zonedDateTime</span> <span class="operator">=</span> ZonedDateTime.now().withHour(<span class="number">0</span>).withMinute(<span class="number">0</span>).withSecond(<span class="number">0</span>).withNano(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//1.zonedDateTime.toInstant()转换成时间戳(因为zonedDateTime包含了时区和时间信息,可以转换为GMT的时间戳(时间+时区))2.Date.from会使用默认时区转换时间戳为本地时间(默认时区)</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> Date.from(zonedDateTime.toInstant());</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将DATE类型转换默认字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Title</span>: getDate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">fmtYMDHMS</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> format.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">fmtYMD</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> format.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 两个时间之间的天数之差</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date1 - date2 = int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getDifferDay</span><span class="params">(String date2, String date1)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (date1 == <span class="literal">null</span> || StringUtils.isBlank(date1))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (date2 == <span class="literal">null</span> || StringUtils.isBlank(date2))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 转换为标准时间</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">myFormatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">start</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">end</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            start = myFormatter.parse(date1);</span><br><span class="line">            end = myFormatter.parse(date2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> (<span class="type">int</span>) ((start.getTime() - end.getTime()) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">        <span class="keyword">return</span> day;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 两个日期相差的分钟</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date1 - date2 = int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getDifferMinute</span><span class="params">(Date date2, Date date1)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timeDelta</span> <span class="operator">=</span> (date1.getTime() - date2.getTime()) / (<span class="number">1000</span> * <span class="number">60</span>);<span class="comment">//单位是秒</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">secondsDelta</span> <span class="operator">=</span> timeDelta &gt; <span class="number">0</span> ? (<span class="type">int</span>) timeDelta : (<span class="type">int</span>) Math.abs(timeDelta);</span><br><span class="line">        <span class="keyword">return</span> secondsDelta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 两个日期相差的秒数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date1 - date2 = int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getDifferSecond</span><span class="params">(Date date2, Date date1)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timeDelta</span> <span class="operator">=</span> (date1.getTime() - date2.getTime()) / <span class="number">1000</span>;<span class="comment">//单位是秒</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">secondsDelta</span> <span class="operator">=</span> timeDelta &gt; <span class="number">0</span> ? (<span class="type">int</span>) timeDelta : (<span class="type">int</span>) Math.abs(timeDelta);</span><br><span class="line">        <span class="keyword">return</span> secondsDelta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对比时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> DATE1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> DATE2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compareDate</span><span class="params">(Date DATE1, Date DATE2)</span> &#123;</span><br><span class="line">        <span class="comment">// SimpleDateFormat sdf = new SimpleDateFormat();</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">dt1</span> <span class="operator">=</span> DATE1;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">dt2</span> <span class="operator">=</span> DATE2;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">res</span> <span class="operator">=</span> dt1.after(dt2);</span><br><span class="line">            <span class="keyword">if</span> (res) &#123;</span><br><span class="line"><span class="comment">//                System.out.println(&quot;d1在d2之后&quot;);</span></span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//                System.out.println(&quot;d1在d2之前&quot;);</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 跟当前时间比较大小 大于true 小于false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beforeDate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">getBeforeCompare</span><span class="params">(Date beforeDate)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">nowDate</span> <span class="operator">=</span> Calendar.getInstance().getTime();</span><br><span class="line">        <span class="keyword">return</span> nowDate.before(beforeDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加年</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date    时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> yearNum 添加几年</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">addDateYear</span><span class="params">(Date date, <span class="type">int</span> yearNum)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.setTime(date);<span class="comment">// 设置起时间</span></span><br><span class="line">        cal.add(Calendar.YEAR, yearNum);<span class="comment">// 增加一年</span></span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加月</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date  时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> month 添加几月</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">addDateMonth</span><span class="params">(Date date, <span class="type">int</span> month)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.setTime(date);<span class="comment">// 设置起时间</span></span><br><span class="line">        cal.add(Calendar.MONTH, month);<span class="comment">// 月改变</span></span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加日</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date 时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> day  添加几日</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">addDateDay</span><span class="params">(Date date, <span class="type">int</span> day)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.setTime(date);<span class="comment">// 设置起时间</span></span><br><span class="line">        cal.add(Calendar.DATE, day);<span class="comment">// 日改变</span></span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取过去第几天的日期</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> past</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getPastDate</span><span class="params">(Date date,<span class="type">int</span> past)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.setTime(date);</span><br><span class="line">        calendar.set(Calendar.DATE, calendar.get(Calendar.DATE) - past);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">today</span> <span class="operator">=</span> calendar.getTime();</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> sdf.format(today);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加分</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date   时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> minute 添加分钟，可为正数或者负数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">addDateMinute</span><span class="params">(Date date, <span class="type">int</span> minute)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.setTime(date);<span class="comment">// 设置起时间</span></span><br><span class="line">        cal.add(Calendar.MINUTE, minute);<span class="comment">// 秒改变</span></span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加秒</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date   时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> second 添加秒数，可为正数或者负数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">addDateSecond</span><span class="params">(Date date, <span class="type">int</span> second)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.setTime(date);<span class="comment">// 设置起时间</span></span><br><span class="line">        cal.add(Calendar.SECOND, second);<span class="comment">// 秒改变</span></span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">strToDateYMD</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = format.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">strToDateYMDHMS</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = format.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">strToDateYMDHM</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = format.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">strToDateYMDHMtoStr</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = format.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> format.format(date);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得当天0点时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getTimeMorning</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.set(cal.get(Calendar.YEAR), cal.get(Calendar.MONTH), cal.get(Calendar.DAY_OF_MONTH), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">beginOfDate</span> <span class="operator">=</span> cal.getTime();</span><br><span class="line">        <span class="keyword">return</span> beginOfDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得本当天23:59:59点时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getTimeNight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.set(cal.get(Calendar.YEAR), cal.get(Calendar.MONTH), cal.get(Calendar.DAY_OF_MONTH), <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">endOfDate</span> <span class="operator">=</span> cal.getTime();</span><br><span class="line">        <span class="keyword">return</span> endOfDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得本周一0点时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getTimesWeekmorning</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.set(cal.get(Calendar.YEAR), cal.get(Calendar.MONDAY), cal.get(Calendar.DAY_OF_MONTH), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        cal.set(Calendar.DAY_OF_WEEK, Calendar.MONDAY);</span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得本周日24点时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getTimesWeeknight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.set(cal.get(Calendar.YEAR), cal.get(Calendar.MONDAY), cal.get(Calendar.DAY_OF_MONTH), <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line">        cal.add(Calendar.DAY_OF_WEEK, <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当月的第一天</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getFirstDay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取前月的第一天</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cale</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cale.add(Calendar.MONTH, <span class="number">0</span>);</span><br><span class="line">        cale.set(cale.get(Calendar.YEAR), cale.get(Calendar.MONDAY), cale.get(Calendar.DAY_OF_MONTH), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        cale.set(Calendar.DAY_OF_MONTH, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">firstDay</span> <span class="operator">=</span> format.format(cale.getTime());</span><br><span class="line">        <span class="keyword">return</span> firstDay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当月的最后一天</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLastDay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd  HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取前月的最后一天</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cale</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cale.add(Calendar.MONTH, <span class="number">1</span>);</span><br><span class="line">        cale.set(cale.get(Calendar.YEAR), cale.get(Calendar.MONDAY), cale.get(Calendar.DAY_OF_MONTH), <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line">        cale.set(Calendar.DAY_OF_MONTH, <span class="number">0</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lastDay</span> <span class="operator">=</span> format.format(cale.getTime());</span><br><span class="line">        <span class="keyword">return</span> lastDay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当周的第一天</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getWeekFirstDay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取前月的第一天</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cale</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cale.add(Calendar.DAY_OF_WEEK, <span class="number">0</span>);</span><br><span class="line">        cale.set(cale.get(Calendar.YEAR), cale.get(Calendar.MONDAY), cale.get(Calendar.DAY_OF_MONTH), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        cale.set(Calendar.DAY_OF_WEEK, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">firstDay</span> <span class="operator">=</span> format.format(cale.getTime());</span><br><span class="line">        <span class="keyword">return</span> firstDay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当月的最后一天</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getWeekEndDay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd  HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取前月的最后一天</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cale</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cale.add(Calendar.DAY_OF_WEEK, <span class="number">1</span>);</span><br><span class="line">        cale.set(cale.get(Calendar.YEAR), cale.get(Calendar.MONDAY), cale.get(Calendar.DAY_OF_MONTH), <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line">        cale.set(Calendar.DAY_OF_WEEK, <span class="number">0</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lastDay</span> <span class="operator">=</span> format.format(cale.getTime());</span><br><span class="line">        <span class="keyword">return</span> lastDay;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取下个月的今天</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getLastMonthToDay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        calendar.add(Calendar.MONTH, <span class="number">1</span>);<span class="comment">//增加一个月</span></span><br><span class="line">        <span class="keyword">return</span> calendar.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取某月多少天</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getDaysByYearMonth</span><span class="params">(<span class="type">int</span> month)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">a</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        <span class="comment">//a.set(Calendar.YEAR,year);</span></span><br><span class="line">        a.set(Calendar.MONTH, month - <span class="number">1</span>);</span><br><span class="line">        a.set(Calendar.DATE, <span class="number">1</span>);</span><br><span class="line">        a.roll(Calendar.DATE, -<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxDate</span> <span class="operator">=</span> a.get(Calendar.DATE);</span><br><span class="line">        <span class="keyword">return</span> maxDate;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前年</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentYear</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="keyword">return</span> sdf.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取字符串 时分 时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">strToStrYMDHM</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = format.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">formatYMDhms</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> formatYMDhms.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当天时间  半小时时间间隔</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Queue&lt;String&gt; <span class="title function_">getDateToHalfHour</span><span class="params">(String time1)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> DateUtil.fmtYMD(DateUtil.strToDateYMD(time1));</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">startTime</span> <span class="operator">=</span> time +<span class="string">&quot; 09:00:00&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">endTime</span> <span class="operator">=</span> time +<span class="string">&quot; 18:30:00&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Date</span> <span class="variable">startDate</span>  <span class="operator">=</span>  DateUtil.strToDateYMDHMS(startTime);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">endDate</span>  <span class="operator">=</span>  DateUtil.strToDateYMDHMS(endTime);</span><br><span class="line"></span><br><span class="line">        Queue&lt;String&gt; queueTime = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">        queueTime.add(<span class="string">&quot;09:00:00&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!startTime.equals(endTime))&#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> startDate.getTime() + <span class="number">30</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(currentTime);</span><br><span class="line"></span><br><span class="line">            startDate = date;</span><br><span class="line"></span><br><span class="line">            <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> format.format(date);</span><br><span class="line">            queueTime.add(str);</span><br><span class="line">            startTime = time + <span class="string">&quot; &quot;</span>+str;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  queueTime;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Queue&lt;String&gt; <span class="title function_">getDateToHalfHourTwo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 半小时[多余冗余半小时] [1]   OR 一小时 [0]</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Queue&lt;String&gt; queueTime = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;String&gt;();</span><br><span class="line">         <span class="type">Integer</span> <span class="variable">KEY_START_NUM</span> <span class="operator">=</span> Const.KEY_START_NUM;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">KEY_END_NUM</span> <span class="operator">=</span> Const.KEY_END_NUM;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">isHalf</span> <span class="operator">=</span> Const.isHalf;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> KEY_START_NUM ; i&lt;= KEY_END_NUM;i++)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">timeHalf</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">10</span>)&#123;</span><br><span class="line">                time = <span class="string">&quot;0&quot;</span>+i+<span class="string">&quot;:00&quot;</span>;</span><br><span class="line">                timeHalf = <span class="string">&quot;0&quot;</span>+i+<span class="string">&quot;:30&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                time = i+<span class="string">&quot;:00&quot;</span>;</span><br><span class="line">                timeHalf = i+<span class="string">&quot;:30&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            queueTime.add(time);</span><br><span class="line">            <span class="keyword">if</span>(isHalf == <span class="number">1</span>)&#123;</span><br><span class="line">                queueTime.add(timeHalf);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queueTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当天时间  半小时时间间隔</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">isClick</span><span class="params">(String time)</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//毫秒值大小</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">compareTime</span>  <span class="operator">=</span>  DateUtil.strToDateYMDHM(time);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">comTime</span> <span class="operator">=</span> compareTime.getTime();</span><br><span class="line"></span><br><span class="line">        <span class="type">Date</span> <span class="variable">nowDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> nowDate.getTime();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currentTime &gt;= comTime)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取日期的遍历，获取一段时间内的每一天的字符串形式并保存到一个数组中</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">getDateTraversal</span><span class="params">(String startTime, String endTime)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">startDate</span> <span class="operator">=</span> dateFormat.parse(startTime);</span><br><span class="line">            <span class="type">Date</span> <span class="variable">endDate</span> <span class="operator">=</span> dateFormat.parse(endTime);</span><br><span class="line">            <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">            calendar.setTime(startDate);</span><br><span class="line">            <span class="keyword">while</span>(calendar.getTime().before(endDate))&#123;</span><br><span class="line"><span class="comment">//                System.out.println(dateFormat.format(calendar.getTime()));</span></span><br><span class="line">                list.add(dateFormat.format(calendar.getTime()));</span><br><span class="line">                calendar.add(Calendar.DAY_OF_MONTH, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            System.out.println(dateFormat.format(endDate));</span></span><br><span class="line">            list.add(dateFormat.format(calendar.getTime()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        System.out.println(list);</span></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/09/MySQL%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/09/MySQL%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">MySQL内置函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-09 23:52:40" itemprop="dateCreated datePublished" datetime="2021-03-09T23:52:40+08:00">2021-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-20 14:32:47" itemprop="dateModified" datetime="2022-01-20T14:32:47+08:00">2022-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySql/" itemprop="url" rel="index"><span itemprop="name">MySql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MySQL-字符串函数"><a href="#MySQL-字符串函数" class="headerlink" title="MySQL 字符串函数"></a>MySQL 字符串函数</h1><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ASCII(s)</td>
<td align="left">返回字符串 s 的第一个字符的 ASCII 码。</td>
<td align="left">返回 CustomerName 字段第一个字母的 ASCII 码：<code>SELECT ASCII(CustomerName) AS NumCodeOfFirstChar FROM Customers;</code></td>
</tr>
<tr>
<td align="center">CHAR_LENGTH(s)</td>
<td align="left">返回字符串 s 的字符数</td>
<td align="left">返回字符串 RUNOOB 的字符数<code>SELECT CHAR_LENGTH(&quot;RUNOOB&quot;) AS LengthOfString;</code></td>
</tr>
<tr>
<td align="center">CHARACTER_LENGTH(s)</td>
<td align="left">返回字符串 s 的字符数</td>
<td align="left">返回字符串 RUNOOB 的字符数<code>SELECT CHARACTER_LENGTH(&quot;RUNOOB&quot;) AS LengthOfString;</code></td>
</tr>
<tr>
<td align="center">CONCAT(s1,s2…sn)</td>
<td align="left">字符串 s1,s2 等多个字符串合并为一个字符串</td>
<td align="left">合并多个字符串<code>SELECT CONCAT(&quot;SQL &quot;, &quot;Runoob &quot;, &quot;Gooogle &quot;, &quot;Facebook&quot;) AS ConcatenatedString;</code></td>
</tr>
<tr>
<td align="center">CONCAT_WS(x, s1,s2…sn)</td>
<td align="left">同 CONCAT(s1,s2,…) 函数，但是每个字符串之间要加上 x，x 可以是分隔符</td>
<td align="left">合并多个字符串，并添加分隔符：<code>SELECT CONCAT_WS(&quot;-&quot;, &quot;SQL&quot;, &quot;Tutorial&quot;, &quot;is&quot;, &quot;fun!&quot;)AS ConcatenatedString;</code></td>
</tr>
<tr>
<td align="center">FIELD(s,s1,s2…)</td>
<td align="left">返回第一个字符串 s 在字符串列表(s1,s2…)中的位置</td>
<td align="left">返回字符串 c 在列表值中的位置：<code>SELECT FIELD(&quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;);</code></td>
</tr>
<tr>
<td align="center">FIND_IN_SET(s1,s2)</td>
<td align="left">返回在字符串s2中与s1匹配的字符串的位置</td>
<td align="left">返回字符串 c 在指定字符串中的位置：<code>SELECT FIND_IN_SET(&quot;c&quot;, &quot;a,b,c,d,e&quot;);</code></td>
</tr>
<tr>
<td align="center">FORMAT(x,n)</td>
<td align="left">函数可以将数字 x 进行格式化 “#,###.##”, 将 x 保留到小数点后 n 位，最后一位四舍五入。</td>
<td align="left">格式化数字 “#,###.##” 形式：<code>SELECT FORMAT(250500.5634, 2);     -- 输出 250,500.56</code></td>
</tr>
<tr>
<td align="center">INSERT(s1,x,len,s2)</td>
<td align="left">字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串</td>
<td align="left">从字符串第一个位置开始的 6 个字符替换为 runoob：<code>SELECT INSERT(&quot;google.com&quot;, 1, 6, &quot;runoob&quot;);  -- 输出：runoob.com</code></td>
</tr>
<tr>
<td align="center">LOCATE(s1,s)</td>
<td align="left">从字符串 s 中获取 s1 的开始位置</td>
<td align="left">获取 b 在字符串 abc 中的位置：<code>SELECT LOCATE(&#39;st&#39;,&#39;myteststring&#39;);  -- 5</code>返回字符串 abc 中 b 的位置：<code>SELECT LOCATE(&#39;b&#39;, &#39;abc&#39;) -- 2</code></td>
</tr>
<tr>
<td align="center">LCASE(s)</td>
<td align="left">将字符串 s 的所有字母变成小写字母</td>
<td align="left">字符串 RUNOOB 转换为小写：<code>SELECT LCASE(&#39;RUNOOB&#39;) -- runoob</code></td>
</tr>
<tr>
<td align="center">LEFT(s,n)</td>
<td align="left">返回字符串 s 的前 n 个字符</td>
<td align="left">返回字符串 runoob 中的前两个字符：<code>SELECT LEFT(&#39;runoob&#39;,2) -- ru</code></td>
</tr>
<tr>
<td align="center">LOWER(s)</td>
<td align="left">将字符串 s 的所有字母变成小写字母</td>
<td align="left">字符串 RUNOOB 转换为小写：<code>SELECT LOWER(&#39;RUNOOB&#39;) -- runoob</code></td>
</tr>
<tr>
<td align="center">LPAD(s1,len,s2)</td>
<td align="left">在字符串 s1 的开始处填充字符串 s2，使字符串长度达到 len</td>
<td align="left">将字符串 xx 填充到 abc 字符串的开始处：<code>SELECT LPAD(&#39;abc&#39;,5,&#39;xx&#39;) -- xxabc</code></td>
</tr>
<tr>
<td align="center">LTRIM(s)</td>
<td align="left">去掉字符串 s 开始处的空格</td>
<td align="left">去掉字符串 RUNOOB开始处的空格：<code>SELECT LTRIM(&quot;    RUNOOB&quot;) AS LeftTrimmedString;-- RUNOOB</code></td>
</tr>
<tr>
<td align="center">MID(s,n,len)</td>
<td align="left">从字符串 s 的 n 位置截取长度为 len 的子字符串，同 SUBSTRING(s,n,len)</td>
<td align="left">从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：<code>SELECT MID(&quot;RUNOOB&quot;, 2, 3) AS ExtractString; -- UNO</code></td>
</tr>
<tr>
<td align="center">POSITION(s1 IN s)</td>
<td align="left">从字符串 s 中获取 s1 的开始位置</td>
<td align="left">返回字符串 abc 中 b 的位置：<code>SELECT POSITION(&#39;b&#39; in &#39;abc&#39;) -- 2</code></td>
</tr>
<tr>
<td align="center">REPEAT(s,n)</td>
<td align="left">将字符串 s 重复 n 次</td>
<td align="left">将字符串 runoob 重复三次：<code>SELECT REPEAT(&#39;runoob&#39;,3) -- runoobrunoobrunoob</code></td>
</tr>
<tr>
<td align="center">REPLACE(s,s1,s2)</td>
<td align="left">将字符串 s2 替代字符串 s 中的字符串 s1</td>
<td align="left">将字符串 abc 中的字符 a 替换为字符 x：<code>SELECT REPLACE(&#39;abc&#39;,&#39;a&#39;,&#39;x&#39;) --xbc</code></td>
</tr>
<tr>
<td align="center">REVERSE(s)</td>
<td align="left">将字符串s的顺序反过来</td>
<td align="left">将字符串 abc 的顺序反过来：<code>SELECT REVERSE(&#39;abc&#39;) -- cba</code></td>
</tr>
<tr>
<td align="center">RIGHT(s,n)</td>
<td align="left">返回字符串 s 的后 n 个字符</td>
<td align="left">返回字符串 runoob 的后两个字符：<code>SELECT RIGHT(&#39;runoob&#39;,2) -- ob</code></td>
</tr>
<tr>
<td align="center">RPAD(s1,len,s2)</td>
<td align="left">在字符串 s1 的结尾处添加字符串 s2，使字符串的长度达到 len</td>
<td align="left">将字符串 xx 填充到 abc 字符串的结尾处：<code>SELECT RPAD(&#39;abc&#39;,5,&#39;xx&#39;) -- abcxx</code></td>
</tr>
<tr>
<td align="center">RTRIM(s)</td>
<td align="left">去掉字符串 s 结尾处的空格</td>
<td align="left">去掉字符串 RUNOOB 的末尾空格：<code>SELECT RTRIM(&quot;RUNOOB     &quot;) AS RightTrimmedString;   -- RUNOOB</code></td>
</tr>
<tr>
<td align="center">SPACE(n)</td>
<td align="left">返回 n 个空格</td>
<td align="left">返回 10 个空格：<code>SELECT SPACE(10);</code></td>
</tr>
<tr>
<td align="center">STRCMP(s1,s2)</td>
<td align="left">比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</td>
<td align="left">比较字符串：<code>SELECT STRCMP(&quot;runoob&quot;, &quot;runoob&quot;);  -- 0</code></td>
</tr>
<tr>
<td align="center">SUBSTR(s, start, length)</td>
<td align="left">从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
<td align="left">从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：<code>SELECT SUBSTR(&quot;RUNOOB&quot;, 2, 3) AS ExtractString; -- UNO</code></td>
</tr>
<tr>
<td align="center">SUBSTRING(s, start, length)</td>
<td align="left">从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
<td align="left">从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：<code>SELECT SUBSTRING(&quot;RUNOOB&quot;, 2, 3) AS ExtractString; -- UNO</code></td>
</tr>
<tr>
<td align="center">SUBSTRING_INDEX(s, delimiter, number)</td>
<td align="left">返回从字符串 s 的第 number 个出现的分隔符 delimiter 之后的子串。 如果 number 是正数，返回第 number 个字符左边的字符串。 如果 number 是负数，返回第(number 的绝对值(从右边数))个字符右边的字符串。</td>
<td align="left"><code>SELECT SUBSTRING_INDEX(&#39;a*b&#39;,&#39;*&#39;,1) -- a SELECT SUBSTRING_INDEX(&#39;a*b&#39;,&#39;*&#39;,-1)  -- b SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(&#39;a*b*c*d*e&#39;,&#39;*&#39;,3),&#39;*&#39;,-1)  -- c</code></td>
</tr>
<tr>
<td align="center">TRIM(s)</td>
<td align="left">去掉字符串 s 开始和结尾处的空格</td>
<td align="left">去掉字符串 RUNOOB 的首尾空格：<code>SELECT TRIM(&#39;    RUNOOB    &#39;) AS TrimmedString;</code></td>
</tr>
<tr>
<td align="center">UCASE(s)</td>
<td align="left">将字符串转换为大写</td>
<td align="left">将字符串 runoob 转换为大写：<code>SELECT UCASE(&quot;runoob&quot;); -- RUNOOB</code></td>
</tr>
<tr>
<td align="center">UPPER(s)</td>
<td align="left">将字符串转换为大写</td>
<td align="left">将字符串 runoob 转换为大写：<code>SELECT UPPER(&quot;runoob&quot;); -- RUNOOB</code></td>
</tr>
</tbody></table>
<hr>
<h1 id="MySQL-数字函数"><a href="#MySQL-数字函数" class="headerlink" title="MySQL 数字函数"></a>MySQL 数字函数</h1><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ABS(x)</td>
<td align="left">返回 x 的绝对值</td>
<td align="left">返回 -1 的绝对值：<code>SELECT ABS(-1) -- 返回1</code></td>
</tr>
<tr>
<td align="left">ACOS(x)</td>
<td align="left">求 x 的反余弦值(参数是弧度)</td>
<td align="left"><code>SELECT ACOS(0.25);</code></td>
</tr>
<tr>
<td align="left">ASIN(x)</td>
<td align="left">求反正弦值(参数是弧度)</td>
<td align="left"><code>SELECT ASIN(0.25);</code></td>
</tr>
<tr>
<td align="left">ATAN(x)</td>
<td align="left">求反正切值(参数是弧度)</td>
<td align="left"><code>SELECT ATAN(2.5);</code></td>
</tr>
<tr>
<td align="left">ATAN2(n, m)</td>
<td align="left">求反正切值(参数是弧度)</td>
<td align="left"><code>SELECT ATAN2(-0.8, 2);</code></td>
</tr>
<tr>
<td align="left">AVG(expression)</td>
<td align="left">返回一个表达式的平均值，expression 是一个字段</td>
<td align="left">返回 Products 表中Price 字段的平均值：<code>SELECT AVG(Price) AS AveragePrice FROM Products;</code></td>
</tr>
<tr>
<td align="left">CEIL(x)</td>
<td align="left">返回大于或等于 x 的最小整数</td>
<td align="left"><code>SELECT CEIL(1.5) -- 返回2</code></td>
</tr>
<tr>
<td align="left">CEILING(x)</td>
<td align="left">返回大于或等于 x 的最小整数</td>
<td align="left"><code>SELECT CEILING(1.5); -- 返回2</code></td>
</tr>
<tr>
<td align="left">COS(x)</td>
<td align="left">求余弦值(参数是弧度)</td>
<td align="left"><code>SELECT COS(2);</code></td>
</tr>
<tr>
<td align="left">COT(x)</td>
<td align="left">求余切值(参数是弧度)</td>
<td align="left"><code>SELECT COT(6);</code></td>
</tr>
<tr>
<td align="left">COUNT(expression)</td>
<td align="left">返回查询的记录总数，expression 参数是一个字段或者 * 号</td>
<td align="left">返回 Products 表中 products 字段总共有多少条记录：<code>SELECT COUNT(ProductID) AS NumberOfProducts FROM Products;</code></td>
</tr>
<tr>
<td align="left">DEGREES(x)</td>
<td align="left">将弧度转换为角度</td>
<td align="left"><code>SELECT DEGREES(3.1415926535898) -- 180</code></td>
</tr>
<tr>
<td align="left">n DIV m</td>
<td align="left">整除，n 为被除数，m 为除数</td>
<td align="left">计算 10 除于 5：<code>SELECT 10 DIV 5;  -- 2</code></td>
</tr>
<tr>
<td align="left">EXP(x)</td>
<td align="left">返回 e 的 x 次方</td>
<td align="left">计算 e 的三次方：<code>SELECT EXP(3) -- 20.085536923188</code></td>
</tr>
<tr>
<td align="left">FLOOR(x)</td>
<td align="left">返回小于或等于 x 的最大整数</td>
<td align="left">小于或等于 1.5 的整数：<code>SELECT FLOOR(1.5) -- 返回1</code></td>
</tr>
<tr>
<td align="left">GREATEST(expr1, expr2, expr3, …)</td>
<td align="left">返回列表中的最大值</td>
<td align="left">返回以下数字列表中的最大值：<code>SELECT GREATEST(3, 12, 34, 8, 25); -- 34</code>返回以下字符串列表中的最大值：<code>SELECT GREATEST(&quot;Google&quot;, &quot;Runoob&quot;, &quot;Apple&quot;);   -- Runoob</code></td>
</tr>
<tr>
<td align="left">LEAST(expr1, expr2, expr3, …)</td>
<td align="left">返回列表中的最小值</td>
<td align="left">返回以下数字列表中的最小值：<code>SELECT LEAST(3, 12, 34, 8, 25); -- 3</code>返回以下字符串列表中的最小值：<code>SELECT LEAST(&quot;Google&quot;, &quot;Runoob&quot;, &quot;Apple&quot;);   -- Apple</code></td>
</tr>
<tr>
<td align="left">LN</td>
<td align="left">返回数字的自然对数，以 e 为底。</td>
<td align="left">返回 2 的自然对数：<code>SELECT LN(2);  -- 0.6931471805599453</code></td>
</tr>
<tr>
<td align="left">LOG(x) 或 LOG(base, x)</td>
<td align="left">返回自然对数(以 e 为底的对数)，如果带有 base 参数，则 base 为指定带底数。</td>
<td align="left"><code>SELECT LOG(20.085536923188) -- 3 SELECT LOG(2, 4); -- 2</code></td>
</tr>
<tr>
<td align="left">LOG10(x)</td>
<td align="left">返回以 10 为底的对数</td>
<td align="left"><code>SELECT LOG10(100) -- 2</code></td>
</tr>
<tr>
<td align="left">LOG2(x)</td>
<td align="left">返回以 2 为底的对数</td>
<td align="left">返回以 2 为底 6 的对数：<code>SELECT LOG2(6);  -- 2.584962500721156</code></td>
</tr>
<tr>
<td align="left">MAX(expression)</td>
<td align="left">返回字段 expression 中的最大值</td>
<td align="left">返回数据表 Products 中字段 Price 的最大值：<code>SELECT MAX(Price) AS LargestPrice FROM Products;</code></td>
</tr>
<tr>
<td align="left">MIN(expression)</td>
<td align="left">返回字段 expression 中的最小值</td>
<td align="left">返回数据表 Products 中字段 Price 的最小值：<code>SELECT MIN(Price) AS MinPrice FROM Products;</code></td>
</tr>
<tr>
<td align="left">MOD(x,y)</td>
<td align="left">返回 x 除以 y 以后的余数</td>
<td align="left">5 除于 2 的余数：<code>SELECT MOD(5,2) -- 1</code></td>
</tr>
<tr>
<td align="left">PI()</td>
<td align="left">返回圆周率(3.141593）</td>
<td align="left"><code>SELECT PI() --3.141593</code></td>
</tr>
<tr>
<td align="left">POW(x,y)</td>
<td align="left">返回 x 的 y 次方</td>
<td align="left">2 的 3 次方：<code>SELECT POW(2,3) -- 8</code></td>
</tr>
<tr>
<td align="left">POWER(x,y)</td>
<td align="left">返回 x 的 y 次方</td>
<td align="left">2 的 3 次方：<code>SELECT POWER(2,3) -- 8</code></td>
</tr>
<tr>
<td align="left">RADIANS(x)</td>
<td align="left">将角度转换为弧度</td>
<td align="left">180 度转换为弧度：<code>SELECT RADIANS(180) -- 3.1415926535898</code></td>
</tr>
<tr>
<td align="left">RAND()</td>
<td align="left">返回 0 到 1 的随机数</td>
<td align="left"><code>SELECT RAND() --0.93099315644334</code></td>
</tr>
<tr>
<td align="left">ROUND(x)</td>
<td align="left">返回离 x 最近的整数</td>
<td align="left"><code>SELECT ROUND(1.23456) --1</code></td>
</tr>
<tr>
<td align="left">SIGN(x)</td>
<td align="left">返回 x 的符号，x 是负数、0、正数分别返回 -1、0 和 1</td>
<td align="left"><code>SELECT SIGN(-10) -- (-1)</code></td>
</tr>
<tr>
<td align="left">SIN(x)</td>
<td align="left">求正弦值(参数是弧度)</td>
<td align="left"><code>SELECT SIN(RADIANS(30)) -- 0.5</code></td>
</tr>
<tr>
<td align="left">SQRT(x)</td>
<td align="left">返回x的平方根</td>
<td align="left">25 的平方根：<code>SELECT SQRT(25) -- 5</code></td>
</tr>
<tr>
<td align="left">SUM(expression)</td>
<td align="left">返回指定字段的总和</td>
<td align="left">计算 OrderDetails 表中字段 Quantity 的总和：<code>SELECT SUM(Quantity) AS TotalItemsOrdered FROM OrderDetails;</code></td>
</tr>
<tr>
<td align="left">TAN(x)</td>
<td align="left">求正切值(参数是弧度)</td>
<td align="left"><code>SELECT TAN(1.75);  -- -5.52037992250933</code></td>
</tr>
<tr>
<td align="left">TRUNCATE(x,y)</td>
<td align="left">返回数值 x 保留到小数点后 y 位的值（与 ROUND 最大的区别是不会进行四舍五入）</td>
<td align="left"><code>SELECT TRUNCATE(1.23456,3) -- 1.234</code></td>
</tr>
</tbody></table>
<hr>
<h1 id="MySQL-日期函数"><a href="#MySQL-日期函数" class="headerlink" title="MySQL 日期函数"></a>MySQL 日期函数</h1><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ADDDATE(d, n)</td>
<td align="left">计算起始日期 d 加上 n 天的日期</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">ADDTIME(t,n)</td>
<td align="left">n 是一个时间表达式，时间 t 加上时间表达式 n</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">CURDATE()</td>
<td align="left">返回当前日期</td>
<td align="left"><code>SELECT CURDATE(); -&gt; 2018-09-19</code></td>
</tr>
<tr>
<td align="left">CURRENT_DATE()</td>
<td align="left">返回当前日期</td>
<td align="left"><code>SELECT CURRENT_DATE(); -&gt; 2018-09-19</code></td>
</tr>
<tr>
<td align="left">CURRENT_TIME</td>
<td align="left">返回当前时间</td>
<td align="left"><code>SELECT CURRENT_TIME(); -&gt; 19:59:02</code></td>
</tr>
<tr>
<td align="left">CURRENT_TIMESTAMP()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT CURRENT_TIMESTAMP() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">CURTIME()</td>
<td align="left">返回当前时间</td>
<td align="left"><code>SELECT CURTIME(); -&gt; 19:59:02</code></td>
</tr>
<tr>
<td align="left">DATE()</td>
<td align="left">从日期或日期时间表达式中提取日期值</td>
<td align="left"><code>SELECT DATE(&quot;2017-06-15&quot;);     -&gt; 2017-06-15</code></td>
</tr>
<tr>
<td align="left">DATEDIFF(d1,d2)</td>
<td align="left">计算日期 d1-&gt;d2 之间相隔的天数</td>
<td align="left"><code>SELECT DATEDIFF(&#39;2001-01-01&#39;,&#39;2001-02-02&#39;) -&gt; -32</code></td>
</tr>
<tr>
<td align="left">DATE_ADD(d，INTERVAL expr type)</td>
<td align="left">计算起始日期 d 加上一个时间段后的日期，type 值可以是：{SECOND | MINUTE | HOUR | DAY | WEEK | MONTH | YEAR | …}</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">DATE_FORMAT(d,f)</td>
<td align="left">按表达式f的要求显示日期d</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">DATE_SUB(date,INTERVAL expr type)</td>
<td align="left">函数从日期减去指定的时间间隔。</td>
<td align="left">Orders 表中 OrderDate 字段减去 2 天：<code>SELECT OrderId,DATE_SUB(OrderDate,INTERVAL 2 DAY) AS OrderPayDate FROM Orders</code></td>
</tr>
<tr>
<td align="left">DAY(d)</td>
<td align="left">返回日期值 d 的日期部分</td>
<td align="left"><code>SELECT DAY(&quot;2017-06-15&quot;);   -&gt; 15</code></td>
</tr>
<tr>
<td align="left">DAYNAME(d)</td>
<td align="left">返回日期 d 是星期几，如 Monday,Tuesday</td>
<td align="left"><code>SELECT DAYNAME(&#39;2011-11-11 11:11:11&#39;) -&gt;Friday</code></td>
</tr>
<tr>
<td align="left">DAYOFMONTH(d)</td>
<td align="left">计算日期 d 是本月的第几天</td>
<td align="left"><code>SELECT DAYOFMONTH(&#39;2011-11-11 11:11:11&#39;) -&gt;11</code></td>
</tr>
<tr>
<td align="left">DAYOFWEEK(d)</td>
<td align="left">日期 d 今天是星期几，1 星期日，2 星期一，以此类推</td>
<td align="left"><code>SELECT DAYOFWEEK(&#39;2011-11-11 11:11:11&#39;) -&gt;6</code></td>
</tr>
<tr>
<td align="left">DAYOFYEAR(d)</td>
<td align="left">计算日期 d 是本年的第几天</td>
<td align="left"><code>SELECT DAYOFYEAR(&#39;2011-11-11 11:11:11&#39;) -&gt;315</code></td>
</tr>
<tr>
<td align="left">EXTRACT(type FROM d)</td>
<td align="left">从日期 d 中获取指定的值，type 指定返回的值。 type可取值为： 见下文</td>
<td align="left"><code>SELECT EXTRACT(MINUTE FROM &#39;2011-11-11 11:11:11&#39;)  -&gt; 11</code></td>
</tr>
<tr>
<td align="left">FROM_DAYS(n)</td>
<td align="left">计算从 0000 年 1 月 1 日开始 n 天后的日期</td>
<td align="left"><code>SELECT FROM_DAYS(1111) -&gt; 0003-01-16</code></td>
</tr>
<tr>
<td align="left">HOUR(t)</td>
<td align="left">返回 t 中的小时值</td>
<td align="left"><code>SELECT HOUR(&#39;1:2:3&#39;) -&gt; 1</code></td>
</tr>
<tr>
<td align="left">LAST_DAY(d)</td>
<td align="left">返回给给定日期的那一月份的最后一天</td>
<td align="left"><code>SELECT LAST_DAY(&quot;2017-06-20&quot;); -&gt; 2017-06-30</code></td>
</tr>
<tr>
<td align="left">LOCALTIME()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT LOCALTIME() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">LOCALTIMESTAMP()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT LOCALTIMESTAMP() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">MAKEDATE(year, day-of-year)</td>
<td align="left">基于给定参数年份 year 和所在年中的天数序号 day-of-year 返回一个日期</td>
<td align="left"><code>SELECT MAKEDATE(2017, 3); -&gt; 2017-01-03</code></td>
</tr>
<tr>
<td align="left">MAKETIME(hour, minute, second)</td>
<td align="left">组合时间，参数分别为小时、分钟、秒</td>
<td align="left"><code>SELECT MAKETIME(11, 35, 4); -&gt; 11:35:04</code></td>
</tr>
<tr>
<td align="left">MICROSECOND(date)</td>
<td align="left">返回日期参数所对应的微秒数</td>
<td align="left"><code>SELECT MICROSECOND(&quot;2017-06-20 09:34:00.000023&quot;); -&gt; 23</code></td>
</tr>
<tr>
<td align="left">MINUTE(t)</td>
<td align="left">返回 t 中的分钟值</td>
<td align="left"><code>SELECT MINUTE(&#39;1:2:3&#39;) -&gt; 2</code></td>
</tr>
<tr>
<td align="left">MONTHNAME(d)</td>
<td align="left">返回日期当中的月份名称，如 November</td>
<td align="left"><code>SELECT MONTHNAME(&#39;2011-11-11 11:11:11&#39;) -&gt; November</code></td>
</tr>
<tr>
<td align="left">MONTH(d)</td>
<td align="left">返回日期d中的月份值，1 到 12</td>
<td align="left"><code>SELECT MONTH(&#39;2011-11-11 11:11:11&#39;) -&gt;11</code></td>
</tr>
<tr>
<td align="left">NOW()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT NOW() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">PERIOD_ADD(period, number)</td>
<td align="left">为 年-月 组合日期添加一个时段</td>
<td align="left"><code>SELECT PERIOD_ADD(201703, 5);    -&gt; 201708</code></td>
</tr>
<tr>
<td align="left">PERIOD_DIFF(period1, period2)</td>
<td align="left">返回两个时段之间的月份差值</td>
<td align="left"><code>SELECT PERIOD_DIFF(201710, 201703); -&gt; 7</code></td>
</tr>
<tr>
<td align="left">QUARTER(d)</td>
<td align="left">返回日期d是第几季节，返回 1 到 4</td>
<td align="left"><code>SELECT QUARTER(&#39;2011-11-11 11:11:11&#39;) -&gt; 4</code></td>
</tr>
<tr>
<td align="left">SECOND(t)</td>
<td align="left">返回 t 中的秒钟值</td>
<td align="left"><code>SELECT SECOND(&#39;1:2:3&#39;) -&gt; 3</code></td>
</tr>
<tr>
<td align="left">SEC_TO_TIME(s)</td>
<td align="left">将以秒为单位的时间 s 转换为时分秒的格式</td>
<td align="left"><code>SELECT SEC_TO_TIME(4320) -&gt; 01:12:00</code></td>
</tr>
<tr>
<td align="left">STR_TO_DATE(string, format_mask)</td>
<td align="left">将字符串转变为日期</td>
<td align="left"><code>SELECT STR_TO_DATE(&quot;August 10 2017&quot;, &quot;%M %d %Y&quot;); -&gt; 2017-08-10</code></td>
</tr>
<tr>
<td align="left">SUBDATE(d,n)</td>
<td align="left">日期 d 减去 n 天后的日期</td>
<td align="left"><code>SELECT SUBDATE(&#39;2011-11-11 11:11:11&#39;, 1) -&gt;2011-11-10 11:11:11 (默认是天)</code></td>
</tr>
<tr>
<td align="left">SUBTIME(t,n)</td>
<td align="left">时间 t 减去 n 秒的时间</td>
<td align="left"><code>SELECT SUBTIME(&#39;2011-11-11 11:11:11&#39;, 5) -&gt;2011-11-11 11:11:06 (秒)</code></td>
</tr>
<tr>
<td align="left">SYSDATE()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT SYSDATE() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">TIME(expression)</td>
<td align="left">提取传入表达式的时间部分</td>
<td align="left"><code>SELECT TIME(&quot;19:30:10&quot;); -&gt; 19:30:10</code></td>
</tr>
<tr>
<td align="left">TIME_FORMAT(t,f)</td>
<td align="left">按表达式 f 的要求显示时间 t</td>
<td align="left"><code>SELECT TIME_FORMAT(&#39;11:11:11&#39;,&#39;%r&#39;) 11:11:11 AM</code></td>
</tr>
<tr>
<td align="left">TIME_TO_SEC(t)</td>
<td align="left">将时间 t 转换为秒</td>
<td align="left"><code>SELECT TIME_TO_SEC(&#39;1:12:00&#39;) -&gt; 4320</code></td>
</tr>
<tr>
<td align="left">TIMEDIFF(time1, time2)</td>
<td align="left">计算时间差值</td>
<td align="left"><code>SELECT TIMEDIFF(&quot;13:10:11&quot;, &quot;13:10:10&quot;); -&gt; 00:00:01</code></td>
</tr>
<tr>
<td align="left">TIMESTAMP(expression, interval)</td>
<td align="left">单个参数时，函数返回日期或日期时间表达式；有2个参数时，将参数加和</td>
<td align="left"><code>SELECT TIMESTAMP(&quot;2017-07-23&quot;,  &quot;13:10:11&quot;); -&gt; 2017-07-23 13:10:11</code></td>
</tr>
<tr>
<td align="left">TO_DAYS(d)</td>
<td align="left">计算日期 d 距离 0000 年 1 月 1 日的天数</td>
<td align="left"><code>SELECT TO_DAYS(&#39;0001-01-01 01:01:01&#39;) -&gt; 366</code></td>
</tr>
<tr>
<td align="left">WEEK(d)</td>
<td align="left">计算日期 d 是本年的第几个星期，范围是 0 到 53</td>
<td align="left"><code>SELECT WEEK(&#39;2011-11-11 11:11:11&#39;) -&gt; 45</code></td>
</tr>
<tr>
<td align="left">WEEKDAY(d)</td>
<td align="left">日期 d 是星期几，0 表示星期一，1 表示星期二</td>
<td align="left"><code>SELECT WEEKDAY(&quot;2017-06-15&quot;); -&gt; 3</code></td>
</tr>
<tr>
<td align="left">WEEKOFYEAR(d)</td>
<td align="left">计算日期 d 是本年的第几个星期，范围是 0 到 53</td>
<td align="left"><code>SELECT WEEKOFYEAR(&#39;2011-11-11 11:11:11&#39;) -&gt; 45</code></td>
</tr>
<tr>
<td align="left">YEAR(d)</td>
<td align="left">返回年份</td>
<td align="left"><code>SELECT YEAR(&quot;2017-06-15&quot;); -&gt; 2017</code></td>
</tr>
<tr>
<td align="left">YEARWEEK(date, [mode])</td>
<td align="left">返回年份及第几周（0到53，1年共54周），mode为0表示一周从周日开始，为1表示一周从周一开始，以此类推，</td>
<td align="left"><code>SELECT YEARWEEK(&quot;2017-06-15&quot;); -&gt; 201724</code>    表示：2017-06-15属于2017年第24周)</td>
</tr>
</tbody></table>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><ul>
<li>  <strong>adddate( d, n )</strong></li>
<li>  <strong>addtime( t, n )</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT ADDDATE(&quot;2017-06-15&quot;, INTERVAL 10 DAY); </span><br><span class="line">-&gt;2017-06-25</span><br><span class="line"></span><br><span class="line"># 加 5 秒：</span><br><span class="line">SELECT ADDTIME(&#x27;2011-11-11 11:11:11&#x27;, 5); </span><br><span class="line">-&gt;2011-11-11 11:11:16 (秒)</span><br><span class="line"></span><br><span class="line"># 加 2 小时, 10 分钟, 5 秒:</span><br><span class="line">SELECT ADDTIME(&quot;2020-06-15 09:34:21&quot;, &quot;2:10:5&quot;);  </span><br><span class="line">-&gt; 2020-06-15 11:44:26</span><br></pre></td></tr></table></figure>





<ul>
<li>  <strong>date_add( d，INTERVAL expr type)</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_ADD(&quot;2017-06-15&quot;, INTERVAL 10 DAY); </span><br><span class="line">-&gt; 2017-06-25</span><br><span class="line"></span><br><span class="line">SELECT DATE_ADD(&quot;2017-06-15 09:34:21&quot;, INTERVAL 15 MINUTE);</span><br><span class="line">-&gt; 2017-06-15 09:49:21</span><br><span class="line"></span><br><span class="line">SELECT DATE_ADD(&quot;2017-06-15 09:34:21&quot;, INTERVAL -3 HOUR);</span><br><span class="line">-&gt;2017-06-15 06:34:21</span><br><span class="line"></span><br><span class="line">SELECT DATE_ADD(&quot;2017-06-15 09:34:21&quot;, INTERVAL -3 HOUR);</span><br><span class="line">-&gt;2017-04-15</span><br></pre></td></tr></table></figure>



<ul>
<li>  <strong>date_format( d, f )</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_FORMAT(&#x27;2011-11-11 11:11:11&#x27;,&#x27;%Y-%m-%d %r&#x27;) </span><br><span class="line">-&gt; 2011-11-11 11:11:11 AM</span><br></pre></td></tr></table></figure>





<hr>
<h1 id="MySQL-高级函数"><a href="#MySQL-高级函数" class="headerlink" title="MySQL 高级函数"></a>MySQL 高级函数</h1><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIN(x)</td>
<td align="left">返回 x 的二进制编码</td>
<td align="left">15 的 2 进制编码:<code>SELECT BIN(15); -- 1111</code></td>
</tr>
<tr>
<td align="left">BINARY(s)</td>
<td align="left">将字符串 s 转换为二进制字符串</td>
<td align="left"><code>SELECT BINARY &quot;RUNOOB&quot;; -&gt; RUNOOB</code></td>
</tr>
<tr>
<td align="left"><code>CASE expression    WHEN condition1 THEN result1    WHEN condition2 THEN result2   ...    WHEN conditionN THEN resultN    ELSE result END</code></td>
<td align="left">CASE 表示函数开始，END 表示函数结束。如果 condition1 成立，则返回 result1, 如果 condition2 成立，则返回 result2，当全部不成立则返回 result，而当有一个成立之后，后面的就不执行了。</td>
<td align="left"><code>SELECT CASE  　WHEN 1 &gt; 0 　THEN &#39;1 &gt; 0&#39; 　WHEN 2 &gt; 0 　THEN &#39;2 &gt; 0&#39; 　ELSE &#39;3 &gt; 0&#39; 　END -&gt;1 &gt; 0</code></td>
</tr>
<tr>
<td align="left">CAST(x AS type)</td>
<td align="left">转换数据类型</td>
<td align="left">字符串日期转换为日期：<code>SELECT CAST(&quot;2017-08-29&quot; AS DATE); -&gt; 2017-08-29</code></td>
</tr>
<tr>
<td align="left">COALESCE(expr1, expr2, …., expr_n)</td>
<td align="left">返回参数中的第一个非空表达式（从左向右）</td>
<td align="left"><code>SELECT COALESCE(NULL, NULL, NULL, &#39;runoob.com&#39;, NULL, &#39;google.com&#39;); -&gt; runoob.com</code></td>
</tr>
<tr>
<td align="left">CONNECTION_ID()</td>
<td align="left">返回唯一的连接 ID</td>
<td align="left"><code>SELECT CONNECTION_ID(); -&gt; 4292835</code></td>
</tr>
<tr>
<td align="left">CONV(x,f1,f2)</td>
<td align="left">返回 f1 进制数变成 f2 进制数</td>
<td align="left"><code>SELECT CONV(15, 10, 2); -&gt; 1111</code></td>
</tr>
<tr>
<td align="left">CONVERT(s USING cs)</td>
<td align="left">函数将字符串 s 的字符集变成 cs</td>
<td align="left"><code>SELECT CHARSET(&#39;ABC&#39;) -&gt;utf-8     SELECT CHARSET(CONVERT(&#39;ABC&#39; USING gbk)) -&gt;gbk</code></td>
</tr>
<tr>
<td align="left">CURRENT_USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT CURRENT_USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">DATABASE()</td>
<td align="left">返回当前数据库名</td>
<td align="left"><code>SELECT DATABASE();    -&gt; runoob</code></td>
</tr>
<tr>
<td align="left">IF(expr,v1,v2)</td>
<td align="left">如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</td>
<td align="left"><code>SELECT IF(1 &gt; 0,&#39;正确&#39;,&#39;错误&#39;)     -&gt;正确</code></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-func-ifnull.html">IFNULL(v1,v2)</a></td>
<td align="left">如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</td>
<td align="left"><code>SELECT IFNULL(null,&#39;Hello Word&#39;) -&gt;Hello Word</code></td>
</tr>
<tr>
<td align="left">ISNULL(expression)</td>
<td align="left">判断表达式是否为 NULL</td>
<td align="left"><code>SELECT ISNULL(NULL); -&gt;1</code></td>
</tr>
<tr>
<td align="left">LAST_INSERT_ID()</td>
<td align="left">返回最近生成的 AUTO_INCREMENT 值</td>
<td align="left"><code>SELECT LAST_INSERT_ID(); -&gt;6</code></td>
</tr>
<tr>
<td align="left">NULLIF(expr1, expr2)</td>
<td align="left">比较两个字符串，如果字符串 expr1 与 expr2 相等 返回 NULL，否则返回 expr1</td>
<td align="left"><code>SELECT NULLIF(25, 25); -&gt;</code></td>
</tr>
<tr>
<td align="left">SESSION_USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT SESSION_USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">SYSTEM_USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT SYSTEM_USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">VERSION()</td>
<td align="left">返回数据库的版本号</td>
<td align="left"><code>SELECT VERSION() -&gt; 5.6.34</code></td>
</tr>
</tbody></table>
<h2 id><a href="#" class="headerlink" title></a></h2><h1 id="CONCANT-函数"><a href="#CONCANT-函数" class="headerlink" title="CONCANT()  函数"></a>CONCANT()  函数</h1><blockquote>
<p>使用方法</p>
</blockquote>
<p><code>CONCANT(str1, str2, str3, ...)</code></p>
<blockquote>
<p>注意事项</p>
</blockquote>
<ul>
<li><strong>返回结果为多个参数拼接产生的字符串。如果有任何一个参数为NULL ，则返回值为 NULL。</strong></li>
</ul>
<blockquote>
<p>错误示例：</p>
</blockquote>
<p>场景：</p>
<p>需求是省市区三级联查，</p>
<ul>
<li>前端页面中有省、市、区三个字段；</li>
<li>数据库中也有省、市、区三个字段；</li>
<li>但是为了节省数据库性能，前端传递给后端的是一个省市区拼接起来的字符串记为 str1，后端也会把数据库中的省市区三个字段拼接起来记为 str2；</li>
<li>然后用 str1 和 str2 进行模糊查询，得到查询结果！</li>
</ul>
<p>错误代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">  1</span><br><span class="line">FROM</span><br><span class="line">  shop</span><br><span class="line">WHERE</span><br><span class="line">  CONCAT(`province`,`city`,`district`) </span><br><span class="line">LIKE </span><br><span class="line">  CONCAT(&#x27;%&#x27;, #&#123;place&#125;, &#x27;%&#x27;);</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">-- 分析</span><br><span class="line">在上面的SQL中，`province`，`city`，`istrict` 是 shop 表中的3个字段，现在想把这3个字段拼接成1个字符串str2；</span><br><span class="line">#&#123;place&#125; 是前端传来的拼接好的字符串str1；</span><br><span class="line">按照原理来说，根据 str1 和 str2 进行模糊查询，就能得到我们想要的数据了。 	但在实际测试时，发现部分数据获取不到，查看数据库表时，发现数据其实是存在的！</span><br></pre></td></tr></table></figure>

<p>错误原因：</p>
<ul>
<li>在仔细分析了数据库中的数据后，我们发现数据库中的数据存在一些问题。其中有一部分数据的省、市、区字段是不全的。即部分数据只有省的字段，而没有市和区的字段，这时SQL在执行省市区字段的拼接操作 <code>CONCAT(province, city, district)</code> 时因为市和区的字段为 null，所以拼接得到的结果还是 null。</li>
<li>即最后执行的SQL是 <code>NULL LIKE CONCAT(&#39;%&#39;, #&#123;place&#125;, &#39;%&#39;)</code>，显然这是得不到任何结果的。</li>
</ul>
<p>修改：</p>
<ul>
<li>找到了原因后，只要对每个要拼接的字段加上<code>IFNULL()</code>判断即可解决问题！</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">  1</span><br><span class="line">FROM</span><br><span class="line">  shop</span><br><span class="line">WHERE </span><br><span class="line">  CONCAT(IFNULL(`province`, &quot;&quot;), IFNULL(`city`, &quot;&quot;), IFNULL(`district`, &quot;&quot;)) </span><br><span class="line">LIKE </span><br><span class="line">  CONCAT(&#x27;%&#x27;, #&#123;place&#125;, &#x27;%&#x27;) </span><br></pre></td></tr></table></figure>

<hr>
<h1 id="IF-、IFNULL-、ISNULL-函数"><a href="#IF-、IFNULL-、ISNULL-函数" class="headerlink" title="IF()、IFNULL()、ISNULL() 函数"></a>IF()、IFNULL()、ISNULL() 函数</h1><table>
<thead>
<tr>
<th>表达式</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>IF(expr,v1,v2)</code></td>
<td>如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</td>
<td>SELECT IF(1&gt;0, “正确”, “错误”)<br>-&gt; 正确</td>
</tr>
<tr>
<td><code>IFNULL(v1,v2)</code></td>
<td>如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</td>
<td>SELECT IFNULL(null, ‘Hello Word’) <br>-&gt;Hello Word</td>
</tr>
<tr>
<td><code>ISNULL(expression)</code></td>
<td>判断表达式是否为 NULL，如果为NULL返回值为 1，否则返回值为 0</td>
<td>SELECT ISNULL(NULL)<br> -&gt;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><code>if()</code> 函数就类似与 Java 中的三元表达式</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/07/SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/07/SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/" class="post-title-link" itemprop="url">SpringBoot与检索</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-07 10:03:22" itemprop="dateCreated datePublished" datetime="2021-03-07T10:03:22+08:00">2021-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-09-09 11:58:09" itemprop="dateModified" datetime="2021-09-09T11:58:09+08:00">2021-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="初步检索"><a href="#初步检索" class="headerlink" title="初步检索"></a>初步检索</h1><p>ES 作为 一个 存储、分析、和检索的引擎</p>
<p>对 ES 的所有操作都封装成了一个 RestAPI ，即 发送请求即可</p>
<h2 id="1、-cat"><a href="#1、-cat" class="headerlink" title="1、_cat"></a>1、_cat</h2><blockquote>
<p>查询 ES 的节点信息</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET/_cat/nodes			查看 ES 上的所有节点</span><br><span class="line">GET/_cat/health			查看 ES 节点的健康状况</span><br><span class="line">GET/_cat/master			查看 ES 的主节点信息</span><br><span class="line">GET/_cat/indices		查看 ES 上的所有索引</span><br><span class="line">GET/_cat/nodes			查看 ES 上的所有节点</span><br></pre></td></tr></table></figure>



<h2 id="2、索引一个文档（保存）"><a href="#2、索引一个文档（保存）" class="headerlink" title="2、索引一个文档（保存）"></a>2、索引一个文档（保存）</h2><p>要做的事：保存一个数据。保存在哪个索引的哪个类型下？指定用哪个唯一标识？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在 customer 索引下的 external 类型下保存1号数据为：</span><br><span class="line">PUT /customer/external/1</span><br></pre></td></tr></table></figure>

<p>返回响应分析</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;customer&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;external&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">_xxx	称之为 元数据 ，反映了当前的一些基本信息</span><br><span class="line">	_index		当前数据在哪个索引下</span><br><span class="line">	_type		当前数据在哪个类型下</span><br><span class="line">	_id			当前数据的唯一标识（主键）</span><br><span class="line">	_version		当前数据的版本号</span><br><span class="line">	_shards		当前数据在哪个索引下</span><br><span class="line">	_seq_no		当前数据在哪个索引下</span><br><span class="line">	_primary_term		当前数据在哪个索引下</span><br><span class="line">resulted	请求执行的结果	</span><br><span class="line">	created		新建</span><br><span class="line">	updated		更新</span><br><span class="line">	noop		没有做任何操作（no operation）</span><br><span class="line">	deleted		删除成功</span><br><span class="line">_shards	分片（用于集群，单机不生效）</span><br></pre></td></tr></table></figure>

<p>PUT 形式带id的保存，发送多次是一个更新操作。</p>
<p>PUT 和 POST 都可以保存</p>
<p>【不带ID或 指定索引中不存在的ID  】POST 新增，如果 不指定ID，会自动生成ID。【ID是随机生成不重复的字符串，所以如果不指定ID 的话，每次一定都是新增操作】</p>
<p>指定ID就会覆盖默认的ID，并新增版本号【指定ID，并且ID之前在索引中就存在， 也就相当于更新操作】</p>
<p>PUT 可以新增可以更新，PUT 必须手动指定ID，由于PUT需要指定ID，我们一般都用来做修改操作，不指定ID会报错！      </p>
<h2 id="3、查询文档"><a href="#3、查询文档" class="headerlink" title="3、查询文档"></a>3、查询文档</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /customer/external/1</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;customer&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;external&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">_source		查询到的数据主体</span><br><span class="line">_seq_no		<span class="comment">// 并发控制字段，每次 更新就会+1，用来做乐观锁</span></span><br><span class="line">_primary_term	<span class="comment">// 同上，主分片重新分配，如重启，就会变化</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">更新携带</span><br><span class="line">?if_seq_no=0&amp;if_primary_term=1</span><br></pre></td></tr></table></figure>





<h2 id="4、更新文档"><a href="#4、更新文档" class="headerlink" title="4、更新文档"></a>4、更新文档</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/<span class="number">1</span>/_update</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;new John Doe&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带上 _update 会对比索引中的源数据，如果发现两次更新的数据没有任何变化，就什么都不做！（即不会更新 _version、_seq_no、_primary_term 等） ！</span></span><br><span class="line"><span class="comment">// 而不带 _update 只是简单的覆盖源数据，而不会去判断是否更新了内容！</span></span><br><span class="line"></span><br><span class="line">POST /customer/external/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;new John Doe&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /customer/external/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;new John Doe&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不同，POST 操作会对比源文档数据，如果相同不会有什么操作，文档version不增加。</span><br><span class="line">PUT操作总会将数据重新保存并增加 version 版本</span><br><span class="line">	带 _update 对比源数据，如果一样就不进行任何操作。</span><br><span class="line">		看场景：</span><br><span class="line">			对于大并发更新，不带update</span><br><span class="line">			对于大并发查询偶尔更新，带update，对比更新，重新计算分配规则</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">更新同时增加 属性</span><br><span class="line">POST /customer/external/<span class="number">1</span>/_update</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;new John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">23</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST /customer/external/<span class="number">1</span>/</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;new John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span><span class="string">&quot;male&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /customer/external/<span class="number">1</span>/</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;new John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span><span class="string">&quot;male&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hoby&quot;</span><span class="punctuation">:</span><span class="string">&quot;ping-pong&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="5、删除文档-amp-索引"><a href="#5、删除文档-amp-索引" class="headerlink" title="5、删除文档 &amp; 索引"></a>5、删除文档 &amp; 索引</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> DELETE /customer/external/1		// 删除某个文档</span><br><span class="line"></span><br><span class="line">DELETE /customer		// 删除整个索引</span><br><span class="line"></span><br><span class="line">Tip：</span><br><span class="line">	不可以删除某个类型，即 DELETE /customer/external 是不合法的</span><br></pre></td></tr></table></figure>





<h2 id="bulk-批量-API"><a href="#bulk-批量-API" class="headerlink" title="bulk 批量 API"></a>bulk 批量 API</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;John Doe 1&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;John Doe 2&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">语法格式</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    action<span class="punctuation">:</span><span class="punctuation">&#123;</span>metadata<span class="punctuation">&#125;</span>\n</span><br><span class="line">	<span class="punctuation">&#123;</span>request body<span class="punctuation">&#125;</span>\n</span><br><span class="line"></span><br><span class="line">	action<span class="punctuation">:</span><span class="punctuation">&#123;</span>metadata<span class="punctuation">&#125;</span>\n</span><br><span class="line">	<span class="punctuation">&#123;</span>request body<span class="punctuation">&#125;</span>\n</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">每<span class="number">2</span>行是一个完整的动作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index 保存操作</span><br><span class="line"></span><br><span class="line">每一个操作都是独立存在的，上一个动作的失败不会影响下一个动作的执行！</span><br><span class="line"></span><br><span class="line">POST /_bulk</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blog&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;create&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;My First Blog post&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;My Second Blog post&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;update&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="number">123</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;My updated Blog post&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">ES 对于 json 数据格式有着非常严格的要求，包括什么时候换行都要符合标准，所以一定要按上述的格式来！</span><br><span class="line">执行的动作占一行，要进行操作的数据占一行（如果没有要进行操作的数据则没有第二行）！</span><br></pre></td></tr></table></figure>



<p>bulk API 以按此顺序执行所有的 action（动作）。如果一个单个的动作因任何原因失败，它将继续处理后面剩余的动作。</p>
<p>当 bulk API 返回时，它将提供每个 动作的状态（与发送的顺序相同），所以你可以检查是否一个指定的动作是不是失效了！</p>
<h2 id="样本测试数量"><a href="#样本测试数量" class="headerlink" title="样本测试数量"></a>样本测试数量</h2><p>样本描述：</p>
<p>这时一份顾客银行账户信息的虚构json文档样本，每个文档都有下列的scheme（模式）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;account_number&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;balance&quot;</span><span class="punctuation">:</span><span class="number">39225</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;firstname&quot;</span><span class="punctuation">:</span><span class="string">&quot;Amber&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duke&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;880 Holmes Lane&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;employer&quot;</span><span class="punctuation">:</span><span class="string">&quot;Pyrami&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;amberduke@pyrami.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="string">&quot;Brogan&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="string">&quot;IL&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>导入测试数据（ES官方提供的）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json">https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST bank/account/_bulk<span class="punctuation">&#123;</span></span><br><span class="line">	<span class="comment">// 测试数据</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<hr>
<h1 id="进阶检索"><a href="#进阶检索" class="headerlink" title="进阶检索"></a>进阶检索</h1><h2 id="1、SearchAPI"><a href="#1、SearchAPI" class="headerlink" title="1、SearchAPI"></a>1、SearchAPI</h2><p>ES 支持两种基本方式检索：</p>
<ol>
<li>通过使用 REST request URI 来发送搜索参数（URL + 检索参数）【将所有 的检索条件放在URL中】</li>
<li>另一个是通过使用 REST request body 来发送它们（URL + 请求体）</li>
</ol>
<ol>
<li><p>检索信息</p>
<ul>
<li><p>一切从 _search 开始</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>GET bank/_search</td>
<td>检索bank下的所有信息，包括 type 和 docs</td>
</tr>
<tr>
<td>GET bank/_search?q=*&amp;sort=account_number:asc</td>
<td>请求参数方式检索</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">响应结果解释<span class="punctuation">:</span></span><br><span class="line">took	执行搜索的时间</span><br><span class="line">timed_out	告诉我们搜索是否超时</span><br><span class="line">_shards		告诉我们多少个分片被搜索了，以及统计了成功/失败的搜索分片</span><br><span class="line">hits		搜索结果（命中的记录）</span><br><span class="line">hits.total.value	搜索结果的总记录数（共检索出了多少个结果）</span><br><span class="line">hits.hits	所有命中的记录展示。实际搜索的结果数组（默认展示前<span class="number">10</span>个文档）</span><br><span class="line">sort</span><br><span class="line">score 和 max_score	相关性得分和最高得分（全文检索用）</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">115</span><span class="punctuation">,</span>	</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bank&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;account&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;account_number&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;balance&quot;</span> <span class="punctuation">:</span> <span class="number">16623</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;firstname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Bradshaw&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;lastname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Mckenzie&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">29</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gender&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;F&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;address&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;244 Columbus Place&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;employer&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Euron&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;email&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bradshawmckenzie@euron.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;city&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Hobucken&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CO&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sort&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">0</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></li>
<li><p>URL + 请求体进行检索</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;account_number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;balance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 查询从10~19号数据，from10，size10</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	HTTP 客户端工具（Postman），GET 请求不能携带请求体，我们变为 POST 请求也是一样的。</span></span><br><span class="line"><span class="comment">	我们 POST 一个 JSON 风格的查询请求体到 _search API。</span></span><br><span class="line"><span class="comment">	需要了解，一旦搜索的结果给返回，ES 就完成了这次请求，并且不会维护任何服务端的资源或者结果的 cursor（游标）</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2、Query-DSL"><a href="#2、Query-DSL" class="headerlink" title="2、Query DSL"></a>2、Query DSL</h2><h3 id="1、基本语法格式"><a href="#1、基本语法格式" class="headerlink" title="1、基本语法格式"></a>1、基本语法格式</h3><p>ES 提供了一个可以执行查询的 Json 风格的 DSL（Domain-Specific Language 领域特定语言）。这个被称为 Query DSL。</p>
<ul>
<li> 一个查询语句的典型结构</li>
</ul>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    QUERY_NAME<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        argument <span class="punctuation">:</span> value<span class="punctuation">,</span></span><br><span class="line">        argument <span class="punctuation">:</span> value<span class="punctuation">,</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果是针对某个字段，那么他的结构如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    QUERY_NAME<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        field_name<span class="punctuation">&#123;</span></span><br><span class="line">            argument <span class="punctuation">:</span> value<span class="punctuation">,</span></span><br><span class="line">            argument <span class="punctuation">:</span> value<span class="punctuation">,</span></span><br><span class="line">            ......</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;balance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;balance&quot;</span><span class="punctuation">,</span> <span class="string">&quot;lastname&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">- query 定义如何查询</span><br><span class="line">- match_all	查询类型（代表查询所有的所有），ES 可以在 query 中组合非常多的查询类型完成复杂查询</span><br><span class="line">- 除了 query 参数之外，我们也可以传递其它的参数以改变查询的结果。如 sort、size 等</span><br><span class="line">- from + size 限定，完成分页功能</span><br><span class="line">- sort 排序，多字段排序，会在前序字段相等时后续字段内部外需，否则以前序为准</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2、返回部分字段"><a href="#2、返回部分字段" class="headerlink" title="2、返回部分字段"></a>2、返回部分字段</h3><p>通过 <code>_source</code>来限制</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;balance&quot;</span><span class="punctuation">,</span> <span class="string">&quot;lastname&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="3、match-【匹配查询】"><a href="#3、match-【匹配查询】" class="headerlink" title="3、match 【匹配查询】"></a>3、match 【匹配查询】</h3><ul>
<li><p>基本类型（非字符串），精确匹配</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;account_number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// match 返回 account_number=20 的记录</span></span><br></pre></td></tr></table></figure></li>
<li><p>字符串，全文检索</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kings&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">## 全文检索最终会按照评分进行排序，会对检索条件进行分词匹配</span><br></pre></td></tr></table></figure></li>
<li><p>字符串，多个单词（分词匹配  + 全文检索）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill road&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">## 最终查出 address 中包含 mill 或者 road 或者 mill road 的所有 记录，并给出相关性得分</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4、match-phrase【短语匹配】"><a href="#4、match-phrase【短语匹配】" class="headerlink" title="4、match_phrase【短语匹配】"></a>4、match_phrase【短语匹配】</h3><p>将需要匹配的值当成一个整体单词（不分词）进行检索</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill road&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## 命中 <span class="number">32</span> 条结果</span><br><span class="line"></span><br><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill road&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## 命中 <span class="number">1</span> 条结果</span><br><span class="line">## 查出 address 中包含 mill road 的所有记录，并给出 相关性得分</span><br></pre></td></tr></table></figure>

<p>查出 address 中包含 mill road 的所有记录，并给出相关性得分</p>
<h3 id="5、multi-match【多字段匹配】"><a href="#5、multi-match【多字段匹配】" class="headerlink" title="5、multi_match【多字段匹配】"></a>5、multi_match【多字段匹配】</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;state&quot;</span><span class="punctuation">,</span> <span class="string">&quot;address&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">## 查询 state 或者 address 这两个字段中包含 mill 的记录</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill WA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;state&quot;</span><span class="punctuation">,</span> <span class="string">&quot;address&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多字段匹配支持分词匹配，即 对于上述查询， state 和 address 字段中 包含 mill 或 WA 的都能被匹配到</span></span><br></pre></td></tr></table></figure>





<h3 id="6、bool【复合查询】"><a href="#6、bool【复合查询】" class="headerlink" title="6、bool【复合查询】"></a>6、bool【复合查询】</h3><p>bool 用来做复合查询</p>
<p>复合语句可以合并<strong>任何</strong>其它查询语句，包括复合语句，了解这一点是很重要的。这就意味着：复合语句之间可以互相嵌套，可以表达非常复杂的逻辑。</p>
<h4 id="must【必须达到-must-列举的所有条件】"><a href="#must【必须达到-must-列举的所有条件】" class="headerlink" title="must【必须达到 must 列举的所有条件】"></a>must【必须达到 must 列举的所有条件】</h4><h4 id="should【应该达到-should-列举的条件，如果达到会-增加相关文档的评分】"><a href="#should【应该达到-should-列举的条件，如果达到会-增加相关文档的评分】" class="headerlink" title="should【应该达到 should 列举的条件，如果达到会 增加相关文档的评分】"></a>should【应该达到 should 列举的条件，如果达到会 增加相关文档的评分】</h4><p>并不会改变查询的记过。如果 query 只有 should 且只有一种匹配规则，那么 should 的条件就会被作为默认匹配条件而去改变查询结果 </p>
<h4 id="must-not【必须不是指定的情况】"><a href="#must-not【必须不是指定的情况】" class="headerlink" title="must_not【必须不是指定的情况】"></a>must_not【必须不是指定的情况】</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;M&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;28&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Holland&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>事件</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>must</code></td>
<td>子句（查询）必须出现在匹配的文档中，并将有助于得分</td>
</tr>
<tr>
<td><code>must_not</code></td>
<td>子句（查询）不能出现在匹配的文档中</td>
</tr>
<tr>
<td><code>should</code></td>
<td>子句（查询）应该出现在匹配的文档中，在布尔查询中不包含must 或 filter子句，一个或多个should子句 必须有相匹配的文件，匹配should条件的最小数目可通过设置<code>minimum_should_match</code>参数</td>
</tr>
<tr>
<td><code>filter</code></td>
<td>子句（查询）必须出现在匹配的文档中，然而不像must此查询的分数将被忽略</td>
</tr>
</tbody></table>
<h3 id="7、filter【结果过滤】"><a href="#7、filter【结果过滤】" class="headerlink" title="7、filter【结果过滤】"></a>7、filter【结果过滤】</h3><p>并不是所有的查询都需要产生分数，特别是那些仅用于<strong>filtering</strong>（过滤）的文档。</p>
<p>为了不计算分数 ES 会自动检查场景并且优化查询的执行</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">30</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">30</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## filter 不会计算相关性得分，会将不满足 filter 的数据过滤掉</span><br></pre></td></tr></table></figure>





<h3 id="8、term"><a href="#8、term" class="headerlink" title="8、term"></a>8、term</h3><p>和 match 一样。匹配某个属性的值。</p>
<p>全文检索字段用 match ，其它非 text 字段（精确的字段）匹配用 term。【推荐】</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;28&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;28&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;990 Mill Road&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## 命中 <span class="number">35</span> 个结果</span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;990 Mill Road&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## 命中<span class="number">0</span>个结果</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;990 Mill Road&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## 先分词，后查询</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;990 Mill&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## 匹配完整词组</span><br><span class="line"></span><br><span class="line">GET /bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address.keyword&quot;</span><span class="punctuation">:</span> <span class="string">&quot;990 Mill&quot;</span>	## 精确匹配</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">## xxx.keyword 有时候等价于 match_phrase，都是按照完整的词组进行查询（不进行分词）</span><br><span class="line">## 不同之处：keyword 要求完全按照匹配的关键词检索，即文本的内容必须和关键词相同，少了自然不行，而多了也不行；</span><br><span class="line">## 而 match_phrase 要求只要文本中包含所查询的关键字即可，少了不行，但多了可以！</span><br></pre></td></tr></table></figure>





<h3 id="9、aggregations（执行聚合）"><a href="#9、aggregations（执行聚合）" class="headerlink" title="9、aggregations（执行聚合）"></a>9、aggregations（执行聚合）</h3><p>聚合提供了从数据中分组和提取数据的能力。最简单的聚合方法大致等于 SQL GROUP BY 和 SQL 的聚合函数。</p>
<p>在 ES 中，执行搜索返回  hits（命中结果），并且同时返回聚合结果。</p>
<p>把一个响应中所有的 hits 分隔开的能力。</p>
<p>这是 非常强大且有效的，你可以执行查询和多个聚合，并且在一次使用中得到各自的（任何一个）返回 结果，使用一次简洁和简化的 API 来避免网络 往返！</p>
<ul>
<li><p>搜索 address 中包含 mill 的所有人的年龄分布及平均年龄，但是不显示这些人的详情。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">## 搜索 address 中包含 mill 的所有人的年龄分布以及平均年龄</span><br><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">,</span> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;group_by_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span><span class="number">10</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;avg_age&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;age&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;avg_balance&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;balance&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span><span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">size：不显示命中的数据结果，只显示聚合的结果</span><br><span class="line">aggs：执行聚合。聚合语法如下：</span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aggs_name[这次聚合的名字，自定义（方便展示在结果中）]&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;AGG_TYPE[聚合的类型(avg、term、terms)]&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;Xxx&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>复杂聚合：按照年龄聚合，并且请求这些年龄段这些人的平均薪资</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;group_by_age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;avg_balance&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;balance&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">,</span> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>查出所有年龄分布，并且这些年龄段中M的平均薪资和F的平均薪资以及这个年龄段的总体平均薪资</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">## 查出所有年龄分布，并且这些年龄段中M的平均薪资和F的平均薪资以及这个年龄段的总体平均薪资</span><br><span class="line"></span><br><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;group_by_age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;age&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span><span class="number">100</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;group_by_gender&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;gender.keyword&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avg_balance&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;balance&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age_avg_balance&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="string">&quot;balance&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">## 聚合是基于查询到的结果做的数据处理，所以聚合前一定要先进行查询，得到数据</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3、Mapping"><a href="#3、Mapping" class="headerlink" title="3、Mapping"></a>3、Mapping</h2><p>Mapping（映射）</p>
<p>Mapping 是用来定义一个文档（Document），以及 它所包含的属性（field）是如何存储和索引的。比如，使用Mapping来定义：</p>
<ul>
<li>哪些字符属性应该被看做全文本属性（full text fields）</li>
<li>哪些属性包含数字、日期或地理位置</li>
<li>文档中的所有属性是否都能被索引（_all配置）</li>
<li>日期的格式</li>
<li>自定义映射规则来执行动态添加属性</li>
</ul>
<p>ES 7 版本开始，移除了 type（类型）的概念</p>
<p>在 ES 7 中，URL 中的 type 参数为可选。比如，索引一个文档不再要求提供文档类型</p>
<p>在 ES 8 中，不再支持 URL 中的 type 参数！ </p>
<ul>
<li><p>查看 mapping 映射信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_mapping</span><br></pre></td></tr></table></figure></li>
<li><p>创建索引并制定映射规则</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>	</span><br></pre></td></tr></table></figure></li>
<li><p>修改 mapping 映射信息</p>
<ol>
<li>添加新的字段映射</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 被索引 = 能被检索到</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>更新映射</p>
<p>对于已经存在的映射字段，我们不能更新，更新必须创建新的索引进行数据迁移！</p>
</li>
<li><p>数据迁移</p>
<p>（1）先创建出一个新的索引，并在创建时指定映射规则</p>
<p>（2）数据迁移</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT /new_my_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new_my_index&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">## 如果旧的索引中使用了 type ，而在新的索引中不希望使用 type ，语法格式为：</span><br><span class="line">POST _reindex</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;type_name&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new_my_index&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="4、分词"><a href="#4、分词" class="headerlink" title="4、分词"></a>4、分词</h2><p>将完整的一段话分成一个一个的单词，利用单词的相关性匹配，完成全文检索功能！</p>
<p>一个 tokenizer（分词器）接收 一个字符流，将之分割为独立的 token（词元，通常是独立的单词），然后输出 token 流。</p>
<h3 id="安装-ik-分词器"><a href="#安装-ik-分词器" class="headerlink" title="安装 ik 分词器"></a>安装 ik 分词器</h3><ul>
<li><p>GitHub 地址 ：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
</li>
<li><p>步骤：</p>
<ol>
<li><p>进入 ES 容器内部 plugins 目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line">cd plugins/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载分词器</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/01/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/03/01/Docker/" class="post-title-link" itemprop="url">Docker</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-01 23:50:12" itemprop="dateCreated datePublished" datetime="2021-03-01T23:50:12+08:00">2021-03-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-03-27 19:52:29" itemprop="dateModified" datetime="2021-03-27T19:52:29+08:00">2021-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Dcoker"><a href="#Dcoker" class="headerlink" title="Dcoker"></a>Dcoker</h1><ol>
<li>如果我们想要安装 MySQL ，首先第一步就是要搜索 Docker 库里面有没有 MySQL 镜像！</li>
</ol>
<h2 id="在linux系统上安装docker"><a href="#在linux系统上安装docker" class="headerlink" title="在linux系统上安装docker"></a>在linux系统上安装docker</h2><blockquote>
<p>步骤：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1、检查内核版本，必须是3.10及以上</span><br><span class="line">uname ‐r</span><br><span class="line"></span><br><span class="line">2、安装 docker</span><br><span class="line">yum install docker</span><br><span class="line"></span><br><span class="line">3、输入 y 确认安装</span><br><span class="line"></span><br><span class="line">4、启动 docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line"></span><br><span class="line">5、查看 docker 版本信息</span><br><span class="line">[root@localhost ~]# docker ‐v</span><br><span class="line"></span><br><span class="line">6、设置 docker 开机自启</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line"></span><br><span class="line">6、停止docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>



<h1 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h1><h2 id="镜像操作"><a href="#镜像操作" class="headerlink" title="镜像操作"></a>镜像操作</h2><table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">命令</th>
<th align="center">eg</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">检索</td>
<td align="center"><code>docker search 镜像名</code></td>
<td align="center"><code>docker search mysql</code></td>
<td>检索（检索镜像库中的镜像）。我们经常去 <a target="_blank" rel="noopener" href="https://hub.docker.com/">DockerHub</a> 上检索镜像的详细信息，如镜像的TAG。</td>
</tr>
<tr>
<td align="center">拉取</td>
<td align="center"><code>docker pull 镜像名:tag</code></td>
<td align="center"><code>docker pull mysql</code></td>
<td>拉取镜像（下载）。<code>:tag</code> 是可选的，表示标签，多为软件的版本，默认是 <code>latest</code></td>
</tr>
<tr>
<td align="center">列表</td>
<td align="center"><code>docker images</code></td>
<td align="center"><code>docker images</code></td>
<td>查看所有本地镜像</td>
</tr>
<tr>
<td align="center">删除</td>
<td align="center"><code>ocker rmi image-id</code></td>
<td align="center"></td>
<td>删除指定的本地镜像</td>
</tr>
</tbody></table>
<h2 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h2><p>软件镜像（QQ安装程序）—-运行镜像—-产生一个容器（正在运行的软件，运行的QQ）</p>
<blockquote>
<ol>
<li>根据镜像启动容器     </li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">	docker run [--name container-name] -d image-name</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">	--name	开启自定义容器的名字</span><br><span class="line">	container-name	容器的名字</span><br><span class="line">	-d		后台运行</span><br><span class="line">	image-name		指定要启动的镜像</span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line">	docker run --name mysql -d tomcat:3.4.5</span><br></pre></td></tr></table></figure>



<blockquote>
<ol start="2">
<li>查看运行中的容器（列表）</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="3">
<li>查看所有的容器（包括运行中的和已经停止的）   </li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>



<blockquote>
<ol start="3">
<li>停止运行中的容器    </li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">	docker stop container-name（或container-id）</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">	container-name		容器的名字</span><br><span class="line">	container-id		容器的ID</span><br><span class="line">eg：</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="4">
<li>启动容器（启动容器针对的是已经启动过但停止的容器，直接启动一个镜像则不会成功）     </li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start container-name（或container-id）</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="5">
<li>删除容器（删除容器的时候容器一定要是停止状态）   </li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm container-id</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="6">
<li>端口映射：<ul>
<li>功能：将 Docker容器 中的服务的端口号映射到主机的端口号上。</li>
<li>原因：Docker 安装在服务器上，启动容器中的服务使用的是容器内部的端口，而通过 HTTP 协议访问的端口是服务器的端口号。  如果不映射的话，通过浏览器就不能访问到Docker容器内的服务，所以必须把 Docker容器 内部的端口号映射到主机的端口号上，这样才能够通过 HTTP 协议访问到容器中的服务！</li>
<li>端口映射应该在启动容器时进行！</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">	docker run [--name container-name] -d [-p host_port:docker_port] container-name[:tags]</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">	-d：后台运行</span><br><span class="line">	-p：将 Docker容器 中的服务的端口号映射到主机的端口号上。   </span><br><span class="line">		格式：主机端口号:容器端口号</span><br></pre></td></tr></table></figure>



<ol>
<li>查看容器的日志</li>
<li>-e  指定参数（参数是键值对）</li>
</ol>
<h1 id="Docker启动高版本的tomcat容器访问端口显示404页面显示"><a href="#Docker启动高版本的tomcat容器访问端口显示404页面显示" class="headerlink" title="Docker启动高版本的tomcat容器访问端口显示404页面显示"></a>Docker启动高版本的tomcat容器访问端口显示404页面显示</h1><p>docker启动tomcat容器访问端口显示404页面显示 源服务器未能找到目标资源的表示或者是不愿公开一个已经存在<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/xyq608074/article/details/107084407">https://blog.csdn.net/xyq608074/article/details/107084407</a></p>
<h1 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h1><p>对于5.x版本的MySQL可以直接使用，对于更高版本的MySQL验证方式有所不同</p>
<h1 id="解决docker安装mysql8-0无法远程连接问题"><a href="#解决docker安装mysql8-0无法远程连接问题" class="headerlink" title="解决docker安装mysql8.0无法远程连接问题"></a>解决docker安装mysql8.0无法远程连接问题</h1><p>MySQL8.0 的加密方式发生了改变，需要把加密方式改回来后才可以正常进行远程登录<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/shuoshuo132/article/details/81304123">https://blog.csdn.net/shuoshuo132/article/details/81304123</a></p>
<h1 id="高级操作"><a href="#高级操作" class="headerlink" title="高级操作"></a>高级操作</h1><p>把主机的 /my/custum 文件夹挂载到 mysqldocker 容器的 /etc/mysql/conf.d 文件夹里面（采用合并的方式，即自定义的配置文件会覆盖合并原先配置文件中同名的属性）<br>我们可以自己指定本地主机中的配置文件夹的名称，如可以将  /my/custum 修改成 /conf/mysql 等</p>
<h1 id="Docker-安装-MongoDB"><a href="#Docker-安装-MongoDB" class="headerlink" title="Docker 安装 MongoDB"></a>Docker 安装 MongoDB</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拉取镜像</span> </span><br><span class="line">docker pull mongo:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建和启动容器</span> </span><br><span class="line">docker run -d --restart=always -p 27017:27017 --name mymongo -v /data/db:/data/db -d mongo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入容器</span> </span><br><span class="line">docker exec -it mymongo /bin/bash </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用MongoDB客户端进行操作</span> </span><br><span class="line">mongo </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs <span class="comment">#查询所有的数据库</span></span> </span><br><span class="line">admin 0.000GB </span><br><span class="line">config 0.000GB </span><br><span class="line">local 0.000GB </span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/19/MapReduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/02/19/MapReduce/" class="post-title-link" itemprop="url">MapReduce</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-19 15:10:17" itemprop="dateCreated datePublished" datetime="2021-02-19T15:10:17+08:00">2021-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-12-14 19:23:26" itemprop="dateModified" datetime="2021-12-14T19:23:26+08:00">2021-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MapReduce-理论基础"><a href="#MapReduce-理论基础" class="headerlink" title="MapReduce 理论基础"></a>MapReduce 理论基础</h1><h2 id="MapReduce-定义"><a href="#MapReduce-定义" class="headerlink" title="MapReduce 定义"></a>MapReduce 定义</h2><p>MapReduce 是一个分布式运算程序的编程框架，是用户开发“基于Hadoop的数据分析应用”的核心框架。</p>
<p>MapReduce 核心功能是将用户编写的业务逻辑代码和自带默认组件整合成一个完整的分布式运算程序，可以运行在一个Hadoop集群上。</p>
<hr>
<h2 id="MapReduce优缺点"><a href="#MapReduce优缺点" class="headerlink" title="MapReduce优缺点"></a>MapReduce优缺点</h2><h3 id="优点——简单"><a href="#优点——简单" class="headerlink" title="优点——简单"></a>优点——简单</h3><h3 id="缺点——慢"><a href="#缺点——慢" class="headerlink" title="缺点——慢"></a>缺点——慢</h3><hr>
<h2 id="MapReduce-组件"><a href="#MapReduce-组件" class="headerlink" title="MapReduce 组件"></a>MapReduce 组件</h2><p>MapReduce 是一种编程思想，符合这种编程思想的程序就可以叫做 MapReduce 程序。</p>
<h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3><p><strong>Job</strong>（作业）：一个符合 MapReduce 编程规范的程序就是一个 Job，Job 其实就是一段可以运行的静态代码。</p>
<hr>
<h3 id="MrAppMaster"><a href="#MrAppMaster" class="headerlink" title="MrAppMaster"></a>MrAppMaster</h3><p><strong>MrAppMaster</strong>：MrAppMaster 是一个进程。在分布式环境下运行 Job 时，会先启动一个 MRAppMaster 进程，这个进程就主要负责 Job 中程序运行过程中执行状态的监控，容错，和 ResourceManager 申请资源，提交 Task 等。</p>
<hr>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><p><strong>Task</strong>：Task 也是一个进程，负责 Job 任务的计算。</p>
<ul>
<li>  MapTask：负责 Map 阶段程序计算的 Task 称为 MapTask。</li>
<li>  ReduceTask：负责 Reduce 阶段程序计算的 Task 称为 ReduceTask。</li>
</ul>
<hr>
<h3 id="Partitioner（分区）"><a href="#Partitioner（分区）" class="headerlink" title="Partitioner（分区）"></a>Partitioner（分区）</h3><p>Partitioner（分区器）负责在 Mapper 将数据写出时，为每组 <code>&lt;keyout-valueout&gt;</code> 打上标记，保存在不同的分区中。</p>
<p>如果 Map 阶段的数据保存在多个分区中，在 Reduce 阶段，一个 ReduceTask 只需处理一个分区的数据即可。</p>
<hr>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>Map 阶段是 MapReduce 程序运行的第一个阶段。</p>
<p>Map 阶段会将输入的数据进行切分，将一份大数据切分为若干小部分，切分后每个部分称为一<strong>片（split）</strong>，每片数据会交给一个MapTask 进程进行计算。</p>
<p>在一个 MapReduce 程序的 Map 阶段，会启动 N 个 MapTask 进程并行运算。</p>
<ul>
<li>  N 取决于切片（split）数，一般会为每一个 split 都分配一个 Task。</li>
</ul>
<hr>
<h3 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h3><p>Reduce 阶段是 MapReduce 程序运行的第二个阶段。</p>
<p>Reduce 阶段的目的是将 Map 阶段每个 MapTask 计算后的结果进行合并汇总，得到最终结果。</p>
<p>Reduce 阶段是可选的，也就是说一个 MapReduce 程序运行时可以没有 Reduce 阶段。</p>
<p>一个 Job 可以通过设置，启动 N 个 ReduceTask，这些 ReduceTask 也是并行运行的，每个 ReduceTask 最终都会产生一个结果。</p>
<hr>
<h2 id="MapReduce-常用API"><a href="#MapReduce-常用API" class="headerlink" title="MapReduce 常用API"></a>MapReduce 常用API</h2><p>Hadoop 是用 Java 实现的，在 MapReduce 程序运行过程中，会创建一些实例对象，其中一些重要的<strong>基类</strong>对象如下：</p>
<h3 id="Map-阶段"><a href="#Map-阶段" class="headerlink" title="Map 阶段"></a>Map 阶段</h3><ol>
<li><p> <strong>Mapper</strong>：map阶段的核心对象</p>
</li>
<li><p><strong>InputFormat</strong>：用于处理指定格式的输入数据</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MapReduce 规范规定程序运行时必须指定一个输入目录，一个输出目录。</span><br><span class="line">InputFormat 限定了输入目录中文件的格式。</span><br><span class="line">	1、如果是普通文件，可以使用 FileInputFormat 实现类；</span><br><span class="line">	2、如果是SequeceFile文件（hadoop提供的一种文件格式），可以使用 SequnceFileInputFormat 实现类；</span><br><span class="line">	3、如果处理的数据在数据库中，需要使用 DBInputFormat 实现类</span><br></pre></td></tr></table></figure></li>
<li><p><strong>RecordReader</strong>：记录读取器</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RecordReader 负责从输入目录文件中，读取数据，读取后封装为一组键值对记录。</span><br><span class="line">因为 MapReduce 只能处理&lt;K,V&gt;数据</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="Reduce阶段"><a href="#Reduce阶段" class="headerlink" title="Reduce阶段"></a>Reduce阶段</h3><ol>
<li><p> <strong>Reducer</strong>：reduce 阶段的核心对象</p>
</li>
<li><p><strong>OutPutFormat</strong>：用于处理输出数据的格式</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OutPutFormat 用于指定 MapReduce 处理后的结果，要以什么样的文件格式写出。</span><br><span class="line">	1、如果想将结果写出到一个普通文件中，可以使用 FileOutputFormat；</span><br><span class="line">	2、如果想将结果写出到数据库中，可以使用 DBOutPutFormat；</span><br><span class="line">	4、如果想将结果写出到 SequeceFile 中，可以使用 SequnceFileOutputFormat</span><br></pre></td></tr></table></figure></li>
<li><p><strong>RecordWriter</strong>：记录写出器</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RecordWriter 将处理的结果以什么样的格式，写出到输出文件中。</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="MapReduce-处理数据的流程："><a href="#MapReduce-处理数据的流程：" class="headerlink" title="MapReduce 处理数据的流程："></a>MapReduce 处理数据的流程：</h3><ol>
<li> <code>InputFormat</code> 调用 <code>RecordReader</code>，读取输入目录下的文件中的数据，并将数据封装为 <code>&lt;keyin, valuein&gt;</code> 对象；</li>
<li> 将封装好的 <code>&lt;keyin, valuein&gt;</code> 对象，交给 <code>Mapper.map()</code>处理 <code>--&gt;</code> 将处理的结果写出到 <code>&lt;keyout, valueout&gt;</code> 对象中；</li>
<li> 将<code>&lt;keyout, valueout&gt;</code> 对象序列化到磁盘中存储；</li>
<li> <code>ReduceTask</code> 进程创建 <code>Reducer</code> 对象，使用 <code>Reducer.reduce()</code> 处理 Mapper 写出的 <code>&lt;keyout, valueout&gt;</code> 对象；</li>
<li> <code>OutPutFormat</code> 调用 <code>RecordWriter</code>，将 <code>Reducer</code> 处理后的 <code>&lt;keyout, valueout&gt;</code> 对象写出到文件中。</li>
</ol>
<hr>
<h1 id="MapReduce-编程规范"><a href="#MapReduce-编程规范" class="headerlink" title="MapReduce 编程规范"></a>MapReduce 编程规范</h1><p>用户编写的程序分成三个部分：Mapper、Reducer 和 Driver</p>
<h2 id="一、Mapper-阶段"><a href="#一、Mapper-阶段" class="headerlink" title="一、Mapper 阶段"></a>一、Mapper 阶段</h2><ol>
<li><p>用户自定义的 Mapper 要继承 <code>org.apache.hadoop.mapreduce.Mapper</code></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mapper</span>&lt;KEYIN, VALUEIN, KEYOUT, VALUEOUT&gt; &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p> Mapper 的输入数据是 KV 对的形式（KV 的类型可自定义）</p>
</li>
<li><p> Mapper 的业务逻辑写在 <code>map()</code> 方法中</p>
</li>
<li><p> Mapper 的输出数据是 KV 对的形式（KV 的类型可自定义）</p>
</li>
<li><p> <code>map()</code> 方法（MapTask 进程）会对每个 <code>&lt;K, V&gt;</code> 都调用一次。</p>
</li>
</ol>
<hr>
<h2 id="二、Reducer-阶段"><a href="#二、Reducer-阶段" class="headerlink" title="二、Reducer 阶段"></a>二、Reducer 阶段</h2><ol>
<li><p>用户自定义的 Reducer 要继承 <code>org.apache.hadoop.mapreduce.Reducer</code></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Reducer</span>&lt;KEYIN,VALUEIN,KEYOUT,VALUEOUT&gt; &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p> Reducer 的输入数据类型对应 Mapper 的输出数据类型，也是 KV</p>
</li>
<li><p> Reducer 的输出数据是 KV 对的形式（KV 的类型可自定义）</p>
</li>
<li><p> Reducer 的业务逻辑写在 <code>reduce()</code> 方法中</p>
</li>
<li><p> ReduceTask 进程对每一组相同 K 的 <code>&lt;K, V&gt;</code> 组调用一次 <code>reduce()</code> 方法。</p>
</li>
</ol>
<hr>
<h2 id="三、Driver"><a href="#三、Driver" class="headerlink" title="三、Driver"></a>三、Driver</h2><p><strong>Driver 就相当于 Yarn 的客户端，用于提交 Job 到 Yarn 中。</strong></p>
<hr>
<h1 id="WordCount-案例"><a href="#WordCount-案例" class="headerlink" title="WordCount 案例"></a>WordCount 案例</h1><h2 id="WordCount-案例分析"><a href="#WordCount-案例分析" class="headerlink" title="WordCount 案例分析"></a>WordCount 案例分析</h2><p><img src="/2021/02/19/MapReduce/image-20211126202235883.png" alt="image-20211126202235883"></p>
<p><img src="/2021/02/19/MapReduce/image-20211202113216507.png" alt="image-20211202113216507"></p>
<h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><p>在 HDFS 的 <code>/hello</code> 目录下存在两个文件，现在要求统计两个文件中不同单词的数量，并要求将 <code>a-p</code> 开头的单词放入到一个结果文件中，<code>q-z</code> 开头的单词放入到另一个结果文件中。    </p>
<ul>
<li><p><code>/hello/a.txt    200M</code></p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hello,hi,hadoop</span><br><span class="line">hive,hadoop,hive,</span><br><span class="line">zoo,spark,wow</span><br><span class="line">zoo,spark,wow</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li><p><code>/hello/b.txt    100M</code></p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello,hi,hadoop</span><br><span class="line">zoo,spark,wow</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Map-阶段-1"><a href="#Map-阶段-1" class="headerlink" title="Map 阶段"></a>Map 阶段</h3><p>Map 阶段：运行多个 MapTask 进程，将大数据切分成若干份小数据，每个 MapTask 进程处理一部分数据，并输出阶段性的结果。</p>
<ol>
<li><p>数据切片（split）：默认的切分策略是以文件为单位，以 block 的大小为单个片的大小进行切片。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/hello/a.txt	200M</span><br><span class="line">/hello/b.txt	100M</span><br><span class="line"></span><br><span class="line">现在我们有2个文件，默认块的大小是128M，所以split的大小也为128M。</span><br><span class="line">所以我们需要对文件 a.txt 进行切片，切分后的结果为：</span><br><span class="line">	split0: /hello/a.txt,0-128M</span><br><span class="line">	split1: /hello/a.txt,128M-200M</span><br><span class="line">对于文件 b.txt，其大小小于128M，所以不需要再进行切片了，直接保存在一个单独的split上；</span><br><span class="line">	split2: /hello/b.txt,0M-100M</span><br></pre></td></tr></table></figure></li>
<li><p>由于目前我们有 3 个 split，所以启动 3 个 MapTask 进程执行任务，每个 MapTask 进程负责处理一个 split 上的数据</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">split0: /hello/a.txt,0-128M--------MapTask1</span><br><span class="line">split1: /hello/a.txt,128M-200M--------MapTask2</span><br><span class="line">split2: /hello/b.txt,0M-100M--------MapTask3</span><br></pre></td></tr></table></figure></li>
<li><p>读取数据阶段。</p>
<p> 在 MapReduce 中，所有的数据必须封装为 <code>&lt;K, V&gt;</code> 形式，所以 MapTask1、2、3 分别都会创建一个 <code>InputFormat</code> 对象（默认实现类为 <code>TextInputFormat</code>），每个 <code>InputFormat</code> 对象再创建一个依赖对象 <code>RecordReader</code>（默认实现类为 <code>LineRecordReader</code>），<code>RecordReader</code> 负责读取 split 中的数据，并封装成 <code>&lt;K, V&gt;</code> 格式。</p>
<p> <code>LineRecordReader</code>：以文件中的当前行的偏移量（offset ）为 key，当前行的内容为 value，将文件内容封装成一个个<code>&lt;K,V&gt;</code>对象。</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">举例：a.txt</span><br><span class="line"><span class="comment"># (k，v) &lt;---&gt; (偏移量，内容)</span></span><br><span class="line">hello,hi,hadoop-----&gt;(<span class="number">0</span>, (hello,hi,hadoop))</span><br><span class="line">hive,hadoop,hive-----&gt;(<span class="number">20</span>, (hive,hadoop,hive))</span><br><span class="line">zoo,spark,wow-----&gt;(<span class="number">30</span>, (zoo,spark,wow))</span><br><span class="line">zoo,spark,wow-----&gt;(<span class="number">40</span>, (zoo,spark,wow))</span><br></pre></td></tr></table></figure></li>
<li><p><code>map()</code>方法</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">map() 是 Map 阶段的核心处理逻辑。 </span><br><span class="line">在单词统计中，map() 会被循环调用，对输入的每个&lt;K,V&gt;对象都进行处理！</span><br><span class="line">    输入：(0, (hello,hi,hadoop))</span><br><span class="line">    输出：(hello,1),(hi,1),(hadoop,1)</span><br><span class="line"></span><br><span class="line">    输入：(20, (hive,hadoop,hive))</span><br><span class="line">    输出：(hive,1),(hadoop,1),(hive,1)  </span><br><span class="line"></span><br><span class="line">    输入：(30, (zoo,spark,wow))</span><br><span class="line">    输出：(zoo,1),(spark,1),(wow,1)  </span><br><span class="line"></span><br><span class="line">    输入：(40, (zoo,spark,wow))</span><br><span class="line">    输出：(zoo,1),(spark,1),(wow,1) </span><br></pre></td></tr></table></figure></li>
<li><p>根据需求，我们需要生成两个结果文件，将 <code>a-p</code> 开头的单词放入到一个结果文件中，<code>q-z</code> 开头的单词放入到另一个结果文件中。所以，我们需要将 MapTask 输出的记录进行<strong>分区</strong>，将 <code>a-p</code> 开头的单词放入到一个区，<code>q-z</code> 开头的单词放入到另一个区，这就需要在Mapper 输出结果后，调用 Partitioner，对 Mapper 输出的 <code>key-value</code> 进行分区，在分区过程中默认会将结果按照字典顺序排序。为了分别处理这两个区的数据，我们也会启动两个 ReduceTask ，每个 ReduceTask 负责处理一个分区中的数据。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">分区规则： </span><br><span class="line">	a-p开头的单词放入到一个区；q-z开头的单词放入到另一个区</span><br><span class="line"></span><br><span class="line">MapTask1：	<span class="comment">// MapTask1 的处理结果分别放入两个区，同理，MapTask2、3也一样，将处理结果输出到两个区中 </span></span><br><span class="line"><span class="number">0</span>号区：  (hadoop,<span class="number">1</span>)，(hadoop,<span class="number">1</span>)，(hello,<span class="number">1</span>),(hi,<span class="number">1</span>),(hive,<span class="number">1</span>),(hive,<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span>号区：  (spark,<span class="number">1</span>),(spark,<span class="number">1</span>),(wow,<span class="number">1</span>) ，(wow,<span class="number">1</span>),(zoo,<span class="number">1</span>)(zoo,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">MapTask2:		   </span><br><span class="line"><span class="number">0</span>号区： ...</span><br><span class="line"><span class="number">1</span>号区： ...</span><br><span class="line"></span><br><span class="line">MapTask3:		   </span><br><span class="line"><span class="number">0</span>号区： (hadoop,<span class="number">1</span>),(hello,<span class="number">1</span>),(hi,<span class="number">1</span>),	<span class="comment">// 分区后的数据按key的字典顺序排列</span></span><br><span class="line"><span class="number">1</span>号区： (spark,<span class="number">1</span>),(wow,<span class="number">1</span>),(zoo,<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="Reduce-阶段"><a href="#Reduce-阶段" class="headerlink" title="Reduce 阶段"></a>Reduce 阶段</h3><ol>
<li><p><strong>copy</strong>：<code>ReduceTask</code> 进程启动后，会启动 <strong>shuffle</strong> 进程，从 MapTask 进程中拷贝相应分区的数据。比如：</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ReduceTask1: 只负责0号区</span><br><span class="line">	将3个MapTask生成的保存在0号区数据全部拷贝到ReduceTask1所在的机器！</span><br><span class="line">        (hadoop,1)，(hadoop,1)，(hello,1),(hi,1),(hive,1),(hive,1)</span><br><span class="line">        (hadoop,1),(hello,1),(hi,1),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ReduceTask2: 只负责1号区</span><br><span class="line">	将3个MapTask生成的保存在1号区数据全部拷贝到ReduceTask2所在的机器！</span><br><span class="line">        (spark,1),(spark,1),(wow,1) ，(wow,1),(zoo,1)(zoo,1)</span><br><span class="line">        (spark,1),(wow,1),(zoo,1)</span><br></pre></td></tr></table></figure>

</li>
<li><p><strong>sort</strong>：排序</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReduceTask1: 将从0号区拷贝到本地机器上的数据进行排序：</span><br><span class="line">	(hadoop,1)，(hadoop,1)，(hadoop,1),(hello,1),(hello,1),(hi,1),(hi,1),(hive,1),(hive,1)</span><br><span class="line">ReduceTask2: 将从1号区拷贝到本地机器上的数据进行排序：</span><br><span class="line">	(spark,1),(spark,1),(spark,1),(wow,1) ，(wow,1),(wow,1),(zoo,1),(zoo,1)(zoo,1)</span><br></pre></td></tr></table></figure></li>
<li><p><strong>reduce</strong></p>
<p> <code>ReduceTask进程 --&gt; 创建Reducer对象 --&gt; 调用reduce()方法(一次读入一组数据)</code></p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">何为一组数据: key相同的为一组数据</span><br><span class="line">ReduceTask1----&gt;Reducer-----&gt;reduce(一次读入一组数据)</span><br><span class="line">	输入： (hadoop,1)，(hadoop,1)，(hadoop,1)</span><br><span class="line">	输出： (hadoop,3)</span><br><span class="line"></span><br><span class="line">	输入： (hello,1),(hello,1)</span><br><span class="line">	输出： (hello,2)</span><br><span class="line">	</span><br><span class="line">	输入： (hi,1),(hi,1)</span><br><span class="line">	输出： (hi,2)</span><br><span class="line">	</span><br><span class="line">	输入：(hive,1),(hive,1)</span><br><span class="line">	输出：(hive,2)</span><br><span class="line">	</span><br><span class="line">ReduceTask2----&gt;Reducer-----&gt;reduce(一次读入一组数据)</span><br><span class="line">	输入： (spark,1),(spark,1),(spark,1)</span><br><span class="line">	输出： (spark,3)</span><br><span class="line">	</span><br><span class="line">	输入： (wow,1) ，(wow,1),(wow,1)</span><br><span class="line">	输出： (wow,3)</span><br><span class="line"></span><br><span class="line">	输入：(zoo,1),(zoo,1)(zoo,1)</span><br><span class="line">	输出：(zoo,3)</span><br></pre></td></tr></table></figure>

</li>
<li><p>调用 <code>OutPutFormat</code> 中的 <code>RecordWriter</code> 将 <code>Reducer</code> 输出的记录落盘</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ReduceTask1----&gt;OutPutFormat（默认使用TextOutPutFormat）------&gt;RecordWriter（默认使用LineRecoreWriter）</span><br><span class="line">    LineRecoreWriter会将一个&lt;K,V&gt;写出为一行，key和alue之间使用\t分割</span><br><span class="line">    在输出目录中，生成文件part-r-0000</span><br><span class="line">        hadoop	3</span><br><span class="line">        hello	2</span><br><span class="line">        hi	2</span><br><span class="line">        hive	2</span><br><span class="line"></span><br><span class="line">ReduceTask2----&gt;OutPutFormat（默认TextOutPutFormat）------&gt;RecordWriter（LineRecoreWriter）</span><br><span class="line">    LineRecoreWriter会将一个&lt;K,V&gt;写出为一行，key和alue之间使用\t分割</span><br><span class="line">    在输出目录中，生成文件part-r-0001</span><br><span class="line">        spark	3</span><br><span class="line">        wow	3</span><br><span class="line">        zoo	3</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="MapReduce总结"><a href="#MapReduce总结" class="headerlink" title="MapReduce总结"></a>MapReduce总结</h3><ul>
<li><p>Map阶段(MapTask)</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">切片(Split)-----读取数据(Read)-------交给Mapper处理(Map)------分区和排序(sort)</span><br></pre></td></tr></table></figure>

</li>
<li><p>Reduce阶段(ReduceTask)</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">拷贝数据(copy)------排序(sort)-----合并(reduce)-----写出(write)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h2 id="WordCount案例实战"><a href="#WordCount案例实战" class="headerlink" title="WordCount案例实战"></a>WordCount案例实战</h2><h3 id="一、准备数据"><a href="#一、准备数据" class="headerlink" title="一、准备数据"></a>一、准备数据</h3><p><strong>注意：</strong></p>
<ul>
<li>  准备的数据的格式必须是文本</li>
<li>  编码必须是<code>utf-8无bom</code></li>
</ul>
<p><img src="/2021/02/19/MapReduce/image-20211202141842801.png" alt="image-20211202141842801"></p>
<hr>
<h1 id="Hadoop-序列化"><a href="#Hadoop-序列化" class="headerlink" title="Hadoop 序列化"></a>Hadoop 序列化</h1><h2 id="什么是序列化"><a href="#什么是序列化" class="headerlink" title="什么是序列化"></a>什么是序列化</h2><ul>
<li>  <strong>序列化</strong>就是把内存中的对象，转换成字节序列（或其他数据传输协议）以便于存储（持久化）和网络传输。</li>
<li>  <strong>反序列化</strong>就是将收到字节序列（或其他数据传输协议）或者是硬盘的持久化数据，转换成内存中的对象。</li>
</ul>
<hr>
<h2 id="为什么要序列化"><a href="#为什么要序列化" class="headerlink" title="为什么要序列化"></a>为什么要序列化</h2><p>一般来说，“活的”对象只存在于内存中，关机断电就没有了。而且“活的”对象只能由本地的进程使用，不能被发送到网络上的另外一台计算机。然而序列化可以存储“活的”对象，可以将“活的”对象发送到远程计算机。</p>
<hr>
<h2 id="为什么不用Java的序列化"><a href="#为什么不用Java的序列化" class="headerlink" title="为什么不用Java的序列化"></a>为什么不用Java的序列化</h2><p>Java 的序列化是一个重量级的序列化框架（Serializable），一个对象被序列化后，会附带很多额外的信息（各种校验信息，Header，继承体系等），不便于在网络中高效传输。所以，Hadoop 自己开发了一套轻量级的序列化机制（Writable）。</p>
<p><strong>Hadoop 序列化特点：</strong></p>
<ol>
<li> 紧凑：高效使用存储空间。</li>
<li> 快速：读写数据的额外开销小。</li>
<li> 可扩展：随着通信协议的升级而可升级</li>
<li> 互操作：支持多语言的交互</li>
</ol>
<hr>
<h2 id="常用数据序列化类型"><a href="#常用数据序列化类型" class="headerlink" title="常用数据序列化类型"></a>常用数据序列化类型</h2><blockquote>
<p>  常用的数据类型对应的 Hadoop 数据序列化类型</p>
</blockquote>
<table>
<thead>
<tr>
<th>Java类型</th>
<th>Hadoop Writable类型</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>BooleanWritable</td>
</tr>
<tr>
<td>byte</td>
<td>ByteWritable</td>
</tr>
<tr>
<td>int</td>
<td>IntWritable</td>
</tr>
<tr>
<td>float</td>
<td>FloatWritable</td>
</tr>
<tr>
<td>long</td>
<td>LongWritable</td>
</tr>
<tr>
<td>double</td>
<td>DoubleWritable</td>
</tr>
<tr>
<td>String</td>
<td>Text</td>
</tr>
<tr>
<td>map</td>
<td>MapWritable</td>
</tr>
<tr>
<td>array</td>
<td>ArrayWritable</td>
</tr>
</tbody></table>
<hr>
<h2 id="自定义-bean-对象事件序列化接口（Writable）"><a href="#自定义-bean-对象事件序列化接口（Writable）" class="headerlink" title="自定义 bean 对象事件序列化接口（Writable）"></a>自定义 bean 对象事件序列化接口（Writable）</h2><p>自定义的 bean 对象如果想要序列化传输，就必须实现序列化接口。具体的操作步骤如下 7 步：</p>
<ol>
<li><p> 实现 <code>Writable</code> 接口</p>
</li>
<li><p>反序列化时，需要反射调用 bean 对象的空参构造函数，所以自定义的 bean 对象必须提供空参构造函数。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">FlowBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>重写序列化方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	out.writeLong(upFlow);</span><br><span class="line">	out.writeLong(downFlow);</span><br><span class="line">	out.writeLong(sumFlow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>重写反序列化方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	upFlow = in.readLong();</span><br><span class="line">	downFlow = in.readLong();</span><br><span class="line">	sumFlow = in.readLong();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p> 注意反序列化方法中参数的顺序要与序列化方法中参数的顺序完全一致</p>
</li>
<li><p> 要想把结果显示在文件中，需要重写 <code>toString()</code> 方法</p>
</li>
<li><p>如果需要将自定义的 bean 对象作为 key 传输，则还需要实现 Comparable 接口，因为 MapReduce 中的 Shuffle 过程要求 key 必须能排序。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(FlowBean o)</span> &#123;</span><br><span class="line">    <span class="comment">// 倒序排列，从大到小</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="序列化案例实操"><a href="#序列化案例实操" class="headerlink" title="序列化案例实操"></a>序列化案例实操</h2><p><strong>一、需求</strong></p>
<p>统计每一个手机号耗费的总上行流量、下行流量、总流量</p>
<p>（1）输入数据</p>
<p>（2）输入数据格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7	13560436666		120.196.100.99		1116	954		 200  </span><br><span class="line">id   手机号码     	 网络ip             上行流量  下行流量   网络状态码  </span><br></pre></td></tr></table></figure>

<p>（3）期望输出数据格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">13560436666      1116         954            2070  </span><br><span class="line">手机号码        上行流量     下行流量         总流量  </span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/19/MapReduce/image-20211202150116535.png" alt="image-20211202150116535"></p>
<hr>
<h1 id="MapReduce-框架原理"><a href="#MapReduce-框架原理" class="headerlink" title="MapReduce 框架原理"></a>MapReduce 框架原理</h1><p><img src="/2021/02/19/MapReduce/image-20211127120148703.png" alt="image-20211127120148703"></p>
<hr>
<h1 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h1><h2 id="FileInputFormat切片源码解析-input-getSplits-job"><a href="#FileInputFormat切片源码解析-input-getSplits-job" class="headerlink" title="FileInputFormat切片源码解析(input.getSplits(job))"></a>FileInputFormat切片源码解析(input.getSplits(job))</h2><p><img src="/2021/02/19/MapReduce/image-20211202172418064.png" alt="image-20211202172418064"></p>
<h2 id="FileInputFormat-的切片策略（默认切片策略）"><a href="#FileInputFormat-的切片策略（默认切片策略）" class="headerlink" title="FileInputFormat 的切片策略（默认切片策略）"></a>FileInputFormat 的切片策略（默认切片策略）</h2><ul>
<li><strong>切片策略</strong><ol>
<li> 首先获取当前输入目录中的所有文件；</li>
<li> 以文件为单位进行切片，如果文件是空文件，默认创建一个空的切片（split）。</li>
<li> 如果文件不为空，要先判断文件是否可切片（非压缩文件都可切，压缩文件只有Bzip2格式可切）。</li>
<li> 如果文件不可切，将整个文件作为一片</li>
<li>如果文件可切，先获取事先设置的每片的大小（默认等于 Block 的大小），再按照文件的内容长度进行循环切片。<ul>
<li>  如果 <code>待切片内容长度/每片大小 &gt; 1.1</code>，则先切去一片，再用剩余的文件大小作为待切片内容，循环判断；</li>
<li>  如果 <code>待切片内容长度/每片大小 &lt;= 1.1</code>，将剩余的所有内容整个作为 1 片。</li>
</ul>
</li>
</ol>
</li>
</ul>
<ul>
<li><p><strong>案例分析</strong></p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">（1）输入目录中共有两个文件</span><br><span class="line">	file1.txt	320M</span><br><span class="line">	file2.txt	130M</span><br><span class="line">	</span><br><span class="line">（2）经过 FileInputFormat 切片后，形成的切片信息如下：</span><br><span class="line">	file1.txt.split1 --- 0~128M</span><br><span class="line">	file1.txt.split2 --- 128~256M</span><br><span class="line">	file1.txt.split3 --- 256~320M</span><br><span class="line">	file2.txt.split1 --- 0~130M</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="片和块的关系"><a href="#片和块的关系" class="headerlink" title="片和块的关系"></a><strong>片和块的关系</strong></h2><ul>
<li>  片（Split）：切片（Split）的过程发生在内存中，在运算 MapReduce 程序时，由于每个 MapTask 会负责一个 split 的运算，所以会临时的将某个目录下的所有文件划分为若干 split。但是实际上每个 split 中的数据还是以 block 的形式存储在 HDFS 中的。</li>
<li>  块（Block）：在向 HDFS 中写文件时，文件中的内容以 block 为单位存储。块是实际的物理存在。</li>
<li>  MapTask 在读取切片的内容时，需要根据切片的 metainfo ，获取到当前切片属于文件的哪部分，再根据此信息去寻找对应的块，读取数据。</li>
</ul>
<p><strong>建议：</strong></p>
<p><img src="/2021/02/19/MapReduce/image-20211202170551898.png" alt="image-20211202170551898"></p>
<ul>
<li><p>片大小最好等于块大小。</p>
<blockquote>
<p>  因为每个片都会启动一个对应的 MapTask 进程，每个 MapTask 进程只能运行在一台服务器上，如果片大小不等于块大小，比如片大小为100M，块大小为128M，那么一个 MapTask 进程就可能要跨节点加载数据，这时产生的网络IO和磁盘IO代价是非常大的。如果片大小等于块大小，就不会出现跨节点加载数据的过程，可以节省网络IO的时间。</p>
</blockquote>
</li>
<li><p>  MapReduce 程序速度慢的原因在于执行时，会频繁发生磁盘 IO 和网络 IO。比如在 map 阶段，需要先将磁盘中的文件读取到内存中进行运算，运算结束后还需要将阶段性的运算结果写出到磁盘上；这个运算结果还可能需要通过网络传输到集群中的其它节点上进行 reduce 阶段的运算，reduce 阶段同样需要把磁盘上的文件（map 阶段的运算结果文件）加载到内存中运算，运算结束后再将运算结果写出到磁盘上。</p>
</li>
<li><p>  将片大小设置为和块大小一致，可以最大限度减少因为切片带来的磁盘 IO 和网络 IO。</p>
</li>
</ul>
<hr>
<p><img src="/2021/02/19/MapReduce/image-20211202173603095.png" alt="image-20211202173603095"></p>
<hr>
<h2 id="CombineTextInputFormat切片机制"><a href="#CombineTextInputFormat切片机制" class="headerlink" title="CombineTextInputFormat切片机制"></a>CombineTextInputFormat切片机制</h2><p>框架默认的TextInputformat切片机制是对任务按文件规划切片，不管文件多小，都会是一个单独的切片，都会交给一个MapTask，这样如果有大量小文件，就会产生大量的MapTask，处理效率极其低下。</p>
<p><strong>一、应用场景：</strong></p>
<p><code>CombineTextInputFormat</code> 用于小文件过多的场景，它可以将多个小文件从逻辑上规划到一个切片中，这样，多个小文件就可以交给一个MapTask处理。</p>
<p><strong>二、虚拟存储切片最大值设置</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CombineTextInputFormat.setMaxInputSplitSize(job, <span class="number">4194304</span>);	<span class="comment">// 4m</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  虚拟存储切片最大值设置可以根据实际的小文件大小情况来设置具体的值。</li>
</ul>
<p><strong>三、切片机制</strong></p>
<p>生成切片过程包括：<strong>虚拟存储过程</strong>和<strong>切片过程</strong>两部分。</p>
<ol>
<li><p><strong>虚拟存储过程：</strong></p>
<ul>
<li>  （a）将输入目录下所有文件按照文件名称字典顺序一次读入，记录文件大小，并累加计算所有文件的总长度。</li>
<li>  （b）根据是否设置 <code>setMaxInputSplitSize</code> 值，将每个文件划分成一个一个 <code>setMaxInputSplitSize</code> 值大小的文件。</li>
<li>  （c）注意：当剩余数据大小超过 <code>setMaxInputSplitSize</code> 值且不大于2倍 <code>setMaxInputSplitSize</code> 值，此时将文件均分成2个虚拟存储块（防止出现太小切片）。</li>
<li>  例如 <code>setMaxInputSplitSize</code> 值为4M，最后文件剩余的大小为4.02M，如果按照4M逻辑划分，就会出现0.02M的小的虚拟存储文件，所以将剩余的4.02M文件切分成（2.01M和2.01M）两个文件。</li>
</ul>
</li>
<li><p><strong>切片过程：</strong></p>
<ul>
<li><p>  （a）判断虚拟存储的文件大小是否大于 <code>setMaxInputSplitSize</code> 值，大于等于则单独形成一个切片。</p>
</li>
<li><p>  （b）如果不大于则跟下一个虚拟存储文件进行合并，共同形成一个切片。</p>
</li>
<li><p>（c）测试举例：有4个小文件大小分别为1.7M、5.1M、3.4M以及6.8M这四个小文件，则虚拟存储之后形成6个文件块，大小分别为：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.7M，（2.55M、2.55M），3.4M以及（3.4M、3.4M）</span><br><span class="line"></span><br><span class="line">最终会形成3个切片，大小分别为：</span><br><span class="line"></span><br><span class="line">（1.7+2.55）M，（2.55+3.4）M，（3.4+3.4）M</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<hr>
<h2 id="CombineTextInputFormat-案例实操"><a href="#CombineTextInputFormat-案例实操" class="headerlink" title="CombineTextInputFormat 案例实操"></a>CombineTextInputFormat 案例实操</h2><ol>
<li><p>需求</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将输入的大量小文件合并成一个切片统一处理。</span><br><span class="line"></span><br><span class="line">（1）输入数据</span><br><span class="line">	准备4个小文件</span><br><span class="line">（2）期望</span><br><span class="line">	期望一个切片处理4个文件</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="InputFormat-数据输入"><a href="#InputFormat-数据输入" class="headerlink" title="InputFormat 数据输入"></a>InputFormat 数据输入</h1><h2 id="FileInputFormat-接口"><a href="#FileInputFormat-接口" class="headerlink" title="FileInputFormat 接口"></a>FileInputFormat 接口</h2><p>MapReduce 任务的输入文件一般都存储在 HDFS 里面。常见的输入文件格式包括：<strong>基于行的日志文件、二进制格式文件等</strong>。这些文件一般会很大，达到数十GB，甚至更大。那么MapReduce是如何读取这些数据的呢？下面我们首先学习 FileInputFormat 接口。</p>
<p>FileInputFormat 常见的接口实现类包括：</p>
<ul>
<li>  TextInputFormat</li>
<li>  KeyValueTextInputFormat</li>
<li>  NLineInputFormat</li>
<li>  CombineTextInputFormat</li>
<li>  自定义 InputFormat </li>
</ul>
<hr>
<h2 id="FileInputFormat-实现类"><a href="#FileInputFormat-实现类" class="headerlink" title="FileInputFormat 实现类"></a>FileInputFormat 实现类</h2><h3 id="TextInputFormat"><a href="#TextInputFormat" class="headerlink" title="TextInputFormat"></a>TextInputFormat</h3><ul>
<li><p>  使用场景：TextInputFormat 是默认的 InputFormat，常用于输入目录中全是文本文件的场景。</p>
</li>
<li><p>  切片策略：使用默认的切片策略。</p>
</li>
<li><p>RecordReader：使用的实现类是<code>LineRecordReader</code>，一次处理一行数据，以行头的偏移量为 key，该行内容作为 value。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LineRecordReader</span><br><span class="line">	LongWritable key	<span class="comment">// 存储该行在整个文件中的起始字节偏移量	</span></span><br><span class="line">	Text value	<span class="comment">// 该行的内容</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="NLineInputFormat"><a href="#NLineInputFormat" class="headerlink" title="NLineInputFormat"></a>NLineInputFormat</h3><ul>
<li><p>  使用场景：常用于输入目录中全是文本文件的场景。适合一行的内容特别多，在 Map 阶段 map() 的处理逻辑非常负责，可以根据行数自定义切片的大小。</p>
</li>
<li><p>  切片策略：以文件为单位，每 N 行作为一个切片。</p>
</li>
<li><p>RecordReader：使用的实现类是<code>LineRecordReader</code>，一次处理一行数据，以行头的偏移量为 key，该行内容作为 value。</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LineRecordReader</span><br><span class="line">	LongWritable key</span><br><span class="line">	Text value</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="KeyValueTextInputFormat"><a href="#KeyValueTextInputFormat" class="headerlink" title="KeyValueTextInputFormat"></a>KeyValueTextInputFormat</h3><ul>
<li><p>  使用场景：常用于输入目录中全是文本文件的场景。使用分隔字符，将每一行的内容分割为 key 和 value。如果没有找到分隔符，则以当前行的内容作为 key，value 为空串。默认的分隔符为 <code>\t</code>，可以通过参数<code>mapreduce.input.keyvaluelinerecordreader.key.value.separator</code> 显式指定分隔符。</p>
</li>
<li><p>  切片策略：使用默认的切片策略。</p>
</li>
<li><p>RecordReader：使用的实现类是 <code>KeyValueLineRecordReader</code></p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KeyValueLineRecordReader</span><br><span class="line">    Text key	分隔符之前的内容</span><br><span class="line">    Text value	分隔符之后的内容</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="CombineTextInputFormat"><a href="#CombineTextInputFormat" class="headerlink" title="CombineTextInputFormat"></a>CombineTextInputFormat</h3><p>框架默认的 <code>TextInputformat</code> 切片机制是以文件为单位，在文件内按照块大小对文件进行切片。也就是说不管文件多小，都会是一个单独的切片，都会交给一个 MapTask，这样如果有大量小文件，就会产生大量的 MapTask，处理效率极其低下。</p>
<ul>
<li><p>  应用场景：<code>CombineTextInputFormat</code> 改变了传统的切片方式，它将多个小文件划分到一个切片中，这样多个小文件就可以交给一个 MapTask 处理，适合小文件较多的场景。</p>
</li>
<li><p>  切片策略：多个小文件划分到一个切片中。根据 maxSize 对每个文件进行逻辑切片，切分为若干 part，将多个 part 组合，直到超过 maxSize，这些 part 作为一个切片。1hu</p>
</li>
<li><p>RecordReader：使用的实现类是<code>LineRecordReader</code>，一次处理一行数据，以行头的偏移量为 key，该行内容作为 value。</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LineRecordReader</span><br><span class="line">	LongWritable key</span><br><span class="line">	Text value</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="自定义-InputFormat-实现类"><a href="#自定义-InputFormat-实现类" class="headerlink" title="自定义 InputFormat 实现类"></a>自定义 InputFormat 实现类</h3><p>在开发中，Hadoop 框架自带的 InputFormat 类型并不能满足所有的应用场景，有时还需要通过自定义 InputFormat 来解决实际问题。</p>
<p>无论是 HDFS 还是 MapReduce，在处理小文件时效率都非常低，但又难免面临处理大量小文件的场景，此时，就需要有相应解决方案。可以自定义 InputFormat 实现小文件的合并。</p>
<p><strong>一、需求</strong></p>
<p>将多个小文件合并成一个 <code>SequenceFile</code> 文件（SequenceFile 文件是 Hadoop 用来存储二进制形式的 <code>key-value</code> 对的文件格式），SequenceFile 里面存储着多个文件，存储的形式为：<code>文件路径+文件名 = key</code>，<code>文件内容=value</code>。</p>
<p><img src="/2021/02/19/MapReduce/image-20211202202010080.png" alt="image-20211202202010080"></p>
<p><strong>二、需求分析</strong></p>
<ol>
<li>自定义一个类继承 FileInputFormat<ul>
<li>  （1）重写 <code>isSplitable()</code> 方法，返回 false 表示单个文件不可被切片</li>
<li>  （2）重写 <code>createRecordReader()</code> 方法，返回自定义的 RecordReader 对象。</li>
</ul>
</li>
<li>重写 RecordReader，实现一次读取一个完整的文件并按照一定的规则封装为<code>&lt;K,V&gt;</code>对象<ul>
<li>  （1）采用 IO 流一次读取一个完整的文件输出到 value 中。（因为设置了文件不可被切片，所以每次都会读取一整个文件封装到 value 中）</li>
<li>  （2）获取 <code>文件路径信息+名称</code>，作为 key </li>
</ul>
</li>
<li> 默认的输出格式是 <code>TextOutputFormat</code>（文本的输出格式），由于我们要将文件输出为 <code>SequenceFile</code> 文件，所以需要将最终的输出格式设置为<code>SequnceFileOutputFormat</code></li>
</ol>
<p><strong>三、程序实现</strong></p>
<hr>
<h2 id="关键设置"><a href="#关键设置" class="headerlink" title="关键设置"></a>关键设置</h2><p>如何设置 MapTask 的数量？</p>
<ul>
<li>  MapTask 的数量，人为设置是无效的，只能由切片数来决定。</li>
</ul>
<h1 id="Job-提交流程阶段总结"><a href="#Job-提交流程阶段总结" class="headerlink" title="Job 提交流程阶段总结"></a>Job 提交流程阶段总结</h1><h2 id="Job提交流程源码"><a href="#Job提交流程源码" class="headerlink" title="Job提交流程源码"></a>Job提交流程源码</h2><blockquote>
<p>  Job提交流程源码详解</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提交job</span></span><br><span class="line">waitForCompletion()</span><br><span class="line"></span><br><span class="line"><span class="comment">// --&gt;</span></span><br><span class="line">submit();</span><br><span class="line"></span><br><span class="line"><span class="comment">// --&gt;</span></span><br><span class="line"><span class="comment">// 1、建立连接</span></span><br><span class="line">connect();  </span><br><span class="line">    <span class="comment">// （1）加载配置，创建提交Job的代理</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cluster</span>(getConfiguration());</span><br><span class="line">    <span class="comment">// （2）判断是本地yarn还是远程</span></span><br><span class="line">    initialize(jobTrackAddr, conf); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、提交job</span></span><br><span class="line">submitter.submitJobInternal(Job.<span class="built_in">this</span>, cluster)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// （1）创建给集群提交数据的Stag路径</span></span><br><span class="line">  <span class="type">Path</span> <span class="variable">jobStagingArea</span> <span class="operator">=</span> JobSubmissionFiles.getStagingDir(cluster, conf);</span><br><span class="line">  <span class="comment">// （2）获取jobId ，并创建Job路径</span></span><br><span class="line">  <span class="type">JobID</span> <span class="variable">jobId</span> <span class="operator">=</span> submitClient.getNewJobID();</span><br><span class="line">  <span class="comment">// （3）拷贝jar包到集群</span></span><br><span class="line">  copyAndConfigureFiles(job, submitJobDir);  </span><br><span class="line">  rUploader.uploadFiles(job, jobSubmitDir);</span><br><span class="line">  <span class="comment">// （4）计算切片，生成切片规划文件</span></span><br><span class="line">  writeSplits(job, submitJobDir);</span><br><span class="line">  maps = writeNewSplits(job, jobSubmitDir);</span><br><span class="line">  input.getSplits(job);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// （5）向Stag路径写XML配置文件</span></span><br><span class="line">  writeConf(conf, submitJobFile);</span><br><span class="line">  conf.writeXml(out);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// （6）提交Job,返回提交状态</span></span><br><span class="line">  status = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials());</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="本地模式"><a href="#本地模式" class="headerlink" title="本地模式"></a>本地模式</h2><p>一、准备阶段</p>
<p>运行 <code>Job.waitForCompletion()</code>，先使用 JobSubmitter 提交 Job，在提交之前，会在 Job 的作业目录中生成以下信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">job.split: 当前Job的切片信息，有几个切片对象</span><br><span class="line">job.splitmetainfo: 切片对象的属性信息</span><br><span class="line">job.xml: job所有的属性配置</span><br></pre></td></tr></table></figure>



<p>二、提交阶段</p>
<ol>
<li><p>LocalJobRunner 进行提交</p>
<ul>
<li>  创建一个 LocalJobRunner.job()</li>
<li>  <code>Job.start()</code>   启动线程</li>
</ul>
</li>
<li><p>Map 阶段</p>
<ul>
<li>  采用线程池提交多个MapTaskRunable线程！</li>
<li>  每个MapTaskRunable线程上，实例化一个MapTask对象！</li>
<li>  每个MapTask对象，实例化一个Mapper!</li>
<li>  Mapper.run()</li>
<li>  线程运行结束，会在线程的作业目录中生成 file.out文件，保存MapTask输出的所有的key-value!</li>
</ul>
</li>
<li><p>Reduce 阶段</p>
<ul>
<li>  采用线程池提交多个ReduceTaskRunable线程！</li>
<li>  每个ReduceTaskRunable线程上，实例化一个ReduceTask对象！</li>
<li>  每个ReduceTask对象，实例化一个Reduce!</li>
<li>  reducer.run()</li>
<li>  线程运行结束，会在输出目录中生成 part-r-000x 文件，保存 ReduceTask 输出的所有的key-value!</li>
</ul>
<p>  阶段定义： </p>
<ul>
<li>  copy：使用 shuffle 线程拷贝 MapTask 对应分区中的数据！</li>
<li>  sort: 将拷贝的所有的分区的数据汇总后，排序</li>
<li>  reduce：对排好序的数据，进行合并！</li>
</ul>
</li>
</ol>
<hr>
<h1 id="Shuffle-机制"><a href="#Shuffle-机制" class="headerlink" title="Shuffle 机制"></a>Shuffle 机制</h1><p>MapReduce 为了确保 Reducer 阶段每个输入数据都是按 key 排序的，会执行多次排序的过程，这个阶段被称为 Shuffle 阶段。</p>
<p>从 Mapper 出去到 Reducer 接收之前全部都是 Shuffle 的范围。</p>
<h2 id="MapTask-工作机制"><a href="#MapTask-工作机制" class="headerlink" title="MapTask 工作机制"></a>MapTask 工作机制</h2><p><img src="/2021/02/19/MapReduce/image-20211203123841956.png" alt="image-20211203123841956"></p>
<p><strong>一、MapTask 的两个阶段（官方定义）</strong></p>
<p>MapTask 的执行过程大致可分为两个阶段：</p>
<ol>
<li> map 阶段：<code>Mapper.map()</code> 方法中在执行 <code>context.write(keyout, valueout)</code> 之前都属于 map 阶段；</li>
<li> sort 阶段：只有当存在 ReduceTask 时才会有 sort 阶段</li>
</ol>
<p><code>Mapper#map()</code> 方法是一个会循环执行的方法，在该方法中会调用 <code>context.write(keyout, valueout)</code> 方法将当前次处理的 <code>&lt;keyout. valueout&gt;</code> 写出到磁盘上。当然写出到磁盘上是最终目的，在真正执行的时候，肯定是先把一个个键值对对象先保存到一个缓冲区中，等到缓冲区快满的时候再写出到磁盘上。</p>
<p>每条记录在写入缓冲区时，会先调用<strong>分区器（Partitioner）</strong>为当前记录分配一个区号。</p>
<p>缓冲区中记录的顺序是按照进入缓冲区的先后时间来排序的，也就是说进入的越早，分配到的索引（index）就越小，第一个进入缓冲区的记录分配到的 index 就是 0，之后依次自增。</p>
<p>缓冲区也是一块内存，对于其中的每条记录，寻址方式就是偏移量。从缓冲区内存的开始位置起（偏移量从0开始），每条记录 key 的偏移量记为 <code>keystart</code>，值的偏移量记为 <code>valuestart</code>。</p>
<p>缓冲区中每条记录的数据格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">索引（序号）	分区号		 key偏移量		value偏移量	key的值	  value的值</span><br><span class="line">index		partition	keystart	  valuestart	  key		  value 		unsued</span><br></pre></td></tr></table></figure>

<p>缓冲区有两个线程，一个为收集线程，收集线程负责将Mapper写出的<code>&lt;K,V&gt;</code> 记录收集到缓冲区。另一个为溢写线程，溢写线程会在缓冲区已经占满了80%时被唤醒，唤醒后负责将缓冲区收集的数据溢写到磁盘。</p>
<p>一旦缓冲区满足了溢写条件后，会先对缓冲区中的所有数据进行一次排序。排序是按照 key 进行升序排序（数字大小升序或字典升序）。排序时，只对索引进行排序，而不会真实移动数据的位置。</p>
<p>排序完成之后，接下来就需要对数据进行溢写，溢写数据的时候会按照分区将数据写出到不同的区。每次溢写都会生成一个临时文件 <code>spillx.out</code>，在一次 MapReduce 中，可能会发生多次溢写（因为每次缓冲区快满的时候就会溢写一次），生成多个临时文件。当 map 阶段执行结束时，缓冲区中的最后一批数据会执行一次 flush（即使缓冲区没有达到要溢写的阈值）。</p>
<p>溢写结束后，会对生成的所有临时文件 <code>spillx.out</code> 执行一次 merge，将多个临时文件合并成一个最终结果。合并时，会将同一个分区的临时文件进行汇总，汇总后再进行排序，由于此时单个临时文件已经是有序的了，所以汇总之后的排序算法采用的是归并排序。在最终结果中，每个分区中的 <code>&lt;K,V&gt;</code> 记录都是有序的，并且会将最终文件写到 MapTask 所在机器磁盘上的某个文件中。等待 ReduceTask 的 Shuffle 线程来拷贝数据。</p>
<blockquote>
<p>  <strong>细节部分</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">① 先分区</span><br><span class="line"></span><br><span class="line">② 每次溢写前，都需要对缓冲区中的数据进行排序。</span><br><span class="line">	排序时，只排索引，不移动数据</span><br><span class="line">	使用的排序算法是快速排序</span><br><span class="line"></span><br><span class="line">③ 合并多个溢写临时文件为最终的文件时，先汇总后排序，排序算法使用归并排序</span><br></pre></td></tr></table></figure>





<hr>
<h2 id="Partition-分区"><a href="#Partition-分区" class="headerlink" title="Partition 分区"></a>Partition 分区</h2><p><strong>一、问题引出</strong></p>
<p>要求<strong>将统计结果按照条件输出到不同的文件中</strong>（分区），比如：将统计结果按照手机归属地不同省份输出到不同文件中。</p>
<p>二、默认 Partition 分区</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashPartitioner</span>&lt;K2, V2&gt; <span class="keyword">implements</span> <span class="title class_">Partitioner</span>&lt;K2, V2&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(K2 key, V2 value, <span class="type">int</span> numReduceTasks)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (key.hashCode() &amp; <span class="number">2147483647</span>) % numReduceTasks;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  默认分区是根据 key 的 hashCode 对 ReduceTasks 个数取模得到的。</li>
</ul>
<p><strong>三、自定义 Partition 步骤</strong></p>
<ol>
<li><p>自定义实现类继承 Partitioner，重写 <code>getPartition</code> 方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPartitioner</span> <span class="keyword">extends</span> <span class="title class_">Partitioner</span>&lt;Text, FlowBean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(Text text, FlowBean flowBean, <span class="type">int</span> numPartitions)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO 控制分区的代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>在 Job 驱动中，将分区器置换为自定义的 Partitioner</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setPartitionerClass(MyPartitioner.class);</span><br></pre></td></tr></table></figure>

</li>
<li><p>自定义 Partition 后，要根据自定义 Partitioner 的逻辑设置相应数量的 ReduceTask</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setNumReduceTasks(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>四、小总结</strong></p>
<ol>
<li> 如果 <code>ReduceTask的数量 &gt; getPartition的结果数</code>，则会多产生几个空的输出文件 <code>part-r-000xx</code>；</li>
<li> 如果 <code>1 &lt; ReduceTask的数量 &lt; getPartitioner的结果数</code>，则会有一部分数据无处安放，会抛出 Exception；</li>
<li> 如果 <code>ReduceTask的数量=1</code>，则不管 MapTask 端输出多少个分区文件，最终结果都会交给这一个 ReduceTask，最终也就只会产生一个结果文件 <code>part-r-0000</code>。</li>
</ol>
<hr>
<h3 id="案例实操"><a href="#案例实操" class="headerlink" title="案例实操"></a>案例实操</h3><hr>
<h2 id="WriteComparable-排序"><a href="#WriteComparable-排序" class="headerlink" title="WriteComparable 排序"></a>WriteComparable 排序</h2><h3 id="排序概述"><a href="#排序概述" class="headerlink" title="排序概述"></a>排序概述</h3><p>排序是 MapReduce 框架中最重要的操作之一。</p>
<p>MapTask 和 ReduceTask 均会对数据按照 key 进行排序。该操作属于 Hadoop 的默认行为。任何应用程序中的数据均会被排序，而不管逻辑上是否需要。</p>
<p>默认排序方式是按照字典顺序排序，且实现该排序的方法是快速排序。</p>
<p>对于 MapTask，它会将处理的结果暂时放到一个缓冲区中，当缓冲区使用率达到一定阈值后（溢写阈值），再对缓冲区中的数据进行一次排序，并将这些有序数据写到磁盘上，而当数据处理完毕后，它会对磁盘上所有文件进行一次合并，以将这些文件合并成一个大的有序文件。</p>
<p>对于 ReduceTask，它从每个 MapTask 所在的服务器上远程拷贝相应的数据文件，如果文件大小超过一定阈值，则放到磁盘上，否则放到内存中。如果磁盘上文件数目达到一定阈值，则进行一次合并以生成一个更大的文件；如果内存中文件大小或数目超过一定阈值，则进行一次合并后将数据写到磁盘上。当所有数据拷贝完毕后，ReduceTask 统一对内存和磁盘上的所有数据进行一次归并排序。</p>
<hr>
<h3 id="排序分类"><a href="#排序分类" class="headerlink" title="排序分类"></a>排序分类</h3><p>一、部分排序</p>
<p>MapReduce 根据输入记录的键对数据集排序，保证输出的每个文件内部有序。</p>
<p>二、全排序</p>
<p>最终输出结果只有一个文件，且文件内部有序。实现方式是只设置一个 ReduceTask。但该方法在处理大型文件时效率极低，因为一台机器处理所有文件，完全丧失了 MapReduce 所提供的并行架构。</p>
<p>三、辅助排序</p>
<p>四、二次排序</p>
<hr>
<h3 id="自定义排序"><a href="#自定义排序" class="headerlink" title="自定义排序"></a>自定义排序</h3><p><strong>一、原理</strong></p>
<p>bean 对象实现 <code>WritableComparable</code> 接口，重写接口中的 <code>compareTo</code> 方法，就可以实现自定义排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(FlowBean o)</span> &#123;</span><br><span class="line">	<span class="comment">// 倒序排列，从大到小</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="Combiner-合并"><a href="#Combiner-合并" class="headerlink" title="Combiner 合并"></a>Combiner 合并</h2><ol>
<li> Combiner 是 MR 程序中 Mapper 和 Reducer 之外的另一种组件；</li>
<li> Combiner 组件的父类就是 Reducer；</li>
<li>Combiner 和 Reducer 的区别在于运行的位置：<ul>
<li>  Reducer 是在 reduce 阶段调用，Combiner 是在 shuffle 阶段调用；</li>
<li>  Combiner 是在每一个 MapTask 所在的节点运行；</li>
<li>  Reducer 是接收全局所有 Mapper 的输出结果。</li>
<li>  Combiner 和 Reducer 本质上都是 Reducer 类，作用都是对有相同 key 的 <code>&lt;K,V&gt;</code> 进行合并。 </li>
</ul>
</li>
<li> Combiner 的意义就是对每一个 MapTask 的输出结果进行局部汇总，以减少网络传输量。</li>
<li> Combiner 能够应用的前提是不影响最终的业务逻辑，而且，Combiner 的输出 <code>&lt;K,V&gt;</code> 应该和 Reducer 的输入 <code>&lt;K,V&gt;</code> 类型对应起来。</li>
</ol>
<h3 id="自定义-Combiner-实现步骤"><a href="#自定义-Combiner-实现步骤" class="headerlink" title="自定义 Combiner 实现步骤"></a>自定义 Combiner 实现步骤</h3><ol>
<li><p>自定义一个 Combiner 继承 Reducer，重写 reduce 方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCombiner</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 汇总操作</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(IntWritable v :values)&#123;</span><br><span class="line">			count += v.get();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写出</span></span><br><span class="line">        context.write(key, <span class="keyword">new</span> <span class="title class_">IntWritable</span>(count));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>在 Job 驱动类中设置</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setCombinerClass(MyCombiner.class);</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="GroupingComparator分组（辅助排序）"><a href="#GroupingComparator分组（辅助排序）" class="headerlink" title="GroupingComparator分组（辅助排序）"></a>GroupingComparator分组（辅助排序）</h2><p>对Reduce阶段的数据根据某一个或几个字段进行分组。</p>
<h3 id="GroupingComparator分组案例实操"><a href="#GroupingComparator分组案例实操" class="headerlink" title="GroupingComparator分组案例实操"></a>GroupingComparator分组案例实操</h3><hr>
<p>移动计算而不是移动数据【目的：减少磁盘IO和网络IO】</p>
<blockquote>
<p>  Shuffle 阶段数据发生了关键的变化：</p>
</blockquote>
<ol>
<li> 从 Mapper 出去的 &lt;K，V&gt; 值是无序的，而到了 Reducer 中数据则是有分组的。 也就是说，在 Shuffle 阶段会将数据整理、分组。</li>
<li> Mapper 出来的数据是无序的，在 Shuffle 阶段首先对数据进行排序，排完序之后，相等的数据就挨在一起了，再进行分组就相对容易了。</li>
<li>排序方法：快排 + 归并<ul>
<li>  对于快速排序来说，需要将所有的数据全部加载进内存中然后再进行比较；但是对于大数据而言，显然是不合理的。所以会先将大数据的切分，对每一块数据进行快排。</li>
<li>  然后再将多个有序块再进行归并排序。</li>
</ul>
</li>
<li> 数据会被分片（逻辑上），每一个片对应一个 MapTask 。每个 MapTask 都会进行排序，最终形成一个归并排序后的有序数据块，这些数据块最终又会汇总到一个 Reducer 中。Reducer 在拿到多个有序文件后，再进行一次归并让多个有序文件变成一个有序文件，最终输入到 Reducer 中。</li>
<li> 这就是 Shuffle 阶段如何把数据进行排序、分组的过程。</li>
</ol>
<ul>
<li>三次排序：<ol>
<li> 快排</li>
<li> 归并</li>
<li> 再次归并</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/10/Hadoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/02/10/Hadoop/" class="post-title-link" itemprop="url">Hadoop理论基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-10 10:49:09" itemprop="dateCreated datePublished" datetime="2021-02-10T10:49:09+08:00">2021-02-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-12-14 16:52:33" itemprop="dateModified" datetime="2021-12-14T16:52:33+08:00">2021-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="大数据"><a href="#大数据" class="headerlink" title="大数据"></a>大数据</h1><blockquote>
<p>大数据（Big Data）：</p>
</blockquote>
<p>大数据指<strong>无法在一定时间范围内</strong>用常规软件工具进行捕捉、管理和处理的数据集合。是需要新处理模式才能具有更强的决策力、洞察发现力和流程优化能力的<strong>海量、高增长率和多样化的信息资产</strong>。</p>
<ul>
<li><strong>多样化</strong>：传统的数据库如 MySQL 只能处理结构化的数据类型，而大数据不仅可以处理结构化的数据，还可以处理非结构化、半结构化的数据。</li>
</ul>
<blockquote>
<p>大数据技术/大数据框架：</p>
</blockquote>
<p>主要解决，海量数据的<strong>存储</strong>和海量数据的<strong>分析计算</strong>问题。</p>
<blockquote>
<p>大数据特点：</p>
</blockquote>
<ol>
<li><p>Volume（大量）  </p>
</li>
<li><p>Velocity（高速）</p>
</li>
<li><p>Variety（多样）</p>
</li>
<li><p>Value（低价值密度）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">因为低价值密度的特点，所以需要：</span><br><span class="line">    （1）我们的计算机有足够好的算力；</span><br><span class="line">    （2）优良的算法。</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h1><blockquote>
<p>Hadoop 设计的初衷是采用大量廉价的机器，组成一个集群！完成大数据的存储和计算！[通过数量的堆叠来提高算力]</p>
</blockquote>
<h2 id="Hadoop-是什么"><a href="#Hadoop-是什么" class="headerlink" title="Hadoop 是什么"></a>Hadoop 是什么</h2><ul>
<li>Hadoop 是一个由 Apache 基金会所开发的<strong>分布式系统基础架构</strong>。【分布式 ==&gt; 多台机器】</li>
<li>主要解决，海量数据的<strong>存储</strong>和海量数据的<strong>分析计算</strong>问题。</li>
<li>狭义上来说，单指 Hadoop 技术。</li>
<li>广义上来说，Hadoop 通常是指一个更广泛的概念——<strong>Hadoop 生态圈</strong></li>
</ul>
<p><img src="/2021/02/10/Hadoop/image-20210210110619991.png" alt="image-20210210110619991"></p>
<hr>
<h2 id="Hadoop-的优点（4高）"><a href="#Hadoop-的优点（4高）" class="headerlink" title="Hadoop 的优点（4高）"></a>Hadoop 的优点（4高）</h2><ol>
<li><p><strong>高可靠性</strong></p>
<p> Hadoop 底层维护多个数据副本，所以即使某个存储节点出现故障（即使 Hadoop 集群中的某个数据副本所在的节点出现故障），也不会导致数据的丢失。</p>
<p> 而且 Hadoop 会实时动态的监测集群中的节点数量，如果集群中的某个节点发生故障导致副本数小于集群预设的副本数，那么 Hadoop 就会自动创建一个新的副本，维护副本数量等于预设的副本数量。</p>
</li>
<li><p><strong>高扩展性</strong></p>
<p> 在集群间分配任务数据，可方便的扩展数以千计的节点。</p>
<p> 在处理数据时如果发现集群中的节点不够使用了，可以很方便的增加一些节点扩展整个 Hadoop 集群。</p>
</li>
<li><p><strong>高效性</strong></p>
<p> 在 MapReduce 的思想下，Hadoop 是并行工作的，通过多台机器数量的堆叠来提高算力，以加快任务处理速度。</p>
</li>
<li><p><strong>高容错性</strong></p>
<p> 能够自动将失败的任务重新分配。</p>
<p> Hadoop 在 Map 阶段会将大的任务分成若干个小的任务进行运算，如果在运算过程中某个小的任务因某些不可抗力因素发生失败，那么 Hadoop  就会重新分配一个线程来运行未成功的任务，直至成功。</p>
</li>
</ol>
<hr>
<h2 id="Hadoop-组件"><a href="#Hadoop-组件" class="headerlink" title="Hadoop 组件"></a>Hadoop 组件</h2><p><img src="/2021/02/10/Hadoop/image-20210210111631179.png" alt="image-20210210111631179"></p>
<ul>
<li>在 Hadoop1.x 时代，Hadoop 中的 MapReduce 同时负责业务运算和资源调度，耦合性较大；</li>
<li><strong>在 Hadoop2.x 时代，增加了 Yarn 。Yarn 只负责资源的调度，MapReduce 只负责运算。</strong></li>
</ul>
<h3 id="Hadoop-1-0"><a href="#Hadoop-1-0" class="headerlink" title="Hadoop 1.0"></a>Hadoop 1.0</h3><ul>
<li><strong>HDFS</strong>：负责存储数据</li>
<li><strong>Common</strong>：Hadoop 中常用工具包的模块。</li>
<li><strong>MapReduce</strong>：1️⃣编程模型；2️⃣负责计算资源的申请和调度。</li>
</ul>
<h3 id="Hadoop-2-0"><a href="#Hadoop-2-0" class="headerlink" title="Hadoop 2.0"></a>Hadoop 2.0</h3><ul>
<li><strong>HDFS</strong>：负责存储数据</li>
<li><strong>Common</strong>：Hadoop 中常用工具包的模块。</li>
<li><strong>YARN</strong>：只负责资源调度。[只有在计算时才会用到 YRAN ，因为在计算时需要申请软、硬件资源，都是由 YARN 统一分配的]</li>
<li><strong>MapReduce</strong>（编程模型）：使用 Hadoop 制定的编程规范要求，来编写程序，完成大数据的计算。</li>
</ul>
<h3 id="Hadoop-1-x-和-Hadoop-2-x-的区别"><a href="#Hadoop-1-x-和-Hadoop-2-x-的区别" class="headerlink" title="Hadoop 1.x 和 Hadoop 2.x 的区别"></a>Hadoop 1.x 和 Hadoop 2.x 的区别</h3><ul>
<li>  在 1.x 版本中，MapReduce 模块既负责规定 MR 程序规范还负责为 MR 程序申请运算资源，<strong>运算和资源申请是硬绑定的</strong>，所以 Hadoop 只能为符合 MR 编程规范的程序提供服务！</li>
<li>  在 2.x 版本中，MR 只负责 MR 程序的计算，资源的调度和管理由 YARN 负责！Hadoop 集群不仅能为自身的 MR 程序提供服务，还可以集成第三方计算引擎，例如 TeZ，Spark，Flink 等提供计算资源的调度服务！</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">完成Java程序运行 vs. 完成大数据的计算</span><br><span class="line"></span><br><span class="line">1、写程序，程序需要符合计算框架的要求！</span><br><span class="line">		java----&gt;main-----&gt;运行</span><br><span class="line">		MapReduce(编程模型)-----&gt;Map--Reducer</span><br><span class="line">2、运行程序，申请计算资源（软、硬件资源）</span><br><span class="line">		java-----&gt;JVM------&gt;OS-----&gt;申请计算资源</span><br><span class="line">		1.0: MapReduce(编程模型)----&gt;JobTracker-----&gt;JVM-----&gt;申请计算资源</span><br><span class="line">		2.0: MapReduce(编程模型)----&gt;jar------&gt;运行时，将jar包中的任务，提交给YARN，和YARN进行通信，由YARN中的组件-----&gt;JVM------&gt;申请计算资源</span><br><span class="line">				</span><br><span class="line">	1.x和2.x的区别是将资源调度和管理进行分离！由统一的资源调度平台YARN进行大数据计算资源的调度！</span><br><span class="line">    提升了Hadoop的通用性！Hadoop搭建的集群中的计算资源，不仅可以运行 Hadoop 中的 MR 程序！</span><br><span class="line">    也可以运行其他计算框架的程序！</span><br><span class="line">	在hadoop不久之后，由于MR的低效性，出现了许多更为高效的计算框架！</span><br><span class="line">	例如： Tez，Storm,Spark，Flink</span><br></pre></td></tr></table></figure>



<ol>
<li> <strong>编写代码</strong>。MapReduce 是一种编程规范，是一种编写代码的标准，如果想要我们写的程序能在 Hadoop 上运行就需要让自己编写的程序符合 MR 规范。</li>
<li> <strong>打成 jar 包</strong>。我们编写好了符合 MapReduce 规范的程序后（其实也就是 Java 程序），就会把这个程序打成 jar 包。这个 jar 包就是需要执行的任务的描述，在执行任务时，需要把 jar 包提交给 Yarn 由 Yarn 中的 ResourceManager 调度资源来执行这个 jar 包中的程序。</li>
</ol>
<hr>
<h1 id="HDFS-概述"><a href="#HDFS-概述" class="headerlink" title="HDFS 概述"></a>HDFS 概述</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2021/02/08/HDFS/">HDFS 详情页链接</a></p>
</blockquote>
<p>HDFS（Hadoop Distribute File System）：负责存储数据。</p>
<p><img src="/2021/02/10/Hadoop/HDFS%20%E6%A0%B8%E5%BF%83%E8%BF%9B%E7%A8%8B.png" alt="HDFS 核心进程"></p>
<h2 id="1、NameNode"><a href="#1、NameNode" class="headerlink" title="1、NameNode"></a>1、NameNode</h2><p>HDFS 是一个分布式文件存储系统，所谓的分布式，就是多台机器。我们知道在大数据环境下数据量能轻易达到 TB、PB 级别，如果想要在单台机器上存储这么多的数据是不实际的，所以就衍生出了分布式文件存储系统，将非常大的数据切割成多份小的数据，分别保存在不同的服务器上。</p>
<p>举个例子就是说如果一个文件大小为 1TB，但是目前提供的所有机器最大存储量都是 500GB，那么如果想要对该大文件进行存储，就必须对大文件进行分割，比如使用 ABC 三台机器，A机器存第 0<del>300GB 的数据，B机器存第 300</del>600GB 的数据，C机器存第 600~1000GB 的数据，这样就成功解决了大文件的存储问题。</p>
<p>但是解决了存储问题后，我们还必须解决数据访问的问题。如果我们若想访问该文件中的某一部分数据，那么我们首先就要定位到这部分数据存储在哪台机器上，在分布式文件存储系统中，一定会有一个文件中保存了该系统中所有数据的分布情况信息，那么保存该文件的节点就叫做 <strong>NameNode</strong>，这个文件中保存的信息就叫做<strong>元数据</strong>。</p>
<p><strong>概念：</strong></p>
<ul>
<li>  NameNode（nn）：负责存储文件的<strong>元数据</strong>。</li>
<li>  <strong>元数据</strong>：文件的属性信息。如<strong>文件名、文件目录结构、文件属性</strong>（生成时间、副本数、文件权限），以及每个文件的<strong>块列表</strong>和<strong>块所在的DataNode</strong> 等。</li>
</ul>
<p><strong>职责：</strong></p>
<ol>
<li>接收客户端的请求，根据元数据信息将请求转发给对应的 DN。</li>
<li>接收 DN 的请求，实时更新元数据信息。[DN 会向 NN 上报当前节点中数据的变化情况]</li>
<li>向 DN 分配任务。</li>
</ol>
<hr>
<h2 id="2、DataNode"><a href="#2、DataNode" class="headerlink" title="2、DataNode"></a>2、DataNode</h2><p><strong>概念：</strong></p>
<ul>
<li>  DataNode（dn）：负责文件中数据的存储。</li>
<li>  在本地文件系统中<strong>存储文件块数据</strong>，以及<strong>块数据的校验和</strong>。</li>
</ul>
<p><strong>职责：</strong></p>
<ol>
<li>负责接收 NM 分配的任务。</li>
<li>负责数据块（block）的管理（读、写）</li>
</ol>
<hr>
<h2 id="3、SecondaryNameNode"><a href="#3、SecondaryNameNode" class="headerlink" title="3、SecondaryNameNode"></a>3、SecondaryNameNode</h2><p><strong>概念：</strong></p>
<ul>
<li>  SecondaryNameNode（2nn）：负责辅助 NameNode 工作！</li>
<li>  <strong>每隔一段时间对NameNode元数据备份</strong>。</li>
</ul>
<hr>
<h1 id="MapReduce-概述"><a href="#MapReduce-概述" class="headerlink" title="MapReduce 概述"></a>MapReduce 概述</h1><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://lvnengdong.github.io/2021/02/19/MapReduce/">MapReduce详解</a></p>
</blockquote>
<p>MapReduce 是一种<strong>编程规范</strong>，将程序的运行划分成两个阶段，一个称为 Map 阶段，另一个称为 Reduce 阶段。在 Map 阶段和 Reduce 阶段分别启动多个进程负责程序的运算，这些进程称为 Task。在 Map 阶段启动的 Task 称为 MapTask，在 Reduce 阶段启动的 Task 称为 ReduceTask。</p>
<p><strong>一个符合 MapReduce 编程规范的程序被称为一个 Job，执行一个 Job 时会使用多个 Task。</strong>Job 就是一段任务代码，描述了任务应该怎么做，而 Task 则是一些线程，用于真正地执行 Job。</p>
<blockquote>
<p>  Job：任务</p>
<p>   Task：进程</p>
<p>  MRAppMaster：MapReduce 应用管理者，进程</p>
</blockquote>
<ul>
<li>遵循 MapReduce 编程规范编写的程序，打包后，被称为一个 <strong>Job</strong>。</li>
<li>Job 需要提交到 YARN 上，向 YARN 申请计算资源，分配 Task 执行 Job 。</li>
<li>在开始执行 Job 时，会先创建一个 MRAppMaster 进程，由这个进程和 ResourceManager 进行通信，为 Job 中的每个 Task 申请计算所需的资源。</li>
<li>Task 的请求，会被 ResourceManager 缓存到一个调度队列中，由 NodeManager 领取 Task，领取后 NodeManager 会根据 Task 的要求，提供计算资源；提供后，为了避免计算资源在当前 Task 使用时被其它的 Task 抢占，NodeManager 会将已分配的计算资源封装到一个容器（Container）中。Container 可以对计算资源进行隔离。</li>
<li>MrAppMaster 还负责监控 Job 中各个 Task 运行情况，进行容错管理！</li>
</ul>
<p>要求程序中有 Mapper（简单处理） 和 Reducer（合并）。</p>
<p>MapReduce将计算过程分为两个阶段：Map和Reduce</p>
<ul>
<li>Map阶段并行处理输入数据</li>
<li>Reduce阶段对Map结果进行汇总</li>
</ul>
<hr>
<h1 id="Yarn-架构概述"><a href="#Yarn-架构概述" class="headerlink" title="Yarn 架构概述"></a>Yarn 架构概述</h1><p>Yarn 负责集群中所有计算资源的管理和调度。</p>
<p>MapReduce 程序会被提交给 Yarn 中的 ResourceManager 上，相当于把一个计算任务交给 的 ResourceManager，ResourceManager 对于 MapReduce 而言就是一个黑盒，ResourceManager 怎么处理 MapReduce 不管</p>
<p>实际上 ResourceManager 在收到了 MapReduce 任务后，会把任务下发给 NodeManager 去执行，ResourceManager 自己是不会真正去执行这个任务的</p>
<p><strong>核心进程</strong></p>
<blockquote>
<ol>
<li>ResourceManager（1个）：负责整个集群上所有资源的管理调度</li>
</ol>
</blockquote>
<ul>
<li>职责<ol>
<li>接收客户端提交的 Job 任务，</li>
<li>向  NM 分配任务。</li>
<li>接收 NM 上报的资源信息。</li>
</ol>
</li>
</ul>
<blockquote>
<ol start="2">
<li>NodeManager（N个）：负责单台计算机上所有资源的管理调度</li>
</ol>
</blockquote>
<ul>
<li>职责：<ol>
<li>负责和 RM 进行通信，上报本机中的可用资源</li>
<li>负责领取 RM 分配的任务！</li>
<li>负责为 Job 中的每个 Task 分配计算资源！</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">计算资源：内存、CPU、硬盘等等。</span><br><span class="line"></span><br><span class="line">1、NM 负责单台计算机所有计算资源的管理调度。	</span><br><span class="line">	* 即 NM 会统计出当前计算机已经使用了多少计算资源，还剩多少资源。</span><br><span class="line">2、RM 负责整个集群所有计算资源的管理调度。	</span><br><span class="line">	* 即每台 NM 统计出自己已使用和可使用的计算资源后，都会上报给 RM 。</span><br><span class="line">	* RM 接收并统计集群中所有已使用和可使用计算资源。	</span><br><span class="line">	* 这样当客户端提交 Job 请求时，RM 就可宏观调控根据需求分配具体的计算资源到每台机器上。 </span><br></pre></td></tr></table></figure>



<p><strong>概念</strong>：</p>
<blockquote>
<p>Container（容器）：</p>
</blockquote>
<p>比如：NodeManager 为 Job 的某个 Task 分配了 2 个 CPU 和 2G 内存的计算资源！</p>
<p>为了防止当前 Task 在使用这些资源期间，被其它的 Task 抢占资源。 NodeManager 就会将这些计算资源，封装到一个 Container 中，在 Container 中的资源，会被暂时隔离，无法被其它进程所抢占。</p>
<p>当前 Task 运行结束后，当前 Container 中的资源才会被释放！允许其它 task 来 使用！</p>
<p><img src="/2021/02/10/Hadoop/image-20210210113413297.png" alt="image-20210210113413297"></p>
<blockquote>
<ol>
<li>ResourceManager（RM）</li>
</ol>
</blockquote>
<ol>
<li>处理客户端请求</li>
<li>监控NodeManager</li>
<li>启动或监控ApplicationMaster</li>
<li>资源的分配与调度</li>
</ol>
<blockquote>
<ol start="2">
<li>NodeManager（NM）</li>
</ol>
</blockquote>
<ol>
<li>管理单个节点上的资源</li>
<li>处理来自ResourceManager的命令</li>
<li>处理来自ApplicationMaster的命令</li>
</ol>
<blockquote>
<ol start="3">
<li>ApplicationMaster（AM）</li>
</ol>
</blockquote>
<ol>
<li>负责数据的切分</li>
<li>为应用程序申请资源并分配给内部的任务</li>
<li>任务的监控与容错</li>
</ol>
<blockquote>
<ol start="4">
<li>Container</li>
</ol>
</blockquote>
<p>Container 是YARN中的资源抽象，它封装了某个节点上的多维度资源，<strong>如内存、CPU、磁盘、网络等</strong>。</p>
<hr>
<h1 id="大数据技术生态体系"><a href="#大数据技术生态体系" class="headerlink" title="大数据技术生态体系"></a>大数据技术生态体系</h1><p><img src="/2021/02/10/Hadoop/image-20210210114157414.png" alt="image-20210210114157414"></p>
<p>图中涉及的技术名词解释如下：</p>
<ol>
<li>Sqoop：Sqoop 是一款开源的工具，主要用于在 Hadoop、Hive 与传统的数据库（MySql）间进行数据的传递，可以将一个关系型数据库（例如 ：MySQL，Oracle 等）中的数据导进到 Hadoop 的 HDFS 中，也可以将 HDFS 的数据导进到关系型数据库中。</li>
<li>Flume：Flume 是一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，Flume 支持在日志系统中定制各类数据发送方，用于收集数据； </li>
<li>Kafka：Kafka 是一种高吞吐量的分布式发布订阅消息系统； </li>
<li>Storm：Storm 用于“连续计算”，对数据流做连续查询，在计算时就将结果以流的形式输出给用户。</li>
<li>Spark：Spark 是当前最流行的开源大数据内存计算框架。可以基于 Hadoop 上存储的大数据进行计算。</li>
<li>Flink：Flink 是当前最流行的开源大数据内存计算框架。用于实时计算的场景较多。</li>
<li>Oozie：Oozie 是一个管理 Hdoop 作业（job）的工作流程调度管理系统。</li>
<li>Hbase：HBase 是一个分布式的、面向列的开源数据库。HBase 不同于一般的关系数据库，它是一个适合于非结构化数据存储的数据库。</li>
<li>Hive：Hive 是基于 Hadoop 的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的 SQL 查询功能，可以将 SQL 语句转换为 MapReduce 任务进行运行。 其优点是学习成本低，可以通过类 SQL 语句快速实现简单的 MapReduce 统计，不必开发专门的 MapReduce 应用，十分适合数据仓库的统计分析。</li>
<li>ZooKeeper：它是一个针对大型分布式系统的可靠协调系统，提供的功能包括：配置维护、名字服务、分布式同步、组服务等。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
